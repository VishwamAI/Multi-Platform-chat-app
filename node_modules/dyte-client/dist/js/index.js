"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("react-redux"),n=require("@reduxjs/toolkit"),r=require("uuid"),i=require("@chakra-ui/react"),o=require("logrocket"),a=require("graphql-hooks"),l=require("@styled-icons/material-rounded");require("@styled-icons/boxicons-logos");var c=require("@styled-icons/styled-icon"),s=require("bowser"),u=require("@chakra-ui/theme-tools"),d=require("axios"),f=require("events"),p=require("@dyteinternals/callstats"),m=require("@dyteinternals/callstats/dist/types"),h=require("classnames"),g=require("hark"),v=require("@emotion/react"),y=require("@dytesdk/mediasoup-client"),b=require("socket.io-client"),E=require("react-dom"),S=require("react-shadow/emotion"),w=require("i18next"),x=require("react-i18next"),C=require("framer-motion"),_=require("react-hook-form"),k=require("hotkeys-js"),I=require("react-intersection-observer");function T(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function P(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var A=T(e),O=P(e),D=T(o),N=T(s),R=T(d),M=T(f),L=T(h),z=T(g),B=T(b),F=T(E),j=T(S),V=T(w),W=T(k),q=T(I),H=function(e,t){return(H=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function U(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}H(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var G,J=function(){return(J=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function Y(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function K(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function l(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}c((r=r.apply(e,t||[])).next())}))}function Z(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(o){return function(l){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}}function Q(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}var X,$,ee,te,ne=n.createAction("session/join-room"),re=n.createAction("websocket/room-state"),ie=n.createAction("websocket/peer-joined"),oe=n.createAction("websocket/peer-closed"),ae=n.createAction("session/reset-peers"),le=n.createAction("websocket/get-page"),ce=n.createAction("websocket/selected-peers"),se=n.createAction("websocket/peer-muted"),ue=n.createAction("websocket/peer-visibility"),de=n.createAction("websocket/peer-unmuted"),fe=n.createAction("session/set-peer-video-transform"),pe=n.createAction("websocket/peer-added-to-stage"),me=n.createAction("websocket/peer-rejected-to-join-stage"),he=n.createAction("websocket/peer-removed-from-stage"),ge=n.createAction("websocket/peer-started-presenting"),ve=n.createAction("websocket/peer-stopped-presenting"),ye=n.createAction("session/all-peer-visibility"),be=n.createAction("session/switch-webinar"),Ee=n.createAction("websocket/metadata-update"),Se=n.createAction("session/peer-label"),we=n.createReducer({joinedPeers:[],currentPagePeerIds:[],activeSpeakerPagePeerIds:[],recordingPeer:null,videoTransforms:{}},((G={})[ae.toString()]=function(e){e.joinedPeers=[],e.recordingPeer=null},G[le.toString()]=function(e,t){e.currentPagePeerIds=Q([],t.payload.peerIds,!0)},G[ce.toString()]=function(e,t){e.activeSpeakerPagePeerIds=Q([],t.payload.peerIds,!0)},G[ne.toString()]=function(e,t){var n=t.payload.peers;e.recordingPeer=n?n.find((function(e){var t;return null===(t=e.flags)||void 0===t?void 0:t.recorder})):null,e.joinedPeers=n?n.filter((function(e){var t;return!(null===(t=e.flags)||void 0===t?void 0:t.recorder)})):[]},G[re.toString()]=function(e,t){var n=t.payload.roomState.peers;e.recordingPeer=n?n.find((function(e){var t;return null===(t=e.flags)||void 0===t?void 0:t.recorder})):null,e.joinedPeers=n?n.filter((function(e){var t;return!(null===(t=e.flags)||void 0===t?void 0:t.recorder)})):[]},G[ie.toString()]=function(e,t){var n,r=t.payload;(null===(n=r.flags)||void 0===n?void 0:n.recorder)?e.recordingPeer=r:e.joinedPeers=e.joinedPeers.filter((function(e){return e.id!==r.id})).concat(r)},G[oe.toString()]=function(e,t){var n,r=t.payload;(null===(n=e.recordingPeer)||void 0===n?void 0:n.id)===r.id?e.recordingPeer=null:e.joinedPeers=e.joinedPeers.filter((function(e){return e.id!==r.id}))},G[ue.toString()]=function(e,t){var n=e.joinedPeers.find((function(e){return e.id===t.payload.peerId}));n&&(n.hiddenParticipant=t.payload.visibility,e.joinedPeers=e.joinedPeers.filter((function(e){return e.id!==n.id})).concat([J({},n)]))},G[ye.toString()]=function(e,t){e.joinedPeers=e.joinedPeers.map((function(e){return e.flags.recorder||(e.hiddenParticipant=t.payload.hidden),e}))},G[se.toString()]=function(e,t){var n=e.joinedPeers.find((function(e){return e.id===t.payload.peerId}));n&&(n.audioMuted=!0,e.joinedPeers=e.joinedPeers.filter((function(e){return e.id!==n.id})).concat([J({},n)]))},G[de.toString()]=function(e,t){var n=e.joinedPeers.find((function(e){return e.id===t.payload.peerId}));n&&(n.audioMuted=!1,e.joinedPeers=e.joinedPeers.filter((function(e){return e.id!==n.id})).concat([J({},n)]))},G[fe.toString()]=function(e,t){e.videoTransforms[t.peerId]=t.transform},G[pe.toString()]=function(e,t){var n=e.joinedPeers.find((function(e){return e.id===t.payload.id}));n&&(n.requestToJoinType=t.payload.requestToJoinType,e.joinedPeers=e.joinedPeers.filter((function(e){return e.id!==n.id})).concat([J({},n)]))},G[me.toString()]=function(e,t){var n=e.joinedPeers.find((function(e){return e.id===t.payload.id}));n&&(n.webinarHiddenParticipant=!0,e.joinedPeers=e.joinedPeers.filter((function(e){return e.id!==n.id})).concat([J({},n)]))},G[he.toString()]=function(e,t){var n=e.joinedPeers.find((function(e){return e.id===t.payload.id}));n&&(delete n.requestToJoinType,n.webinarHiddenParticipant=!0,n.audioMuted=!0,e.joinedPeers=e.joinedPeers.filter((function(e){return e.id!==n.id})).concat([J({},n)]))},G[ge.toString()]=function(e,t){var n=e.joinedPeers.find((function(e){return e.id===t.payload.id}));n&&(n.webinarHiddenParticipant=!1,e.joinedPeers=e.joinedPeers.filter((function(e){return e.id!==n.id})).concat([J({},n)]))},G[ve.toString()]=function(e,t){var n=e.joinedPeers.find((function(e){return e.id===t.payload.id}));n&&(delete n.requestToJoinType,n.webinarHiddenParticipant=!0,n.audioMuted=!0,e.joinedPeers=e.joinedPeers.filter((function(e){return e.id!==n.id})).concat([J({},n)]))},G[be.toString()]=function(e,t){e.joinedPeers=Q([],e.joinedPeers.map((function(e){return e.webinarHiddenParticipant=!0,e})),!0)},G[Ee.toString()]=function(e,t){var n=e.joinedPeers.find((function(e){return e.id===t.payload.id}));n&&(n.metadata.preset_name=t.payload.preset_name,n.metadata.view_type=t.payload.view_type,e.joinedPeers=e.joinedPeers.filter((function(e){return e.id!==n.id})).concat([J({},n)]))},G[Se.toString()]=function(e,t){var n=e.joinedPeers.find((function(e){return e.id===t.payload.id}));n&&(n.label=t.payload.label,e.joinedPeers=e.joinedPeers.filter((function(e){return e.id!==n.id})).concat([J({},n)]))},G));!function(e){e.NOT_STARTED="NOT_STARTED",e.CONNECTING="CONNECTING",e.FETCHED="FETCHED",e.LOADED="LOADED",e.STOPPING="STOPPING",e.NOT_APPLICABLE="NOT_APPLICABLE"}($||($={})),function(e){e.NOT_STARTED="NOT_STARTED",e.CONNECTED="CONNECTED",e.DISCONNECTED="DISCONNECTED",e.ERRORED="ERRORED",e.RECONNECT="RECONNECT"}(ee||(ee={})),function(e){e[e.NONE=0]="NONE",e[e.WAITING=1]="WAITING",e[e.ACCEPTED=2]="ACCEPTED",e[e.REJECTED=3]="REJECTED"}(te||(te={}));var xe={initialGUMFetch:!1,routerState:$.NOT_APPLICABLE,producersState:$.NOT_APPLICABLE,roomDisplayTitleState:$.NOT_STARTED,socketState:ee.NOT_STARTED,polls:{},chatMessages:[],legacyMode:!1,joined:!1,roomDisplayTitle:"",activeSpeakerPeerId:"",roomUUID:"",startedAt:null,pipMode:!1,maxPreferredStreams:10,roomNodeLink:"",waitingState:te.NONE,waitlistedPeers:[],password:"",roomName:"",gridView:"multi",gridViewSaved:"multi",currentPage:0,pinnedPeerId:null,kicked:"",presetFetched:!1,roomViewType:null,requestToJoinPeersList:[],selectedScreenSharingPeer:""},Ce=n.createAction("session/set-pip-mode"),_e=n.createAction("websocket/router-capability");n.createAction("websocket/create-transport"),n.createAction("websocket/connect-transport");var ke=n.createAction("session/socket-state"),Ie=n.createAction("session/preset-fetched"),Te=n.createAction("session/router-state"),Pe=n.createAction("session/room-display-title-state"),Ae=n.createAction("session/room-node-link"),Oe=n.createAction("session/producers-state"),De=n.createAction("session/reset-room"),Ne=n.createAction("session/set-room-name"),Re=n.createAction("session/initial-get-user-media-fetch"),Me=n.createAction("websocket/new-chat-message"),Le=n.createAction("websocket/get-chat-messages"),ze=n.createAction("websocket/get-polls"),Be=n.createAction("websocket/update-poll"),Fe=n.createAction("websocket/room-legacy-mode"),je=n.createAction("websocket/room-state"),Ve=n.createAction("websocket/room-display-title"),We=n.createAction("websocket/active-speaker"),qe=n.createAction("websocket/no-active-speaker"),He=n.createAction("websocket/waitlist-accepted"),Ue=n.createAction("websocket/waitlist-rejected"),Ge=n.createAction("websocket/waitlist-peer-added"),Je=n.createAction("websocket/waitlist-peer-closed"),Ye=n.createAction("session/room-password"),Ke=n.createAction("session/mark-messages-read"),Ze=n.createAction("session/room-grid-view"),Qe=n.createAction("websocket/pin-peer"),Xe=n.createAction("websocket/kicked"),$e=n.createAction("websocket/room-view-type"),et=n.createAction("session/set-current-page"),tt=n.createAction("websocket/request-to-join-stage-peer-added"),nt=n.createAction("websocket/peer-added-to-stage"),rt=n.createAction("websocket/peer-rejected-to-join-stage"),it=n.createAction("room/seen-all-participant"),ot=n.createAction("session/set-active-screenshare"),at=n.createReducer(xe,((X={})[De.toString()]=function(e){Object.keys(xe).forEach((function(t){e[t]=xe[t]}))},X[ke.toString()]=function(e,t){e.socketState=t.payload},X[Te.toString()]=function(e,t){e.routerState=t.payload},X[Ie.toString()]=function(e,t){e.presetFetched=t.payload},X[Re.toString()]=function(e,t){e.initialGUMFetch=t.payload},X[_e.toString()]=function(e){e.routerState=$.FETCHED},X[$e.toString()]=function(e,t){e.roomViewType=t.payload},X[Me.toString()]=function(e,t){e.chatMessages=Q(Q([],e.chatMessages,!0),[J(J({},t.payload),{read:!1})],!1)},X[Le.toString()]=function(e,t){e.chatMessages=t.payload.messages.map((function(e){return J(J({},e),{read:!0})}))},X[Ke.toString()]=function(e,t){e.chatMessages=e.chatMessages.map((function(e){return t.payload&&e.type!==t.payload?e:J(J({},e),{read:!0})}))},X[Be.toString()]=function(e,t){var n=t.payload.poll;e.polls[n.id]=n},X[ze.toString()]=function(e,t){e.polls=t.payload.polls},X[Ve.toString()]=function(e,t){e.roomDisplayTitle=t.payload.displayTitle},X[Pe.toString()]=function(e,t){e.roomDisplayTitleState=t.payload},X[je.toString()]=function(e,t){var n=t.payload.roomState,r=n.roomUUID,i=n.displayTitle,o=n.roomName;e.roomDisplayTitle=i,e.roomUUID=r,e.roomName=o},X[ne.toString()]=function(e,t){e.legacyMode=t.payload.legacyMode||xe.legacyMode,e.startedAt=t.payload.waitlisted?null:t.payload.startedAt,e.maxPreferredStreams=t.payload.maxPreferredStreams||xe.maxPreferredStreams,e.joined=!0,e.waitingState=t.payload.waitlisted?te.WAITING:te.NONE,e.pinnedPeerId=t.payload.pinnedPeerId,e.gridView=t.payload.pinnedPeerId?"highlighted":e.gridView,t.payload.waitlistedPeers&&(e.waitlistedPeers=t.payload.waitlistedPeers),t.payload.requestToJoinPeersList&&(e.requestToJoinPeersList=t.payload.requestToJoinPeersList)},X[Fe.toString()]=function(e,t){e.legacyMode=t.payload.turnOn},X[et.toString()]=function(e,t){e.currentPage=t.payload},X[We.toString()]=function(e,t){e.activeSpeakerPeerId=t.payload.peerId},X[qe.toString()]=function(e){e.activeSpeakerPeerId=""},X[Oe.toString()]=function(e,t){e.producersState=t.payload},X[Ae.toString()]=function(e,t){e.roomNodeLink=t.payload},X[He.toString()]=function(e,t){e.waitingState=te.ACCEPTED},X[Ue.toString()]=function(e,t){e.waitingState=te.REJECTED},X[Ge.toString()]=function(e,t){e.waitlistedPeers=Q(Q([],e.waitlistedPeers.filter((function(e){return e.id!==t.payload.id})),!0),[t.payload],!1)},X[Je.toString()]=function(e,t){e.waitlistedPeers=e.waitlistedPeers.filter((function(e){return e.id!==t.payload.id}))},X[Ye.toString()]=function(e,t){e.password=t.payload},X[Ze.toString()]=function(e,t){e.gridView=t.payload},X[Qe.toString()]=function(e,t){t.payload.peerId?(e.gridViewSaved=e.gridViewSaved?e.gridViewSaved:e.gridView,e.gridView="highlighted"):(e.gridView=e.gridViewSaved,e.gridViewSaved=null),e.pinnedPeerId=t.payload.peerId},X[Xe.toString()]=function(e,t){var n,r;(null===(n=t.payload)||void 0===n?void 0:n.kickType)||(e.kicked="unknown"),e.kicked=null===(r=t.payload)||void 0===r?void 0:r.kickType},X[Ne.toString()]=function(e,t){e.roomName=t.payload.roomName},X[tt.toString()]=function(e,t){e.requestToJoinPeersList=Q(Q([],e.requestToJoinPeersList.filter((function(e){return e.id!==t.payload.id})),!0),[J(J({},t.payload),{seen:!1})],!1)},X[rt.toString()]=function(e,t){e.requestToJoinPeersList=e.requestToJoinPeersList.filter((function(e){return e.id!==t.payload.id}))},X[nt.toString()]=function(e,t){e.requestToJoinPeersList=e.requestToJoinPeersList.filter((function(e){return e.id!==t.payload.id}))},X[it.toString()]=function(e){e.requestToJoinPeersList=Q([],e.requestToJoinPeersList.map((function(e){return e.seen=!0,e})),!0)},X[oe.toString()]=function(e,t){e.requestToJoinPeersList=e.requestToJoinPeersList.filter((function(e){return e.id!==t.payload.id}))},X[Ce.toString()]=function(e,t){e.pipMode=t.payload},X[ot.toString()]=function(e,t){e.selectedScreenSharingPeer=t.payload},X)),lt=i.createStandaloneToast({colorMode:"light"});function ct(){return{width:window.innerWidth,height:window.innerHeight}}var st,ut,dt,ft,pt,mt,ht,gt,vt,yt,bt,Et=function(){var t=e.useState(ct()),n=t[0],r=t[1];return e.useEffect((function(){function e(){r(ct())}return window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[]),n};!function(e){e.skip="SKIP",e.onAccept="ON_ACCEPT",e.skipOnPrivilegedUserEntry="SKIP_ON_PRIVILEGED_USER_ENTRY",e.skipOnAccept="ON_ACCEPT"}(st||(st={})),function(e){e.groupCall="GROUP_CALL",e.webinar="WEBINAR",e.audioRoom="AUDIO_ROOM"}(ut||(ut={})),function(e){e.AUDIO="AUDIO",e.VIDEO="VIDEO",e.SPEAKER="SPEAKER"}(dt||(dt={})),function(e){e[e.REQUESTED_BY_PARTICIPANT=0]="REQUESTED_BY_PARTICIPANT",e[e.REQUESTED_BY_MODERATOR=1]="REQUESTED_BY_MODERATOR"}(ft||(ft={})),function(e){e.PARTICIPANT="PARTICIPANT",e.PEER="PEER",e.CLIENT="CLIENT"}(pt||(pt={})),function(e){e.QUICK_ZOOM="quick_zoom",e.INTERNAL_CALL_STATS="internal_call_stats",e.CFWS="cfws",e.LOGROCKET="logrocket",e.SIMULCAST="simulcast",e.SOCKET_POLLING="socket_polling",e.SOCKET_PINGSTATS="socket_pingstats",e.SKIP_REACQUIRE_AUDIO="skip_reacquire_audio",e.NOTIFY_AUDIO_TRACK_SILENCE="notify_audio_track_silence"}(mt||(mt={})),function(e){e.ALLOWED="allowed",e.ON_REQUEST="on_request",e.NOT_ALLOWED="not_allowed"}(gt||(gt={})),function(e){e[e.PRESENTING=0]="PRESENTING",e[e.NOT_PRESENTING=1]="NOT_PRESENTING",e[e.INITIATED=2]="INITIATED"}(vt||(vt={})),function(e){e[e.NONE=0]="NONE",e[e.WAITING=1]="WAITING",e[e.ACCEPTED=2]="ACCEPTED",e[e.REJECTED=3]="REJECTED",e[e.INITIATED=4]="INITIATED"}(yt||(yt={})),function(e){e.present="REQUEST_TO_PRESENT",e.ask="REQUEST_TO_ASK"}(bt||(bt={}));var St=n.createAction("participant/set-user"),wt=n.createAction("participant/set-user-error"),xt=n.createAction("participant/set-token"),Ct=n.createAction("participant/set-user-permission"),_t=n.createAction("participant/set-logged-in"),kt=n.createAction("participant/set-display-name"),It=n.createAction("participant/set-display-image"),Tt=n.createAction("participant/set-video-production"),Pt=n.createAction("participant/set-audio-production"),At=n.createAction("participant/set-screen-sharing-production"),Ot=n.createAction("participant/set-audio-muted"),Dt=n.createAction("participant/set-screen-sharing"),Nt=n.createAction("participant/set-video-off"),Rt=n.createAction("participant/set-video-track-selection"),Mt=n.createAction("participant/set-audio-track-selection"),Lt=n.createAction("participant/set-speaker-track-selection"),zt=n.createAction("session/reset-pariticipant"),Bt=n.createAction("websocket/mute-all"),Ft=n.createAction("websocket/mute-all-video"),jt=n.createAction("websocket/disable-audio"),Vt=n.createAction("websocket/disable-video"),Wt=n.createAction("websocket/device-changed"),qt=n.createAction("websocket/visibility-settings"),Ht=n.createAction("websocket/update-webinar-update-setting"),Ut=n.createAction("websocket/update_can_update"),Gt=n.createAction("websocket/request-to-join-stage-accepted"),Jt=n.createAction("websocket/request-to-join-stage-rejected"),Yt=n.createAction("websocket/removed-from-stage"),Kt=n.createAction("room/request-to-join-stage-state"),Zt=n.createAction("participant/request-to-join-type"),Qt=n.createAction("websocket/started-presenting"),Xt=n.createAction("websocket/stopped-presenting"),$t=n.createAction("participant/initiate-presenting"),en=n.createAction("websocket/peer-added-to-stage"),tn=n.createAction("websocket/update-userpreset"),nn={id:"",peerId:r.v4().toString(),device:"",email:"",displayName:"",authToken:"",organizationId:"",loggedIn:!1,displayImageURL:"",audioMuted:!1,deviceChanges:0,videoOff:!1,sharingScreen:!1,videoProduction:$.NOT_STARTED,audioProduction:$.NOT_STARTED,screenSharingProduction:$.NOT_STARTED,shouldProduce:!0,canAllowParticipantAudio:!1,canAllowParticipantVideo:!1,canUnMute:!0,clientSpecificId:null,userFetchError:null,hidden:!1,webinarHiddenParticipant:!1,joinStageSettings:gt.ALLOWED,requestToJoinStageState:yt.NONE,presentingState:vt.NOT_PRESENTING,canPresent:!1,metadata:{preset_name:"default",view_type:"GROUP_CALL"},preset:null};var rn=n.createReducer(nn,((ht={})[zt.toString()]=function(e,t){e.sharingScreen=!1,e.videoProduction=$.NOT_STARTED,e.audioProduction=$.NOT_STARTED,t.payload||(e.videoOff=!1,e.webinarHiddenParticipant=!1,e.requestToJoinStageState=yt.NONE,e.presentingState=vt.NOT_PRESENTING),e.userFetchError=null},ht[St.toString()]=function(e,t){e.authToken=t.payload.authToken,e.loggedIn=t.payload.loggedIn||!1,e.email=t.payload.email||"",e.displayImageURL=t.payload.picture||"",e.id=t.payload.id||"",e.clientSpecificId=t.payload.clientSpecificId,e.organizationId=t.payload.organizationId,e.videoOff="false"===localStorage.getItem("dyte-video"),t.payload.name&&t.payload.name.length>0&&(e.displayName=t.payload.name||"",localStorage.setItem("dyte-displayName",t.payload.name))},ht[wt.toString()]=function(e,t){e.userFetchError={code:t.payload.statusCode,message:t.payload.message}},ht[qt.toString()]=function(e,t){var n=t.payload,r=n.hidden,i=n.joinStageSettings;e.hidden=r,e.joinStageSettings=i},ht[Ht.toString()]=function(e,t){e.webinarHiddenParticipant=t.payload},ht[xt.toString()]=function(e,t){e.authToken=t.payload,e.id=function(e){var t;return null===(t=JSON.parse(atob(e.split(".")[1])))||void 0===t?void 0:t.id}(t.payload)},ht[kt.toString()]=function(e,t){e.displayName=t.payload,localStorage.setItem("dyte-displayName",t.payload)},ht[It.toString()]=function(e,t){e.displayImageURL=t.payload},ht[_t.toString()]=function(e,t){e.loggedIn=t.payload},ht[Ut.toString()]=function(e,t){e.canPresent=t.payload},ht[Tt.toString()]=function(e,t){e.videoProduction=t.payload},ht[Pt.toString()]=function(e,t){e.audioProduction=t.payload},ht[At.toString()]=function(e,t){e.screenSharingProduction=t.payload},ht[Ot.toString()]=function(e,t){!1!==e.canUnMute&&(localStorage.setItem("dyte-audio",t.payload?"false":"true"),e.audioMuted=t.payload)},ht[Nt.toString()]=function(e,t){localStorage.setItem("dyte-video",t.payload?"false":"true"),e.videoOff=t.payload},ht[Rt.toString()]=function(e,t){e.videoTrackSelection=t.payload},ht[Mt.toString()]=function(e,t){e.audioTrackSelection=t.payload},ht[Dt.toString()]=function(e,t){e.sharingScreen=t.payload},ht[Lt.toString()]=function(e,t){e.speakerTrackSelection=t.payload},ht[Ct.toString()]=function(e,t){e.canAllowParticipantAudio=t.payload.canAllowParticipantAudio,e.canAllowParticipantVideo=t.payload.canAllowParticipantVideo},ht[Bt.toString()]=function(e,t){e.canAllowParticipantAudio||(e.audioMuted=!0,e.canUnMute=t.payload.allowUnMute)},ht[Ft.toString()]=function(e,t){e.canAllowParticipantVideo||(e.videoOff=!0)},ht[jt.toString()]=function(e){e.audioMuted=!0},ht[Vt.toString()]=function(e){e.videoOff=!0},ht[Wt.toString()]=function(e){e.deviceChanges=e.deviceChanges+1},ht[Gt.toString()]=function(e,t){e.joinStageSettings=gt.ALLOWED,e.requestToJoinStageState=yt.ACCEPTED,e.presentingState=vt.INITIATED,e.requestToJoinType=t.payload.requestToJoinType,e.canPresent=!0,lt({description:"Request Accepted",status:"success",duration:5e3,isClosable:!0,position:"top"})},ht[Jt.toString()]=function(e){e.webinarHiddenParticipant=!0,e.joinStageSettings=gt.NOT_ALLOWED,e.requestToJoinStageState=yt.REJECTED,e.presentingState=vt.NOT_PRESENTING,e.screenSharingProduction=$.NOT_STARTED,lt({description:"Request Rejected",status:"error",duration:5e3,isClosable:!0,position:"top"})},ht[Yt.toString()]=function(e,t){e.webinarHiddenParticipant=!0,e.joinStageSettings=gt.NOT_ALLOWED,e.audioMuted=!0,e.videoOff=!0,e.requestToJoinStageState=yt.NONE,e.presentingState=vt.NOT_PRESENTING,e.screenSharingProduction=$.NOT_STARTED;var n=t.payload.type===ft.REQUESTED_BY_PARTICIPANT?"You are no longer Presenting":"Host has stopped you from Presenting";lt({description:n,status:"error",duration:5e3,isClosable:!0,position:"top"}),e.requestToJoinType=void 0,e.canPresent=!1},ht[Kt.toString()]=function(e,t){e.requestToJoinStageState=t.payload},ht[Zt.toString()]=function(e,t){e.requestToJoinType=t.payload},ht[Qt.toString()]=function(e){e.webinarHiddenParticipant=!1,e.presentingState=vt.PRESENTING},ht[Xt.toString()]=function(e){e.webinarHiddenParticipant=!0,e.presentingState=vt.NOT_PRESENTING,e.screenSharingProduction=$.NOT_STARTED,e.sharingScreen=!1},ht[$t.toString()]=function(e){e.presentingState=vt.INITIATED},ht[en.toString()]=function(e,t){t.payload.id===e.peerId&&(e.requestToJoinType=t.payload.requestToJoinType)},ht[tn.toString()]=function(e,t){e.preset=t.payload.preset},ht[Ee.toString()]=function(e,t){e.peerId===t.payload.id&&(e.metadata.preset_name=t.payload.preset_name,e.metadata.view_type=t.payload.view_type)},ht));var on=".dyte-client {\n  font-size: 14px;\n  margin: 0;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n.dyte-client video {\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n}\n\n.dyte-client-selfVideo {\n  position: fixed;\n  bottom: var(--chakra-fontSizes-md);\n  left: var(--chakra-fontSizes-md);\n}\n\n.dyte-client-selfVideo video {\n  position: fixed;\n  bottom: var(--chakra-fontSizes-md);\n  left: var(--chakra-fontSizes-md);\n  object-position: right;\n  object-fit: contain;\n  transform: scaleX(-1);\n}\n\n.dyte-client-centerAligned {\n  justify-self: center;\n}\n\n#dyte-base-elem button:focus {\n  box-shadow: unset !important;\n}\n\n.dyte-client-videoOverlay {\n  position: absolute !important;\n  bottom: var(--chakra-fontSizes-md);\n  right: var(--chakra-fontSizes-md);\n  width: 100%;\n}\n\n.dyte-client-muteIcon {\n  float: left;\n  position: absolute;\n  margin-top: calc(0.5 * var(--chakra-fontSizes-md));\n  right: var(--chakra-fontSizes-md);\n}\n\n.dyte-client-name {\n  float: right;\n  position: absolute;\n  margin-top: calc(0.5 * var(--chakra-fontSizes-md));\n  left: 1em;\n}\n\n.dyte-client-discussion {\n  margin: 0 auto;\n  display: flex;\n  flex-flow: column wrap;\n}\n\n.dyte-client-bubble {\n  padding: calc(0.35 * var(--chakra-fontSizes-md))\n    calc(0.8 * var(--chakra-fontSizes-md));\n  margin: 0.0625em;\n  min-width: 35px;\n  max-width: 200px;\n  animation: bubble-slide 0.15s ease-in;\n}\n\n.dyte-client-bubble span {\n  white-space: pre-wrap;\n}\n\n.dyte-polls {\n  max-width: 250px;\n}\n\n.dyte-client-chat-timestamp {\n  font-variant-numeric: tabular-nums;\n}\n\n.dyte-client-bubble.dyte-client-self {\n  border-radius: 1em;\n  align-self: flex-end;\n  background-color: var(--chakra-colors-primary-500);\n  color: var(--chakra-colors-text-100);\n  text-align: left;\n  text-justify: auto;\n}\n\n.dyte-client-bubble.dyte-client-type-3 {\n  background-color: var(--chakra-colors-secondary-800);\n  padding-bottom: var(--chakra-fontSizes-md);\n  width: 200px;\n}\n\n.dyte-client-bubble.dyte-client-other {\n  border-radius: 1.2em 1.2em 1.2em 1.2em;\n  align-self: flex-start;\n  background-color: var(--chakra-colors-secondary-800);\n  color: var(--chakra-colors-text-100);\n  text-align: left;\n  margin-left: calc(0.3 * var(--chakra-fontSizes-md));\n}\n\n.dyte-client-user {\n  font-size: var(--chakra-fontSizes-sm);\n  margin-left: calc(3 * var(--chakra-fontSizes-md));\n  margin-bottom: calc(0.15 * var(--chakra-fontSizes-md));\n  color: var(--chakra-colors-text-200);\n}\n\n.dyte-client-chatInput:focus {\n  background-color: var(--chakra-colors-secondary-1000);\n}\n\n/*\n  input:placeholder-shown {\n\t  background-color: var(--chakra-colors-secondary-800);\n  }\n\n  input.dark:placeholder-shown {\n\t  background-color: #171717;\n\n  }*/\n\n.dyte-client-otherText.dyte-client-last,\n.dyte-client-selfText.dyte-client-last {\n  margin-bottom: 1.7em;\n}\n\n.dyte-client-otherText.dyte-client-only,\n.dyte-client-selfText.dyte-client-only {\n  margin-bottom: 1.7em;\n}\n\n.dyte-client-first.dyte-client-self {\n  border-bottom-right-radius: 0.1em;\n}\n\n.dyte-client-bubble.dyte-client-self.dyte-client-first {\n  border-bottom-right-radius: 0.1em;\n}\n\n.dyte-client-bubble.dyte-client-self.dyte-client-last {\n  border-top-right-radius: 0.1em;\n  margin-bottom: 0;\n}\n\n.dyte-client-bubble.dyte-client-self.dyte-client-middle {\n  border-top-right-radius: 0.1em;\n  border-bottom-right-radius: 0.1em;\n}\n\n.dyte-client-bubble.dyte-client-other.dyte-client-first {\n  border-bottom-left-radius: 0.1em;\n}\n\n.dyte-client-bubble.dyte-client-other.dyte-client-last {\n  border-top-left-radius: 0.1em;\n  margin-bottom: 0;\n}\n\n.dyte-client-bubble.dyte-client-other.dyte-client-only,\n.dyte-client-bubble.dyte-client-self.dyte-client-only {\n  margin-bottom: 0;\n}\n\n.dyte-client-bubble.dyte-client-other.dyte-client-middle {\n  border-bottom-left-radius: 0.1em;\n  border-top-left-radius: 0.1em;\n}\n\n.dyte-client-outerContainer {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n}\n\n.dyte-client-eventContainer {\n  flex: 1 1 auto;\n}\n\n.chakra-checkbox__label {\n  overflow-wrap: anywhere;\n}\n\n.dyte-client-videoStatic {\n  background-color: rgba(255, 255, 255, 0.2);\n  backdrop-filter: blur(4px);\n  padding: 0.7em;\n  visibility: hidden;\n  z-index: 10;\n  opacity: 0;\n  transition: opacity 1s ease-out;\n  transition: background-color 1s;\n}\n\n.dyte-client-videoStatic.dyte-client-active {\n  transition: box-shadow 1s;\n  -webkit-box-shadow: 0px 10px 30px 1px var(--chakra-colors-secondary-800);\n  -moz-box-shadow: 0px 10px 30px 1px var(--chakra-colors-secondary-800);\n  box-shadow: 0px 10px 30px 1px var(--chakra-colors-secondary-800);\n}\n\n.dyte-client-videoStatic.dyte-client-visible {\n  visibility: visible;\n  opacity: 1;\n}\n\n.dyte-client-videoHover:hover {\n  opacity: 1;\n  transition: background-color 1s;\n}\n\n.dyte-client-hideBackground {\n  background-color: rgba(255, 255, 255, 0) !important;\n  backdrop-filter: blur(0px) !important;\n}\n\n.dyte-client-controls {\n  display: flex;\n  width: -webkit-fill-available;\n  left: 0;\n  right: 0;\n  justify-content: center;\n}\n\n.dyte-client-round {\n  border-radius: 2em;\n}\n\n/* colorScheme bgColor bg nothing works*/\n\n.dyte-client-chatActive {\n  background: var(--chakra-colors-primary-300) !important;\n}\n\n.dyte-client option {\n  color: black;\n}\n\n.dyte-client-feedback {\n  border-radius: 0 !important;\n}\n\n.dyte-client-form-ui {\n  border-radius: 0 !important;\n}\n\n.dyte-client-form-ui:focus {\n  border: 1px solid var(--chakra-colors-primary-300) !important;\n}\n\n.dyte-client-form-ui:hover {\n  border: 1px solid var(--chakra-colors-primary-300) !important;\n}\n\n.dyte-client-mobileChat {\n  width: 100%;\n  text-shadow: 0px 0px 1px var(--chakra-colors-secondary-1000);\n}\n\n.dyte-client-selfText .dyte-client-user {\n  display: none;\n}\n\n.dyte-client-selfVideo .muteIcon {\n  position: absolute;\n  left: 0;\n}\n\n@keyframes bubble-slide {\n  0% {\n    opacity: 0;\n    transform: translateY(20px);\n  }\n  100% {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n.dyte-client-invertOnly {\n  /* rotateY gives an issue on safari ipad, use this to flip horizontally */\n  -webkit-transform: scaleX(-1);\n  transform: scaleX(-1);\n}\n\n.dyte-client-activeSpeaker video {\n  border: 2px solid var(--chakra-colors-primary-300);\n}\n\n/* .dyte-client-activeSpeaker .dyte-client-peerVideo {\n  border: 2px solid var(--chakra-colors-primary-300);\n} */\n\n/*\n\tadd this class to remove the ugly blue box from links\n\tNOTE- it will override box-shadow and outline properties\n  */\n\n.dyte-client-removeFocusBox:focus {\n  box-shadow: none !important;\n  outline: none !important;\n}\n\n.dyte-client-scrollbar {\n\t/* For mozilla  */\n\tscrollbar-width: thin;\n\tscrollbar-color: var(--chakra-colors-secondary-700) var(--chakra-colors-secondary-1000);\n}\n\n/* For Blink/Webkit */\n.dyte-client-scrollbar::-webkit-scrollbar {\n\twidth: 6px;\n\tbackground-color: var(--chakra-colors-secondary-1000);\n}\n\n.dyte-client-scrollbar::-webkit-scrollbar-thumb {\n\tborder-radius: 9999px;\n\tbackground-color: var(--chakra-colors-secondary-700);\n}\n\n.dyte-client-noScrollbar {\n  scrollbar-width: none;\n}\n\n.dyte-client-noScrollbar::-webkit-scrollbar {\n  width: 0;\n  height: 0;\n}\n\n.dyte-client-noSelect {\n  -webkit-touch-callout: none;\n  -webkit-user-select: none;\n  -khtml-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n}\n\n.dyte-client-selectable {\n  -webkit-touch-callout: text;\n  -webkit-user-select: text;\n  -khtml-user-select: text;\n  -moz-user-select: text;\n  -ms-user-select: text;\n  user-select: text;\n}\n\n.dyte-client-stageButton {\n  align-items: center;\n  background-color: var(--chakra-colors-secondary-800);\n  margin-left: 0px !important;\n  color: var(--chakra-colors-text-300);\n  width: 96px;\n  height: 56px;\n  justify-content: center;\n  display: inline-flex;\n  flex-direction: column;\n}\n\n.dyte-client-stageButton:focus {\n  outline: none;\n}\n\n.dyte-client-stageButton:hover {\n  background-color: var(--chakra-colors-secondary-900);\n}\n\n.dyte-client-mobileDrawer {\n  position: absolute;\n  bottom: 0;\n  background-color: var(--chakra-colors-secondary-1000);\n  width: 100%;\n  height: 82%;\n  border-top-left-radius: 4px;\n  border-top-right-radius: 4px;\n}\n\n.dyte-client-notificationBadge {\n  border-radius: 50%;\n  position: absolute;\n  border: solid 3px;\n  font-weight: bold;\n  font-size: 9px;\n  height:23px;\n  width:23px;\n  top: -1px;\n  z-index: 2;\n  right: 12px;\n}\n\n.dyte-badge-border{\n\tborder-color: var(--chakra-colors-secondary-1000);\n\ttransition: border-color 0.3s ease-out;\n}\n\n.dyte-badge-border-primary{\n\tborder-color: var(--chakra-colors-primary-500);\n\ttransition: border-color 0.3s ease-out;\n}\n.dyte-control-bar-btn-wrapper:hover .dyte-badge-border{\n\tborder:solid 3px var(--chakra-colors-secondary-800);\n\ttransition: border-color 0.3s ease-out;\n}\n\n.dyte-control-bar-btn-wrapper-small:hover .dyte-badge-border-primary{\n\tborder:solid 3px var(--chakra-colors-primary-700);\n\ttransition: border-color 0.3s ease-out;\n}\n\n.dyte-client-notificationBadge span {\n  display: inline-block;\n  padding-top: 50%;\n  padding-bottom: 50%;\n  margin-left: 0.25em;\n  margin-right: 0.3em;\n}\n\n.dyte-client-blink {\n  animation: blink 4s linear infinite;\n}\n\n@keyframes blink {\n  0%,\n  10% {\n    opacity: 0;\n  }\n  11%,\n  100% {\n    opacity: 1;\n  }\n}\n\n.dyte-client-screen-preview * {\n  -webkit-transition: width 300ms ease-in-out, height 300ms ease-in-out,\n    opacity 300ms ease-in-out 200ms;\n  -moz-transition: width 300ms ease-in-out, height 300ms ease-in-out,\n    opacity 300ms ease-in-out 200ms;\n  -o-transition: width 300ms ease-in-out, height 300ms ease-in-out,\n    opacity 300ms ease-in-out 200ms;\n  transition: width 300ms ease-in-out, height 300ms ease-in-out,\n    opacity 300ms ease-in-out 200ms;\n}\n\n.dyte-kvfysmfp {\n  overflow: hidden;\n  touch-action: none;\n  border-radius: 6px;\n  height: 100%;\n}\n\n.dyte-ufhsfnkm {\n  transform-origin: 0 0;\n}\n\n.dyte-fullWidth {\n  width: 100%;\n}\n\n.dyte-client a:hover {\n  color: var(--chakra-colors-text-100);\n}\n\n.dyte-client-type-1:hover .dyte-client-chat-img-actions {\n  display: block;\n}\n\n.dyte-client-bubble.dyte-client-type-1 {\n  padding: 0.4em;\n  border-radius: 6px;\n}\n\n.dyte-iframe {\n  height: 100%;\n}\n\n.dyte-meeting-title {\n  -webkit-line-clamp: 1;\n  -webkit-box-orient: vertical;\n}\n\n.dyte-clock {\n  font-variant-numeric: tabular-nums;\n}\n\n.dyte-peerview {\n  user-select: none;\n  -webkit-user-select: none;\n  -webkit-touch-callout: none;\n}\n\n#dyte-base-elem {\n  position: relative;\n  width: 100%;\n  height: 100%;\n}\n\n.dyte-client ::-webkit-scrollbar {\n  width: 7px;\n  height: 5px;\n  background: var(--chakra-colors-secondary-1000);\n}\n\n.dyte-client ::-webkit-scrollbar-thumb {\n  background: var(--chakra-colors-secondary-800);\n  border-radius:7px;\n}\n\n.dyte-modal-content-container::-webkit-scrollbar{\n\tdisplay:none;\n}\n\n.make-session-layout{\n    flex-direction:row;\n\tjustify-content:center;\n}\n.make-session-spacer{\n    width:4rem;\n    height:3px;\n}\n.make-session-layout.mw800 {\n    flex-direction:column;\n}\n.make-session-spacer.mw800{\n    width:100%;\n    min-height:20px;\n    height:2rem;\n}\n.make-session-layout.mw800.mh600{\n    padding:2ex 0;\n    height: auto;\n\tjustify-content:flex-start;\n}\n\n.permission-denied-alert.mw800.mh600{\n\tfont-size:12px;\n}\n\n.permission-denied-alert-button.mw800.mh600{\n\tmax-width: 50px;\n}\n\n.make-session-layout.mh400.mw460{\n    padding:2ex 0;\n    height: auto;\n}";!function(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}(on);var an,ln,cn,sn=on,un={apiBase:"https://api.cluster.dyte.in"},dn=function(e){un.apiBase=e},fn={baseURL:"http://localhost:5000",createdAt:"2021-08-05T10:49:56.602Z",description:"Develop plugins on http://localhost:5000",id:"09259e3b-7be8-46f6-9801-106bf1866e1c",name:"Localhost Dev",organizationId:"4ad15a19-80e2-4105-bf43-48039fd2963e",picture:"https://dyte-uploads.s3.ap-south-1.amazonaws.com/dyte.png",private:!1,published:!0,staggered:!1,tags:["#localhost","#dev"],type:"self_hosted",updatedAt:"2021-08-05T10:50:07.681Z"},pn=n.createAction("plugins/addView"),mn=n.createAction("plugins/removeView"),hn=n.createAction("websocket/plugin-acl-grant"),gn=n.createAction("websocket/plugin-acl-remove"),vn=n.createAction("plugins/initialize"),yn=function(e,t){var n=e;return Object.entries(t).forEach((function(e){var t=e[0],r=e[1];n.searchParams.append(t,r)})),n},bn=n.createReducer({plugins:[],main:[],side:[],background:[],titlebar:[],controlbar:[],initialized:!1},((an={})[De.toString()]=function(e,t){e.plugins=[],e.main=[],e.background=[],e.controlbar=[],e.side=[],e.titlebar=[]},an[pn.toString()]=function(e,t){var n=t.payload,r=n.plugin,i=n.meeting,o=n.config,a=n.pluginService;e.plugins.push(r);var l={auth:r.authToken,parent:window.location.origin,backend:un.apiBase,pluginId:r.id};if(o){var c=o.contentScript,s=o.views;if(s)Object.entries(s).forEach((function(t){var n=t[0],o=t[1];if("controlbar"===n){var c={url:yn(new URL(o.path,r.baseURL),l).href,plugin:r.id,view:o.path,props:{icon:o.icon,label:o.label,position:o.position}};e.controlbar.push(c)}else if("sidebar"===n){var s=yn(new URL(null!=o?o:"/",r.baseURL),l),u={url:s.href,plugin:r.id,view:null!=o?o:"/"};0===i.modules.getAll().filter((function(e){return e.sidebarComponent.name===r.name})).length&&i.modules.add({type:"sidebar",icon:A.default.createElement("img",{src:r.picture,width:28}),sidebarComponent:{name:r.name,component:function(){return A.default.createElement("iframe",{id:"dyte-plugin-sidebar",src:s.href,className:"dyte-iframe",width:"100%",height:"100%",ref:function(e){a.addIframeView(u,e)},allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"})}}}),e.side.push(u)}else{c={url:yn(new URL(null!=o?o:"/",r.baseURL),l).href,plugin:r.id,view:null!=o?o:"/"};switch(n){case"root":e.main.push(c);break;case"titlebar":e.titlebar.push(c)}}}));else{var u={url:yn(new URL(r.baseURL),l).href,plugin:r.id,view:"/"};e.main.push(u)}if(c){var d=r.name.replace(" ","-")+"_contentScript";if(!document.getElementById(d)){var f=new URL(c,r.baseURL),p=document.createElement("script");p.id=d,p.src=f.href,document.documentElement.appendChild(p),p.onload=function(){try{window.initDytePlugin(i)}catch(e){}}}}}else{u={url:yn(new URL(r.baseURL),l).href,plugin:r.id,view:"/"};e.main.push(u)}},an[mn.toString()]=function(e,t){var n=t.payload;e.main=e.main.filter((function(e){return e.plugin!==n.id})),e.side=e.side.filter((function(e){return e.plugin!==n.id})),e.background=e.background.filter((function(e){return e.plugin!==n.id})),e.plugins=e.plugins.filter((function(e){return e.id!==n.id})),e.titlebar=e.titlebar.filter((function(e){return e.plugin!==n.id})),e.controlbar=e.controlbar.filter((function(e){return e.plugin!==n.id}))},an[hn.toString()]=function(e,t){var n=t.payload,r=e.plugins.find((function(e){return e.id===n.pluginId}));if(r){var i=J({},r);i.ACLAccessGrantedUsers.push(n.userId),i.ACLAccessRemovedUsers=i.ACLAccessRemovedUsers.filter((function(e){return e!==n.userId})),e.plugins=e.plugins.filter((function(e){return e.id!==r.id})).concat([i])}},an[gn.toString()]=function(e,t){var n=t.payload,r=e.plugins.find((function(e){return e.id===n.pluginId}));if(r){var i=J({},r);i.ACLAccessRemovedUsers.push(n.userId),i.ACLAccessGrantedUsers=i.ACLAccessGrantedUsers.filter((function(e){return e!==n.userId})),e.plugins=e.plugins.filter((function(e){return e.id!==r.id})).concat([i])}},an[vn.toString()]=function(e,t){var n=t.payload;e.initialized=n.initialized},an)),En=n.createAction("session/add-consumer"),Sn=n.createAction("websocket/consumer-paused"),wn=n.createAction("websocket/consumer-resumed"),xn=n.createAction("websocket/consumer-closed"),Cn=n.createAction("websocket/consumer-score"),_n=n.createAction("session/reset-consumers"),kn=n.createReducer({activeConsumers:[],closedConsumers:[],consumerScores:{}},((ln={})[De.toString()]=function(e){e.activeConsumers=[],e.closedConsumers=[]},ln[_n.toString()]=function(e){e.activeConsumers=[],e.closedConsumers=[]},ln[En.toString()]=function(e,t){e.closedConsumers.includes(t.payload.id)?e.closedConsumers=e.closedConsumers.filter((function(e){return e!==t.payload.id})):e.activeConsumers=e.activeConsumers.filter((function(e){return e.id!==t.payload.id})).concat([t.payload])},ln[xn.toString()]=function(e,t){e.activeConsumers.find((function(e){return e.id===t.payload.id}))?e.activeConsumers=e.activeConsumers.filter((function(e){return e.id!==t.payload.id})):e.closedConsumers=e.closedConsumers.concat([t.payload.id])},ln[Cn.toString()]=function(e,t){e.consumerScores[t.payload.id]={score:t.payload.score.score,id:t.payload.id,producerScore:t.payload.score.producerScore}},ln[Sn.toString()]=function(e,t){var n=e.activeConsumers.find((function(e){return e.id===t.payload.id}));n&&(n.remotelyPaused=!0,e.activeConsumers=e.activeConsumers.filter((function(e){return e.id!==t.payload.id})).concat([J({},n)]))},ln[wn.toString()]=function(e,t){var n=e.activeConsumers.find((function(e){return e.id===t.payload.id}));n&&(n.remotelyPaused=!1,e.activeConsumers=e.activeConsumers.filter((function(e){return e.id!==t.payload.id})).concat([J({},n)]))},ln)),In=n.createAction("websocket/producer-connect"),Tn=n.createAction("websocket/producer-closed"),Pn=n.createAction("websocket/producer-score"),An=n.createAction("session/reset-producers"),On=n.createReducer({activeProducers:[]},((cn={})[De.toString()]=function(e){e.activeProducers=[]},cn[An.toString()]=function(e){e.activeProducers=[]},cn[In.toString()]=function(e,t){e.activeProducers=e.activeProducers.filter((function(e){return e.id!==t.payload.id})).concat([t.payload])},cn[Tn.toString()]=function(e,t){e.activeProducers=e.activeProducers.filter((function(e){return e.id!==t.payload.id}))},cn[Pn.toString()]=function(e,t){var n=e.activeProducers.find((function(e){return e.id===t.payload.id}));n&&(n.score=t.payload.score[0].score,e.activeProducers=e.activeProducers.filter((function(e){return e.id!==t.payload.id})).concat([J({},n)]))},cn)),Dn=n.configureStore({reducer:{room:at,peers:we,participant:rn,plugin:bn,consumers:kn,producers:On},devTools:!1,middleware:function(e){return Q(Q([],e({serializableCheck:{ignoredActions:["plugins/addView","plugins/removeView"]}}),!0),[D.default.reduxMiddleware()],!1)}});new a.GraphQLClient({url:un.apiBase+"/graphql"});var Nn=function(e){return new a.GraphQLClient({url:(e||un.apiBase)+"/graphql"})},Rn=O.forwardRef((function(e,t){var n={fill:e.fill};return O.createElement(c.StyledIconBase,J({iconAttrs:n,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:t}),O.createElement("path",{fill:e.fill,d:"M13.13 22.19L11.5 18.36C13.07 17.78 14.54 17 15.9 16.09L13.13 22.19M5.64 12.5L1.81 10.87L7.91 8.1C7 9.46 6.22 10.93 5.64 12.5M21.61 2.39C21.61 2.39 16.66 .269 11 5.93C8.81 8.12 7.5 10.53 6.65 12.64C6.37 13.39 6.56 14.21 7.11 14.77L9.24 16.89C9.79 17.45 10.61 17.63 11.36 17.35C13.5 16.53 15.88 15.19 18.07 13C23.73 7.34 21.61 2.39 21.61 2.39M14.54 9.46C13.76 8.68 13.76 7.41 14.54 6.63S16.59 5.85 17.37 6.63C18.14 7.41 18.15 8.68 17.37 9.46C16.59 10.24 15.32 10.24 14.54 9.46M8.88 16.53L7.47 15.12L8.88 16.53M6.24 22L9.88 18.36C9.54 18.27 9.21 18.12 8.91 17.91L4.83 22H6.24M2 22H3.41L8.18 17.24L6.76 15.83L2 20.59V22M2 19.17L6.09 15.09C5.88 14.79 5.73 14.47 5.64 14.12L2 17.76V19.17Z"}))}));Rn.displayName="RocketIcon";var Mn=O.forwardRef((function(e,t){return O.createElement(c.StyledIconBase,J({iconAttrs:{fill:"currentColor"},iconVerticalAlign:"middle",iconViewBox:"0 0 18 18"},e,{ref:t}),O.createElement("path",{path:"currentColor",d:"M1 16h15V1z"}))}));Mn.displayName="FullSignalIcon";var Ln=O.forwardRef((function(e,t){return O.createElement(c.StyledIconBase,J({iconAttrs:{fill:"currentColor"},iconVerticalAlign:"middle",iconViewBox:"0 0 18 18"},e,{ref:t}),O.createElement("path",{fill:"currentColor",fillOpacity:".3",d:"M1 16h15V1z"}),O.createElement("path",{d:"M1 16h9V7z"}))}));Ln.displayName="HalfSignalIcon",O.forwardRef((function(e,t){return O.createElement(c.StyledIconBase,J({iconAttrs:{fill:"currentColor"},iconVerticalAlign:"middle",iconViewBox:"0 0 18 18"},e,{ref:t}),O.createElement("path",{fill:"currentColor",fillOpacity:".3",d:"M1 16h15V1z"}))})).displayName="NoSignalIcon";var zn=O.forwardRef((function(e,t){return O.createElement(c.StyledIconBase,J({iconAttrs:{fill:"currentColor"},iconVerticalAlign:"middle",iconViewBox:"0 0 18 18"},e,{ref:t}),O.createElement("path",{d:"M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"}),O.createElement("path",{d:"M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 4.995z"}))}));zn.displayName="ExclamationIcon";var Bn={primary:{300:"#1A90FF",500:"#2160FD",700:"#054DFF",900:"#0635AA"},secondary:{1e3:"#0E0E0E",900:"#1A1A1A",800:"#262626",700:"#474747"},text:{400:"#C4C4C4",300:"#E0E0E0",200:"#EEEEEE",100:"#F5F5F7"},logos:{google:"#DD4B39",linkedIn:"#0E76A8",apple:"#EEEEEE"},danger:{300:"#FF5A65",500:"#FF414D",700:"#FF2331"},warning:{500:"#FFC300"},success:{500:"#35F2B3"},background:"#1A1A1A"},Fn=function(){return N.default.getParser((null===window||void 0===window?void 0:window.navigator.userAgent)||"")},jn=function(){return Fn().getBrowserName()},Vn=function(){return Fn().getOSVersion()},Wn=function(){return"mobile"===Fn().getPlatformType()},qn=function(){return"Blink"===Fn().getEngineName()},Hn=function(){return"ios"===Fn().getOSName(!0)},Un=function(){return"android"===Fn().getOSName(!0)},Gn=function(){return Fn().satisfies({edge:"<79",firefox:"<22",chrome:"<23",opera:"<18"})},Jn=function(){return!window.RTCPeerConnection||"Internet Explorer"===Fn().getBrowserName()},Yn=function(){return qn()&&document.pictureInPictureEnabled},Kn=function(){return{isMobile:Wn(),browserName:jn(),osName:Fn().getOSName(),browserVersion:Fn().getBrowserVersion(),osVersionName:Vn(),engineName:Fn().getEngineName()}},Zn=function(){return"safari"===Fn().getBrowserName(!0)};function Qn(t){var n,r=t.text,o=t.inStage,a=t.showTextAfter,c=t.loading,s=t.showReloadButton,u=e.useContext(Vr).sessionConfig,d=Et(),f=(null===(n=u.theme)||void 0===n?void 0:n.dimensions)||d,p=f.height,m=f.width;p-=o?104:0;var h=e.useState(0===a),g=h[0],v=h[1];e.useEffect((function(){var e;return a&&(e=setTimeout((function(){return v(!0)}),1e3*a)),function(){return clearTimeout(e)}}),[]);var y=Wn()&&o&&p<m;return A.default.createElement(i.Stack,{height:y?m:p,width:y?"auto":m,bg:"secondary.900",justify:"center",align:"center",transform:y?"rotate(90deg)":"unset",marginTop:y?"-2em":"unset"},c&&A.default.createElement(i.Spinner,{color:"text.100",size:"xl"}),g&&r&&A.default.createElement(i.Text,{textAlign:"center",color:"text.100",fontSize:"lg",px:"6",className:"dyte-client-noSelect"},r),g&&s&&A.default.createElement(i.Button,{onClick:function(){return window.location.reload()},px:"6",py:"2"},A.default.createElement(i.HStack,{spacing:"2"},A.default.createElement(l.Refresh,{color:Bn.text[100],size:"1.5em"}),A.default.createElement(i.Text,null,"Refresh"))))}Qn.defaultProps={text:"",inStage:!1,showTextAfter:0,loading:!0,showReloadButton:!1};var Xn={px:"1px",.5:"0.125em",1:"0.25em",1.5:"0.375em",2:"0.5em",2.5:"0.625em",3:"0.75em",3.5:"0.875em",4:"1em",5:"1.25em",6:"1.5em",7:"1.75em",8:"2em",9:"2.25em",10:"2.5em",12:"3em",14:"3.5em",16:"4em",20:"5em",24:"6em",28:"7em",32:"8em",36:"9em",40:"10em",44:"11em",48:"12em",52:"13em",56:"14em",60:"15em",64:"16em",72:"18em",80:"20em",96:"24em"},$n=J(J(J({},Xn),{max:"max-content",min:"min-content",full:"100%","3xs":"14em","2xs":"16em",xs:"20em",sm:"24em",md:"28em",lg:"32em",xl:"36em","2xl":"42em","3xl":"48em","4xl":"56em","5xl":"64em","6xl":"72em","7xl":"80em","8xl":"90em"}),{container:{sm:"640px",md:"768px",lg:"1024px",xl:"1280px"}}),er=J(J({direction:"ltr",config:{useSystemColorMode:!1,initialColorMode:"light",cssVarPrefix:"chakra"},radii:{none:"0",sm:"0.125em",base:"0.25em",md:"0.375em",lg:"0.5em",xl:"0.75em","2xl":"1em","3xl":"1.5em",full:"9999px"},colors:Bn},{letterSpacings:{tighter:"-0.05em",tight:"-0.025em",normal:"0",wide:"0.025em",wider:"0.05em",widest:"0.1em"},lineHeights:{normal:"normal",none:1,shorter:1.25,short:1.375,base:1.5,tall:1.625,taller:"2",3:".75em",4:"1em",5:"1.25em",6:"1.5em",7:"1.75em",8:"2em",9:"2.25em",10:"2.5em"},fontWeights:{hairline:100,thin:200,light:300,normal:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},fonts:{heading:'"Inter", sans-serif',body:'"Lato", system-ui, sans-serif',mono:"Menlo, monospace"},fontSizes:{xs:"0.75em",sm:"0.875em",md:"1em",lg:"1.125em",xl:"1.25em","2xl":"1.5em","3xl":"1.875em","4xl":"2.25em","5xl":"3em","6xl":"3.75em","7xl":"4.5em","8xl":"6em","9xl":"8em"}}),{sizes:$n,space:Xn});function tr(e){var t=$n[e];return{container:{width:e,height:e,fontSize:"calc("+(null!=t?t:e)+" / 2.5)"},excessLabel:{width:e,height:e},label:{fontSize:"calc("+(null!=t?t:e)+" / 2.5)",lineHeight:"100%"!==e?null!=t?t:e:void 0}}}var nr,rr,ir,or,ar,lr={sizes:{"2xs":tr("4"),xs:tr("6"),sm:tr("8"),md:tr("12"),lg:tr("16"),xl:tr("24"),"2xl":tr("32"),full:tr("100%")}},cr={variants:{disabled:{bg:"text.200"}}},sr={baseStyle:{fontWeight:"medium",borderRadius:4,transition:"all .2s ease-in"},sizes:{md:{fontSize:"md",height:"auto",px:16,py:3},icon:{fontSize:"md"}},variants:{primaryDefault:{bg:"primary.500",color:"text.100",boxShadow:"none",fontSize:"1.075em",fontWeight:600,_hover:{bg:"primary.700",boxShadow:"none"}},controls:{bg:"secondary.1000",color:"text.400",borderRadius:0,_hover:{bg:"secondary.800",color:"text.100"}},primaryDisabled:{bg:"primary.700",color:"text.400",opacity:"0.5",_hover:{cursor:"not-allowed"}},secondaryDefault:{bg:"secondary.800",color:"text.100",_hover:{bg:"secondary.700"}},alternateDefault:{color:"primary.500",_hover:{borderColor:"primary.500"}},danger:{bg:"danger.500",color:"white",_hover:{bg:"danger.700"}},dangerSimple:{bg:"secondary.800",borderColor:"secondary.800",color:"danger.500",_hover:{bg:"secondary.900"},_active:{borderColor:"secondary.800"}},solid:{bg:"primary.500",_hover:{bg:"primary.500"}},solidDark:{border:"1px",borderColor:"secondary.800",bg:"secondary.800",color:"text.100",_hover:{color:"text.100",border:"1px",borderColor:"text.400"}},solidDarker:{border:"2px",borderColor:"secondary.900",bg:"secondary.900",color:"text.100",_hover:{fill:"primary.300",color:"text.100",borderColor:"primary.500",bg:"secondary.800"}},alternateDark:{border:"1px",borderColor:"secondary.700",bg:"secondary.800",color:"text.100",_hover:{bg:"secondary.700"}}},defaultProps:{size:"md",variant:"primaryDefault"}},ur={baseStyle:{fontWeight:"500",color:"text.100",lineHeight:"150%"},variants:{content:{color:"primary.900"}}},dr={baseStyle:{fontWeight:"normal",lineHeight:"150%",color:"text.100"},variants:{subtext:{fontSize:"12px",color:"#757575"}}},fr={baseStyle:{bg:"secondary.900",color:"text.100"}},pr={variants:{primary:{color:"text.100",height:"3em",backgroundColor:"secondary.1000",border:"1px",borderColor:"secondary.700",transition:".2s",boxSizing:"border-box",borderRadius:"4px",errorBorderColor:"danger.500",fontSize:"1.125em",_placeholder:{color:"text.300",fontWeight:"light"},_focus:{bgColor:"secondary.1000",borderColor:"primary.300"}},dark:{field:{backgroundColor:"secondary.900",_placeholder:{color:"text.400",fontSize:"1em"}}},disabled:{color:"text.100",height:"3em",backgroundColor:"secondary.800",border:"1px",borderColor:"secondary.800",boxShadow:"0px 4px 8px secondary.900",transition:".2s",boxSizing:"border-box",borderRadius:"4px",errorBorderColor:"danger.500",fontSize:"1.125em",_placeholder:{color:"text.400",fontWeight:"light",bgColor:"unset"},_focus:{bgColor:"secondary.1000",borderColor:"primary.300"}}}},mr={baseStyle:{ml:2,color:"text.200",fontWeight:"normal"}},hr={variants:{dark:{backgroundColor:"secondary.900",_placeholder:{color:"text.400",fontSize:"1em"}}}},gr={parts:["menu","item","list","groupTitle","divider"],baseStyle:{menu:{boxShadow:"lg",rounded:"lg",flexDirection:"column",py:"2",p:"4"},item:{fontWeight:"medium",lineHeight:"normal",bg:"secondary.800",color:"text.200",py:"3",_first:{bg:"secondary.800"},_checked:{fill:"text.300",bg:"secondary.800"},_hover:{bg:"secondary.1000"},_focus:{bg:"none"}},list:{bg:"secondary.800",boxShadow:"0 10px 15px -3px rgb(0 0 0 / 0.2), 0 4px 6px -4px rgb(0 0 0 / 0.2)",border:"none"},groupTitle:{color:"text.100",fontSize:"md"},divider:{borderColor:"secondary.800"}},variants:{chat:{menu:{background:"transparent"},item:{background:"transparent",_first:{bg:"none"},_checked:{bg:"none"},_hover:{bg:"none"},_focus:{bg:"none"}},list:{background:"transparent"}}}},vr=function(e){var t=e.scrollBehavior;return{borderRadius:"md",bg:u.mode("white","gray.700")(e),color:"inherit",my:"3.75em",zIndex:"modal",maxH:"inside"===t?"calc(100% - 7.5em)":void 0,boxShadow:u.mode("lg","dark-lg")(e)}},yr={baseStyle:function(e){return{dialog:vr(e)}},parts:["content","header","body","footer"],variants:{primary:{header:{bg:"secondary.1000",color:"text.100",textAlign:"center",borderRadius:"8px 8px 0 0",paddingTop:"8"},body:{bg:"secondary.1000",color:"text.100"},footer:{bg:"secondary.1000",color:"text.100",borderRadius:"0 0 8px 8px",paddingBottom:"6"}}}},br={parts:["content","header","body","footer"],variants:{primary:{header:{bg:"secondary.800",color:"text.200",textAlign:"left",borderRadius:"8px 8px 0 0",fontSize:"lg",fontWeight:600,borderColor:"secondary.800"},body:{bg:"secondary.800",color:"text.200",borderColor:"secondary.800"},footer:{bg:"secondary.800",color:"text.200",borderColor:"secondary.800"},content:{bg:"secondary.800",borderColor:"secondary.800"}}}},Er={sizes:{sm:{control:{h:3,w:3},label:{fontSize:"sm"},icon:{fontSize:"0.45em"}},md:{control:{w:4,h:4},label:{fontSize:"md"},icon:{fontSize:"0.625em"}},lg:{control:{w:5,h:5},label:{fontSize:"lg"},icon:{fontSize:"0.625em"}}},variants:{poll:{control:{display:"flex",div:{svg:{width:"100%"}},_checked:{backgroundColor:"text.100",borderColor:"text.100",color:"secondary.700",_hover:{backgroundColor:"text.100",borderColor:"text.100"}}}},primary:{control:{borderColor:"secondary.700",_checked:{backgroundColor:"secondary.700",borderColor:"secondary.700",color:"text.100",_hover:{backgroundColor:"secondary.800",boxShadow:"0 0 0 1px var(--text-400)",borderColor:"secondary.800"}},_hover:{borderColor:"secondary.800"},_focus:{boxShadow:"0 0 0 1px var(--text-400)"},_disabled:{borderColor:"secondary.900",background:"none"}}}},defaultProps:{variant:"primary",display:"block"},baseStyle:{display:"block"}},Sr={defaultProps:{spacing:"0.5em"}},wr=u.cssVar("spinner-size"),xr={baseStyle:{width:[wr.reference],height:[wr.reference]},sizes:{xs:(nr={},nr[wr.variable]="0.75em",nr),sm:(rr={},rr[wr.variable]="1em",rr),md:(ir={},ir[wr.variable]="1.5em",ir),lg:(or={},or[wr.variable]="2em",or),xl:(ar={},ar[wr.variable]="3em",ar)},defaultProps:{size:"md"}},Cr="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var _r,kr=(function(e,t){var n="__lodash_hash_undefined__",r=9007199254740991,i="[object Arguments]",o="[object Function]",a="[object Object]",l=/^\[object .+?Constructor\]$/,c=/^(?:0|[1-9]\d*)$/,s={};s["[object Float32Array]"]=s["[object Float64Array]"]=s["[object Int8Array]"]=s["[object Int16Array]"]=s["[object Int32Array]"]=s["[object Uint8Array]"]=s["[object Uint8ClampedArray]"]=s["[object Uint16Array]"]=s["[object Uint32Array]"]=!0,s[i]=s["[object Array]"]=s["[object ArrayBuffer]"]=s["[object Boolean]"]=s["[object DataView]"]=s["[object Date]"]=s["[object Error]"]=s[o]=s["[object Map]"]=s["[object Number]"]=s[a]=s["[object RegExp]"]=s["[object Set]"]=s["[object String]"]=s["[object WeakMap]"]=!1;var u="object"==typeof Cr&&Cr&&Cr.Object===Object&&Cr,d="object"==typeof self&&self&&self.Object===Object&&self,f=u||d||Function("return this")(),p=t&&!t.nodeType&&t,m=p&&e&&!e.nodeType&&e,h=m&&m.exports===p,g=h&&u.process,v=function(){try{var e=m&&m.require&&m.require("util").types;return e||g&&g.binding&&g.binding("util")}catch(e){}}(),y=v&&v.isTypedArray;function b(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}var E,S,w,x=Array.prototype,C=Function.prototype,_=Object.prototype,k=f["__core-js_shared__"],I=C.toString,T=_.hasOwnProperty,P=(E=/[^.]+$/.exec(k&&k.keys&&k.keys.IE_PROTO||""))?"Symbol(src)_1."+E:"",A=_.toString,O=I.call(Object),D=RegExp("^"+I.call(T).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),N=h?f.Buffer:void 0,R=f.Symbol,M=f.Uint8Array,L=N?N.allocUnsafe:void 0,z=(S=Object.getPrototypeOf,w=Object,function(e){return S(w(e))}),B=Object.create,F=_.propertyIsEnumerable,j=x.splice,V=R?R.toStringTag:void 0,W=function(){try{var e=pe(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),q=N?N.isBuffer:void 0,H=Math.max,U=Date.now,G=pe(f,"Map"),J=pe(Object,"create"),Y=function(){function e(){}return function(t){if(!_e(t))return{};if(B)return B(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function K(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Z(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Q(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function X(e){var t=this.__data__=new Z(e);this.size=t.size}function $(e,t){var n=Ee(e),r=!n&&be(e),i=!n&&!r&&we(e),o=!n&&!r&&!i&&Ie(e),a=n||r||i||o,l=a?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],c=l.length;for(var s in e)!t&&!T.call(e,s)||a&&("length"==s||i&&("offset"==s||"parent"==s)||o&&("buffer"==s||"byteLength"==s||"byteOffset"==s)||me(s,c))||l.push(s);return l}function ee(e,t,n){(void 0!==n&&!ye(e[t],n)||void 0===n&&!(t in e))&&re(e,t,n)}function te(e,t,n){var r=e[t];T.call(e,t)&&ye(r,n)&&(void 0!==n||t in e)||re(e,t,n)}function ne(e,t){for(var n=e.length;n--;)if(ye(e[n][0],t))return n;return-1}function re(e,t,n){"__proto__"==t&&W?W(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}K.prototype.clear=function(){this.__data__=J?J(null):{},this.size=0},K.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},K.prototype.get=function(e){var t=this.__data__;if(J){var r=t[e];return r===n?void 0:r}return T.call(t,e)?t[e]:void 0},K.prototype.has=function(e){var t=this.__data__;return J?void 0!==t[e]:T.call(t,e)},K.prototype.set=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=J&&void 0===t?n:t,this},Z.prototype.clear=function(){this.__data__=[],this.size=0},Z.prototype.delete=function(e){var t=this.__data__,n=ne(t,e);return!(n<0||(n==t.length-1?t.pop():j.call(t,n,1),--this.size,0))},Z.prototype.get=function(e){var t=this.__data__,n=ne(t,e);return n<0?void 0:t[n][1]},Z.prototype.has=function(e){return ne(this.__data__,e)>-1},Z.prototype.set=function(e,t){var n=this.__data__,r=ne(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this},Q.prototype.clear=function(){this.size=0,this.__data__={hash:new K,map:new(G||Z),string:new K}},Q.prototype.delete=function(e){var t=fe(this,e).delete(e);return this.size-=t?1:0,t},Q.prototype.get=function(e){return fe(this,e).get(e)},Q.prototype.has=function(e){return fe(this,e).has(e)},Q.prototype.set=function(e,t){var n=fe(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this},X.prototype.clear=function(){this.__data__=new Z,this.size=0},X.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},X.prototype.get=function(e){return this.__data__.get(e)},X.prototype.has=function(e){return this.__data__.has(e)},X.prototype.set=function(e,t){var n=this.__data__;if(n instanceof Z){var r=n.__data__;if(!G||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Q(r)}return n.set(e,t),this.size=n.size,this};var ie,oe=function(e,t,n){for(var r=-1,i=Object(e),o=n(e),a=o.length;a--;){var l=o[ie?a:++r];if(!1===t(i[l],l,i))break}return e};function ae(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":V&&V in Object(e)?function(e){var t=T.call(e,V),n=e[V];try{e[V]=void 0;var r=!0}catch(e){}var i=A.call(e);return r&&(t?e[V]=n:delete e[V]),i}(e):function(e){return A.call(e)}(e)}function le(e){return ke(e)&&ae(e)==i}function ce(e){return!(!_e(e)||function(e){return!!P&&P in e}(e))&&(xe(e)?D:l).test(function(e){if(null!=e){try{return I.call(e)}catch(e){}try{return e+""}catch(e){}}return""}(e))}function se(e){if(!_e(e))return function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}(e);var t=he(e),n=[];for(var r in e)("constructor"!=r||!t&&T.call(e,r))&&n.push(r);return n}function ue(e,t,n,r,i){e!==t&&oe(t,(function(o,l){if(i||(i=new X),_e(o))!function(e,t,n,r,i,o,l){var c=ge(e,n),s=ge(t,n),u=l.get(s);if(u)ee(e,n,u);else{var d,f,p,m,h,g=o?o(c,s,n+"",e,t,l):void 0,v=void 0===g;if(v){var y=Ee(s),b=!y&&we(s),E=!y&&!b&&Ie(s);g=s,y||b||E?Ee(c)?g=c:ke(h=c)&&Se(h)?g=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}(c):b?(v=!1,g=function(e,t){if(t)return e.slice();var n=e.length,r=L?L(n):new e.constructor(n);return e.copy(r),r}(s,!0)):E?(v=!1,p=(d=s).buffer,m=new p.constructor(p.byteLength),new M(m).set(new M(p)),f=m,g=new d.constructor(f,d.byteOffset,d.length)):g=[]:function(e){if(!ke(e)||ae(e)!=a)return!1;var t=z(e);if(null===t)return!0;var n=T.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&I.call(n)==O}(s)||be(s)?(g=c,be(c)?g=function(e){return function(e,t,n,r){var i=!n;n||(n={});for(var o=-1,a=t.length;++o<a;){var l=t[o],c=r?r(n[l],e[l],l,n,e):void 0;void 0===c&&(c=e[l]),i?re(n,l,c):te(n,l,c)}return n}(e,Te(e))}(c):_e(c)&&!xe(c)||(g=function(e){return"function"!=typeof e.constructor||he(e)?{}:Y(z(e))}(s))):v=!1}v&&(l.set(s,g),i(g,s,r,o,l),l.delete(s)),ee(e,n,g)}}(e,t,l,n,ue,r,i);else{var c=r?r(ge(e,l),o,l+"",e,t,i):void 0;void 0===c&&(c=o),ee(e,l,c)}}),Te)}function de(e,t){return ve(function(e,t,n){return t=H(void 0===t?e.length-1:t,0),function(){for(var r=arguments,i=-1,o=H(r.length-t,0),a=Array(o);++i<o;)a[i]=r[t+i];i=-1;for(var l=Array(t+1);++i<t;)l[i]=r[i];return l[t]=n(a),b(e,this,l)}}(e,t,Oe),e+"")}function fe(e,t){var n,r,i=e.__data__;return("string"==(r=typeof(n=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof t?"string":"hash"]:i.map}function pe(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return ce(n)?n:void 0}function me(e,t){var n=typeof e;return!!(t=null==t?r:t)&&("number"==n||"symbol"!=n&&c.test(e))&&e>-1&&e%1==0&&e<t}function he(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||_)}function ge(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}var ve=function(e){var t=0,n=0;return function(){var r=U(),i=16-(r-n);if(n=r,i>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(W?function(e,t){return W(e,"toString",{configurable:!0,enumerable:!1,value:(n=t,function(){return n}),writable:!0});var n}:Oe);function ye(e,t){return e===t||e!=e&&t!=t}var be=le(function(){return arguments}())?le:function(e){return ke(e)&&T.call(e,"callee")&&!F.call(e,"callee")},Ee=Array.isArray;function Se(e){return null!=e&&Ce(e.length)&&!xe(e)}var we=q||function(){return!1};function xe(e){if(!_e(e))return!1;var t=ae(e);return t==o||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}function Ce(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=r}function _e(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function ke(e){return null!=e&&"object"==typeof e}var Ie=y?function(e){return function(t){return e(t)}}(y):function(e){return ke(e)&&Ce(e.length)&&!!s[ae(e)]};function Te(e){return Se(e)?$(e,!0):se(e)}var Pe,Ae=(Pe=function(e,t,n){ue(e,t,n)},de((function(e,t){var n=-1,r=t.length,i=r>1?t[r-1]:void 0,o=r>2?t[2]:void 0;for(i=Pe.length>3&&"function"==typeof i?(r--,i):void 0,o&&function(e,t,n){if(!_e(n))return!1;var r=typeof t;return!!("number"==r?Se(n)&&me(t,n.length):"string"==r&&t in n)&&ye(n[t],e)}(t[0],t[1],o)&&(i=r<3?void 0:i,r=1),e=Object(e);++n<r;){var a=t[n];a&&Pe(e,a,n,i)}return e})));function Oe(e){return e}e.exports=Ae}(_r={exports:{}},_r.exports),_r.exports);function Ir(e){var t=e.replace("#","");return(299*parseInt(t.substr(0,2),16)+587*parseInt(t.substr(2,2),16)+114*parseInt(t.substr(4,2),16))/1e3>155}function Tr(e,t){var n=parseInt(e.substring(1,3),16),r=parseInt(e.substring(3,5),16),i=parseInt(e.substring(5,7),16);return n=parseInt(""+n*(100+t)/100),r=(r=parseInt(""+r*(100+t)/100))<255?r:255,i=(i=parseInt(""+i*(100+t)/100))<255?i:255,"#"+(1===(n=n<255?n:255).toString(16).length?"0"+n.toString(16):n.toString(16))+(1===r.toString(16).length?"0"+r.toString(16):r.toString(16))+(1===i.toString(16).length?"0"+i.toString(16):i.toString(16))}var Pr,Ar,Or,Dr=function(e,t){return[Tr(e,20+t),e,Tr(e,-20-t),Tr(e,-30-t)]},Nr=function(e){var t=e;if((null==t?void 0:t.primary)&&"object"==typeof t.primary&&t.primary[300])return e;if((null==t?void 0:t.primary)&&"string"==typeof t.primary&&(t.primary=Dr(t.primary,25)),(null==t?void 0:t.secondary)&&"string"==typeof e.secondary){var n=Dr(t.secondary,10);t.secondary=Ir(t.secondary)?n:n.reverse()}if((null==t?void 0:t.text)&&"string"==typeof e.text){var r=Dr(t.text,-10);t.text=Ir(t.text)?r.reverse():r}var i={primary:{},secondary:{},text:{}};return(null==t?void 0:t.primary)?i.primary={300:t.primary[0],500:t.primary[1],700:t.primary[2],900:t.primary[3]}:delete i.primary,(null==t?void 0:t.secondary)?i.secondary={1e3:t.secondary[0],900:t.secondary[1],800:t.secondary[2],700:t.secondary[3]}:delete i.secondary,(null==t?void 0:t.text)?i.text={400:t.text[0],300:t.text[1],200:t.text[2],100:t.text[3]}:delete i.text,(null==t?void 0:t.background)&&Object.assign(i,{background:t.background}),i},Rr=function(t){var n,r=t.children,o=e.useState(null),a=o[0],l=o[1],c=e.useContext(Vr).sessionConfig,s=function(e){l(function(e){return i.extendTheme(J(J({},er),{components:{Avatar:lr,Box:cr,Button:sr,FormLabel:mr,Heading:ur,Popover:br,Text:dr,Input:pr,Menu:gr,Modal:yr,Tooltip:fr,Textarea:hr,Checkbox:Er,Stack:Sr,Spinner:xr},colors:kr(er.colors,Nr((null==e?void 0:e.colors)||{})),logo:(null==e?void 0:e.logo)||"/dyte_logo.svg"}))}(e))};if(e.useEffect((function(){((null==c?void 0:c.theme.colors)||(null==c?void 0:c.theme.header.elements.logo))&&s({logo:null==c?void 0:c.theme.header.elements.logo,colors:(null==c?void 0:c.theme.colors)||{}})}),[c]),e.useEffect((function(){s({})}),[]),!a||!c)return A.default.createElement(Qn,null);var u="#dyte-base-elem";return(null===(n=document.getElementById("dyte-shadow"))||void 0===n?void 0:n.shadowRoot)&&(u=":host, :root"),A.default.createElement(i.ChakraProvider,{resetCSS:!0,theme:a,cssVarsRoot:u},r)};!function(e){e.skip="SKIP",e.onAccept="ON_ACCEPT",e.skipOnPrivilegedUserEntry="SKIP_ON_PRIVILEGED_USER_ENTRY",e.skipOnAccept="SKIP_ON_ACCEPT"}(Pr||(Pr={})),function(e){e.groupCall="GROUP_CALL",e.webinar="WEBINAR",e.audioRoom="AUDIO_ROOM"}(Ar||(Ar={})),function(e){e.SKIP="skip",e.SKIP_ON_PRIVILEGED_USER_ENTRY="skipOnPrivilegedUserEntry",e.ON_ACCEPT="skipOnAccept"}(Or||(Or={}));var Mr,Lr=function(e,t){var n,r=J({},e),i=J(J({},r.control_bar),{is_enabled:void 0!==t.controlBar?t.controlBar:r.control_bar.is_enabled}),o=J(J({},r.header),{is_enabled:void 0!==t.header?t.header:r.header.is_enabled});if(null==t?void 0:t.controlBarElements){var a=J({},i.elements);void 0!==(null==t?void 0:t.controlBarElements.chat)&&(a.chat=t.controlBarElements.chat),void 0!==(null==t?void 0:t.controlBarElements.fullscreen)&&(a.fullscreen=t.controlBarElements.fullscreen),void 0!==(null==t?void 0:t.controlBarElements.participants)&&(a.participants=t.controlBarElements.participants),void 0!==(null==t?void 0:t.controlBarElements.plugins)&&(a.plugins=t.controlBarElements.plugins),void 0!==(null==t?void 0:t.controlBarElements.polls)&&(a.polls=t.controlBarElements.polls),void 0!==(null==t?void 0:t.controlBarElements.screenShare)&&(a.screenshare=t.controlBarElements.screenShare),void 0!==(null==t?void 0:t.controlBarElements.share)&&(a.invite=t.controlBarElements.share),a.reactions=!1,a.layout=!1,i.elements=a}if(null==t?void 0:t.headerElements){a=J({},o.elements);void 0!==(null==t?void 0:t.headerElements.clock)&&(a.timer=t.headerElements.clock),void 0!==(null==t?void 0:t.headerElements.participantCount)&&(a.participant_count=t.headerElements.participantCount),void 0!==(null==t?void 0:t.headerElements.title)&&(a.title=t.headerElements.title),a.change_layout=!1,o.elements=a}if(void 0!==(null==t?void 0:t.logo)&&""!==t.logo&&(o.elements.logo=t.logo),r.header=o,r.control_bar=i,null==t?void 0:t.colors){var l=J({},r.colors);t.colors.primary&&(l.primary=t.colors.primary),(null==t?void 0:t.colors.secondary)&&(l.secondary=t.colors.secondary),(null==t?void 0:t.colors.textPrimary)&&(l.text=t.colors.textPrimary,l.textPrimary=t.colors.textPrimary),(null==t?void 0:t.colors.videoBackground)&&(l.background=t.colors.videoBackground,l.videoBackground=t.colors.videoBackground),r.colors=l}return(null==t?void 0:t.dimensions)&&(r.dimensions=t.dimensions),(null==t?void 0:t.waitingRoom)&&(r.waiting_room={is_enabled:!0,enable_preview:void 0===(null===(n=t.waitingRoom)||void 0===n?void 0:n.showSelf)||t.waitingRoom.showSelf,element:t.waitingRoom.roomElement}),void 0!==t.aloneHereElement&&(r.alone_here={is_enabled:t.aloneHereElement}),r.pip_mode=!0,r},zr={permissions:{view_type:Ar.groupCall,accept_waiting_requests:!1,accept_present_requests:!1,request_produce:!1,can_allow_participant_audio:!1,can_allow_participant_screensharing:!1,can_allow_participant_video:!1,request_kick_participant:!1,kick_participant:!1,pin_participant:!1,can_edit_display_name:!1,can_record:!1,waiting_room_type:Pr.skipOnAccept,plugins:{can_close:!0,can_start:!0,can_edit_acl:!1,config:{}},polls:{can_create:!0,can_vote:!0,can_view:!0},produce:{video:{allow:!0,quality:"vga",frame_rate:24},audio:!0,screenshare:{allow:!0,quality:"hd",frame_rate:5}},chat:{public:{can_send:!0,text:!0,files:!0},private:{can_send:!1,can_receive:!1,text:!1,files:!1}},reactions:!1,hidden_participant:!1,is_recorder:!1,show_participant_list:!0,can_change_participant_role:!1,can_change_theme:!1,can_present:!1,max_screenshare_count:1},theme:{setup_screen:{is_enabled:!1},alone_here:{is_enabled:!1},waiting_room:{is_enabled:!1,enable_preview:!0},control_bar:{is_enabled:!0,elements:{plugins:!0,screenshare:!0,invite:!1,participants:!0,chat:!0,reactions:!1,polls:!0,fullscreen:!0,layout:!0}},header:{is_enabled:!0,elements:{timer:!0,title:!0,participant_count:!0,change_layout:!0}},pip_mode:!0,auto_tune:!0,grid:{multi:{maxVideoCount:6,videoFit:"cover"},single:{maxVideoCount:6,videoFit:"cover"},defaultView:"MULTI"},controls:{pip_toggle:!1}},version:"0.5.0"};Ar.groupCall,Pr.skipOnAccept;var Br="hXgU8Wc8pwuGNq9ms5q9Hh";"undefined"!=typeof process&&(null===(Mr=null===process||void 0===process?void 0:process.env)||void 0===Mr?void 0:Mr.FLAGSMITH_ENVIRONMENT_KEY)&&(Br=process.env.FLAGSMITH_ENVIRONMENT_KEY);var Fr=new(function(){function e(e){void 0===e&&(e=Br),this.flags={},this.environmentKey=null,this.environmentKey=e,this.identify=this.identify.bind(this),this.getValue=this.getValue.bind(this),this.hasFeature=this.hasFeature.bind(this),this.getAllFlags=this.getAllFlags.bind(this)}return e.prototype.identify=function(e,t,n){return void 0===t&&(t={}),void 0===n&&(n=!1),K(this,void 0,void 0,(function(){var r,i,o,a;return Z(this,(function(l){switch(l.label){case 0:r=JSON.parse(JSON.stringify(t)),i=Object.entries(r).map((function(e){return{trait_key:e[0],trait_value:e[1]}})),l.label=1;case 1:return l.trys.push([1,3,,4]),o="_"+(Math.random()+1).toString(36).substring(2),[4,R.default.post("https://api.flagsmith.com/api/v1/identities/",{identifier:e+(n?o:""),traits:i},{headers:{"Content-Type":"application/json","X-Environment-Key":this.environmentKey}})];case 2:return a=l.sent(),this.flags=function(e){void 0===e&&(e=[]);var t={};return e.forEach((function(e){t[e.feature.name]={enabled:e.enabled,value:e.feature_state_value}})),t}(a.data.flags||[]),[3,4];case 3:return l.sent(),[3,4];case 4:return[2,this.flags]}}))}))},e.prototype.getValue=function(e){return this.flags&&this.flags[e]&&this.flags[e].value},e.prototype.hasFeature=function(e){return this.flags&&this.flags[e]&&this.flags[e].enabled},e.prototype.getAllFlags=function(){return this.flags},e}()),jr=new(function(){function e(){this.level=0}return e.prototype.process=function(e){var t={};try{Object.getOwnPropertyNames(e||{}).forEach((function(n){try{t[n]=JSON.stringify(e[n])}catch(e){t[n]="Failed to stringify"}}))}catch(e){}return t},e.prototype.init=function(e){"trace"===e?this.level=3:"log"===e?this.level=2:"error"===e&&(this.level=1)},e.prototype.trace=function(e,t){this.level<3||D.default.track(e,this.process(t))},e.prototype.warn=function(e,t){this.level<2||D.default.track(e,this.process(t))},e.prototype.error=function(e,t){this.level<1||D.default.track(e,this.process(t))},e}()),Vr=e.createContext(null),Wr=function(n){var r=t.useDispatch(),i=e.useContext(a.ClientContext),o=e.useState(null),l=o[0],c=o[1],s=n.children,u=n.meeting,d=e.useState(J({},u.config)),f=d[0],p=d[1],m=e.useRef(f),h=t.useSelector((function(e){return e.participant.peerId})),g=t.useSelector((function(e){return e.room.roomViewType})),v=e.useState([]),y=v[0],b=v[1],E=e.useState(!1),S=E[0],w=E[1],x=t.useSelector((function(e){return e.participant.id}));m.current=f;var C=function(e){var t,n,r,i,o,a,l,c=J({},e);if("multi"===(null===(r=null===(n=null===(t=c.theme)||void 0===t?void 0:t.grid)||void 0===n?void 0:n.defaultView)||void 0===r?void 0:r.toLowerCase())?Dn.dispatch(Ze("multi")):"highlighted"===(null===(a=null===(o=null===(i=c.theme)||void 0===i?void 0:i.grid)||void 0===o?void 0:o.defaultView)||void 0===a?void 0:a.toLowerCase())&&Dn.dispatch(Ze("highlighted")),c.theme=Lr(c.theme,u._uiConfig),u.config=c,"fillParent"===(null===(l=u.config.theme.dimensions)||void 0===l?void 0:l.mode)){var s=document.getElementsByClassName("dyte-client-root")[0];s&&(s.style="width: 100%; height: 100%;")}p(c)},_=function(e){return K(void 0,void 0,void 0,(function(){var n;return Z(this,(function(i){return n=e.hasOwnProperty("uiConfig")||e.hasOwnProperty("role")?function(e,t){var n,r,i,o,a,l,c,s,u,d,f,p,m,h,g,v,y,b,E,S,w,x,C=J({},e);if(t.role){var _=J({},C.permissions);void 0!==(null===(n=t.role.permissions)||void 0===n?void 0:n.acceptWaitingRequests)&&(_.accept_waiting_requests=t.role.permissions.acceptWaitingRequests),void 0!==(null===(r=t.role.permissions)||void 0===r?void 0:r.allowRecording)&&(_.can_record=t.role.permissions.allowRecording),void 0!==(null===(i=t.role.permissions)||void 0===i?void 0:i.editDisplayName)&&(_.can_edit_display_name=t.role.permissions.editDisplayName),void 0!==(null===(o=t.role.permissions)||void 0===o?void 0:o.disableParticipantAudio)&&(_.can_allow_participant_audio=t.role.permissions.disableParticipantAudio),void 0!==(null===(a=t.role.permissions)||void 0===a?void 0:a.disableParticipantScreensharing)&&(_.can_allow_participant_screensharing=t.role.permissions.disableParticipantScreensharing),void 0!==(null===(l=t.role.permissions)||void 0===l?void 0:l.disableParticipantVideo)&&(_.can_allow_participant_video=t.role.permissions.disableParticipantVideo),void 0!==(null===(c=t.role.permissions)||void 0===c?void 0:c.kickParticipants)&&(_.kick_participant=t.role.permissions.kickParticipants),void 0!==(null===(s=t.role.permissions)||void 0===s?void 0:s.pinParticipant)&&(_.pin_participant=t.role.permissions.pinParticipant),(null===(u=t.role)||void 0===u?void 0:u.plugins)&&(_.plugins={can_start:t.role.plugins.start,can_close:t.role.plugins.close,can_edit_acl:t.role.plugins.canEditAcl,config:{}},(null===(f=null===(d=t.role)||void 0===d?void 0:d.pluginConfig)||void 0===f?void 0:f.hostOnlyControl)&&t.role.pluginConfig.hostOnlyControl.forEach((function(e){_.plugins.config[e]={defaultAccess:"whitelist"}})),(null===(m=null===(p=t.role)||void 0===p?void 0:p.pluginConfig)||void 0===m?void 0:m.handlesViewOnly)&&t.role.pluginConfig.hostOnlyControl.forEach((function(e){void 0===_.plugins.config[e]&&(_.plugins.config[e]={defaultAccess:"blacklist"}),_.plugins.config[e].handlesViewOnly=!0}))),(null===(h=t.role)||void 0===h?void 0:h.produce)&&(_.produce={video:J(J({},_.produce.video),{allow:void 0===(null===(g=t.role.produce)||void 0===g?void 0:g.video)||t.role.produce.video}),audio:void 0===t.role.produce.audio||t.role.produce.audio,screenshare:J(J({},_.produce.screenshare),{allow:void 0===(null===(v=t.role.produce)||void 0===v?void 0:v.screenshare)||t.role.produce.screenshare})},_.polls=J(J({},_.polls),{can_create:void 0===t.role.produce.polls||t.role.produce.polls}),(null===(y=t.role.produce)||void 0===y?void 0:y.chat)&&(_.chat=J(J({},_.chat),{public:J(J({},t.role.produce.chat),{can_send:!0})}))),t.role.flags&&(_.hidden_participant=t.role.flags.hiddenParticipant,_.is_recorder=t.role.flags.recorder),_.show_participant_list=!0,_.can_change_participant_role=!1,_.view_type=t.roomViewType?Ar[t.roomViewType]:Ar.groupCall,_.reactions=!1,_.request_produce=!(Ar[t.roomViewType]!==Ar.webinar||!(null===(E=null===(b=t.role)||void 0===b?void 0:b.webinar)||void 0===E?void 0:E.viewOnly)),_.request_kick_participant=!1,_.waiting_room_type=t.role.waitingRoom?Pr[t.role.waitingRoom]:Pr.skip,_.accept_present_requests=!(Ar[t.roomViewType]!==Ar.webinar||(null===(w=null===(S=t.role)||void 0===S?void 0:S.webinar)||void 0===w?void 0:w.viewOnly)||!(null===(x=t.role.permissions)||void 0===x?void 0:x.acceptWaitingRequests)),C.permissions=_}return t.uiConfig&&(C.theme=Lr(C.theme,t.uiConfig)),C}(u.config,e):e,t.batch((function(){var e,t;if(r(Ct({canAllowParticipantAudio:n.permissions.can_allow_participant_audio,canAllowParticipantVideo:n.permissions.can_allow_participant_video})),r(Ie(!0)),r(Ee({id:h,view_type:null===(e=n.permissions)||void 0===e?void 0:e.view_type,preset_name:n.preset_name})),(null===(t=n.permissions)||void 0===t?void 0:t.view_type)&&r($e(n.permissions.view_type)),n.permissions.view_type===ut.webinar&&g!==ut.webinar&&r(Ht(!0)),f.permissions.view_type!==ut.webinar&&n.permissions.view_type===ut.webinar)r(Ht(!0)),r(Ut(n.permissions.can_present)),r(be());else if(n.permissions.hidden_participant){var i={hidden:!1,joinStageSettings:gt.ALLOWED};r(qt(i)),r(ye({hidden:!1}))}})),C(J({},kr(u.config,n))),[2]}))}))};e.useEffect((function(){x&&function(){K(this,void 0,void 0,(function(){var e,t;return Z(this,(function(n){return w(!0),Fr.hasFeature(mt.LOGROCKET)&&(e=JSON.parse(Fr.getValue(mt.LOGROCKET).toString()),D.default.init("bhibaz/dyte",{release:"0.37.0",dom:e.dom}),jr.init(e.level)),t=Fr.getAllFlags(),jr.trace("Flagsmith Flags List For Current Participant: ",t),Object.keys(t).forEach((function(e){jr.trace("Flagsmith Flag "+e+" as "+t[e].enabled,t[e])})),[2]}))}))}()}),[x]),e.useEffect((function(){var e,t;u&&(t=u.connectionConfig.authToken,K(void 0,void 0,void 0,(function(){var e;return Z(this,(function(n){switch(n.label){case 0:return[4,fetch(un.apiBase+"/auth/basicUserDetails?authToken="+t,{method:"GET",headers:{authorization:"Bearer "+t,"dyte-tracing-id":h}})];case 1:return[4,n.sent().json()];case 2:return(e=n.sent()).errors?r(wt(J({},e.errors[0]))):e.user&&(D.default.identify(e.user.id,{name:e.user.name,email:e.user.email}),e.user.email.endsWith("@anon.dyte.in")&&(e.user.name===e.user.email.split("@anon")[0]&&delete e.user.name,delete e.user.email),r(St(J(J({},e.user),{authToken:t}))),i.setHeader("Authorization","Bearer "+t),c(t)),[2]}}))})),u._setUIConfig=C,u._controlsHook=function(e){b((function(t){return t.concat(e)}))},"e305a6cd-1da1-407d-879b-449ba721702f"===(null===(e=u.connectionConfig)||void 0===e?void 0:e.clientId)&&document.getElementsByTagName("html")[0].classList.add("dyte-client-noScrollbar"))}),[u]),e.useEffect((function(){i.setHeader("Authorization","Bearer "+u.connectionConfig.authToken),i.setHeader("dyte-tracing-id",h)}),[i]),e.useEffect((function(){i.setHeader("Authorization","Bearer "+u.connectionConfig.authToken),i.setHeader("dyte-tracing-id",h),r(De()),r(zt(!1)),r(ae());var e,t=document.getElementsByClassName("dyte-client-root")[0],n=function(){var e;if(t&&"fillParent"===(null===(e=u.config.theme.dimensions)||void 0===e?void 0:e.mode)){var n=t.offsetWidth,r=t.offsetHeight;t.parentElement&&(0===r&&(r=t.parentElement.offsetHeight),0===n&&(n=t.parentElement.offsetWidth));var i=J({},m.current);i.theme.dimensions.height=r,i.theme.dimensions.width=n,C(i)}};return window.ResizeObserver&&(e=new ResizeObserver(n)).observe(t),window.onresize=function(){var e;if("fillParent"===(null===(e=u.config.theme.dimensions)||void 0===e?void 0:e.mode)){var t=J({},m.current);t.theme.dimensions.height=0,t.theme.dimensions.width=0,C(t),setTimeout(n,200)}},function(){return null==e?void 0:e.disconnect()}}),[]);var k={sessionConfig:f,meeting:u,updatePreset:function(e,t){return K(void 0,void 0,void 0,(function(){var n,r,i,o;return Z(this,(function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),[4,fetch(un.apiBase+"/v1/userpreset",{method:"POST",headers:{"content-type":"application/json","dyte-tracing-id":h},body:JSON.stringify({authToken:t,roomName:e,version:"0.5.0",clientType:"CLIENT_APP"})})];case 1:return[4,a.sent().json()];case 2:return n=a.sent(),(null===(o=null==n?void 0:n.data)||void 0===o?void 0:o.preset)?(r=n.data.preset,_(r)):(jr.error("update_preset_failed",n),_(u.config)),[3,4];case 3:return i=a.sent(),jr.error("update_preset_failed",i),_(u.config),[3,4];case 4:return[2]}}))}))},processPreset:_,participantControls:y};return(null==u?void 0:u.connectionConfig.authToken)||l?S?A.default.createElement(Vr.Provider,{value:k},A.default.createElement(Rr,null,A.default.createElement("div",{style:(null==f?void 0:f.theme.dimensions)?{}:{zIndex:1e3,position:"fixed",top:0,left:0}},s))):A.default.createElement("div",null,"Loading Config.."):null},qr={qqvga:{width:{ideal:160},height:{ideal:120}},qvga:{width:{ideal:320},height:{ideal:240}},vga:{width:{ideal:640},height:{ideal:480}},hd:{width:{ideal:1280},height:{ideal:720}},hd_cropped:{width:{ideal:900},height:{ideal:720}}},Hr={optional:[{googDscp:!0}]},Ur=[{rid:"r0",scalabilityMode:"L1T2"},{rid:"r1",scalabilityMode:"L1T2"}],Gr=[{scalabilityMode:"L3T3_KEY"}],Jr=[{dtx:!0,maxBitrate:15e5},{dtx:!0,maxBitrate:6e6}],Yr=null,Kr=[{urls:"turn:turn.dyte.in:443?transport=tcp",username:"dyte",credential:"dytein",credentialType:"password"},{urls:"turn:turn.dyte.in:3478?transport=udp",username:"dyte",credential:"dytein",credentialType:"password"}],Zr=function(e){return K(void 0,void 0,void 0,(function(){var t,n,r,i,o;return Z(this,(function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),t=Dn.getState().participant.authToken,n=Dn.getState().participant.peerId,[4,fetch(un.apiBase+"/iceservers/candidateRegional/"+e,{method:"GET",headers:{authorization:"Bearer "+t,"dyte-tracing-id":n}})];case 1:return[4,a.sent().json()];case 2:return r=a.sent(),[2,null===(o=r.iceServersList)||void 0===o?void 0:o.iceServersList];case 3:return i=a.sent(),jr.error("get_regional_ice_server_err",i),[2,void 0];case 4:return[2]}}))}))},Qr=function(){return K(void 0,void 0,void 0,(function(){var e,t,n,r;return Z(this,(function(i){switch(i.label){case 0:if(null!==Yr)return[3,5];i.label=1;case 1:return i.trys.push([1,4,,5]),e=Dn.getState().participant.authToken,t=Dn.getState().participant.peerId,[4,fetch(un.apiBase+"/iceservers",{method:"GET",headers:{authorization:"Bearer "+e,"dyte-tracing-id":t}})];case 2:return[4,i.sent().json()];case 3:return(n=i.sent()).success?(Yr=n.iceServers,[3,5]):[2,Kr];case 4:return r=i.sent(),jr.error("get_ice_server_err",r),[2,Kr];case 5:return[2,Yr]}}))}))},Xr=new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.initialized=!1,t.stalled=!1,t}return U(t,e),t.prototype.initialize=function(e,t){var n;return K(this,void 0,void 0,(function(){var t,r=this;return Z(this,(function(i){switch(i.label){case 0:this.peerId=e;try{this.backend=new p.CallStats(un.apiBase,Kn().engineName,m.ClientEnvType.PRODUCTION),this.backend.eventHandler.on("initialized",(function(e){r.ipInformation=e,r.initialized=!0,r.emit("initialized",e)}))}catch(e){jr.error("CallStatsIntegration: ",e)}return t=this,[4,Qr()];case 1:return t.iceServers=i.sent(),null===(n=this.backend)||void 0===n||n.registerIceServers(this.iceServers),this.startPreCallTest(),[2]}}))}))},t.prototype.authenticate=function(e){var t;null===(t=this.backend)||void 0===t||t.authenticate(e)},t.prototype.setRoomName=function(e){this.roomURL=e},t.prototype.configureSendTransport=function(e){var t;null===(t=this.backend)||void 0===t||t.registerProducingTransport(e)},t.prototype.configureRecvTransport=function(e){var t;null===(t=this.backend)||void 0===t||t.registerConsumingTransport(e)},t.prototype.candidateRegionalNetworkQualityTest=function(e){var t;return K(this,void 0,void 0,(function(){var n,r;return Z(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,Zr(e)];case 1:return(n=i.sent())&&(null===(t=this.backend)||void 0===t||t.sendNetworkQualityTestBeginEvent(n)),[3,3];case 2:return r=i.sent(),jr.warn("Error in callstats candidateRegionalNetworkQualityTest",r),[3,3];case 3:return[2]}}))}))},t.prototype.roomJoined=function(){var e,t;return K(this,void 0,void 0,(function(){var n,r,i,o,a,l,c,s,u,d;return Z(this,(function(f){return n=Kn(),r=Dn.getState().participant,i=r.id,o=r.peerId,a=r.displayName,l=Dn.getState().room,c=l.roomUUID,s=l.roomViewType,u=l.roomName,d={userId:i,peerId:o,displayName:a,roomUUID:c,roomViewType:s,roomName:u,deviceInfo:n},null===(e=this.backend)||void 0===e||e.sendCallJoinBeginEvent(d),this.backend&&this.candidateRegionalNetworkQualityTest(u),null===(t=this.backend)||void 0===t||t.startPingStats(),[2]}))}))},t.prototype.audioOff=function(){var e;null===(e=this.backend)||void 0===e||e.sendAudioToggleEvent(!1)},t.prototype.audioOn=function(){var e;null===(e=this.backend)||void 0===e||e.sendAudioToggleEvent(!0)},t.prototype.videoOff=function(){var e;null===(e=this.backend)||void 0===e||e.sendVideoToggleEvent(!1)},t.prototype.videoOn=function(){var e;null===(e=this.backend)||void 0===e||e.sendVideoToggleEvent(!0)},t.prototype.callEnded=function(){var e;null===(e=this.backend)||void 0===e||e.sendDisconnectEvent()},t.prototype.screenShareStart=function(e){var t;null===(t=this.backend)||void 0===t||t.sendScreenShareToggleEvent(!0,e)},t.prototype.screenShareStop=function(e){var t;null===(t=this.backend)||void 0===t||t.sendScreenShareToggleEvent(!1,e)},t.prototype.screenShareRequested=function(){var e;null===(e=this.backend)||void 0===e||e.sendScreenShareRequestedEvent()},t.prototype.activeSpeaker=function(e){var t;e===this.peerId&&(null===(t=this.backend)||void 0===t||t.sendActiveSpeakerEvent(e))},t.prototype.devices=function(e,t){var n;null===(n=this.backend)||void 0===n||n.devices(e,t)},t.prototype.selectedDevice=function(e,t){var n;null===(n=this.backend)||void 0===n||n.selectedDevice(e,t)},t.prototype.mediaPermission=function(e,t){var n;null===(n=this.backend)||void 0===n||n.mediaPermission(e,t)},t.prototype.mediaPlaybackFailed=function(e){var t;null===(t=this.backend)||void 0===t||t.mediaPlaybackFailed(e)},t.prototype.mediaTrackMuted=function(e){var t;null===(t=this.backend)||void 0===t||t.mediaTrackMuted(e)},t.prototype.tabChanged=function(e){var t;void 0===e&&(e=!1),null===(t=this.backend)||void 0===t||t.tabChanged(e)},t.prototype.browserBackgrounded=function(){var e;null===(e=this.backend)||void 0===e||e.browserBackgrounded()},t.prototype.browserForegrounded=function(){var e;null===(e=this.backend)||void 0===e||e.browserForegrounded()},t.prototype.legacySwitch=function(e){var t;null===(t=this.backend)||void 0===t||t.legacySwitch(e)},t.prototype.startPreCallTest=function(){var e;return K(this,void 0,void 0,(function(){return Z(this,(function(t){return null===(e=this.backend)||void 0===e||e.sendPreCallTestBeginEvent(),[2]}))}))},t.prototype.onPreCallTestResults=function(e){var t;return null===(t=this.backend)||void 0===t||t.eventHandler.once("precall_end",e),e},t.prototype.onReceivingConsumerAudioStatus=function(e){var t;null===(t=this.backend)||void 0===t||t.eventHandler.on("consumer_audio_status",e)},t.prototype.onReceivingConsumerVideoStatus=function(e){var t;null===(t=this.backend)||void 0===t||t.eventHandler.on("consumer_video_status",e)},t.prototype.onSafeInitialization=function(e){if(this.initialized)e(this.ipInformation,!1);else if(!this.stalled){var t=function(t){e(t,!0)};return this.once("initialized",t),t}return function(){}},t.prototype.removeInitializationListener=function(e){this.removeListener("initialized",e)},t.prototype.stallCallStats=function(){this.stalled=!0,this.removeAllListeners("initialized")},t.prototype.addRecvStream=function(e,t){},t.prototype.addSendStream=function(e,t){},t}(M.default)),$r=function(e,t){var n=qr[e.toLowerCase()];if(!n)throw new Error("Invalid quality");if(t){if(t<5||t>30)throw new Error("Invalid framerate");n.frameRate={ideal:t}}return n},ei=function(e,t,n){return K(void 0,void 0,void 0,(function(){var r,i,o,a,l,c,s,u;return Z(this,(function(d){switch(d.label){case 0:r=t||qr.vga,i=(null==n?void 0:n.indexOf("OBS Virtual"))>-1,o={video:J({deviceId:{exact:e||""},frameRate:{ideal:24,max:30}},i?{}:r),audio:!1},d.label=1;case 1:return d.trys.push([1,3,,5]),[4,navigator.mediaDevices.getUserMedia(o)];case 2:return a=d.sent(),[3,5];case 3:return l=d.sent(),jr.trace("get_video_track_first_attempt_err",l),o.video.deviceId.ideal=o.video.deviceId.exact,delete o.video.deviceId.exact,[4,navigator.mediaDevices.getUserMedia(o)];case 4:return a=d.sent(),[3,5];case 5:if(c=a.getVideoTracks()[0],i)try{s=c.getSettings().width,u=c.getSettings().height,c.applyConstraints({width:{ideal:r.width.ideal},height:{ideal:Math.floor(u*r.width.ideal/s)}})}catch(e){jr.error("obs_constrain",e)}return[2,c]}}))}))},ti=function(e){return K(void 0,void 0,void 0,(function(){var t,n,r;return Z(this,(function(i){switch(i.label){case 0:return t={echoCancellation:{ideal:!0},autoGainControl:{ideal:!0},noiseSuppression:{ideal:!0}},"chrome"!==Fn().getBrowserName(!0)||Wn()?[3,2]:(n=JSON.parse('{"video":false,"audio":{"optional":[{"sourceId":"'+e+'"},{"echoCancellation":true},{"googEchoCancellation":true},{"googAutoGainControl":true},{"googNoiseSuppression":true},{"googHighpassFilter":true},{"googNoiseSuppression2":true},{"googEchoCancellation2":true},{"googAutoGainControl2":true}]}}'),[4,navigator.mediaDevices.getUserMedia(n)]);case 1:return r=i.sent(),[3,7];case 2:n={audio:J({deviceId:{exact:e||""}},t),video:!1},i.label=3;case 3:return i.trys.push([3,5,,7]),[4,navigator.mediaDevices.getUserMedia(n)];case 4:return r=i.sent(),[3,7];case 5:return i.sent(),n.audio.deviceId.ideal=n.audio.deviceId.exact,delete n.audio.deviceId.exact,[4,navigator.mediaDevices.getUserMedia(n)];case 6:return r=i.sent(),[3,7];case 7:return[2,r.getAudioTracks()[0]]}}))}))},ni=function(){return K(void 0,void 0,void 0,(function(){var e;return Z(this,(function(t){switch(t.label){case 0:return[4,navigator.mediaDevices.getDisplayMedia({audio:!0,video:{width:{max:1920},height:{max:1080},frameRate:{max:5}}})];case 1:return[2,{video:(e=t.sent()).getVideoTracks()[0],audio:e.getAudioTracks()[0]}]}}))}))},ri={Chrome:"chrome",Chromium:"chrome",Opera:"opera",Firefox:"firefox","Internet Explorer":"iexplorer",Safari:"safari"};function ii(){var e=navigator.userAgent;return e.match(/Electron/)?{name:"electron",version:e.match(/Electron\/([\d.]+)/)[1]}:null}function oi(){var e=navigator.userAgent;if(e.match(/JitsiMeetNW/))return{name:"nwjs",version:e.match(/JitsiMeetNW\/([\d.]+)/)[1]}}function ai(){var e,t=navigator.userAgent.match(/\b(react[ \t_-]*native)(?:\/(\S+))?/i);if(t||"ReactNative"===navigator.product)return t&&t.length>2&&(e=t[2]),e||(e="unknown"),{name:"react-native",version:e}}function li(e){for(var t,n=[ai,ii,oi],r=0;r<n.length;r+=1)if(t=n[r]())return t;var i=e.getBrowserName();return i in ri?{name:ri[i],version:e.getBrowserVersion()}:(t=function(){var e=navigator.userAgent,t={name:"unknown",version:void 0};if(e.match(/Chrome/)&&!e.match(/Edge/))if(e.match(/Edg(A?)/)){var n=e.match(/Chrome\/([\d.]+)/)[1];Number.parseInt(n,10)>72&&(t.name="chrome",t.version=n)}else t.name="chrome",t.version=e.match(/Chrome\/([\d.]+)/)[1];return t}())||{name:"unknown",version:void 0}}var ci=function(){function e(){}return e.prototype.init=function(e){var t,n;if(this._bowser=N.default.getParser(navigator.userAgent),this._bowser&&void 0===e){var r=li(this._bowser);t=r.name,n=r.version}else void 0!==e&&e.name in ri?(t=ri[e.name],n=e.version):(t="unknown",n=void 0);this._name=t,this._version=n},e.prototype.getName=function(){return this._name},e.prototype.isChrome=function(){return"chrome"===this._name},e.prototype.isOpera=function(){return"opera"===this._name},e.prototype.isFirefox=function(){return"firefox"===this._name},e.prototype.isIExplorer=function(){return"iexplorer"===this._name},e.prototype.isSafari=function(){return"safari"===this._name},e.prototype.isNWJS=function(){return"nwjs"===this._name},e.prototype.isElectron=function(){return"electron"===this._name},e.prototype.isReactNative=function(){return"react-native"===this._name},e.prototype.getVersion=function(){return this._version},e.prototype._checkCondition=function(e){if(this._version)return this._bowser.satisfies(e)},e.prototype.isVersionGreaterThan=function(e){var t;return this._checkCondition(((t={})[this._name]=">"+e,t))},e.prototype.isVersionLessThan=function(e){var t;return this._checkCondition(((t={})[this._name]="<"+e,t))},e.prototype.isVersionEqualTo=function(e){var t;return this._checkCondition(((t={})[this._name]="~"+e,t))},e}(),si=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return U(t,e),t.prototype.setup=function(){this.init()},t.prototype.doesVideoMuteByStreamRemove=function(){return this.isChromiumBased()||this.isWebKitBased()},t.prototype.supportsP2P=function(){return!this.usesUnifiedPlan()},t.prototype.isChromiumBased=function(){return this.isChrome()||this.isElectron()||this.isNWJS()||this.isOpera()},t.prototype.isWebKitBased=function(){return this._bowser&&this._bowser.isEngine("webkit")&&void 0!==navigator.mediaDevices&&void 0!==navigator.mediaDevices.getUserMedia&&void 0!==window.RTCRtpTransceiver&&Object.keys(RTCRtpTransceiver.prototype).indexOf("currentDirection")>-1},t.prototype.isSupported=function(){return this.isChromiumBased()&&this._getChromiumBasedVersion()>=72||this.isFirefox()||this.isReactNative()||this.isWebKitBased()},t.prototype.isUserInteractionRequiredForUnmute=function(){return this.isFirefox()&&this.isVersionLessThan("68")},t.prototype.supportsVideoMuteOnConnInterrupted=function(){return this.isChromiumBased()||this.isReactNative()||this.isWebKitBased()},t.prototype.supportsBandwidthStatistics=function(){return!this.isFirefox()&&!this.isWebKitBased()},t.prototype.supportsCodecPreferences=function(){return this.usesUnifiedPlan()&&void 0!==window.RTCRtpTransceiver&&Object.keys(window.RTCRtpTransceiver.prototype).indexOf("setCodecPreferences")>-1&&Object.keys(RTCRtpSender.prototype).indexOf("getCapabilities")>-1&&!this.isWebKitBased()},t.prototype.supportsDeviceChangeEvent=function(){return navigator.mediaDevices&&void 0!==navigator.mediaDevices.ondevicechange&&void 0!==navigator.mediaDevices.addEventListener},t.prototype.supportsLocalCandidateRttStatistics=function(){return this.isChromiumBased()||this.isReactNative()||this.isWebKitBased()},t.prototype.supportsPerformanceObserver=function(){return void 0!==window.PerformanceObserver&&PerformanceObserver.supportedEntryTypes.indexOf("longtask")>-1},t.prototype.supportsReceiverStats=function(){return void 0!==window.RTCRtpReceiver&&Object.keys(RTCRtpReceiver.prototype).indexOf("getSynchronizationSources")>-1},t.prototype.supportsRTTStatistics=function(){return!this.isFirefox()},t.prototype.usesPlanB=function(){return!this.usesUnifiedPlan()},t.prototype.usesSdpMungingForSimulcast=function(){return this.isChromiumBased()||this.isReactNative()||this.isWebKitBased()},t.prototype.usesUnifiedPlan=function(){return!(!this.isFirefox()&&!this.isWebKitBased())},t.prototype.usesNewGumFlow=function(){return!!(this.isChromiumBased()||this.isFirefox()||this.isWebKitBased())},t.prototype.usesAdapter=function(){return this.usesNewGumFlow()},t.prototype.usesRidsForSimulcast=function(){return!1},t.prototype.supportsGetDisplayMedia=function(){return void 0!==navigator.getDisplayMedia||void 0!==navigator.mediaDevices&&void 0!==navigator.mediaDevices.getDisplayMedia},t.prototype.supportsInsertableStreams=function(){if(void 0===window.RTCRtpSender||!window.RTCRtpSender.prototype.createEncodedStreams&&!window.RTCRtpSender.prototype.createEncodedVideoStreams)return!1;var e=new ReadableStream;try{return window.postMessage(e,"*",[e]),!0}catch(e){return!1}},t.prototype.supportsAudioRed=function(){return Boolean(window.RTCRtpSender&&window.RTCRtpSender.getCapabilities&&window.RTCRtpSender.getCapabilities("audio").codecs.some((function(e){return"audio/red"===e.mimeType}))&&window.RTCRtpReceiver&&window.RTCRtpReceiver.getCapabilities&&window.RTCRtpReceiver.getCapabilities("audio").codecs.some((function(e){return"audio/red"===e.mimeType})))},t.prototype.supportsSdpSemantics=function(){return this.isChromiumBased()},t.prototype._getChromiumBasedVersion=function(){if(this.isChromiumBased()){var e=navigator.userAgent;if(e.match(/Chrome/))return Number.parseInt(e.match(/Chrome\/([\d.]+)/)[1],10)}return-1},t}(ci),ui=[],di=!1,fi=!1,pi=!1,mi=!1,hi=!1,gi=new(function(){function e(){var e=this;this.browser=new si,this.isDeviceListAvailable=function(){return Boolean(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices)},this.setOnDeviceChange=function(t){e.browser.supportsDeviceChangeEvent()&&navigator.mediaDevices.addEventListener("devicechange",(function(){return e.enumerateDevices().then(t)}))},this.getAllAudioDevices=function(){return ui.filter((function(e){return"audioinput"===e.kind}))},this.getAllVideoDevices=function(){return ui.filter((function(e){return"videoinput"===e.kind}))},this.getAllSpeakerDevices=function(){return ui.filter((function(e){return"audiooutput"===e.kind}))}}return e.prototype.onMediaDevicesListChanged=function(e){var t=this;jr.trace("media_devices",e),ui=e.slice(0),Xr.onSafeInitialization((function(){Xr.devices(dt.AUDIO,t.getAllAudioDevices()),Xr.devices(dt.VIDEO,t.getAllVideoDevices()),Xr.devices(dt.SPEAKER,t.getAllSpeakerDevices())}))},e.prototype.compareAvailableMediaDevices=function(e){if(e.length!==ui.length)return!0;function t(e){return JSON.stringify({kind:e.kind,deviceId:e.deviceId,groupId:e.groupId,label:e.label,facing:e.facing})}return e.map(t).sort().join("")!==ui.map(t).sort().join("")},e.prototype.updateKnownDevices=function(e){this.compareAvailableMediaDevices(e)&&this.onMediaDevicesListChanged(e)},e.prototype.init=function(e){return void 0===e&&(e={}),K(this,void 0,void 0,(function(){var t;return Z(this,(function(n){switch(n.label){case 0:return"boolean"==typeof e.disableAEC&&(fi=e.disableAEC),"boolean"==typeof e.disableNS&&(pi=e.disableNS),"boolean"==typeof e.disableAP&&(di=e.disableAP),"boolean"==typeof e.disableAGC&&(mi=e.disableAGC),"boolean"==typeof e.disableHPF&&(hi=e.disableHPF),this.browser.setup(),this.pcConstraints=this.browser.isChromiumBased()||this.browser.isReactNative()?{optional:[{googScreencastMinBitrate:100},{googCpuOveruseDetection:!0}]}:{},this.isDeviceListAvailable()?[4,this.enumerateDevices()]:[3,2];case 1:t=n.sent(),ui=t.slice(0),n.label=2;case 2:return[2]}}))}))},e.prototype.enumerateDevices=function(){var e=this;return new Promise((function(t,n){navigator.mediaDevices.enumerateDevices().then((function(n){jr.trace("device_enum_success",{totalDevices:null==n?void 0:n.length}),e.updateKnownDevices(n),t(n)})).catch((function(n){jr.error("device_enum_failed",n),e.updateKnownDevices([]),t([])}))}))},e.prototype.getConstraints=function(e,t){void 0===e&&(e=[]),void 0===t&&(t={});var n={};if(e.indexOf("video")>=0)if(n.video||(n.video=J({},t.initialWebcamConstraints)||qr.vga),t.cameraDeviceId)n.video.deviceId=t.cameraDeviceId;else{var r=t.facingMode||"user";n.video.facingMode=r}else n.video=!1;return e.indexOf("audio")>=0?(n.audio&&"boolean"!=typeof n.audio||(n.audio={}),this.browser.isFirefox()||this.browser.isWebKitBased()?n.audio={deviceId:t.micDeviceId,autoGainControl:!mi&&!di,echoCancellation:!fi&&!di,noiseSuppression:!pi&&!di}:(n.audio.optional||(n.audio.optional=[]),n.audio.optional.push({sourceId:t.micDeviceId},{echoCancellation:!fi&&!di},{googEchoCancellation:!fi&&!di},{googAutoGainControl:!mi&&!di},{googNoiseSuppression:!pi&&!di},{googHighpassFilter:!hi&&!di},{googNoiseSuppression2:!pi&&!di},{googEchoCancellation2:!fi&&!di},{googAutoGainControl2:!mi&&!di}))):n.audio=!1,n},e.prototype._getUserMedia=function(e,t,n){return void 0===t&&(t={}),void 0===n&&(n=0),new Promise((function(e,r){var i,o=!1;jr.trace("getUserMedia",t),"number"==typeof n&&!Number.isNaN(n)&&n>0&&(i=setTimeout((function(){o=!0,i=void 0,r(new Error("timeout"))}),n)),navigator.mediaDevices.getUserMedia(t).then((function(t){o||(void 0!==i&&clearTimeout(i),e(t))})).catch((function(e){jr.error("local_media_failed",{error:e.message,constraints:t}),o||(void 0!==i&&clearTimeout(i),r(e))}))}))},e.prototype._parsePermissionFromError=function(e){return["PermissionDeniedError","NotAllowedError","SecurityError"].includes(e.name)?e.message.indexOf("by system")>0?Si.SYS_DENIED:Si.DENIED:["DevicesNotFoundError","NotFoundError","AbortError","NotReadableError"].includes(e.name)?Si.NOTFOUND:Si.FAILED},e.prototype.obtainAudioAndVideoStream=function(e){return K(this,void 0,void 0,(function(){var t,n,r,i,o,a,l,c,s,u,d=this;return Z(this,(function(f){switch(f.label){case 0:t=e.timeout,n=Y(e,["timeout"]),r=new Map,i=function(){var e=(n.devices||["audio","video"]).filter((function(e){return"audio"===e||"video"===e}));if(!e.length)return Promise.resolve();var r=d.getConstraints(e,n);return d._getUserMedia(e,r,t)},o=function(){return K(d,void 0,void 0,(function(){var e,r,i,o,a,l,c,s,u,d,f,p;return Z(this,(function(m){switch(m.label){case 0:if(e=n.devices||["audio","video"],r={audio:Si.INIT,video:Si.INIT},!(i=e.filter((function(e){return"audio"===e||"video"===e}))).length)return[2,Promise.resolve()];o=this.getConstraints(["audio"],n),a=this.getConstraints(["video"],n),l=new MediaStream,m.label=1;case 1:return m.trys.push([1,3,,4]),[4,this._getUserMedia(i,o,t)];case 2:return c=m.sent(),(s=c.getAudioTracks()[0])?(l.addTrack(s),r.audio=Si.ACCEPTED):r.audio=Si.NOTFOUND,[3,4];case 3:return u=m.sent(),r.audio=this._parsePermissionFromError(u),[3,4];case 4:return m.trys.push([4,6,,7]),[4,this._getUserMedia(i,a,t)];case 5:return d=m.sent(),(f=d.getVideoTracks()[0])?l.addTrack(f):r.video=Si.NOTFOUND,[3,7];case 6:return p=m.sent(),r.video=this._parsePermissionFromError(p),[3,7];case 7:return[2,[l,r]]}}))}))},a=function(e){if(e){var t=e.getAudioTracks();if(t.length){var i=new MediaStream(t);r.set("audio",{type:"audio",stream:i,track:i.getAudioTracks()[0],effects:n.effects})}var o=e.getVideoTracks();if(o.length){var a=new MediaStream(o);r.set("video",{stream:a,track:a.getVideoTracks()[0],type:"webcam",effects:n.effects})}}},c={audio:Si.ACCEPTED,video:Si.ACCEPTED},f.label=1;case 1:return f.trys.push([1,3,5,7]),[4,i()];case 2:return l=f.sent(),[3,7];case 3:return s=f.sent(),jr.warn("capture_failed_retrying",s),[4,o()];case 4:return u=f.sent(),l=u[0],c=u[1],!qn()||c.audio!==Si.DENIED&&c.video!==Si.DENIED||i(),[3,7];case 5:return[4,a(l)];case 6:return f.sent(),[7];case 7:return[2,[r,c]]}}))}))},e.prototype.stopMediaStream=function(e){e&&(e.getTracks().forEach((function(e){e.stop&&e.stop()})),e.stop&&e.stop(),e.release&&e.release())},e.prototype.arePermissionsGranted=function(){return ui.some((function(e){return Boolean(e.label)}))},e}()),vi=function(e,t,n){var r="number"==typeof n?n:250,i=e.createMediaStreamSource(t),o=e.createAnalyser();o.fftSize=2048,i.connect(o);var a=new Uint8Array(o.fftSize),l=!1;return setTimeout((function(){l=!0}),r),function e(){return l?Promise.resolve(!0):(o.getByteTimeDomainData(a),a.some((function(e){return 128!==e&&0!==e}))?Promise.resolve(!1):function(e){return void 0===e&&(e=0),new Promise((function(t){return setTimeout(t,e)}))}().then(e))}().then((function(e){return i.disconnect(),e}),(function(e){throw i.disconnect(),e}))},yi="undefined"!=typeof AudioContext?AudioContext:null,bi=new(function(){function e(t){var n=J({AudioContext:yi},t);Object.defineProperties(this,{_AudioContext:{value:n.AudioContext},audioContext:{value:null,writable:!0},_holders:{value:new Set},AudioContextFactory:{enumerable:!0,value:e}})}return e.prototype.getOrCreate=function(e){if(!this._holders.has(e)&&(this._holders.add(e),this._AudioContext&&!this.audioContext))try{this.audioContext=new this._AudioContext}catch(e){}return this.audioContext},e.prototype.release=function(e){this._holders.has(e)&&(this._holders.delete(e),!this._holders.size&&this.audioContext&&(this.audioContext.close(),this.audioContext=null))},e}());function Ei(e){var t={},n=bi.getOrCreate(t),r=3;return function t(){return r-=1,vi(n,e.srcObject,250).then((function(e){return!!e&&(!(r>0)||t())})).catch((function(){return!0}))}().finally((function(){bi.release(t)}))}var Si,wi=function(e){return"https://cdn.dyte.in/assets/permissions/"+e},xi=function(){var t,n,r=jn(),o=e.useContext(Vr).sessionConfig,a=Et(),l=((null===(t=o.theme)||void 0===t?void 0:t.dimensions)||a).width,c={Safari:{video:"Desktop_Safari.mp4",text:['Choose Safari> "Settings for this website" in the menu bar','Select "Always allow", then click done',"Refresh or rejoin meeting"]},ios:{video:"",text:["Go to Settings > Search for "+r,"Enable microphone and camera","Refresh or rejoin meeting"]},android:{video:"",text:["Go to Settings > Search for "+r,"Open Permissions > Enable microphone and camera","Refresh or rejoin meeting"]},Safari_ios:{video:"iOS Safari.mp4",text:[]},Chrome_ios:{video:"Chrome_ios.mp4",text:[]},Firefox_android:{video:"Android_Firefox.mp4",text:[]},Chrome_android:{video:"Android_Chrome.mp4",text:[A.default.createElement(A.default.Fragment,null,"Tap on the"," "," "," ",A.default.createElement(i.Img,{verticalAlign:"middle",display:"inline",h:"8",src:wi("chrome-android-lock.png"),alt:"Lock icon in Chrome"})," ","in the address bar"),A.default.createElement(A.default.Fragment,null,"Select the"," ",A.default.createElement(i.Img,{verticalAlign:"middle",display:"inline",h:"8",src:wi("chrome-android-settings.png"),alt:"Settings icon in Chrome"})," ","permissions section"),'Toggle the camera and microphone switch to "allowed"',"Refresh or rejoin"]},Firefox:{video:"Desktop_Firefox.mp4",text:[A.default.createElement(A.default.Fragment,null,"Click the camera icon"," ",A.default.createElement(i.Img,{src:wi("firefox-icon.png"),verticalAlign:"middle",display:"inline",h:"8",alt:"Disabled media access icons in Firefox"})," ","in your browser's address bar"),'Click X for any "Blocked" or "Blocked Temporarily" devices under Permissions','Then click "Allow" when permission request popup shows up']},"Microsoft Edge":{video:"Desktop_Edge.mp4",text:[A.default.createElement(A.default.Fragment,null,"Click the camera icon"," ",A.default.createElement(i.Img,{src:wi("edge-icon.png"),alt:"Video icon on Edge",verticalAlign:"middle",display:"inline",h:"8"})," ","in your browser's address bar"),'Select "Always allow", then click done',"Refresh or rejoin meeting"]},Chrome:{video:"Desktop_Chrome.mp4",text:[A.default.createElement(A.default.Fragment,null,"Click the camera icon"," ",A.default.createElement(i.Img,{src:wi("chrome-icon.png"),alt:"Video icon on Edge",verticalAlign:"middle",display:"inline",h:"8"})," ","in your browser's address bar"),'Select "Always allow", then click done',"Refresh or rejoin meeting"]}},s=(n=c.Chrome,Wn()?n=Hn()&&c[r+"_ios"]?c[r+"_ios"]:Un()&&c[r+"_android"]?c[r+"_android"]:c[Hn()?"ios":"android"]:c[r]&&(n=c[r]),n);return A.default.createElement(A.default.Fragment,null,""!==s.video&&A.default.createElement(i.Box,{mt:"4",mb:"2",w:"80%",mx:"auto"},Wn()?A.default.createElement("video",{src:wi(s.video),autoPlay:!0,muted:!0,controls:!0,loop:!0,playsInline:!0}):A.default.createElement("video",{src:wi(s.video),autoPlay:!0,muted:!0,loop:!0})),l>320&&A.default.createElement(i.OrderedList,{my:"4",mx:"auto",listStylePosition:"inside",spacing:"2"},s.text.map((function(e){return A.default.createElement(i.ListItem,null,e)}))))},Ci=function(t){var n=t.videoPermission,r=t.audioPermission,o=e.useRef(document.getElementById("dyte-base-elem")||document.getElementById("dyte-shadow").shadowRoot.getElementById("dyte-base-elem")),a=e.useContext(ki).permissionModal,l=a.isOpen,c=a.onClose,s=a.onOpen,u=e.useState(Si.ACCEPTED),d=u[0],f=u[1],p=e.useRef(Si.ACCEPTED);e.useEffect((function(){var e=function(e,t){return e===Si.INIT&&t===Si.INIT?Si.INIT:e===Si.DENIED||t===Si.DENIED?Si.DENIED:e===Si.SYS_DENIED||t===Si.SYS_DENIED?Si.SYS_DENIED:Si.ACCEPTED}(n,r);p.current=e,f(e),e!==Si.INIT&&s()}),[n,r]);var m=function(){return n!==Si.DENIED&&n!==Si.SYS_DENIED||r!==Si.DENIED&&r!==Si.SYS_DENIED?n===Si.DENIED||n===Si.SYS_DENIED?"Camera":"Mic":"Camera and Mic"};if(d===Si.ACCEPTED)return null;var h=wi("mac-permissions.mp4"),g=A.default.createElement(i.OrderedList,{my:"3",mx:"",listStylePosition:"inside",spacing:"2"},A.default.createElement(i.ListItem,{textAlign:"left"},"Go to System Preferences > Security & Privacy > Privacy > Camera"),A.default.createElement(i.ListItem,{textAlign:"left"},"Tick the box next to"," ",A.default.createElement("b",null,jn())),A.default.createElement(i.ListItem,{textAlign:"left"},"Do steps 1 and 2 for microphone too"),A.default.createElement(i.ListItem,{textAlign:"left"},"Restart the browser and rejoin the meeting"));if(Wn()){var v=jn()+"-"+(Hn()?"ios":"android")+"-permissions.mp4";h=["Safari-ios-permissions.mp4","Chrome-ios-permissions.mp4"].indexOf(v)>=0?wi(v):null,g=Hn()?A.default.createElement(i.OrderedList,{my:"3",mx:"",listStylePosition:"inside",spacing:"2"},A.default.createElement(i.ListItem,{textAlign:"left"},"Go to Settings > Search for"," ",A.default.createElement("b",null,jn())),A.default.createElement(i.ListItem,{textAlign:"left"},"Go to the "+jn()+" app settings"),A.default.createElement(i.ListItem,{textAlign:"left"},"Enable both microphone and camera"),A.default.createElement(i.ListItem,{textAlign:"left"},"Restart the browser and rejoin the meeting")):A.default.createElement(i.OrderedList,{my:"3",mx:"",listStylePosition:"inside",spacing:"2"},A.default.createElement(i.ListItem,{textAlign:"left"},"Go to Settings > Search for"," ",A.default.createElement("b",null,jn())),A.default.createElement(i.ListItem,{textAlign:"left"},"Tap on the browser to go to the settings"),A.default.createElement(i.ListItem,{textAlign:"left"},"Open Permissions > Enable microphone and camera"),A.default.createElement(i.ListItem,{textAlign:"left"},"Restart the browser and rejoin the meeting"))}return A.default.createElement(i.Modal,{isOpen:l,onClose:c,portalProps:{containerRef:o},variant:"primary",isCentered:!0},d===Si.DENIED&&A.default.createElement(A.default.Fragment,null,A.default.createElement(i.ModalOverlay,{bg:"secondary.900"}),A.default.createElement(i.ModalContent,{background:"secondary.1000",w:"90%",maxW:"640px",px:"4",py:"6",textAlign:"center",color:"text.100"},A.default.createElement(i.Text,{fontSize:"2xl",fontWeight:"bold",color:"danger.500"},"Unblock "+m()+"?"),!(window.hasOwnProperty("Android ")||window.hasOwnProperty("Android")||window.hasOwnProperty("cordova"))&&A.default.createElement(xi,null),A.default.createElement(i.Button,{mt:"2",variant:"solidDark",onClick:c},"Continue without "+m()))),d===Si.SYS_DENIED&&A.default.createElement(A.default.Fragment,null,A.default.createElement(i.ModalOverlay,{bg:"secondary.800"}),A.default.createElement(i.ModalContent,{background:"secondary.1000",w:"90%",maxW:"640px",maxH:"90%",px:"4",py:"6",textAlign:"center",color:"text.100",overflow:"auto"},A.default.createElement(i.Text,{fontSize:"2xl",fontWeight:"bold"},"Unblock "+m()+"?"),h&&(Wn()?A.default.createElement("video",{src:h,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,controls:!0,style:{borderRadius:"6px",width:"90%",maxWidth:"400px",margin:"1.2em auto"}}):A.default.createElement("video",{src:h,autoPlay:!0,loop:!0,muted:!0,style:{borderRadius:"6px",width:"90%",maxWidth:"400px",margin:"1.2em auto"}})),g,A.default.createElement(i.Button,{mt:"2",variant:"solidDark",onClick:c},"Continue without"," ",m()))))},_i=function(t){var n=t.screensharePermission,r=e.useRef(document.getElementById("dyte-base-elem")||document.getElementById("dyte-shadow").shadowRoot.getElementById("dyte-base-elem")),o=e.useContext(ki).screensharePermissionModal,a=o.isOpen,l=o.onClose,c=o.onOpen;if(e.useEffect((function(){n!==Si.INIT&&c()}),[n]),n!==Si.DENIED&&n!==Si.SYS_DENIED)return null;var s=A.default.createElement("a",{style:{color:"white",textDecoration:"underline"},href:"x-apple.systempreferences:com.apple.preference.security?Privacy_ScreenCapture"},"click here");return A.default.createElement(i.Modal,{isOpen:a,onClose:l,portalProps:{containerRef:r},variant:"primary",isCentered:!0},A.default.createElement(i.ModalOverlay,{bg:"secondary.800"}),A.default.createElement(i.ModalContent,{background:"secondary.1000",w:"90%",maxW:"640px",maxH:"90%",px:"4",py:"6",textAlign:"center",color:"text.100",overflow:"auto"},A.default.createElement(i.Text,{fontSize:"2xl",fontWeight:"bold"},"Unblock Screen share?"),A.default.createElement("video",{src:wi("mac-screenshare-permissions.mp4"),autoPlay:!0,loop:!0,muted:!0,style:{borderRadius:"6px",width:"90%",maxWidth:"400px",margin:"1.2em auto"}}),A.default.createElement(i.OrderedList,{my:"3",mx:"auto",listStylePosition:"inside",spacing:"2"},A.default.createElement(i.ListItem,{textAlign:"left"},"Go to System Preferences > Security & Privacy > Privacy > Screen Recording"," ","(",s,")"),A.default.createElement(i.ListItem,{textAlign:"left"},"Tick the box next to"," ",A.default.createElement("b",null,jn())),A.default.createElement(i.ListItem,{textAlign:"left"},"Restart the browser and rejoin the meeting")),"If screen recording is already enabled, simply restart the browser and rejoin the meeting.",A.default.createElement("br",null),"If the issue persists, please switch to a different browser.",A.default.createElement(i.Button,{mt:"2",variant:"solidDark",onClick:l},"Continue without Screen share")))};!function(e){e[e.INIT=0]="INIT",e[e.ACCEPTED=1]="ACCEPTED",e[e.DENIED=2]="DENIED",e[e.SYS_DENIED=3]="SYS_DENIED",e[e.FAILED=4]="FAILED",e[e.NOTFOUND=5]="NOTFOUND",e[e.NOT_APPLICABLE=6]="NOT_APPLICABLE"}(Si||(Si={}));var ki=e.createContext(null);function Ii(n){var r,o,a,l,c,s,u,d,f,p=this,m=e.useState(),h=m[0],g=m[1],v=e.useState([]),y=v[0],b=v[1],E=e.useState(),S=E[0],w=E[1],x=e.useState(),C=x[0],_=x[1],k=e.useState([]),I=k[0],T=k[1],P=e.useState(),O=P[0],D=P[1],N=e.useState(),R=N[0],M=N[1],L=e.useState([]),z=L[0],B=L[1],F=e.useState(!1),j=F[0],V=F[1],W=e.useRef(null),q=e.useRef(null),H=e.useRef(null),U=e.useContext(Vr),G=U.meeting,J=U.sessionConfig,Y=e.useRef(null),Q=e.useRef(null),X=e.useRef(null),ee=e.useRef(null),te=$r(null===(a=null===(o=null===(r=J.permissions)||void 0===r?void 0:r.produce)||void 0===o?void 0:o.video)||void 0===a?void 0:a.quality,null===(s=null===(c=null===(l=J.permissions)||void 0===l?void 0:l.produce)||void 0===c?void 0:c.video)||void 0===s?void 0:s.frame_rate),ne=n.children,re=t.useSelector((function(e){return e.participant.audioMuted})),ie=t.useSelector((function(e){return e.participant.videoOff})),oe=t.useSelector((function(e){return e.room.producersState})),ae=e.useState(!1),le=ae[0],ce=ae[1],se=e.useState(Si.INIT),ue=se[0],de=se[1],fe=e.useState(Si.INIT),pe=fe[0],me=fe[1],he=e.useState(Si.INIT),ge=he[0],ve=he[1],ye=e.useRef(),be=t.useSelector((function(e){return e.participant.presentingState})),Ee=t.useSelector((function(e){return e.room.roomViewType})),Se=t.useSelector((function(e){return e.participant.requestToJoinType})),we=t.useSelector((function(e){return e.room.routerState})),xe=e.useRef(null),Ce=i.useDisclosure(),_e=Ce.isOpen,ke=Ce.onClose,Ie=Ce.onOpen,Te=i.useDisclosure(),Pe=Te.isOpen,Ae=Te.onClose,Oe=Te.onOpen;Ee===ut.webinar&&Se===bt.ask&&(te=$r("QQVGA",null===(f=null===(d=null===(u=J.permissions)||void 0===u?void 0:u.produce)||void 0===d?void 0:d.video)||void 0===f?void 0:f.frame_rate));var De=e.useRef(),Ne=e.useRef(),Me=e.useRef(null),Le=t.useSelector((function(e){return e.participant.audioTrackSelection})),ze=t.useSelector((function(e){return e.participant.videoTrackSelection})),Be=t.useSelector((function(e){return e.participant.speakerTrackSelection})),Fe=t.useSelector((function(e){return e.participant.videoProduction})),je=t.useSelector((function(e){return e.participant.audioProduction})),Ve=t.useSelector((function(e){return e.participant.deviceChanges})),We=oe===$.NOT_APPLICABLE||Fe===$.LOADED||Fe===$.NOT_STARTED,qe=oe===$.NOT_APPLICABLE||je===$.LOADED||je===$.NOT_STARTED,He=we===$.LOADED&&je!==$.LOADED&&(Ee!==ut.webinar||be===vt.PRESENTING),Ue=we===$.LOADED&&(Ee!==ut.webinar||be===vt.PRESENTING),Ge=t.useDispatch();e.useEffect((function(){W.current=S,q.current=O,H.current=h,Y.current=je,Q.current=Fe,X.current=re,ee.current=ie,Me.current=Le}),[S,O,h,je,re,ie,Le]),e.useEffect((function(){h&&(h.enabled=!re),re&&Xr.onSafeInitialization((function(){Xr.mediaTrackMuted(dt.AUDIO)}))}),[re,h]),e.useEffect((function(){ie&&Xr.onSafeInitialization((function(){Xr.mediaTrackMuted(dt.VIDEO)}))}),[ie]),e.useEffect((function(){pe===Si.ACCEPTED&&jr.trace("video_perm_accepted"),Xr.onSafeInitialization((function(){Xr.mediaPermission(dt.VIDEO,pe)}))}),[pe]),e.useEffect((function(){ue===Si.ACCEPTED&&jr.trace("audio_perm_accepted"),Xr.onSafeInitialization((function(){Xr.mediaPermission(dt.AUDIO,ue)}))}),[ue]);var Je=function(e){return K(p,void 0,void 0,(function(){var t,n,r,i,o,a;return Z(this,(function(l){switch(l.label){case 0:t=new Audio,(n=new MediaStream).addTrack(null!=e?e:H.current),t.srcObject=n,r=!1,l.label=1;case 1:return l.trys.push([1,5,6,7]),(i=t.play())?[4,i]:[3,3];case 2:l.sent(),l.label=3;case 3:return[4,Ei(t)];case 4:return(r=l.sent())&&jr.trace("Silence detected",{track:(null==e?void 0:e.id)||(null===(a=H.current)||void 0===a?void 0:a.id)||"null"}),[3,7];case 5:return o=l.sent(),jr.warn("Failed to detect silence:",o),[3,7];case 6:return t.pause(),t.remove(),[7];case 7:return[2,r]}}))}))},Ye=function(e){return K(p,void 0,void 0,(function(){var n,r,i,o,a,l;return Z(this,(function(c){switch(c.label){case 0:n=null!==(a=null==e?void 0:e.deviceId)&&void 0!==a?a:null===(l=Me.current)||void 0===l?void 0:l.selectedDeviceId,jr.trace("setting_audio_device",{deviceId:n}),t.batch((function(){var e;Ge(Ot(!1)),(null===(e=Me.current)||void 0===e?void 0:e.selectedDeviceId)!==n&&Ge(Mt({selectedDeviceId:n}))})),h&&(nt(h),h.stop()),c.label=1;case 1:return c.trys.push([1,4,,5]),[4,ti(n)];case 2:return r=c.sent(),g(r),rt(r),He&&Ge(Pt($.CONNECTING)),ue!==Si.ACCEPTED&&de(Si.ACCEPTED),[4,Je(r)];case 3:return i=c.sent(),jr.trace("is_set_audio_device_silent",{isTrackSilent:i}),Fr.hasFeature(mt.NOTIFY_AUDIO_TRACK_SILENCE)&&ce(i),[3,5];case 4:return o=c.sent(),jr.error("set_audio_device_err",o),g(null),ue===Si.ACCEPTED&&de(Si.FAILED),Ge(Pt($.NOT_APPLICABLE)),Ge(Ot(!0)),[3,5];case 5:return[2]}}))}))},Ke=function(e){return K(p,void 0,void 0,(function(){var n,r=this;return Z(this,(function(i){return(n=(null==e?void 0:e.deviceId)||(null==ze?void 0:ze.selectedDeviceId))?(t.batch((function(){Ge(Nt(!1)),(null==ze?void 0:ze.selectedDeviceId)!==n&&Ge(Rt({selectedDeviceId:n}))})),[2,new Promise((function(t,i){setTimeout((function(){return K(r,void 0,void 0,(function(){var r,o;return Z(this,(function(a){switch(a.label){case 0:S&&(nt(S),S.stop()),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,ei(n,te,null==e?void 0:e.label)];case 2:return r=a.sent(),w(r),Ue&&Ge(Tt($.CONNECTING)),pe!==Si.ACCEPTED&&me(Si.ACCEPTED),t(),[3,4];case 3:return o=a.sent(),jr.error("set_video_device_err",o),w(null),pe===Si.ACCEPTED&&me(Si.FAILED),Ge(Tt($.NOT_APPLICABLE)),Ge(Nt(!0)),i(),[3,4];case 4:return[2]}}))}))}))}))]):[2,new Promise((function(e){return e()}))]}))}))},Ze=function(e){return K(p,void 0,void 0,(function(){return Z(this,(function(e){switch(e.label){case 0:return We?ie?[4,Ke()]:[3,2]:[2];case 1:return e.sent(),[3,3];case 2:t.batch((function(){Ue&&Ge(Tt($.STOPPING)),Ge(Nt(!0)),setTimeout((function(){S&&(nt(S),S.stop()),w(void 0)}))})),e.label=3;case 3:return[2]}}))}))};e.useEffect((function(){Ee!==xe.current&&(null!==xe.current&&(ie||Ze(),Ot(!0)),xe.current=Ee)}),[Ee]),e.useEffect((function(){Ee===ut.webinar&&we===$.LOADED&&be===vt.NOT_PRESENTING?t.batch((function(){Ge(Nt(!0)),Ge(Ot(!0)),setTimeout((function(){S&&(nt(S),S.stop()),h&&(nt(h),h.stop()),g(void 0),w(void 0)}))})):be===vt.INITIATED&&(Ge(Re(!1)),Promise.all([Ke(),Ye()]).then((function(){Ge(Re(!0))})))}),[we,be]);var Qe=function(e){return K(p,void 0,void 0,(function(){var t,n,r,i,o,a;return Z(this,(function(l){switch(l.label){case 0:return t=gi.browser.isWebKitBased(),"audio"===e?n=H.current:"video"===e&&(n=W.current),n?(r="ended"===n.readyState,i="audio"===e?Y.current===$.LOADED:Q.current===$.LOADED,o=r&&i&&t,a=!1,"audio"!==e?[3,2]:[4,Je()]):(jr.trace("no_"+e+"_track_to_reacquire"),[2,!1]);case 1:a=l.sent(),l.label=2;case 2:return[2,"visible"===document.visibilityState&&(n.muted||o||a)]}}))}))},Xe=function(e){return K(p,void 0,void 0,(function(){return Z(this,(function(t){switch(t.label){case 0:return Ne.current||X.current?[2]:(jr.trace("maybe_restart_audio",{type:null==e?void 0:e.type}),[4,Promise.race([new Promise((function(e){return null==h?void 0:h.addEventListener("unmute",e)})),new Promise((function(e){return setTimeout(e,50)}))])]);case 1:return t.sent(),[4,Qe("audio")];case 2:return t.sent()?(jr.trace("reacquiring_audio_track"),Ne.current=!0,[4,Ye()]):[3,4];case 3:t.sent(),Ne.current=!1,t.label=4;case 4:return[2]}}))}))},$e=function(e){return K(p,void 0,void 0,(function(){return Z(this,(function(t){switch(t.label){case 0:return De.current||ee.current?[2]:(jr.trace("maybe_restart_video",{type:null==e?void 0:e.type}),[4,Promise.race([new Promise((function(e){return null==S?void 0:S.addEventListener("unmute",e)})),new Promise((function(e){return setTimeout(e,50)}))])]);case 1:return t.sent(),[4,Qe("video")];case 2:return t.sent()?(jr.trace("reacquiring_video_track"),De.current=!0,nt(S),[4,Ke()]):[3,4];case 3:t.sent(),rt(S),De.current=!1,t.label=4;case 4:return[2]}}))}))},et=function(e){jr.warn("Track unmuted",e)},tt=function(){if("visible"===document.visibilityState){var e=new Event("visibility-change");!Wn()&&Fr.hasFeature(mt.SKIP_REACQUIRE_AUDIO)?jr.trace("skip_audio_reacquire"):Xe(e),$e(e)}Xr.onSafeInitialization((function(){Xr.tabChanged("visible"===document.visibilityState),"visible"!==document.visibilityState?Xr.browserBackgrounded():Xr.browserForegrounded()}))},nt=function(e){if(e){jr.trace("removing_media_events",{trackId:e.id});var t="audio"===e.kind?Xe:$e;return e.removeEventListener("ended",t),e.removeEventListener("mute",t),e.removeEventListener("unmute",et),e}},rt=function(e){if(e){jr.trace("adding_media_events",{trackId:e.id});var t="audio"===e.kind?Xe:$e;return e.addEventListener("ended",t),e.addEventListener("mute",t),e.addEventListener("unmute",et),e}},it=function(e){return K(p,void 0,void 0,(function(){return Z(this,(function(t){return Ge(Lt({selectedDeviceId:e.deviceId})),[2]}))}))};e.useEffect((function(){Ve>0&&(ye.current||(ye.current=setTimeout((function(){K(p,void 0,void 0,(function(){var e,n,r,i,o,a,l,c,s,u,d,f;return Z(this,(function(p){switch(p.label){case 0:return e=gi.getAllAudioDevices(),n=gi.getAllVideoDevices(),r=gi.getAllSpeakerDevices(),i=e.find((function(e){return!y.map((function(e){return e.deviceId})).includes(e.deviceId)})),b(e),o=n.find((function(e){return!I.map((function(e){return e.deviceId})).includes(e.deviceId)})),T(n),a=r.find((function(e){return!z.map((function(e){return e.deviceId})).includes(e.deviceId)})),B(r),l=!e.map((function(e){return e.deviceId})).includes(null==Le?void 0:Le.selectedDeviceId),c=!n.map((function(e){return e.deviceId})).includes(null==ze?void 0:ze.selectedDeviceId),s=!r.map((function(e){return e.deviceId})).includes(null==Be?void 0:Be.selectedDeviceId),re?[3,5]:i&&(null===(d=null==h?void 0:h.getSettings())||void 0===d?void 0:d.groupId)!==i.groupId?[4,Ye(i)]:[3,2];case 1:return p.sent(),[3,5];case 2:return e.length<1?(t.batch((function(){Ge(Pt($.NOT_APPLICABLE)),Ge(Ot(!0)),setTimeout((function(){h&&(nt(h),h.stop()),g(void 0)}))})),[3,5]):[3,3];case 3:return l?(u=e[0],[4,Ye(u)]):[3,5];case 4:p.sent(),p.label=5;case 5:return ie?[3,10]:o&&(null===(f=null==S?void 0:S.getSettings())||void 0===f?void 0:f.groupId)!==o.groupId?[4,Ke(o)]:[3,7];case 6:return p.sent(),[3,10];case 7:return n.length<1?(t.batch((function(){Ge(Tt($.NOT_APPLICABLE)),Ge(Nt(!0)),setTimeout((function(){S&&(nt(S),S.stop()),w(void 0)}))})),[3,10]):[3,8];case 8:return c?(u=n[0],[4,Ke(u)]):[3,10];case 9:p.sent(),p.label=10;case 10:return a?it(a):s&&r.length>0&&(u=r[0],it(u)),[2]}}))})),ye.current=void 0}),500)))}),[Ve]),e.useEffect((function(){return document.addEventListener("visibilitychange",tt),function(){var e,t,n,r;W.current&&W.current.stop(),H.current&&H.current.stop(),(null===(e=q.current)||void 0===e?void 0:e.video)&&(null===(t=q.current)||void 0===t||t.video.stop()),(null===(n=q.current)||void 0===n?void 0:n.audio)&&(null===(r=q.current)||void 0===r||r.audio.stop()),document.removeEventListener("visibilitychange",tt)}}),[]);var ot={mediaTracks:{webcamTrack:S,setWebcamTrack:w,processedWebcamTrack:C,setProcessedWebcamTrack:_,audioTrack:h,setAudioTrack:g,screenShareTracks:O,setScreenShareTracks:D,speakerTrack:R,setSpeakerTrack:M},inputDevices:{audioInputDevices:y,videoInputDevices:I,speakerOutputDevices:z,setAudioInputDevices:b,setVideoInputDevices:T,setSpeakerOutputDevices:B,setAudioDevice:Ye,setVideoDevice:Ke,setSpeakerDevice:it,toggleAudioState:function(){return K(p,void 0,void 0,(function(){var e;return Z(this,(function(t){switch(t.label){case 0:return qe?(e=!h||"ended"===h.readyState,re&&e?[4,Ye()]:[3,2]):[2];case 1:return t.sent(),[3,3];case 2:Ge(Ot(!re)),t.label=3;case 3:return[2]}}))}))},toggleVideoState:Ze,onAudioInputChange:function(e){return K(p,void 0,void 0,(function(){var t;return Z(this,(function(n){switch(n.label){case 0:return t=y.find((function(t){return t.deviceId===e})),[4,Ye(t)];case 1:return n.sent(),Xr.onSafeInitialization((function(){Xr.selectedDevice(dt.AUDIO,t)})),[2]}}))}))},onVideoInputChange:function(e){return K(p,void 0,void 0,(function(){var t;return Z(this,(function(n){switch(n.label){case 0:return t=I.find((function(t){return t.deviceId===e})),[4,Ke(t)];case 1:return n.sent(),Xr.onSafeInitialization((function(){Xr.selectedDevice(dt.VIDEO,t)})),[2]}}))}))},onSpeakerOutputChange:function(e){return K(p,void 0,void 0,(function(){var t;return Z(this,(function(n){switch(n.label){case 0:return t=z.find((function(t){return t.deviceId===e})),[4,it(t)];case 1:return n.sent(),Xr.onSafeInitialization((function(){Xr.selectedDevice(dt.SPEAKER,t)})),[2]}}))}))}},processingStatus:{webcamProccessing:j,setWebcamProcessing:V},setupStreams:function(){return K(p,void 0,void 0,(function(){return Z(this,(function(e){switch(e.label){case 0:return[4,gi.init()];case 1:return e.sent(),[4,K(p,void 0,void 0,(function(){var e,n,r,i,o,a,l,c,s,u,d,f,p,m,h,v,y,E,S,x,C,_,k,I,P;return Z(this,(function(A){switch(A.label){case 0:return A.trys.push([0,7,8,9]),e=J.permissions.produce,n=e.audio,r=e.video.allow,i=null===(C=null===(x=G.connectionConfig.devicePreferences)||void 0===x?void 0:x.camera)||void 0===C?void 0:C.facing,o=gi.getAllVideoDevices(),a=function(e){return"default"===(null==e?void 0:e.deviceId)||e.label&&e.label.toLowerCase().includes("default")},l=o.find(a)||o[0],c=gi.getAllAudioDevices(),s=c.find(a)||c[0],u={devices:[],micDeviceId:"",cameraDeviceId:"",initialWebcamConstraints:te,timeout:null,facingMode:"user"},c.length>0&&n?(u.devices.push("audio"),u.micDeviceId=s.deviceId):0===c.length&&n?de(Si.NOTFOUND):de(Si.NOT_APPLICABLE),o.length>0&&r?(u.devices.push("video"),i?u.facingMode=i:u.cameraDeviceId=l.deviceId):0===o.length&&r?me(Si.NOTFOUND):me(Si.NOT_APPLICABLE),gi.arePermissionsGranted()&&(u.timeout=15e3),[4,gi.obtainAudioAndVideoStream(u)];case 1:return d=A.sent(),f=d[0],p=d[1],m=null===(_=f.get("audio"))||void 0===_?void 0:_.track,h=null===(k=f.get("video"))||void 0===k?void 0:k.track,m=rt(m),h=rt(h),gi.isDeviceListAvailable()?[4,gi.enumerateDevices()]:[3,3];case 2:A.sent(),o=gi.getAllVideoDevices(),c=gi.getAllAudioDevices(),o.some((function(e){return Boolean(e.label)}))&&T(o),c.some((function(e){return Boolean(e.label)}))&&b(c),A.label=3;case 3:return m?(g(m),de(Si.ACCEPTED),Ge(Mt({selectedDeviceId:(null===(I=m.getSettings())||void 0===I?void 0:I.deviceId)||""})),(v=gi.getAllSpeakerDevices()).length>0&&(v.some((function(e){return Boolean(e.label)}))&&B(v),y=v.find(a)||v[0],Ge(Lt({selectedDeviceId:y.deviceId}))),[4,Je(m)]):[3,5];case 4:return E=A.sent(),jr.trace("is_set_audio_device_silent",{isTrackSilent:E}),Fr.hasFeature(mt.NOTIFY_AUDIO_TRACK_SILENCE)&&ce(E),[3,6];case 5:de(p.audio),Ge(Pt($.NOT_APPLICABLE)),Ge(Ot(!0)),A.label=6;case 6:return h?(ie?h.stop():w(h),me(Si.ACCEPTED),Ge(Rt({selectedDeviceId:(null===(P=h.getSettings())||void 0===P?void 0:P.deviceId)||""}))):(me(p.video),Ge(Tt($.NOT_APPLICABLE)),Ge(Nt(!0))),[3,9];case 7:return S=A.sent(),jr.warn("permission_error",S),de(Si.FAILED),me(Si.FAILED),t.batch((function(){Ge(Pt($.NOT_APPLICABLE)),Ge(Ot(!0)),Ge(Tt($.NOT_APPLICABLE)),Ge(Nt(!0))})),[3,9];case 8:return Ge(Re(!0)),[7];case 9:return[2]}}))}))];case 2:return e.sent(),gi.setOnDeviceChange((function(){return Ge(Wt())})),[2]}}))}))},isAudioTrackSilent:le,audioPermission:ue,videoPermission:pe,screensharePermission:ge,setScreensharePermission:ve,permissionModal:{isOpen:_e,onClose:ke,onOpen:Ie},screensharePermissionModal:{isOpen:Pe,onOpen:Oe,onClose:Ae}};return A.default.createElement(ki.Provider,{value:ot},A.default.createElement(Ci,{videoPermission:pe,audioPermission:ue}),A.default.createElement(_i,{screensharePermission:ge}),ne)}function Ti(n){var r=n.height,o=window.location.href.replace("/meeting/stage",""),a=t.useSelector((function(e){return e.participant.displayName})),c=t.useSelector((function(e){return e.room.password})),s=t.useSelector((function(e){return e.room.roomName})),u=a+" has invited you to join them on a dyte call. Head over to "+o+" to join them. "+(c?"Meeting password: "+c:""),d=e.useState(!1),f=d[0],p=d[1],m=i.useClipboard(o).onCopy,h=i.useClipboard(u).onCopy,g=function(){p(!0),m()};return e.useEffect((function(){f&&setTimeout((function(){p(!1)}),5e3)}),[f,p]),A.default.createElement(i.Flex,{bg:"background",direction:"column",height:r,borderRadius:"6px",justify:"center",className:"dyte-client-noSelect"},A.default.createElement(i.Center,{color:"text.400"},A.default.createElement(i.Stack,{spacing:6,width:"35%"},A.default.createElement(i.Text,{fontSize:"lg",align:"center",fontWeight:"500",color:"text.400"},"You seem to be alone here,",A.default.createElement("br",null),"try inviting someone."),A.default.createElement(i.Flex,{justify:"space-between"},A.default.createElement(i.Text,{color:"text.400"},"Meeting Code"),A.default.createElement(i.Text,{color:"text.400",className:"dyte-client-selectable"},s)),c&&A.default.createElement(i.Flex,{justify:"space-between"},A.default.createElement(i.Text,{color:"text.400"},"Password"),A.default.createElement(i.Text,{color:"text.400",className:"dyte-client-selectable"},c)),A.default.createElement(i.Flex,{direction:"column"},A.default.createElement(i.InputGroup,null,A.default.createElement(i.Input,{autoComplete:"off",placeholder:"meeting-url",name:"meetingURL",size:"md",border:"none",value:o.replace(/^https?:\/\//,""),variant:"disabled",bg:"secondary.900",readOnly:!0,onClick:g}),A.default.createElement(i.InputRightAddon,{as:i.IconButton,"aria-label":"copy",icon:f?A.default.createElement(i.Icon,{as:l.Check,fill:"text.200"}):A.default.createElement(i.Icon,{as:l.ContentCopy,fill:"text.200"}),bg:"primary.500",color:"text.400",border:"none",onClick:g})),A.default.createElement(i.Text,{fontSize:"sm",color:"text.400"},"Share this link to invite participants.")),A.default.createElement(i.Flex,{justify:"center"},A.default.createElement(i.Button,{variant:"solidDark",bg:"secondary.900",color:"text.200",fontWeight:"500",onClick:h},"Copy Invite Message")))))}function Pi(t){var n=t.height,r=e.useContext(Vr).sessionConfig;return A.default.createElement(i.Flex,{bg:"background",direction:"column",height:n,width:"100%",borderRadius:"6px",justify:"center",alignItems:"center",className:"dyte-client-noSelect"},A.default.createElement(i.Stack,{direction:(r.theme.waiting_room.enable_preview,"column"),align:"center",spacing:20},r.theme.waiting_room.element?"string"==typeof r.theme.waiting_room.element?A.default.createElement("div",{dangerouslySetInnerHTML:{__html:r.theme.waiting_room.element}}):r.theme.waiting_room.element:A.default.createElement(i.Text,{fontSize:"lg",align:"center",fontWeight:"500",color:"text.400"},"You are in the waiting room, the host will let you in soon.")))}Ti.defaultProps={height:"100%"},Pi.defaultProps={height:"100%"};var Ai=function(){return"ontouchstart"in window||navigator.maxTouchPoints>0},Oi=Math.abs,Di=Math.max,Ni=Math.min,Ri=Math.sqrt,Mi="undefined"==typeof window,Li=!Mi&&/(Mac)/i.test(navigator.platform),zi=function(e){return"drag"===e},Bi=function(e){return"zoom"===e},Fi=function(e){return Li&&e.ctrlKey},ji=function(e){e.stopPropagation(),e.preventDefault()},Vi=function(e,t){var n=e.x-t.x,r=e.y-t.y;return Ri(n*n+r*r)},Wi=function(e,t){var n=Vi(e[0],e[1]);return Vi(t[0],t[1])/n},qi=function(e){return-Math.cos(e*Math.PI)/2+.5},Hi=function(e){return{x:e.pageX,y:e.pageY}},Ui=function(e){return Array.from(e).map(Hi)},Gi=function(e,t){return e+t},Ji=function(e,t,n){return n<e?e:n>t?t:n},Yi=function(e){return!(e.ctrlKey||e.metaKey)},Ki=function(){},Zi={x:0,y:0},Qi=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._prevDragMovePoint=null,t._containerObserver=null,t._fingers=0,t._firstMove=!0,t._initialOffset=J({},Zi),t._interaction=null,t._isDoubleTap=!1,t._isOffsetsSet=!1,t._lastDragPosition=null,t._lastScale=1,t._lastTouchStart=0,t._lastZoomCenter=null,t._listenMouseMove=!1,t._nthZoom=0,t._offset=J({},Zi),t._startTouches=null,t._updatePlaned=!1,t._wheelTimeOut=null,t._zoomFactor=1,t._initialZoomFactor=1,t._ignoreNextClick=!1,t._containerRef=O.createRef(),t._handleClick=function(e){t._ignoreNextClick&&(t._ignoreNextClick=!1,e.stopPropagation())},t._onResize=function(){t._updateInitialZoomFactor(),t._setupOffsets(),t._update()},t._handlerOnTouchEnd=t._handlerIfEnable((function(e){t._fingers=e.touches.length,t._updateInteraction(e)})),t._handlerOnTouchStart=t._handlerIfEnable((function(e){t._firstMove=!0,t._fingers=e.touches.length,t._detectDoubleTap(e)})),t._handlerOnTouchMove=t._handlerIfEnable((function(e){t._isDoubleTap||(t._collectInertia(e),t._firstMove?(t._updateInteraction(e),t._interaction&&ji(e),t._startTouches=Ui(e.touches)):(Bi(t._interaction)?t._startTouches&&2===t._startTouches.length&&2===e.touches.length&&t._handleZoom(e,Wi(t._startTouches,Ui(e.touches))):zi(t._interaction)&&t._handleDrag(e),t._interaction&&(ji(e),t._update())),t._firstMove=!1)})),t._handlerWheel=function(e){if(!t.props.shouldInterceptWheel(e)){ji(e);var n=e.pageX,r=e.pageY,i=e.deltaY,o=e.deltaMode,a=1;(Fi(e)||1===o)&&(a=15);var l={touches:[{pageX:n,pageY:r}]},c=t._getOffsetByFirstTouch(l),s=i*a;t._stopAnimation(),t._scaleTo(t._zoomFactor-s/t.props.wheelScaleFactor,c),t._update(),clearTimeout(t._wheelTimeOut),t._wheelTimeOut=setTimeout((function(){return t._sanitize()}),100)}},t._handlers=t.props.isTouch()?[["touchstart",t._handlerOnTouchStart],["touchend",t._handlerOnTouchEnd],["touchmove",t._handlerOnTouchMove]]:[["mousemove",t.simulate(t._handlerOnTouchMove),t.props._document],["mouseup",t.simulate(t._handlerOnTouchEnd),t.props._document],["mousedown",t.simulate(t._handlerOnTouchStart)],["click",t._handleClick],["wheel",t._handlerWheel]],t}return U(t,e),t.prototype._handleDragStart=function(e){this._ignoreNextClick=!0,this.props.onDragStart(),this._stopAnimation(),this._resetInertia(),this._lastDragPosition=null,this._hasInteraction=!0,this._handleDrag(e)},t.prototype._handleDrag=function(e){var t=this._getOffsetByFirstTouch(e);this._drag(t,this._lastDragPosition),this._offset=this._sanitizeOffset(this._offset),this._lastDragPosition=t},t.prototype._resetInertia=function(){this._velocity=null,this._prevDragMovePoint=null},t.prototype._realizeInertia=function(){var e=this,t=this.props,n=t.inertiaFriction;if(t.inertia&&this._velocity){var r=this._velocity,i=r.x,o=r.y;if(i||o){this._stopAnimation(),this._resetInertia();this._animate((function(){if(o*=n,!(i*=n)&&!o)return e._stopAnimation();var t,r,a=J({},e._offset);if(e._addOffset({x:i,y:o}),e._offset=e._sanitizeOffset(e._offset),t=a,r=e._offset,t.x===r.x&&t.y===r.y)return e._stopAnimation();e._update({isAnimation:!0})}),{duration:9999})}}},t.prototype._collectInertia=function(e){var t=e.touches;if(this.props.inertia){var n,r,i=Ui(t)[0],o=this._prevDragMovePoint;o&&(this._velocity=(n=i,{x:(r=o).x-n.x,y:r.y-n.y})),this._prevDragMovePoint=i}},t.prototype._handleDragEnd=function(){this.props.onDragEnd(),this._end(),this._realizeInertia()},t.prototype._handleZoomStart=function(){this.props.onZoomStart(),this._stopAnimation(),this._lastScale=1,this._nthZoom=0,this._lastZoomCenter=null,this._hasInteraction=!0},t.prototype._handleZoom=function(e,t){var n,r={x:(n=this._getOffsetTouches(e)).map((function(e){return e.x})).reduce(Gi,0)/n.length,y:n.map((function(e){return e.y})).reduce(Gi,0)/n.length},i=t/this._lastScale;this._lastScale=t,this._nthZoom+=1,this._nthZoom>3&&(this._scale(i,r),this._drag(r,this._lastZoomCenter)),this._lastZoomCenter=r},t.prototype._handleZoomEnd=function(){this.props.onZoomEnd(),this._end()},t.prototype._handleDoubleTap=function(e){this._hasInteraction||(this.props.onDoubleTap(),this._ignoreNextClick=!0,this._isDoubleTap=!0)},t.prototype._computeInitialOffset=function(){var e=this._getContainerRect(),t=this._getChildSize(),n=t.width,r=t.height,i=-Oi(n*this._getInitialZoomFactor()-e.width)/2,o=-Oi(r*this._getInitialZoomFactor()-e.height)/2;this._initialOffset={x:i,y:o}},t.prototype._resetOffset=function(){this._offset=J({},this._initialOffset)},t.prototype._setupOffsets=function(){this.props.setOffsetsOnce&&this._isOffsetsSet||(this._isOffsetsSet=!0,this._computeInitialOffset(),this._resetOffset())},t.prototype._sanitizeOffset=function(e){var t=this._getContainerRect(),n=this._getChildSize(),r=n.width,i=n.height,o=r*this._getInitialZoomFactor()*this._zoomFactor,a=i*this._getInitialZoomFactor()*this._zoomFactor,l=o-t.width+this.props.horizontalPadding,c=a-t.height+this.props.verticalPadding,s=Di(l,0),u=Di(c,0),d=Ni(l,0)-this.props.horizontalPadding,f=Ni(c,0)-this.props.verticalPadding;return{x:Ji(d,s,e.x),y:Ji(f,u,e.y)}},t.prototype.alignCenter=function(e){var t=this,n=J({duration:250,animated:!0},e),r=n.x,i=n.y,o=n.scale,a=n.animated,l=n.duration,c=this._zoomFactor,s=J({},this._offset),u=this._getContainerRect(),d={x:u.width/2,y:u.height/2};if(this._zoomFactor=1,this._offset={x:-(d.x-r),y:-(d.y-i)},this._scaleTo(o,d),this._stopAnimation(),!a)return this._update();var f=this._zoomFactor-c,p=this._offset.x-s.x,m=this._offset.y-s.y;this._zoomFactor=c,this._offset=J({},s);this._animate((function(e){var n=s.x+p*e,r=s.y+m*e;t._zoomFactor=c+f*e,t._offset=t._sanitizeOffset({x:n,y:r}),t._update()}),{callback:function(){return t._sanitize()},duration:l})},t.prototype.scaleTo=function(e){var t=this,n=J({duration:250,animated:!0},e),r=n.x,i=n.y,o=n.scale,a=n.animated,l=n.duration,c=this._zoomFactor,s=J({},this._offset);if(this._zoomFactor=1,this._offset={x:0,y:0},this._scaleTo(o,{x:r,y:i}),this._stopAnimation(),!a)return this._update();var u=this._zoomFactor-c,d=this._offset.x-s.x,f=this._offset.y-s.y;this._zoomFactor=c,this._offset=J({},s);this._animate((function(e){var n=s.x+d*e,r=s.y+f*e;t._zoomFactor=c+u*e,t._offset={x:n,y:r},t._update()}),{callback:function(){return t._sanitize()},duration:l})},t.prototype._scaleTo=function(e,t){this._scale(e/this._zoomFactor,t)},t.prototype._scale=function(e,t){var n=this._scaleZoomFactor(e);this._addOffset({x:(n-1)*(t.x+this._offset.x),y:(n-1)*(t.y+this._offset.y)}),this.props.onZoomUpdate()},t.prototype._scaleZoomFactor=function(e){var t=this._zoomFactor;return this._zoomFactor*=e,this._zoomFactor=Ji(this.props.minZoom,this.props.maxZoom,this._zoomFactor),this._zoomFactor/t},t.prototype._canDrag=function(){return this.props.draggableUnZoomed||!((e=this._zoomFactor)>(t=1)-.01&&e<t+.01);var e,t},t.prototype._drag=function(e,t){if(t){var n=-(e.y-t.y),r=-(e.x-t.x);this.props.lockDragAxis?Oi(r)>Oi(n)?this._addOffset({x:r,y:0}):this._addOffset({y:n,x:0}):this._addOffset({x:r,y:n}),this.props.onDragUpdate()}},t.prototype._addOffset=function(e){var t=this._offset,n=t.x,r=t.y;this._offset={x:n+e.x,y:r+e.y}},t.prototype._sanitize=function(){this._zoomFactor<this.props.zoomOutFactor?this._zoomOutAnimation():this._isInsaneOffset()&&this._sanitizeOffsetAnimation()},t.prototype._isInsaneOffset=function(){var e=this._offset,t=this._sanitizeOffset(e);return t.x!==e.x||t.y!==e.y},t.prototype._sanitizeOffsetAnimation=function(){var e=this,t=this._sanitizeOffset(this._offset),n=J({},this._offset);this._animate((function(r){var i=n.x+r*(t.x-n.x),o=n.y+r*(t.y-n.y);e._offset={x:i,y:o},e._update()}))},t.prototype._zoomOutAnimation=function(){var e=this;if(1!==this._zoomFactor){var t=this._zoomFactor,n=this._getCurrentZoomCenter();this._animate((function(r){var i=t+r*(1-t);e._scaleTo(i,n)}))}},t.prototype._getInitialZoomFactor=function(){return this._initialZoomFactor},t.prototype._getCurrentZoomCenter=function(){var e=this._offset,t=e.x,n=e.y,r=t-this._initialOffset.x,i=n-this._initialOffset.y;return{x:-1*t-r/(1/this._zoomFactor-1),y:-1*n-i/(1/this._zoomFactor-1)}},t.prototype._getOffsetByFirstTouch=function(e){return this._getOffsetTouches(e)[0]},t.prototype._getOffsetTouches=function(e){var t=this.props._document,n=t.documentElement,r=t.body,i=this._getContainerRect(),o=i.top,a=i.left,l=n.scrollTop||r.scrollTop,c=n.scrollLeft||r.scrollLeft,s=o+l,u=a+c;return Ui(e.touches).map((function(e){var t=e.x,n=e.y;return{x:t-u,y:n-s}}))},t.prototype._animate=function(e,t){var n=this,r=(new Date).getTime(),i=J({timeFn:qi,callback:function(){},duration:this.props.animationDuration},t),o=i.timeFn,a=i.callback,l=i.duration,c=function(){if(n._inAnimation){var t=(new Date).getTime()-r,i=t/l;t>=l?(e(1),n._stopAnimation(),a(),n._update()):(i=o(i),e(i),n._update({isAnimation:!0}),requestAnimationFrame(c))}};this._inAnimation=!0,requestAnimationFrame(c)},t.prototype._stopAnimation=function(){this._inAnimation=!1},t.prototype._end=function(){this._hasInteraction=!1,this._sanitize(),this._update()},t.prototype._getContainerRect=function(){return this._containerRef.current.getBoundingClientRect()},t.prototype._getChildSize=function(){var e=this._containerRef.current;return function(e){if(e){var t=e.offsetWidth,n=e.offsetHeight;if(t&&n)return{width:t,height:n};var r=getComputedStyle(e),i=parseFloat(r.width),o=parseFloat(r.height);if(o&&i)return{width:i,height:o}}return{width:0,height:0}}(e&&e.firstElementChild)},t.prototype._updateInitialZoomFactor=function(){var e=this._getContainerRect(),t=this._getChildSize(),n=e.width/t.width,r=e.height/t.height;this._initialZoomFactor=Ni(n,r)},t.prototype._bindEvents=function(){var e=this,t=this._containerRef.current;window.ResizeObserver?this._containerObserver=new ResizeObserver((function(t){window.requestAnimationFrame((function(){Array.isArray(t)&&t.length&&e._onResize()}))})):window.addEventListener("resize",this._onResize),this._handlers.forEach((function(e){var n=e[0],r=e[1];(e[2]||t).addEventListener(n,r,!0)}))},t.prototype._unSubscribe=function(){var e=this._containerRef.current;this._containerObserver&&(this._containerObserver.disconnect(),this._containerObserver=null),window.removeEventListener("resize",this._onResize),this._handlers.forEach((function(t){var n=t[0],r=t[1];(t[2]||e).removeEventListener(n,r,!0)}))},t.prototype._update=function(e){var t=this;if(!this._updatePlaned){var n=function(){var e=t._getInitialZoomFactor()*t._zoomFactor,n=-t._offset.x/e,r=-t._offset.y/e;t.props.onUpdate({scale:e,x:n,y:r})};if(e&&e.isAnimation)return n();this._updatePlaned=!0,requestAnimationFrame((function(){t._updatePlaned=!1,n()}))}},t.prototype._handlerIfEnable=function(e){var t=this;return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];t.props.enabled&&e.apply(void 0,n)}},t.prototype._setInteraction=function(e,t){var n=this._interaction;n!==e&&(n&&!e&&(Bi(n)?this._handleZoomEnd():zi(n)&&this._handleDragEnd()),Bi(e)?this._handleZoomStart():zi(e)&&this._handleDragStart(t)),this._interaction=e},t.prototype._updateInteraction=function(e){var t=this._fingers;return 2===t?this._setInteraction("zoom",e):1===t&&this._canDrag()?this._setInteraction("drag",e):void this._setInteraction(null,e)},t.prototype._detectDoubleTap=function(e){var t=(new Date).getTime();this._fingers>2&&(this._lastTouchStart=0),2===this._fingers&&(ji(e),this._handleDoubleTap(e)),t-this._lastTouchStart<700?(ji(e),this._handleDoubleTap(e),Bi(this._interaction)?this._handleZoomEnd():zi(this._interaction)&&this._handleDragEnd()):this._isDoubleTap=!1,1===this._fingers&&(this._lastTouchStart=t)},t.prototype.simulate=function(e){var t=this;return function(n){var r=n.pageX,i=n.pageY,o=n.type,a="mouseup"===o;"mousedown"===o&&(n.preventDefault(),t._listenMouseMove=!0),t._listenMouseMove&&(n.touches=a?[]:[{pageX:r,pageY:i}],e(n)),a&&(t._listenMouseMove=!1)}},t.prototype.componentDidMount=function(){this._bindEvents(),this._update()},t.prototype.componentWillUnmount=function(){this._stopAnimation(),this._unSubscribe()},t.prototype.render=function(){var e=this.props,t=e.children,n=e.containerProps,r=O.Children.only(t),i=n||{};return O.createElement("div",{className:"dyte-fullWidth"},O.createElement("div",J({},i,{ref:this._containerRef,className:"dyte-kvfysmfp"}),O.cloneElement(r,{className:"dyte-ufhsfnkm"})))},t.defaultProps={animationDuration:250,draggableUnZoomed:!0,enabled:!0,inertia:!0,inertiaFriction:.96,horizontalPadding:0,isTouch:Ai,lockDragAxis:!1,maxZoom:5,minZoom:.5,onDoubleTap:Ki,onDragEnd:Ki,onDragStart:Ki,onDragUpdate:Ki,onZoomEnd:Ki,onZoomStart:Ki,onZoomUpdate:Ki,setOffsetsOnce:!1,shouldInterceptWheel:Yi,tapZoomFactor:1,verticalPadding:0,wheelScaleFactor:1500,zoomOutFactor:1.3,_document:Mi?null:null===window||void 0===window?void 0:window.document},t}(O.Component),Xi=function(e){var t=e.children,n=Y(e,["children"]);return Fr.hasFeature(mt.QUICK_ZOOM)?O.createElement(Qi,J({},n),t):O.createElement("div",{className:"dyte-fullWidth"},O.createElement("div",{className:"dyte-kvfysmfp"},t))};Xi.defaultProps={onDoubleTap:function(){}};var $i=function(e){function t(t){var n=e.call(this,t)||this;return n.holder=Math.random(),n.canvas=A.default.createRef(),n.state={volume:0},n}return U(t,e),t.prototype.componentDidMount=function(){var e=this.props.track,t=new MediaStream;t.addTrack(e),this.runHark(t),this.draw()},t.prototype.componentDidUpdate=function(e){var t=this.props.track;if(t!==e.track){this.visualizerHark&&this.visualizerHark.stop();var n=new MediaStream;n.addTrack(t),this.runHark(n),this.draw()}},t.prototype.componentWillUnmount=function(){this.visualizerHark&&this.visualizerHark.stop(),bi.release(this.holder)},t.prototype.runHark=function(e){var t=this;if(!e.getAudioTracks()[0])throw new Error("_runHark() | given stream has no audio track");this.visualizerHark=z.default(e,{play:!1,interval:100,audioContext:bi.getOrCreate(this.holder)}),this.visualizerHark.on("volume_change",(function(e){var n=t.state.volume,r=Math.round(10*Math.pow(10,e/115));r<3&&(r=0);var i=Math.round((2*n+r)/3);n!==i&&(t.setState({volume:i}),t.draw())}))},t.prototype.draw=function(){var e=this.state.volume,t=Math.round(2.5),n=Q([],Array(5),!0).map((function(n,r){var i=r;return i>t-1&&(i=5-i-1),Math.round((i+1)/(t+1)*e)})),r=this.canvas.current;if(r){var i=r.height,o=r.width,a=r.getContext("2d"),l=2,c=1*o/n.length,s=c-4;a.clearRect(0,0,o,i),a.fillStyle="rgb(0,0,0,0.0)",a.fillRect(0,0,o,i);var u=this.context;a.fillStyle=u.colors.primary[500],a.strokeStyle=u.colors.primary[500],a.lineCap="round",a.lineWidth=3,a.beginPath(),n.forEach((function(e){var t=Math.min(-Math.abs(1.2*e/10*i)+i/2,i/2-2.5),n=Math.max(2*(i/2-t),5);a.moveTo(l+s/2,t),a.lineTo(l+s/2,t+n),l+=c})),a.stroke()}},t.prototype.render=function(){return A.default.createElement("canvas",{width:"24",height:"24",ref:this.canvas})},t}(e.Component);function eo(e){var t=e.name,n=e.charSize;return A.default.createElement(i.Box,{whiteSpace:"nowrap",display:"inline"},function(e,t){return e.length>t?e.substring(0,t)+"...":e}(t,n))}function to(e){var t=e.audioMuted,n=e.audioTrack,r=e.name,o=e.size,a=e.screenshare,c={sm:{px:"2",py:"1",iconSize:"4"},md:{px:"3",py:"2",iconSize:"6"}}[o];return A.default.createElement(i.Flex,{borderRadius:"lg",overflowX:"hidden",m:"sm"===o&&3,position:"relative",transformOrigin:"0 50%"},A.default.createElement(i.Box,{px:c.px,position:"absolute",py:c.py,width:"100%",height:"100%",bg:"sm"===o||a?"secondary.800":"secondary.900",opacity:"sm"===o||a?"0.5":"1"}),A.default.createElement(i.Flex,{color:"text.300",position:"relative",fontSize:o,justify:"start",px:c.px,py:c.py},!(a&&t)&&A.default.createElement(i.Center,null,!t&&n?A.default.createElement($i,{track:n}):A.default.createElement(i.Icon,{as:l.MicOff,fill:"danger.500",w:"1.25em",h:"1.25em"})),""!==r.trim()&&A.default.createElement(i.Center,{ml:c.px},A.default.createElement(eo,{name:r,charSize:13}))))}function no(e){var t=e.isOpen,n=e.onClose,r=e.children,o=e.small,a=e.modalSize,l=e.hasBorder,c=void 0===l||l,s=document.getElementById("dyte-base-elem")||document.getElementById("dyte-shadow").shadowRoot.getElementById("dyte-base-elem");return A.default.createElement(i.Modal,{isOpen:t,onClose:n,variant:"primary",isCentered:!0,size:a,portalProps:{containerRef:{current:s}}},A.default.createElement(i.ModalOverlay,{bg:"rgba(0,0,0,0.6)"}),A.default.createElement(i.ModalContent,{borderRadius:"8px",className:"dyte-client-noSelect",color:"text.100",borderWidth:c&&2,borderColor:c&&"primary.300",p:"1px",bg:"secondary.900",width:o?"200px":"100%"},A.default.createElement(i.ModalCloseButton,null),r))}$i.contextType=v.ThemeContext,eo.defaultProps={charSize:15},to.defaultProps={size:"md",screenshare:!1},no.defaultProps={small:!1,modalSize:"md",hasBorder:!0};var ro=A.default.createContext({isOpen:!1,closeMenu:function(){},openMenu:function(){},menuRef:void 0,position:{x:0,y:0},setPosition:function(){}}),io=function(t){var n=t.children,r=t.close,o=i.useDisclosure(),a=o.isOpen,l=o.onClose,c=o.onOpen,s=e.useState({x:0,y:0}),u=s[0],d=s[1],f=e.useRef(null);return A.default.createElement(ro.Provider,{value:{isOpen:a,closeMenu:function(){r&&r(),l()},openMenu:c,menuRef:f,position:u,setPosition:d}},n)};io.defaultProps={close:null};var oo=function(t){var n=t.children,r=t.onClick,o=t.icon,a=t.label,l=t.dataCy,c=t.disabled,s=t.badge,u=e.useContext(ro).closeMenu;return A.default.createElement(i.Button,{onClick:function(e){e.preventDefault(),r(e),u()},variant:"secondaryDefault",_hover:{backgroundColor:"primary.500"},borderRadius:0,w:"100%",justifyContent:"left",size:"sm",overflow:"hidden",textOverflow:"ellipsis",disabled:c,"data-cy":l,py:"6"},n||A.default.createElement(i.HStack,null,A.default.createElement(i.Box,null,o),A.default.createElement(i.Text,{fontSize:"lg"},a),""!==s&&A.default.createElement(i.Center,{bgColor:"primary.500",textColor:"text.100",width:5,height:5,fontSize:"sm"},A.default.createElement("span",null,s))))};oo.defaultProps={disabled:!1,dataCy:"",icon:null,children:null,label:null,badge:""};var ao,lo=function(t){var n=t.children,r=e.useContext(ro),o=r.closeMenu,a=r.isOpen,l=r.menuRef,c=r.position,s=c.x,u=c.y,d=e.useState({}),f=d[0],p=d[1];return e.useEffect((function(){var e,t,n,r,i,o,a=null===(e=null==l?void 0:l.current)||void 0===e?void 0:e.clientHeight,c=null===(t=null==l?void 0:l.current)||void 0===t?void 0:t.clientWidth,d=window.innerWidth,f=window.innerHeight;a&&c&&(s+c>d?r=d-s:n=s,u+a>f?o=f-u:i=u-20,p({top:i?i+"px":null,bottom:o?o+"px":null,left:n?n+"px":null,right:r?r+"px":null}))}),[l,s,u]),i.useOutsideClick({ref:l,handler:function(){a&&o()}}),A.default.createElement(i.Box,{ref:l,position:"fixed",bg:"secondary.800",py:1,minW:40,maxW:96,style:{visibility:a?"visible":"collapse",top:f.top,left:f.left,right:f.right,bottom:f.bottom},borderRadius:5,display:"flex",flexDirection:"column",zIndex:1001,border:"2px solid",borderColor:"secondary.700",boxShadow:"0 10px 15px -3px rgb(0 0 0 / 0.4), 0 4px 6px -4px rgb(0 0 0 / 0.4)"},n)},co=function(t){var n=t.children,r=t.onInit,o=e.useContext(ro),a=o.openMenu,l=o.setPosition;return r(a),A.default.createElement(i.Box,{onContextMenu:function(e){e.preventDefault(),l({x:e.clientX,y:e.clientY}),a()}},n)},so=function(t){var n=t.children,r=e.useContext(ro),o=r.closeMenu,a=r.isOpen;return A.default.createElement(no,{isOpen:a,onClose:function(){return o()},small:!0},n,A.default.createElement(oo,{onClick:function(){return o()}},A.default.createElement(i.Text,{color:"danger.500"},"Close")))},uo=function(){function e(e,t,n,r,i,o,a){void 0===o&&(o=!1),void 0===a&&(a=!1),this.socketObj=n,this.peerid=e,Xr.authenticate({peerId:e}),this.dispatch=r,this.device=new y.Device,this.consumers=new Map,this.legacyMode=!0,this.handleSockets=this.handleSockets.bind(this),this.hidden=o,this.roomName=t,this.webcamMutex=1,this.simulcast=a}return e.prototype.setICEServers=function(e){this.ICE_SERVERS=e},e.prototype.handleSockets=function(e,t){if(e)switch(e.type){case"websocket/new-consumer":this.createConsumer(e.payload,t);break;case"websocket/consumer-closed":this.closeConsumer(e.payload);break;case"websocket/consumer-paused":this.pauseConsumer(e.payload);break;case"websocket/consumer-resumed":this.resumeConsumer(e.payload);break;case"websocket/recording-started":this.setRecordingStatus(!0);break;case"websocket/recording-stopped":this.setRecordingStatus(!1);break;case"websocket/disable-video":this.disableWebcam()}},e.prototype.loadRouter=function(){var e;return K(this,void 0,void 0,(function(){var t,n;return Z(this,(function(r){switch(r.label){case 0:return(this.recvTransport||this.sendTransport)&&this.stopAllTransports(),this.dispatch(Te($.CONNECTING)),[4,null===(e=this.socketObj)||void 0===e?void 0:e.sendMessage({type:"getRouterRtpCapabilities"})];case 1:return t=r.sent(),this.device.loaded&&(this.device=new y.Device),(n=null==t?void 0:t.payload)&&(n.headerExtensions=n.headerExtensions.filter((function(e){return"urn:3gpp:video-orientation"!==e.uri}))),this.socketObj.emitter.on("socket",this.handleSockets),[2,this.device.load({routerRtpCapabilities:n})]}}))}))},e.prototype.getRoomState=function(){var e;return K(this,void 0,void 0,(function(){return Z(this,(function(t){switch(t.label){case 0:return this.dispatch(Pe($.CONNECTING)),[4,null===(e=this.socketObj)||void 0===e?void 0:e.sendMessage({type:"getRoomState"})];case 1:return t.sent(),this.dispatch(Pe($.LOADED)),[2]}}))}))},e.prototype.changeRoomDisplayTitle=function(e){var t;return K(this,void 0,void 0,(function(){return Z(this,(function(n){switch(n.label){case 0:return this.dispatch(Pe($.CONNECTING)),[4,null===(t=this.socketObj)||void 0===t?void 0:t.sendMessage({type:"changeDisplayTitle",payload:{displayTitle:e}})];case 1:return n.sent(),this.dispatch(Pe($.LOADED)),[2]}}))}))},e.prototype.joinRoom=function(e,t,n){return K(this,void 0,void 0,(function(){var r;return Z(this,(function(i){switch(i.label){case 0:return[4,this.socketObj.sendMessage({type:"joinRoom",payload:{device:Kn(),displayName:e.trim(),rtpCapabilities:this.device.rtpCapabilities,isLegacy:this.legacyMode,audioMuted:t}})];case 1:return r=i.sent(),this.legacyMode=r.payload.legacyMode||this.legacyMode,n&&""!==n?[4,this.changeRoomDisplayTitle(n)]:[3,3];case 2:i.sent(),i.label=3;case 3:return this.dispatch(ne(r.payload)),Xr.roomJoined(),Xr.legacySwitch(!!this.legacyMode),[2,r]}}))}))},e.prototype.createRecvTransport=function(){return K(this,void 0,void 0,(function(){var e,t,n=this;return Z(this,(function(r){switch(r.label){case 0:return jr.trace("createRecvTransport"),void 0===this.socketObj?[2]:(e={forceTcp:!1,producing:!1,consuming:!0},[4,this.socketObj.sendMessage({type:"createWebRtcTransport",payload:e})]);case 1:return t=r.sent().payload,this.recvTransport=this.device.createRecvTransport(J(J({},t),{iceServers:this.ICE_SERVERS,proprietaryConstraints:Hr})),Xr.configureRecvTransport(this.recvTransport),Object.assign(window,{recvTransport:this.recvTransport}),this.recvTransport.on("connect",(function(e,t,r){var i,o,a=e.dtlsParameters;return null===(i=n.socketObj)||void 0===i?void 0:i.sendMessage({type:"connectWebRtcTransport",payload:{transportId:null===(o=n.recvTransport)||void 0===o?void 0:o.id,dtlsParameters:a}},(function(e){e.payload.error?r():t()}))})),this.recvTransport.observer.on("close",(function(){n.recvTransport=void 0,jr.warn("recvTransport_closed"),Object.assign(window,{recvTransport:null})})),[2]}}))}))},e.prototype.createSendTransport=function(){return K(this,void 0,void 0,(function(){var e,t,n=this;return Z(this,(function(r){switch(r.label){case 0:return jr.trace("createSendTransport"),e={forceTcp:!1,producing:!0,consuming:!1},[4,this.socketObj.sendMessage({type:"createWebRtcTransport",payload:e})];case 1:return t=r.sent().payload,this.sendTransport=this.device.createSendTransport(J(J({},t),{iceServers:this.ICE_SERVERS,proprietaryConstraints:Hr})),Xr.configureSendTransport(this.sendTransport),void 0!==this.sendTransport&&(this.sendTransport.on("connect",(function(e,t,r){var i,o,a=e.dtlsParameters;return null===(i=n.socketObj)||void 0===i?void 0:i.sendMessage({type:"connectWebRtcTransport",payload:{transportId:null===(o=n.sendTransport)||void 0===o?void 0:o.id,dtlsParameters:a}},(function(e){e.payload.error?r():t()}))})),this.sendTransport.on("produce",(function(e,t,r){var i,o,a=e.kind,l=e.rtpParameters,c=e.appData;return null===(i=n.socketObj)||void 0===i?void 0:i.sendMessage({type:"produce",payload:{transportId:null===(o=n.sendTransport)||void 0===o?void 0:o.id,kind:a,rtpParameters:l,appData:c}},(function(e){e.payload.error?r(e.payload.error):t({id:e.payload.id})}))})),this.sendTransport.observer.on("close",(function(){jr.warn("sendTransport_closed"),n.sendTransport=void 0,Object.assign(window,{sendTransport:null})}))),[2]}}))}))},e.prototype.createConsumer=function(e,t){return K(this,void 0,void 0,(function(){var n,r,i,o,a,l,c,s,u,d,f;return Z(this,(function(p){switch(p.label){case 0:return void 0===this.recvTransport||this.recvTransport.closed?[2]:(n=e.peerId,r=e.producerId,i=e.id,o=e.kind,a=e.rtpParameters,l=e.type,c=e.appData,s=e.producerPaused,u=e.remotelyPaused,d=e.priority,[4,this.recvTransport.consume({id:i,producerId:r,kind:o,rtpParameters:a,appData:J(J({},c),{peerId:n})})]);case 1:return f=p.sent(),this.consumers.set(f.id,f),this.dispatch(En({id:i,peerId:n,type:l,kind:o,remotelyPaused:u,producerPaused:s,priority:d,appData:f.appData})),t&&t("Done"),[2]}}))}))},e.prototype.closeConsumer=function(e){return K(this,void 0,void 0,(function(){var t,n;return Z(this,(function(r){return jr.trace("closeConsumer",{request:e}),t=e.id,(n=this.consumers.get(t))?(n.close(),this.consumers.delete(t),[2]):[2]}))}))},e.prototype.pauseConsumer=function(e){return K(this,void 0,void 0,(function(){var t,n;return Z(this,(function(r){return jr.trace("pauseConsumer",{request:e}),t=e.id,(n=this.consumers.get(t))?(n.pause(),[2]):[2]}))}))},e.prototype.resumeConsumer=function(e){return K(this,void 0,void 0,(function(){var t,n;return Z(this,(function(r){return jr.trace("resumeConsumer",{request:e}),t=e.id,(n=this.consumers.get(t))?(n.resume(),[2]):[2]}))}))},e.prototype.shareWebcam=function(e){return K(this,void 0,void 0,(function(){var t,n,r,i,o,a=this;return Z(this,(function(l){switch(l.label){case 0:return jr.trace("shareWebcam"),0===this.webcamMutex?[2]:(this.webcamMutex=0,void 0===e||"ended"===e.readyState?(this.dispatch(Nt(!0)),[2]):(this.dispatch(Tt($.FETCHED)),this.webCamProducer?[4,this.removeProducer("webCamProducer",!1)]:[3,2]));case 1:l.sent(),l.label=2;case 2:return t=Ur,n=this.device.rtpCapabilities.codecs.find((function(e){return"video/vp9"===e.mimeType.toLowerCase()}))||void 0,r=this.device.rtpCapabilities.codecs.find((function(e){return"video/vp8"===e.mimeType.toLowerCase()}))||void 0,n&&!this.legacyMode&&(t=Gr),this.dispatch(Nt(!1)),i={track:e,encodings:t,codecOptions:{videoGoogleStartBitrate:1e3},codec:function(){return a.legacyMode?r:n}(),appData:{screenShare:!1},stopTracks:!1},o=function(){a.disableWebcam()},[4,this.createProducer("webCamProducer",i,o)];case 3:return l.sent(),this.dispatch(Tt($.LOADED)),this.dispatch(Nt(!1)),Xr.videoOn(),this.webcamMutex=1,[2]}}))}))},e.prototype.shareScreen=function(e){var t,n;return K(this,void 0,void 0,(function(){var r,i,o,a,l,c,s,u=this;return Z(this,(function(d){switch(d.label){case 0:return jr.trace("shareScreen"),r=e.video,i=e.audio,void 0===r||"ended"===r.readyState?(this.dispatch(Dt(!1)),[2]):(this.dispatch(Dt(!0)),this.dispatch(At($.FETCHED)),o=[],this.simulcast&&(o=Jr),a=J(J({track:r},o?{encodings:o}:{}),{codecOptions:{videoGoogleStartBitrate:1e3},appData:{screenShare:!0},stopTracks:!1}),l=function(){u.disableScreenShare()},[4,this.createProducer("screenShareVideoProducer",a,l)]);case 1:return d.sent(),i?(c={track:i,codecOptions:{opusDtx:!1,opusStereo:!1,opusFec:!0},appData:{screenShare:!0},stopTracks:!1},s=function(){},[4,this.createProducer("screenShareAudioProducer",c,s)]):[3,3];case 2:d.sent(),d.label=3;case 3:return this.dispatch(At($.LOADED)),Xr.screenShareStart(null===(n=null===(t=this.screenShareVideoProducer)||void 0===t?void 0:t.rtpParameters.encodings[0])||void 0===n?void 0:n.ssrc),[2]}}))}))},e.prototype.shareMic=function(e,t){return K(this,void 0,void 0,(function(){var n,r,i=this;return Z(this,(function(o){switch(o.label){case 0:return jr.trace("shareMic"),void 0===e||"ended"===e.readyState?(this.dispatch(Ot(!0)),[2]):this.micProducer?[4,this.removeProducer("micProducer",!1)]:[3,2];case 1:o.sent(),o.label=2;case 2:return this.dispatch(Ot(t||!1)),this.dispatch(Pt($.FETCHED)),n={track:e,codecOptions:{opusDtx:!1,opusStereo:!1,opusFec:!0,opusMaxAverageBitrate:16e3},stopTracks:!1},r=function(){i.disableMic({silent:!0})},[4,this.createProducer("micProducer",n,r)];case 3:return o.sent(),this.dispatch(Pt($.LOADED)),Xr.audioOn(),[2]}}))}))},e.prototype.pauseMic=function(){jr.trace("pauseMic"),this.dispatch(Ot(!0)),this.micProducer.pause()},e.prototype.pauseWebcam=function(){jr.trace("pauseWebcam"),this.dispatch(Nt(!0)),this.webCamProducer.pause()},e.prototype.resumeMic=function(){jr.trace("resumeMic"),this.dispatch(Ot(!1)),this.micProducer.resume()},e.prototype.resumeWebcam=function(){jr.trace("resumeWebcam"),this.dispatch(Nt(!1)),this.webCamProducer.resume()},e.prototype.disableWebcam=function(e){return K(this,void 0,void 0,(function(){return Z(this,(function(t){switch(t.label){case 0:return jr.trace("disableWebcam",{data:e}),e&&(null==e?void 0:e.silent)||this.dispatch(Nt(!0)),[4,this.removeProducer("webCamProducer",null==e?void 0:e.stopTrack)];case 1:return t.sent(),this.dispatch(Tt($.NOT_STARTED)),Xr.videoOff(),[2]}}))}))},e.prototype.disableMic=function(e){jr.trace("disableMic",e),e&&(null==e?void 0:e.silent)||this.dispatch(Ot(!0)),this.removeProducer("micProducer",null==e?void 0:e.stopTrack),this.dispatch(Pt($.NOT_STARTED)),Xr.audioOff()},e.prototype.disableScreenShare=function(e){var t,n;void 0===e&&(e={stopTrack:!0}),jr.trace("disableScreenShare",e),this.dispatch(At($.NOT_STARTED)),this.dispatch(Dt(!1)),this.removeProducer("screenShareVideoProducer",null==e?void 0:e.stopTrack),this.removeProducer("screenShareAudioProducer",null==e?void 0:e.stopTrack),Xr.screenShareStop(null===(n=null===(t=this.screenShareVideoProducer)||void 0===t?void 0:t.rtpParameters.encodings[0])||void 0===n?void 0:n.ssrc)},e.prototype.stopAllProducers=function(e){void 0===e&&(e=!1),jr.trace("stopAllProducers",{stopTrack:e}),this.webCamProducer&&this.disableWebcam({stopTrack:e}),this.screenShareVideoProducer&&this.disableScreenShare({stopTrack:e}),this.micProducer&&this.disableMic({stopTrack:e})},e.prototype.stopAllTransports=function(){var e,t;return K(this,void 0,void 0,(function(){return Z(this,(function(n){jr.trace("stopAllProducers");try{null===(e=this.sendTransport)||void 0===e||e.close(),null===(t=this.recvTransport)||void 0===t||t.close()}catch(e){jr.error("stop_transport_failed",e)}return this.dispatch(Te($.NOT_STARTED)),[2]}))}))},e.prototype.resetVideoProducers=function(e,t){return K(this,void 0,void 0,(function(){return Z(this,(function(n){switch(n.label){case 0:return jr.trace("resetVideoProducers"),e?[4,this.removeProducer("webCamProducer",!1)]:[3,2];case 1:n.sent(),this.shareWebcam(e),n.label=2;case 2:return t?[4,this.removeProducer("screenShareVideoProducer",!1)]:[3,4];case 3:n.sent(),this.shareScreen({video:t}),n.label=4;case 4:return[2]}}))}))},e.prototype.createProducer=function(e,t,n){return K(this,void 0,void 0,(function(){var n,r,i=this;return Z(this,(function(o){switch(o.label){case 0:if(jr.trace("createProducer",{producer:e,hidden:this.hidden}),this.hidden)throw new Error("Cant produce in hidden mode");return void 0===this.sendTransport||this.sendTransport.closed?[2]:(n=this,r=e,[4,this.sendTransport.produce(t)]);case 1:return n[r]=o.sent(),this[e].on("transportclose",(function(){jr.warn("transport_closed"),i[e]=void 0})),this[e].on("trackended",(function(){jr.warn("trackended")})),[2]}}))}))},e.prototype.replaceTrackOnProducer=function(e,t){return K(this,void 0,void 0,(function(){var n,r;return Z(this,(function(i){switch(i.label){case 0:jr.trace("replacing track id: "+t.id+" with new on on "+e),n=this[e],i.label=1;case 1:return i.trys.push([1,3,,4]),[4,n.replaceTrack({track:t})];case 2:return i.sent(),[3,4];case 3:return r=i.sent(),jr.error("Error on replacing track of producer",{error:r,producer:e}),[3,4];case 4:return[2]}}))}))},e.prototype.removeProducer=function(e,t){return void 0===t&&(t=!0),K(this,void 0,void 0,(function(){return Z(this,(function(n){switch(n.label){case 0:return jr.trace("removeProduce",{producer:e,stopTrack:t}),!this[e]||this[e].closed?[2]:(t&&this[e].track.stop(),this[e].close(),[4,this.socketObj.sendMessage({type:"closeProducer",payload:{producerId:this[e].id}})]);case 1:return n.sent(),this[e]=null,[2]}}))}))},e.prototype.sendMessage=function(e){return K(this,void 0,void 0,(function(){return Z(this,(function(t){switch(t.label){case 0:return[4,this.socketObj.sendMessage({type:"chatMessage",payload:e})];case 1:return t.sent(),[2]}}))}))},e.prototype.getMesssages=function(){return K(this,void 0,void 0,(function(){return Z(this,(function(e){switch(e.label){case 0:return[4,this.socketObj.sendMessage({type:"getChatMessages"})];case 1:return e.sent(),[2]}}))}))},e.prototype.getPolls=function(){return K(this,void 0,void 0,(function(){return Z(this,(function(e){switch(e.label){case 0:return[4,this.socketObj.sendMessage({type:"getPolls"})];case 1:return e.sent(),[2]}}))}))},e.prototype.newPoll=function(e){return K(this,void 0,void 0,(function(){return Z(this,(function(t){switch(t.label){case 0:return[4,this.socketObj.sendMessage({type:"newPoll",payload:e})];case 1:return t.sent(),[2]}}))}))},e.prototype.votePoll=function(e){return K(this,void 0,void 0,(function(){return Z(this,(function(t){switch(t.label){case 0:return[4,this.socketObj.sendMessage({type:"votePoll",payload:e})];case 1:return t.sent(),[2]}}))}))},e.prototype.acceptWaitingRequest=function(e){return K(this,void 0,void 0,(function(){return Z(this,(function(t){switch(t.label){case 0:return[4,this.socketObj.sendMessage({type:"acceptWaitingRequest",payload:{id:e}})];case 1:return t.sent(),[2]}}))}))},e.prototype.rejectWaitingRequest=function(e){return K(this,void 0,void 0,(function(){return Z(this,(function(t){switch(t.label){case 0:return[4,this.socketObj.sendMessage({type:"rejectWaitingRequest",payload:{id:e}})];case 1:return t.sent(),[2]}}))}))},e.prototype.muteAll=function(e){return K(this,void 0,void 0,(function(){return Z(this,(function(t){switch(t.label){case 0:return[4,this.socketObj.sendMessage({type:"muteAllNew",payload:{allowUnMute:e}})];case 1:return t.sent(),[2]}}))}))},e.prototype.muteAllVideo=function(){return K(this,void 0,void 0,(function(){return Z(this,(function(e){switch(e.label){case 0:return[4,this.socketObj.sendMessage({type:"muteAllVideo"})];case 1:return e.sent(),[2]}}))}))},e.prototype.pin=function(e){return K(this,void 0,void 0,(function(){return Z(this,(function(t){switch(t.label){case 0:return[4,this.socketObj.sendMessage({type:"pinPeer",payload:{id:e}})];case 1:return t.sent(),[2]}}))}))},e.prototype.disableAudio=function(e){return K(this,void 0,void 0,(function(){return Z(this,(function(t){switch(t.label){case 0:return[4,this.socketObj.sendMessage({type:"disableAudioPeerNew",payload:{id:e}})];case 1:return t.sent(),[2]}}))}))},e.prototype.disableVideo=function(e){return K(this,void 0,void 0,(function(){return Z(this,(function(t){switch(t.label){case 0:return[4,this.socketObj.sendMessage({type:"disableVideoPeer",payload:{id:e}})];case 1:return t.sent(),[2]}}))}))},e.prototype.kickAll=function(){return K(this,void 0,void 0,(function(){return Z(this,(function(e){switch(e.label){case 0:return[4,this.socketObj.sendMessage({type:"kickAll"})];case 1:return e.sent(),[2]}}))}))},e.prototype.kick=function(e){return K(this,void 0,void 0,(function(){return Z(this,(function(t){switch(t.label){case 0:return[4,this.socketObj.sendMessage({type:"kick",payload:{id:e}})];case 1:return t.sent(),[2]}}))}))},e.prototype.getPage=function(e){return K(this,void 0,void 0,(function(){return Z(this,(function(t){switch(t.label){case 0:return[4,this.socketObj.sendMessage({type:"getPage",payload:{pageNum:e}})];case 1:return t.sent(),[2]}}))}))},e.prototype.setRecordingStatus=function(e){return K(this,void 0,void 0,(function(){return Z(this,(function(t){return window.triggerDyteRecording=e,jr.warn("triggerDyteRecording",{status:e}),[2]}))}))},e.prototype.muteSelf=function(){return K(this,void 0,void 0,(function(){return Z(this,(function(e){switch(e.label){case 0:return Xr.audioOff(),[4,this.socketObj.sendMessage({type:"muteSelf"})];case 1:return e.sent(),[2]}}))}))},e.prototype.unmuteSelf=function(){return K(this,void 0,void 0,(function(){return Z(this,(function(e){switch(e.label){case 0:return Xr.audioOn(),[4,this.socketObj.sendMessage({type:"unmuteSelf"})];case 1:return e.sent(),[2]}}))}))},e.prototype.requestToJoinStage=function(e){return K(this,void 0,void 0,(function(){return Z(this,(function(t){switch(t.label){case 0:return[4,this.socketObj.sendMessage({type:"requestToJoinStage",payload:e})];case 1:return t.sent(),[2]}}))}))},e.prototype.acceptAllRequestToJoinStage=function(e){return K(this,void 0,void 0,(function(){return Z(this,(function(t){switch(t.label){case 0:return[4,this.socketObj.sendMessage({type:"acceptAllRequestToJoinStage",payload:e})];case 1:return t.sent(),[2]}}))}))},e.prototype.removePeerFromStage=function(e,t){return K(this,void 0,void 0,(function(){return Z(this,(function(n){switch(n.label){case 0:return[4,this.socketObj.sendMessage({type:"removePeerFromStage",payload:{id:e,type:t}})];case 1:return n.sent(),[2]}}))}))},e.prototype.startPresenting=function(){return K(this,void 0,void 0,(function(){return Z(this,(function(e){switch(e.label){case 0:return[4,this.socketObj.sendMessage({type:"startPresenting"})];case 1:return e.sent(),[2]}}))}))},e.prototype.stopPresenting=function(){return K(this,void 0,void 0,(function(){return Z(this,(function(e){switch(e.label){case 0:return[4,this.socketObj.sendMessage({type:"stopPresenting"})];case 1:return e.sent(),[2]}}))}))},e.prototype.rejectRequestToJoinStage=function(e){return K(this,void 0,void 0,(function(){return Z(this,(function(t){switch(t.label){case 0:return[4,this.socketObj.sendMessage({type:"rejectRequestToJoinStage",payload:{id:e}})];case 1:return t.sent(),[2]}}))}))},e.prototype.grantPluginAccess=function(e,t){return K(this,void 0,void 0,(function(){return Z(this,(function(n){switch(n.label){case 0:return[4,this.socketObj.sendMessage({type:"grantPluginAccess",payload:{userId:t,pluginId:e}})];case 1:return n.sent(),[2]}}))}))},e.prototype.removePluginAccess=function(e,t){return K(this,void 0,void 0,(function(){return Z(this,(function(n){switch(n.label){case 0:return[4,this.socketObj.sendMessage({type:"removePluginAccess",payload:{userId:t,pluginId:e}})];case 1:return n.sent(),[2]}}))}))},e.prototype.updateRole=function(e,t){return K(this,void 0,void 0,(function(){return Z(this,(function(n){switch(n.label){case 0:return[4,this.socketObj.sendMessage({type:"updatePeerRole",payload:{id:e,roleName:t}})];case 1:return n.sent(),[2]}}))}))},e.prototype.updatePreset=function(e,t){return K(this,void 0,void 0,(function(){return Z(this,(function(n){switch(n.label){case 0:return[4,this.socketObj.sendMessage({type:"updatePeerPreset",payload:{id:e,presetName:t}})];case 1:return n.sent(),[2]}}))}))},e}(),fo=e.createContext(null),po=function(n){var r=n.children,i=n.url,o=n.roomURL,a=n.peerId,l=t.useDispatch(),c=e.useRef(!1),s=e.useState(),u=s[0],d=s[1],p=t.useSelector((function(e){return e.participant.authToken}));return e.useEffect((function(){if(!i||!o||!a)return function(){};var e=new f.EventEmitter,t=i+"?roomURL="+o+"&peerId="+a+"&authToken="+p+"&version=0.5.0";Fr.hasFeature(mt.CFWS)&&(t="https://ws-proxy-ts.pgo.workers.dev?proxyURL="+encodeURIComponent(t),jr.warn("cfWorkerProxyTest"));var n=B.default(t,{transports:["websocket"],autoConnect:!0});n.on("close",(function(e){c.current="connection_timeout"===e})),n.on("disconnect",(function(e){jr.trace("reason for disconnection: "+e),l(ke(ee.DISCONNECTED)),c.current&&n.connect()})),n.io.on("reconnect_failed",(function(){jr.error("websocket_connect_error",{url:i,roomURL:o,authToken:p}),window.location.reload()})),n.io.on("ping",(function(){Fr.hasFeature(mt.SOCKET_PINGSTATS)&&jr.trace("ping recieved")})),n.io.engine.on("pong",(function(){Fr.hasFeature(mt.SOCKET_PINGSTATS)&&jr.trace("pong sent")})),n.on("connect_error",(function(e){!Fr.hasFeature(mt.CFWS)&&Fr.hasFeature(mt.SOCKET_POLLING)&&(n.io.opts.transports=["polling","websocket"]),jr.error("websocket_connect_error",{message:e.message,url:i,roomURL:o,authToken:p}),"roomNotFound"===e.message&&window.location.reload()})),n.on("connect",(function(){jr.trace("websocket_connected"),l(ke(ee.CONNECTED))})),n.io.on("reconnect",(function(){jr.trace("websocket_reconnected")})),n.on("event://server-simple-message",(function(t,n){var r=JSON.parse(t);e.emit("socket",r,n),l(r)}));return d({socket:n,sendMessage:function(e,t){return new Promise((function(r){n.emit("event://send-message",JSON.stringify(e),(function(e){var n=JSON.parse(e);"websocket/resolve"!==n.type&&l(n),r(n),t&&t(n)}))}))},emitter:e,roomURL:o}),function(){n.disconnect(),d(null)}}),[i,o,a,p,l]),A.default.createElement(fo.Provider,{value:u},r)},mo=function(){function e(){this.buttons=[]}return e.prototype.addButton=function(e){var t=e;return"string"==typeof e.icon&&(t.icon=A.default.createElement("div",{dangerouslySetInnerHTML:{__html:e.icon}})),this.buttons.push(t),this._setButtons&&this._setButtons(Q([],this.buttons,!0)),this.buttons.length-1},e.prototype.removeButton=function(e){this.buttons[e]={},this._setButtons(Q([],this.buttons,!0))},e}();!function(e){e.MULTI="MULTI",e.HIGHLIGHTED="HIGHLIGHTED",e.SINGLE="SINGLE"}(ao||(ao={}));var ho,go=function(){function e(){this.layouts=ao}return e.prototype.update=function(e){e.layout&&(e.layout===ao.MULTI&&Dn.dispatch(Ze("multi")),e.layout===ao.HIGHLIGHTED&&Dn.dispatch(Ze("highlighted"))),e.participantVideo&&(this.participantVideoConfiguration=e.participantVideo)},e.prototype.setOverlay=function(e,t){},e}(),vo=function(){function e(){this.metadata={view_type:"",preset_name:""}}return e.prototype._update=function(e,t){this.id=e.id,this.name=e.displayName,this.picture=e.picture,this.isMe=e.isMe,this.isPinned=e.isPinned,this.videoTrack=e.videoTrack,this.audioTrack=e.audioTrack,this.videoEnabled=e.videoVisible,this.audioEnabled=!e.audioMuted,this.clientSpecificId=e.clientSpecificId,this._participantHook=t,this.metadata=e.metadata},e.prototype.pin=function(){this._participantHook&&this._participantHook.pin(this.id)},e.prototype.unpin=function(){this._participantHook&&this._participantHook.unpin(this.id)},e.prototype.updateRole=function(e){this._participantHook&&this._participantHook.updateRole(this.id,e)},e.prototype.updatePreset=function(e){this._participantHook&&this._participantHook.updatePreset(this.id,e)},e}(),yo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return U(t,e),t.prototype.sendMessage=function(e){this._sendMessage&&this._sendMessage(e)},t.prototype.addControl=function(e){this._participantHook&&this._participantHook.addControls(J(J({},e),{id:this.id}))},t.prototype.removeControl=function(e){this._participantHook&&this._participantHook.removeControls(J(J({},e),{id:this.id}))},t.prototype.disableAudio=function(){this._participantHook&&this.audioEnabled&&this._participantHook.disablePeerAudio(this.id)},t.prototype.disableVideo=function(){this._participantHook&&this.videoEnabled&&this._participantHook.disablePeerVideo(this.id)},t.prototype.setOverlay=function(e){},t.prototype.zoom=function(e){e.scale,e.x,e.y},t.prototype.setLabel=function(e){this._participantHook&&this._participantHook.setLabel(this.id,e)},t}(vo),bo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return U(t,e),t.prototype._update=function(t,n){e.prototype._update.call(this,t,n),this.isScreensharing=t.isScreensharing,this.isPresenting=!t.webinarHiddenParticipant},t.prototype.enableAudio=function(){this._participantHook&&!this.audioEnabled&&this._participantHook.toggleSelfAudio(this.id)},t.prototype.enableVideo=function(){this._participantHook&&!this.videoEnabled&&this._participantHook.toggleSelfVideo(this.id)},t.prototype.disableAudio=function(){this._participantHook&&this.audioEnabled&&this._participantHook.toggleSelfAudio(this.id)},t.prototype.disableVideo=function(){this._participantHook&&this.videoEnabled&&this._participantHook.toggleSelfVideo(this.id)},t.prototype.enableScreenshare=function(){this._participantHook&&!this.isScreensharing&&this._participantHook.toggleSelfScreenSharing()},t.prototype.disableScreenshare=function(){this._participantHook&&this.isScreensharing&&this._participantHook.toggleSelfScreenSharing()},t.prototype.setOverlay=function(e){this._videoHook.setPeerOverlayElement(e)},t.prototype.zoom=function(e){var t=e.scale,n=e.x,r=e.y;this._videoHook.setPeerZoom({scale:t,x:n,y:r})},t.prototype.startPresenting=function(){this._participantHook&&!this.isPresenting&&this._participantHook.toggleSelfPresenting()},t.prototype.stopPresenting=function(){this._participantHook&&this.isPresenting&&this._participantHook.toggleSelfPresenting()},t}(vo),Eo=e.createContext(null),So=function(n){var r,i=n.children,o=e.useContext(Vr),a=o.meeting,l=o.sessionConfig,c=e.useState([]),s=c[0],u=c[1],d=t.useSelector((function(e){return e.peers.joinedPeers})),f=t.useSelector((function(e){return e.room.roomViewType})),p=t.useSelector((function(e){return e.participant})),m=t.useSelector((function(e){return e.consumers.activeConsumers})),h=m.filter((function(e){return"video"===e.kind&&e.appData.screenShare})),g=m.filter((function(e){return"audio"===e.kind&&e.appData.screenShare})),v=t.useSelector((function(e){return e.room.pinnedPeerId})),y=e.useState(null),b=y[0],E=y[1],S=e.useState({}),w=S[0],x=S[1],C=e.useState([]),_=C[0],k=C[1],I=t.useDispatch(),T=h.length<(l.permissions.max_screenshare_count||1),P=e.useContext(Io).mediaRoom,O=e.useContext(ki),D=O.mediaTracks,N=D.screenShareTracks,R=D.setScreenShareTracks,M=D.webcamTrack,L=D.audioTrack,z=D.processedWebcamTrack,B=O.inputDevices,F=B.toggleAudioState,j=B.toggleVideoState,V={pin:function(e){return P.pin(e)},unpin:function(e){return P.pin(null)},toggleSelfAudio:function(){return F()},addControls:function(e){var t;w[e.id]?((t=w)[e.id]=Q(Q([],t[e.id].filter((function(t){return t.label!==e.label})),!0),[e],!1),x(t)):((t=w)[e.id]=[e],x(t))},removeControls:function(e){var t=w;if(t[e.id]){t[e.id]=t[e.id].filter((function(t){return t.label!==e.label})),t[e.id].length<=0&&delete t[e.id];var n=J({},t);x(n)}},toggleSelfVideo:function(){return j()},toggleSelfPresenting:function(){p.webinarHiddenParticipant?I($t()):P.stopPresenting()},toggleSelfScreenSharing:function(){return K(void 0,void 0,void 0,(function(){var e,t;return Z(this,(function(n){switch(n.label){case 0:if(p.sharingScreen||!T)return[3,5];void 0!==(null==N?void 0:N.video)&&(null==N||N.video.stop()),void 0!==(null==N?void 0:N.audio)&&(null==N||N.audio.stop()),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,ni()];case 2:return e=n.sent(),R({video:e.video,audio:e.audio}),[3,4];case 3:return t=n.sent(),jr.error("screenshare_toggle_failed",t),[3,4];case 4:return[3,6];case 5:P.disableScreenShare(),R(void 0),n.label=6;case 6:return[2]}}))}))},disablePeerAudio:function(e){return P.disableAudio(e)},disablePeerVideo:function(e){return P.disableVideo(e)},updateRole:function(e,t){return P.updateRole(e,t)},updatePreset:function(e,t){return P.updatePreset(e,t)},setLabel:function(e,t){I(Se({id:e,label:t}))}},W=!0;e.useEffect((function(){E({id:null==P?void 0:P.peerid,audioMuted:p.audioMuted,displayName:p.displayName,userId:p.id,picture:p.displayImageURL,isMe:!0,videoVisible:!p.videoOff,videoTrack:z||M,audioTrack:L,isPinned:v&&v===(null==P?void 0:P.peerid),clientSpecificId:p.clientSpecificId,videoConsumerId:p.videoOff?void 0:"dummy",audioConsumerId:p.audioMuted?void 0:"dummy",isScreensharing:p.sharingScreen,hiddenParticipant:p.hidden,metadata:p.metadata,requestToJoinType:p.requestToJoinType,webinarHiddenParticipant:p.webinarHiddenParticipant})}),[null==P?void 0:P.peerid,p.sharingScreen,p.videoOff,p.audioMuted,p.displayName,M,z,null===(r=null==P?void 0:P.micProducer)||void 0===r?void 0:r.track,v,p.hidden,p.requestToJoinType,L,p.videoProduction,p.metadata]),e.useEffect((function(){b&&a&&a._addUpdateParticipant(J(J({},b),{isPinned:b.id===v,isScreensharing:p.sharingScreen}),V)}),[b,a,R]),e.useEffect((function(){var e=[];p.screenSharingProduction===$.LOADED&&e.push({videoTrack:null==N?void 0:N.video,id:null==b?void 0:b.id,displayName:"Screen - "+(null==b?void 0:b.displayName),videoVisible:!0,audioTrack:null,audioMuted:!0,screenshare:!0}),h.forEach((function(t){var n,r,i,o=null===(n=P.consumers.get(t.id))||void 0===n?void 0:n.track,a=g.find((function(e){return e.appData.peerId===t.appData.peerId}));a&&(i=null===(r=P.consumers.get(a.id))||void 0===r?void 0:r.track);var l=d.find((function(e){return e.id===t.appData.peerId}));e.push({videoTrack:o,id:null==l?void 0:l.id,displayName:"Screen - "+(null==l?void 0:l.displayName),videoVisible:!0,audioTrack:i,audioMuted:null===i,screenshare:!0})})),k(e)}),[h.length,g.length,p.screenSharingProduction]),e.useEffect((function(){a&&(s.map((function(e){return d.find((function(t){return t.id===e.id}))||e.id===b.id||a._removeParticipant(e),null})),u(d))}),[d]);var q=function(e){var t=J(J({},e),{isPinned:v===e.id,isScreensharing:!1}),n=m.find((function(t){return t.peerId===e.id&&"video"===t.kind&&!t.appData.screenShare})),r=m.find((function(t){return t.peerId===e.id&&"audio"===t.kind&&!t.appData.screenShare}));return n&&(t.videoConsumerId=n.id,t.videoTrack=P.consumers.get(n.id).track),r&&(t.audioConsumerId=r.id,t.audioTrack=P.consumers.get(r.id).track),h.find((function(t){var n;return(null===(n=t.appData)||void 0===n?void 0:n.peerId)===e.id}))&&(t.isScreensharing=!0),t.videoVisible=!(void 0===n||n.remotelyPaused),t.audioMuted=void 0===r||e.audioMuted,t.audioMuted||(W=!1),a&&t.id!==b.id&&a._addUpdateParticipant(J(J({},t),{isPinned:t.id===v}),V),t},H=f===ut.webinar?d.filter((function(e){return!(null==e?void 0:e.webinarHiddenParticipant)&&(null==e?void 0:e.requestToJoinType)!==bt.ask})).map(q).filter((function(e){return null!==e})):d.filter((function(e){return!(null==e?void 0:e.hiddenParticipant)})).map(q).filter((function(e){return null!==e})),U=d.map(q).filter((function(e){return null!==e}));return A.default.createElement(Eo.Provider,{value:{processedPeers:H,selfPeer:b,allMuted:W,screenshareVideoConsumers:h,screenshareAudioConsumers:g,screenSharePeers:_,joinedProcessedPeers:U,individualControls:w}},i)},wo=function(){function e(){this.modules=[]}return e.prototype.getAll=function(){return this.modules},e.prototype.add=function(e){this.modules.push(e)},e.prototype.initAndAdd=function(e,t){if(!Zn()&&!Wn()){var n=e({themeContext:v.ThemeContext,peerContext:Eo,userTrackContext:ki,mediaRoomContext:Io});n.hidden=t,this.modules.push(n)}},e}(),xo={en:{translation:{check_audio_video:"Check your audio and video",check_audio:"Check your audio",leave_stage_header:"Do you want to leave the stage?",no_active_plugin:"No active plugin, activate one below ",confirm_leave:"Are you sure you want to leave the call?"}},es:{translation:{check_audio_video:"Compruebe su audio y vdeo",leave_stage_header:"Do you want to leave the stage?",no_active_plugin:"Ningn plugin activo, active uno a continuacin ","Mute All":"Silenciar todos","Mic Off":"Apagar micro","Video Off":"Apagar vdeo",Leave:"Abandonar",Polls:"Encuestas",Participants:"Participantes",Pin:"Fijar","Mute Audio":"Silenciar audio","Disable Video":"Desactivar vdeo",Plugins:"Plugins","Active Plugin":"Activar plugin",File:"Archivo",Poll:"Encuesta",Image:"Imgen","End Meeting for All":"Terminar reunin para todos","Create Poll":"Crear encuesta","Create New Poll":"Crear encuesta",Speaker:"Altavoce","Output Speaker Device":"Altavoce","Input Microphone Device":"Micrfono",Microphone:"Micrfono",Camera:"Cmara","Camera Device":"Cmara",Join:"Unirse","Full Screen":"Pantalla completa","Share Screen":"Compartir pantalla",Layout:"Composicin","Cancel Poll Creation":"Cancelar creacin de encuesta","View only":"Solo ver","Full control":"Control completo","Poll Question":"Pregunta de la encuesta","What is your poll for ?":"Para qu es su encuesta?","Enter an option":"Introducir una opcin","Add an option":"Aadir una opcin",Anonymous:"Annimo","Hide results before voting":"Ocultar resultados antes de votar","Type a message...":"Escriba un mensaje",confirm_leave:"Est seguro que quiere abandonar la llamada?",Connecting:"Conectando",Reconnecting:"Reconectando","Waiting for permissions":"Esperando permisos"}},pt:{translations:{check_audio_video:"Compre seu udio e vdeo",leave_stage_header:"Voc quer sair do palco?",no_active_plugin:"Ningn plugin ativo, ativo uma continuao ","Mute All":"Silenciar todos","Mic Off":"Apagar micro","Video Off":"Apagar vdeo",Leave:"Abandonar",Polls:"Encuestas",Participants:"Participantes",Pin:"Fijar","Mute Audio":"Silenciar udio","Disanle video":"Desativar vdeo",Plugins:"Plugins","Active Plugin":"Ativar plugin",File:"Arquivo",Poll:"Enquete",Image:"Imagem","End Meeting for All":"Terminar reunin para todos","Create Poll":"Criar encuesta","Create New Poll":"Criar encuesta",Speaker:"Altavoce","Output Speaker Device":"Altavoce","Input Microphone Device":"Micrfono",Microphone:"Microfone",Camera:"Cmara","Camera Device":"Cmara",Join:"Unirse","Full Screen":"Pantala Completa","Share Screen":"Compartilhar pantalla",Layout:"Esquema","Cancel Poll Creation":"Cancelar criao de consulta","View Only":"Verso individual","Full Control":"Controle completo","Poll Question":"Pregunta de la encuesta","What is your poll for ?":"Para que serve sua enquete?","Enter an option":"Introduo de uma opo","Add an option":"Adicionar uma opo",Anonymous:"Annimo","Hide results before voting":"Ocultar resultados antes de votar","Type a message...":"Digite uma mensagem",confirm_leave:"Est seguro que quer abandonar a lhamada?",Connecting:"Conectando",Reconnecting:"Reconectando","Waiting for permissions":"Esperando permisses"}}},Co=function(e){var t=e.useShadowDom,n=e.children;return t&&(document.head.createShadowRoot||document.head.attachShadow)?A.default.createElement(j.default.div,{id:"dyte-shadow"},A.default.createElement("style",null,sn),A.default.createElement("link",{rel:"stylesheet",href:"https://fonts.googleapis.com/css?family=Inter:400,500,600|Lato:300,400,600"}),A.default.createElement("style",null,"* {\n\t\t\tfont-family: 'Inter';\n\t\t}"),n):A.default.createElement(A.default.Fragment,null,A.default.createElement("style",null,sn),n)};!function(e){e.participantJoin="participantJoin",e.participantLeave="participantLeave",e.disconnect="disconnect",e.connect="connect",e.meetingEnded="meetingEnded",e.roomMessage="roomMessage",e.chatMessage="chatMessage",e.message="message",e.meetingJoined="meetingJoined",e.activeSpeaker="activeSpeaker",e.recordingStarted="recordingStarted",e.recordingStopped="recordingStopped",e.participantVideoZoomed="participantVideoZoomed",e.localMediaConnected="localMediaConnected",e.screenSharingUpdated="screenSharingUpdated",e.audioUpdated="audioUpdated",e.videoUpdated="videoUpdated"}(ho||(ho={}));var _o=J({},zr),ko=function(e){function n(t,n){var r=e.call(this)||this;r.config=_o,r.participants=[],r.showSetupScreen=!1,r.leaveRoom=function(){},r.kickAll=function(){},r.openChatView=function(){},r.closeChatView=function(){},r.kick=function(e){},r.enablePiP=function(){},r.disablePiP=function(){},r._uiConfig={},r.connectionConfig=t;var i,o=JSON.parse(JSON.stringify(n||{}));return r._uiConfig=o,r.config.theme=Lr(r.config.theme,o),r.controlBar=new mo,r.grid=new go,r.Events=ho,r.modules=new wo,r.plugins=[],r.isPiPEnabled=!1,i=t.lang||document.documentElement.lang||"en",V.default.use(x.initReactI18next).init({resources:xo,lng:i,interpolation:{escapeValue:!1}}),jr.trace("roomName",r.connectionConfig.roomName),(null==t?void 0:t.apiBase)&&dn(t.apiBase),r}return U(n,e),n.prototype.updateUIConfig=function(e){this._uiConfig=kr(this._uiConfig,e),this.config.theme=Lr(this.config.theme,e),this._setUIConfig&&this._setUIConfig(this.config)},n.prototype.addParticipantControl=function(e){this._controlsHook(e)},n.prototype.sendRoomMessage=function(e){},n.prototype.sendMessage=function(e,t){},n.prototype.createPopup=function(e){},n.prototype.closePopup=function(){this.createPopup(null)},n.prototype.onError=function(e){this._onError=e},n.prototype.onSocketMessage=function(e){var t,n;switch(e.type){case"websocket/room-message":this.emit(ho.roomMessage,null===(t=e.payload)||void 0===t?void 0:t.message);break;case"websocket/message":this.emit(ho.message,null===(n=e.payload)||void 0===n?void 0:n.message);break;case"websocket/new-chat-message":this.emit(ho.chatMessage,e.payload)}},n.prototype._addUpdateParticipant=function(e,t){if(e.id){var n=this.participants.findIndex((function(t){return t.id===e.id}));if(-1===n){if(e.isMe)(r=new bo)._update(e,t),this.participants.push(r),this.self=r;else(r=new yo)._update(e,t),this.participants.push(r),this.emit(ho.participantJoin,r)}else{var r=this.participants[n];e.isMe&&(r.isScreensharing!==e.isScreensharing&&this.emit(this.Events.screenSharingUpdated,e.isScreensharing),r.audioEnabled!==!e.audioMuted&&this.emit(this.Events.audioUpdated,!e.audioMuted),r.videoEnabled!==e.videoVisible&&this.emit(this.Events.videoUpdated,e.videoVisible)),r._update(e,t)}}},n.prototype._removeParticipant=function(e){var t=this.participants.find((function(t){return t.id===e.id}));this.participants=this.participants.filter((function(t){return t.id!==e.id})),this.emit(ho.participantLeave,t)},n.prototype._render=function(e){F.default.render(A.default.createElement(A.default.StrictMode,null,A.default.createElement("div",{className:"dyte-client dyte-client-root"},A.default.createElement("link",{rel:"stylesheet",href:"https://fonts.googleapis.com/css?family=Inter:400,500,600|Lato:300,400,600"}),A.default.createElement(Co,{useShadowDom:this.connectionConfig.useShadowDOM},A.default.createElement("div",{id:"dyte-base-elem"},A.default.createElement(t.Provider,{store:Dn},A.default.createElement(a.ClientContext.Provider,{value:Nn(this.connectionConfig.apiBase)},A.default.createElement(Wr,{meeting:this},A.default.createElement(Ii,null,A.default.createElement(wl,{roomName:this.connectionConfig.roomName,autoTune:void 0===this.connectionConfig.autoTune||this.connectionConfig.autoTune}))))))))),document.getElementById(e))},n.prototype.init=function(e){var t=this;"loading"!==document.readyState?this._render(e):window.addEventListener("load",(function(){t._render(e)})),this.on(ho.meetingEnded,(function(){F.default.unmountComponentAtNode(document.getElementById(e)),document.querySelectorAll(".chakra-portal").forEach((function(e){return e.remove()}))}))},n}(f.EventEmitter),Io=e.createContext(null),To=function(n){var r=n.children,i=n.peerId,o=n.roomName,a=n.autoTune,l=e.useContext(fo),c=e.useContext(Vr),s=c.meeting,u=c.sessionConfig.permissions,d=e.useContext(ki),f=d.mediaTracks,p=f.webcamTrack,m=f.processedWebcamTrack,h=f.audioTrack,g=d.processingStatus.webcamProccessing,v=t.useDispatch(),y=e.useState(null),b=y[0],E=y[1],S=e.useRef(null),w=t.useSelector((function(e){return e.room.socketState})),x=t.useSelector((function(e){return e.room.producersState})),C=t.useSelector((function(e){return e.participant.videoProduction})),_=t.useSelector((function(e){return e.participant.audioProduction})),k=t.useSelector((function(e){return e.participant.audioMuted}));e.useEffect((function(){b&&(S.current=b)}),[b]),e.useEffect((function(){k?null==b||b.muteSelf():null==b||b.unmuteSelf()}),[k]),e.useEffect((function(){if(x===$.LOADED)if(p||C!==$.STOPPING)if(g){if(!m)return;C===$.LOADED?null==b||b.webCamProducer.replaceTrack({track:m}):C===$.CONNECTING&&(null==b||b.shareWebcam(m))}else!g&&C===$.LOADED&&p&&(null==b?void 0:b.webCamProducer.track.id)!==p.id?null==b||b.webCamProducer.replaceTrack({track:p}):p&&C===$.CONNECTING&&(null==b||b.shareWebcam(p));else null==b||b.disableWebcam()}),[p,C,g,m]),e.useEffect((function(){x===$.LOADED&&(h&&_===$.CONNECTING?null==b||b.shareMic(h):h&&_===$.LOADED?null==b||b.replaceTrackOnProducer("micProducer",h):_!==$.CONNECTING&&_!==$.STOPPING||null==b||b.disableMic())}),[h,_]),e.useEffect((function(){var e;if(w===ee.CONNECTED){s&&s.emit(s.Events.connect);var n=new uo(i,o,l,v,a,!1,!!Fr.hasFeature(mt.SIMULCAST));E(n),n.setRecordingStatus(!0),e=n,K(void 0,void 0,void 0,(function(){var t;return Z(this,(function(n){switch(n.label){case 0:return[4,Qr()];case 1:return t=n.sent(),e.setICEServers(t),[4,e.getRoomState()];case 2:return n.sent(),[4,e.loadRouter()];case 3:return n.sent(),[4,Promise.all([e.createRecvTransport(),e.createSendTransport()])];case 4:return n.sent(),s&&(s.sendRoomMessage=function(e){l.sendMessage({type:ho.roomMessage,payload:{message:e}})},s.sendMessage=function(e,t){l.sendMessage({type:ho.message,payload:{peerId:e,message:t}})},s.kickAll=function(){u.kick_participant&&e.kickAll()},s.kick=function(t){u.kick_participant&&e.kick(t)},s.enablePiP=function(){Yn()&&v(Ce(!0))},s.disablePiP=function(){Yn()&&v(Ce(!1))},null==l||l.emitter.on("socket",(function(e){s.onSocketMessage(e)}))),v(Te($.LOADED)),v(Oe($.NOT_STARTED)),[2]}}))}))}else w===ee.DISCONNECTED&&(null==b||b.stopAllTransports(),null==l||l.emitter.removeAllListeners(),t.batch((function(){v(ae()),v(zt(!0)),v(_n()),v(An())})),E(null),Te($.NOT_APPLICABLE))}),[w,i]),e.useEffect((function(){return function(){var e,t;null===(e=S.current)||void 0===e||e.stopAllProducers(),null===(t=S.current)||void 0===t||t.stopAllTransports()}}),[]);var I={mediaRoom:b};return A.default.createElement(Io.Provider,{value:I},r)},Po=function(e){return e.videoScore<4?A.default.createElement(i.Icon,{zIndex:5,as:Ln,color:"danger.500"}):A.default.createElement(i.Icon,{zIndex:5,as:Ln,fill:"warning.500"})};function Ao(e){var t=e.name,n=e.size,r=e.imgSrc,o=e.dimensions,a=e.fontSize;return A.default.createElement(i.Avatar,{className:"dyte-client-noSelect",size:n,bg:"primary.500",color:"text.200",h:o,w:o,name:(t||"").trim(),src:r,fontSize:a})}Ao.defaultProps={imgSrc:"",size:"sm",dimensions:null,fontSize:"inherit"};var Oo=e.createContext(null),Do=function(n){var r=t.useDispatch(),i=e.useRef(null),o=e.useRef(null),a=A.default.useRef(),l=t.useSelector((function(e){return e.room.pipMode})),c=e.useContext(Vr).meeting,s=n.children,u=e.useRef([]),d=function(){var e=u.current.length,t=function(e,t,n){switch(n){case 0:case 1:case 2:return[Math.floor(e/2),t];case 3:case 4:return[Math.floor(e/2),Math.floor(t/2)];case 5:case 6:default:return[Math.floor(e/3),Math.floor(t/2)]}}(1280,720,e),n=t[0],r=t[1],o=i.current.getContext("2d");!function(e){var t=e.gridW,n=e.gridH,r=e.videoRefs,i=e.gridSize,o=e.ctx;o.fillStyle="#000000",o.fillRect(0,0,1280,720);for(var a,l,c,s,u,d,f,p,m,h,g,v,y,b,E=0,S=0;E<715;){for(var w=0;w<1275&&S<i;){var x=r.current[S].video;o.drawImage.apply(o,Q([x],(a=w,l=E,c=t,s=n,u=void 0,d=void 0,f=void 0,p=void 0,m=void 0,h=void 0,g=void 0,v=void 0,y=void 0,b=void 0,m=x.videoWidth,y=(h=x.videoHeight)*(g=Math.min(c/m,s/h)),b=1,(v=m*g)<c&&(b=c/v),Math.abs(b-1)<1e-14&&y<s&&(b=s/y),(u=.5*(m-(f=m/((v*=b)/c))))<0&&(u=0),(d=.5*(h-(p=h/((y*=b)/s))))<0&&(d=0),f>m&&(f=m),p>h&&(p=h),[u,d,f,p,a,l,c,s]),!1)),S+=1,w+=t}E+=n}}({gridW:n,gridH:r,videoRefs:u,gridSize:e,ctx:o})};return e.useEffect((function(){if(l){var e=document.createElement("canvas");e.height=720,e.width=1280,i.current=e;var t=document.createElement("video");t.height=720,t.width=1280,t.autoplay=!0,o.current=t,t.srcObject=e.captureStream(24),t.onloadedmetadata=function(e){try{t.requestPictureInPicture(),c.isPiPEnabled=!0,t.onleavepictureinpicture=function(){r(Ce(!1)),a.current=void 0}}catch(e){jr.error("pip_failed",e)}};var n=function(){d(),a.current&&(a.current=requestAnimationFrame(n))};a.current=requestAnimationFrame(n)}else try{document.pictureInPictureElement&&(document.exitPictureInPicture(),c.isPiPEnabled=!1,a.current=void 0)}catch(e){}}),[l]),A.default.createElement(Oo.Provider,{value:{registerVideoRef:function(e,t){u.current=u.current.filter((function(t){return t.peerId!==e})).concat([{peerId:e,video:t}])},deregisterVideoRef:function(e){u.current=u.current.filter((function(t){return t.peerId!==e}))}}},s)};function No(n){var r=n.peer,o=n.hideBadge,a=n.isMobile,c=n.totalPeers,s=n.size,u=n.pipMode,d=n.isInactiveScreenShare,f=e.useState(!1),p=f[0],m=f[1],h=t.useSelector((function(e){return e.participant.displayName})),g=t.useSelector((function(e){return e.room.roomViewType})),v=e.useContext(Io),y=null==v?void 0:v.mediaRoom,b=i.useTheme().colors,E=t.useSelector((function(e){return e.consumers.consumerScores[null==r?void 0:r.videoConsumerId]})),S=(null==E?void 0:E.score)||10,w=e.useContext(Vr),x=w.meeting,C=w.sessionConfig,_=w.participantControls,k=e.useRef(),I=e.useContext(Oo),T=e.useRef(null),P=e.useRef(null),O=e.useState(null),D=O[0],N=O[1],R=t.useDispatch(),M=function(e){return e?so:lo}(a),z=t.useSelector((function(e){return e.participant.displayImageURL})),B=t.useSelector((function(e){return e.peers.videoTransforms[null==r?void 0:r.id]}))||"",F=r.isMe?z:r.picture,j=function(){try{var e=r.videoTrack&&"function"==typeof r.videoTrack.getCapabilities?r.videoTrack.getCapabilities():null;return(null==e?void 0:e.facingMode)||[]}catch(e){return jr.trace("get_video_track_capbility_failure",e),[]}};e.useEffect((function(){var e=r.videoTrack;r.videoVisible&&function(e){k.current=e;var t=P.current;if(e){var n=new MediaStream;if(n.addTrack(e),t){t.srcObject=n,t.oncanplay=function(){return m(!0)};var i=t.play();r.screenshare||null==I||I.registerVideoRef(r.id,P.current),null==i||i.catch((function(e){Xr.mediaPlaybackFailed("VIDEO"),jr.error("videoElem_play_failed",e)}))}}else t&&(t.srcObject=null,r.screenshare||null==I||I.deregisterVideoRef(r.id))}(e)}),[r.videoTrack,r.videoVisible]);var V=function(e){P.current=e},W=function(e){var t=e.x,n=e.y,i=e.scale,o=P.current;if(o){var a=function(e){var t=e.x,n=e.y,r=e.scale;return"scale3d("+r+","+r+", 1) translate3d("+t+"px, "+n+"px, 0)"}({x:t,y:n,scale:i});o.style.setProperty("transform",a),R(fe({peerId:r.id,transform:a}))}};e.useEffect((function(){if(x){var e=x.participants.find((function(e){return e.id===r.id}));e&&(e.setOverlay=N,e.zoom=W)}}),[x]);var q=e.useCallback((function(e){var t=e.x,n=e.y,i=e.scale;if(a&&(W({x:t,y:n,scale:i}),x)){var o=x.participants.find((function(e){return e.id===r.id}));x.emit(x.Events.participantVideoZoomed,{participant:o,zoom:{x:t,y:n,scale:i}})}}),[]),H=function(e,t,o,l,c){var d=n.width,f=n.maxVideoHeight,p=n.contain,m=n.isSideView,h=function(e,t){return{newHeight:"number"==typeof e?e+"px":e,newWidth:"number"==typeof t?t+"px":t}}(t,d);return e?A.default.createElement(i.Flex,{width:"100%",padding:a?"3px":m?"0px":"5px",justifyContent:"center",className:r.isMe&&!j().includes("environment")?"dyte-client-invertOnly":""},S<10&&A.default.createElement(i.Box,{position:"absolute",top:"1em",right:"1em",zIndex:5},A.default.createElement(Po,{videoScore:S})),(0===S||!l)&&A.default.createElement(i.Spinner,{zIndex:10,color:"text.100",position:"absolute",top:0,bottom:0,marginTop:"auto",marginBottom:"auto"}),A.default.createElement(Xi,{onUpdate:q,onDoubleTap:function(){a&&T.current&&T.current()}},A.default.createElement("video",{ref:V,style:{visibility:e?"visible":"hidden",height:h.newHeight,width:h.newWidth,maxHeight:f||"100vh",objectFit:p?"contain":"cover",backgroundColor:"secondary.800",borderRadius:"6px",filter:"blur("+(0===S?"4px":"0px")+")",opacity:0===S?.25:1,transform:B,boxShadow:u?"0px 2px 9px -1px rgba(0,0,0,0.5)":"none"},className:L.default({hidden:!e}),autoPlay:!0,playsInline:!0,muted:!0,controls:!1}))):A.default.createElement(i.Flex,{width:"100%",padding:a?"3px":m?"0px":"5px",justifyContent:"center"},A.default.createElement(Xi,{onUpdate:function(){},onDoubleTap:function(){a&&T.current&&T.current()}},A.default.createElement(i.Flex,{className:"dyte-client-peerVideo",backgroundColor:"background",height:h.newHeight,width:h.newWidth,justify:"center",align:"center",borderRadius:"6px",boxShadow:u?"0px 2px 9px -1px rgba(0,0,0,0.5)":"none"},A.default.createElement(Ao,{size:"sm"===s||u?"lg":"xl",name:c.trim(),imgSrc:o,fontSize:"1em"}))))},U=r.audioMuted,G=r.videoVisible,J=r.isPinned,Y=r.isScreensharing,K=function(e){if(!a)return e;var t=e;return c>2&&(t=(t=e.split(" ")[0]).slice(0,10)),c>6&&(t=t.slice(0,8)),t}(r.isMe?h:r.displayName),Z=n.height,Q=n.width,X=n.children,$=Z||("number"==typeof Q?Math.floor(.5625*Q):"calc("+Q+" * 0.5625"),ee=null==C?void 0:C.permissions,te=(null==ee?void 0:ee.pin_participant)||(null==ee?void 0:ee.can_allow_participant_audio)||(null==ee?void 0:ee.can_allow_participant_video)||(null==ee?void 0:ee.kick_participant);return A.default.createElement(i.Box,{"data-component":"PeerView",position:"relative",width:Q,maxHeight:"fit-content",className:"dyte-peerview"},D?A.default.createElement("div",{style:{position:"absolute",top:0,left:0,zIndex:10,width:"100%",height:"100%"}},D):null,d?A.default.createElement("div",{style:{position:"absolute",top:0,left:0,display:"flex",justifyContent:"center",alignItems:"center",width:"100%",opacity:.8,background:"#000",zIndex:1,height:"100%",cursor:"pointer"},onClick:function(){return R(ot(r.id))}},A.default.createElement(l.Fullscreen,{color:b.text[300],size:32})):null,c>0&&te?A.default.createElement(io,null,A.default.createElement(co,{onInit:function(e){T.current=e}},H(G,$,F,p,K)),A.default.createElement(M,null,ee.pin_participant&&g!==Ar.webinar&&(J?A.default.createElement(oo,{onClick:function(){return y.pin(null)}},"Unpin"):A.default.createElement(oo,{onClick:function(){return y.pin(r.id)}},"Pin")),ee.can_allow_participant_audio&&A.default.createElement(oo,{disabled:U,onClick:function(){return y.disableAudio(r.id)}},"Mute Audio"),ee.can_allow_participant_video&&A.default.createElement(oo,{disabled:!G,onClick:function(){return y.disableVideo(r.id)}},"Disable Video"),!r.isMe&&ee.kick_participant&&A.default.createElement(oo,{onClick:function(){return y.kick(r.id)}},"Kick"),(null==_?void 0:_.length)>0&&A.default.createElement(i.Divider,null),null==_?void 0:_.map((function(e){return A.default.createElement(oo,{onClick:function(){return e.onClick(r.id)}},e.label)})))):H(G,$,F,p,K),A.default.createElement(i.Flex,{width:"100%",position:"absolute",top:"0em",padding:a||"sm"===s?"3px":"1em"},Y&&!o&&A.default.createElement(i.Flex,{width:a||"sm"===s?"100%":"auto",justifyContent:"flex-start",direction:"column",p:"1",zIndex:2},A.default.createElement(l.ScreenShare,{size:32,color:b.text[300],style:{borderRadius:"50%",padding:"8px",backgroundColor:b.secondary[800]}})),J&&!Y&&A.default.createElement(i.Flex,{width:a||"sm"===s?"100%":"auto",justifyContent:"flex-start",direction:"column",p:"1"},A.default.createElement(l.PushPin,{size:32,color:b.text[300],style:{borderRadius:"50%",padding:"8px",transform:"rotate(45deg)",backgroundColor:b.secondary[800]}})),A.default.createElement(i.Spacer,null),A.default.createElement(i.Stack,{isInline:!0,justify:"flex-end"})),A.default.createElement(i.Flex,{width:"100%",position:"absolute",bottom:"0em",zIndex:2,padding:a||"sm"===s||u?"0px":"0.6em 1.2em",alignItems:"flex-end"},o||u||A.default.createElement(i.Flex,{maxWidth:"100%",overflow:"hidden",width:"auto",justifyContent:"flex-start",direction:"column"},A.default.createElement(to,{audioMuted:U,audioTrack:r.audioTrack,name:K,size:a||"sm"===s?"sm":"md",screenshare:r.screenshare})),u&&A.default.createElement(i.Flex,{maxWidth:"100%",overflow:"hidden",width:"auto",justifyContent:"flex-start",direction:"column"},A.default.createElement(to,{audioMuted:U,audioTrack:r.audioTrack,name:K,size:a||"sm"===s||u?"sm":"md",screenshare:r.screenshare})),A.default.createElement(i.Spacer,null),A.default.createElement(i.Stack,{isInline:!0,justify:"flex-end",spacing:"0.5em"},X)))}No.defaultProps={isMobile:!1,hideBadge:!1,height:0,width:"100%",maxVideoHeight:"",children:A.default.createElement(A.default.Fragment,null),contain:!1,totalPeers:0,size:"md",isMe:!1,pipMode:!1};var Ro={12:"1fr 1fr 1fr",9:"1fr 1fr 1fr",8:"1fr 1fr 1fr",7:"1fr 1fr 1fr",6:"1fr 1fr",5:"1fr 1fr",4:"1fr 1fr",3:"1fr 1fr",2:"1fr",1:"1fr"},Mo={12:"1fr 1fr 1fr 1fr",9:"1fr 1fr 1fr",8:"1.4fr 0.7fr 0.7fr 1.4fr",7:"1.4fr 0.7fr 0.7fr 1.4fr",6:"1fr 1fr 1fr",5:"1.4fr 0.7fr 0.7fr 1.4fr",4:"1fr 1fr",3:"1fr 1fr",2:"1fr 1fr",1:"1fr"},Lo={12:["1/2","1/2","1/2","1/2","2/3","2/3","2/3","2/3","3/4","3/4","3/4","3/4"],9:["1/2","1/2","1/2","2/3","2/3","2/3","3/4","3/4","3/4"],8:["1/2","1/2","2/3","2/3","2/3","3/4","3/4","3/4"],7:["1/2","1/2","2/3","2/3","3/4","3/4","3/4"],6:["1/2","1/2","1/2","2/3","2/3","2/3"],5:["1/2","1/2","2/3","2/3","2/3"],4:["1/2","1/2","2/3","2/3"],3:["1/3","1/2","2/3"],2:["1/2","1/2"],1:["1"]},zo={12:["1/2","2/3","3/4","4/5","1/2","2/3","3/4","4/5","1/2","2/3","3/4","4/5"],9:["1/2","2/3","3/4","1/2","2/3","3/4","1/2","2/3","3/4"],8:["1/3","3/5","1/2","2/4","4/5","1/2","2/4","4/5"],7:["1/3","3/5","1/3","3/5","1/2","2/4","4/5"],6:["1/2","2/3","3/4","1/2","2/3","3/4"],5:["1/3","3/5","1/2","2/4","4/5"],4:["1/2","2/3","1/2","2/3"],3:["1/2","2/3","2/3"],2:["1/2","2/3"],1:["1"]},Bo={12:Array(12).fill(3),9:Array(9).fill(3),8:Array(9).fill(3),7:Array(9).fill(3),6:Array(6).fill(2),5:Array(5).fill(2),4:Array(4).fill(2),3:[1,2,2],2:[1,1],1:[1]},Fo={12:Array(12).fill(4),9:Array(9).fill(3),8:Array(9).fill(3),7:Array(9).fill(3),6:Array(6).fill(3),5:Q(Q([],Array(2).fill(2),!0),Array(3).fill(3),!0),4:Array(4).fill(2),3:Array(3).fill(2),2:Array(2).fill(2),1:[1]},jo=function(n){var r,o,a,l=e.useContext(Vr).sessionConfig,c=Et(),s=t.useSelector((function(e){return e.room.roomViewType})),u=t.useSelector((function(e){return e.room.currentPage})),d=(null===(r=l.theme)||void 0===r?void 0:r.dimensions)||c,f=d.width,p=d.height,m=f>p,h=f<1024,g=Wn()&&m,v=h&&m,y=n.peers,b=n.gridSize,E=n.waitingRoom,S=n.widthOffset,w=n.controlBarHeight;n.showAlone;var x=0;l.theme.header.is_enabled&&(x-=40),!l.theme.control_bar.is_enabled||E&&!l.theme.waiting_room.enable_preview||(x-=w),g?f+=x:(p+=x,f-=S);var C,_=1===b&&s!==ut.webinar&&!h&&(null===(a=null===(o=l.theme)||void 0===o?void 0:o.alone_here)||void 0===a?void 0:a.is_enabled)&&!E,k=E&&(!h||!l.theme.waiting_room.enable_preview),I=(_&&0===u||k)&&1;7===(C=1===b&&0===u&&_?2:1===b?1:b)||8===C?C=9:C>9&&(C=12);var T=function(e,t){return Math.floor(p/e)-2*t*(e+1)/e},P=function(e){return h&&!v?{cols:Ro[e],rows:Mo[e]}:{cols:Mo[e],rows:Ro[e]}},O=function(e,t){return h&&!v?{col:Lo[e][t],row:zo[e][t]}:{col:zo[e][t],row:Lo[e][t]}},D=function(e,t){return T(h&&!v?Fo[e][t]:Bo[e][t],3)},N=O(C,0),R="rotate("+(g?90:0)+"deg)",M=Math.floor(p/2)+"px "+Math.floor(p/2)+"px";return A.default.createElement(i.Grid,{height:p-(g?2:0),width:f,backgroundColor:"secondary.1000",px:h?"3px":"5px",gridTemplateColumns:P(C).cols,gridTemplateRows:P(C).rows,transform:R,transformOrigin:M},_&&0===u&&A.default.createElement(i.Box,{gridColumn:N.col,gridRow:N.row,p:"5px"},A.default.createElement(Ti,{height:D(C,0)})),E&&A.default.createElement(i.Box,{gridColumn:N.col,gridRow:N.row,p:"5px"},A.default.createElement(Pi,{height:D(C,0)})),!E||l.theme.waiting_room.enable_preview&&!h?y.map((function(e,t){var n,r=O(C,t+I);return A.default.createElement(i.Box,{key:e.id+"_video",gridColumn:r.col,gridRow:r.row},A.default.createElement(No,{height:D(C,t+I),peer:e,totalPeers:y.length,isMobile:h,contain:"contain"===(null===(n=l.theme.grid)||void 0===n?void 0:n.multi.videoFit)}))})):null)};jo.defaultProps={waitingRoom:!1,widthOffset:0,controlBarHeight:72,showAlone:!0};var Vo=function(){function e(e,t,n,r,i,o){this.socketObj=e,this.dispatch=n,this.roomName=t,this.plugins={},this.iframes={},this.peerId=r,this.handleSockets=this.handleSockets.bind(this),this.authToken=i,this.meeting=o}return e.prototype.handleSockets=function(e){if(e)switch(e.type){case"websocket/enable-plugin":this.enablePlugin(e.payload);break;case"websocket/disable-plugin":this.disablePlugin(e.payload);break;case"websocket/plugin-event":case"websocket/plugin-data":this.sendIframeEvent(e);break;case"websocket/peer-joined":case"websocket/peer-closed":case"websocket/new-chat-message":this.broadcastIframeEvent(e)}},e.prototype.broadcastIframeEvent=function(e){Object.values(this.iframes).forEach((function(t){Object.values(t).forEach((function(t){t.iframe&&t.iframe.contentWindow.postMessage(e,t.iframe.src)}))}))},e.prototype.sendIframeEvent=function(e){var t=this.iframes[e.payload.pluginId||e.payload.id];t&&Object.values(t).forEach((function(t){t.iframe&&t.iframe.contentWindow.postMessage(e,"*")}))},e.prototype.listenSocketEvents=function(){return K(this,void 0,void 0,(function(){return Z(this,(function(e){return this.socketObj.emitter.on("socket",this.handleSockets),[2,this.getRoomPlugins()]}))}))},e.prototype.getRoomPlugins=function(){return K(this,void 0,void 0,(function(){var e,t,n=this;return Z(this,(function(r){switch(r.label){case 0:return[4,this.socketObj.sendMessage({type:"getRoomState"})];case 1:return e=r.sent(),t=e.payload.roomState.plugins,[4,Promise.all(t.map((function(e){return n.enablePlugin(e)})))];case 2:return r.sent(),[2]}}))}))},e.prototype.enablePlugin=function(e){return K(this,void 0,void 0,(function(){var t,n,r,i=this;return Z(this,(function(o){switch(o.label){case 0:return this.plugins[e.id]?[2]:[4,fetch(un.apiBase+"/v2/plugins/view/"+e.id,{method:"GET",headers:{authorization:"Bearer "+this.authToken,"dyte-tracing-id":this.peerId}})];case 1:return[4,o.sent().json()];case 2:return t=o.sent(),[4,fetch(un.apiBase+"/v2/plugins/authorize/"+e.id,{method:"POST",headers:{authorization:"Bearer "+this.authToken,"Content-Type":"application/json","dyte-tracing-id":this.peerId},body:JSON.stringify({roomName:this.roomName,peerId:this.peerId})})];case 3:return[4,o.sent().json()];case 4:return n=o.sent().data.token,r=J(J({},t.data.plugin),{authToken:n,enabledBy:e.enabledBy,ACLAccessGrantedUsers:e.ACLAccessGrantedUsers||[],ACLAccessRemovedUsers:e.ACLAccessRemovedUsers||[]}),this.plugins[e.id]=r,this.iframes[e.id]={},fetch(r.baseURL+"/dyte-config.json").then((function(e){return e.json()})).then((function(e){i.dispatch(pn({plugin:r,meeting:i.meeting,config:e,pluginService:i}))})).catch((function(e){i.dispatch(pn({plugin:r,meeting:i.meeting,config:null,pluginService:i}))})),[2]}}))}))},e.prototype.disablePlugin=function(e){return K(this,void 0,void 0,(function(){return Z(this,(function(t){return this.plugins[e.id]&&(delete this.plugins[e.id],this.dispatch(mn(e)),this.meeting.plugins.find((function(t){return t.id===e.id})).emit("closed")),[2]}))}))},e.prototype.getEnabledByPeerId=function(e){var t,n;if(!e)return n;var r=this.plugins[e].enabledBy,i=Dn.getState().peers.joinedPeers,o=Dn.getState().participant;return o.id===r&&(n=o.peerId),n||(n=null===(t=i.find((function(e){return e.userId===r})))||void 0===t?void 0:t.id),n},e.prototype.handleIframeMessage=function(e){var t,n;return K(this,void 0,void 0,(function(){var r,i,o,a,l=this;return Z(this,(function(c){switch(e.type){case"pluginEvent":case"storePluginData":case"getPluginData":case"enablePluginForAll":case"enablePluginForUser":case"disablePluginForUser":case"chatMessage":this.socketObj.sendMessage(e,(function(e){l.sendIframeEvent(e)}));break;case"getJoinedPeers":this.sendIframeEvent({type:"websocket/get-joined-peers",payload:J(J({},e.payload),{peers:Dn.getState().peers.joinedPeers})});break;case"getPeerInfo":r={type:e.type,payload:J(J({},e.payload),{peerId:null!==(n=null===(t=e.payload)||void 0===t?void 0:t.peerId)&&void 0!==n?n:this.peerId})},this.socketObj.sendMessage(r,(function(e){l.sendIframeEvent(e)}));break;case"getRoomState":i=this.getEnabledByPeerId(e.payload.pluginId),this.socketObj.sendMessage(e,(function(t){l.sendIframeEvent({type:"websocket/get-room-state",payload:J(J({},e.payload),{roomName:l.roomName,pluginInitiatorPeerId:i,peers:t.payload.roomState.peers,displayTitle:t.payload.roomState.displayTitle,roomUUID:t.payload.roomState.roomUUID,currentPeer:l.peerId})})}));break;case"getPluginInitiatorId":o=this.getEnabledByPeerId(e.payload.pluginId),this.sendIframeEvent({type:"websocket/get-plugin-initiator-peer-id",payload:J(J({},e.payload),{pluginInitiatorPeerId:o})});break;case"getPluginInitiatorUserId":a=this.plugins[e.payload.pluginId].enabledBy,this.sendIframeEvent({type:"websocket/get-plugin-initiator-user-id",payload:J(J({},e.payload),{pluginInitiatorUserId:a})});break;case"pluginEventToParent":this.meeting.plugins.find((function(t){return t.id===e.payload.id})).emit(e.payload.eventName,e.payload.data);break;case"toggleViewMode":this.meeting.plugins.find((function(t){return t.id===e.payload.id})).emit("toggleViewMode",e.payload.data)}return[2]}))}))},e.prototype.addIframeView=function(e,t){return K(this,void 0,void 0,(function(){var n,r=this;return Z(this,(function(i){return this.iframes[e.plugin][e.view]&&this.removeIframeView(e),n=function(e){t&&e.source===t.contentWindow&&r.handleIframeMessage(e.data)},window.addEventListener("message",n),this.iframes[e.plugin][e.view]={listener:n,iframe:t},[2]}))}))},e.prototype.removeIframeView=function(e){return K(this,void 0,void 0,(function(){var t;return Z(this,(function(n){return(t=this.iframes[e.plugin][e.view])&&(window.removeEventListener("message",t.listener),delete this.iframes[e.plugin][e.view]),[2]}))}))},e.prototype.addRoomPlugin=function(e){return K(this,void 0,void 0,(function(){return Z(this,(function(t){switch(t.label){case 0:return this.plugins[e.id]?[2]:[4,this.socketObj.sendMessage({type:"addPlugin",payload:e})];case 1:return t.sent(),this.meeting.plugins.find((function(t){return t.id===e.id})).emit("opened"),[2]}}))}))},e.prototype.removeRoomPlugin=function(e){return K(this,void 0,void 0,(function(){return Z(this,(function(t){return[2,this.socketObj.sendMessage({type:"removePlugin",payload:e})]}))}))},e}(),Wo=function(e){function t(t,n){var r=e.call(this)||this;return r.isActivated=!!n.plugins[t.id],r.data=[],r.manager=n,r.plugin=t,r}return U(t,e),Object.defineProperty(t.prototype,"id",{get:function(){return this.plugin.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.plugin.name},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ACLType",{get:function(){return this.plugin.ACLType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"staggered",{get:function(){return this.plugin.staggered},enumerable:!1,configurable:!0}),t.prototype.activate=function(){this.manager.addRoomPlugin(this.plugin)},t.prototype.deactivate=function(){this.manager.removeRoomPlugin(this.plugin)},t.prototype.sendData=function(e){this.manager.sendIframeEvent({type:"websocket/plugin-internal-data",payload:{pluginId:this.id,data:e}})},t}(M.default),qo=e.createContext(null),Ho=function(n){var r=n.children,i=n.roomName,o=n.peerId,a=e.useContext(fo),l=t.useSelector((function(e){return e.participant.authToken})),c=t.useDispatch(),s=e.useState(null),u=s[0],d=s[1],f=e.useState([]),p=f[0],m=f[1],h=e.useContext(Vr),g=h.sessionConfig,v=h.meeting,y=t.useSelector((function(e){return e.room.socketState})),b=function(e,t){0===v.plugins.length&&e.forEach((function(e){var n=e;n.ACLType=function(e){var t;return(null===(t=g.permissions.plugins.config[e])||void 0===t?void 0:t.defaultAccess)||"blacklist"}(n.id);var r=new Wo(n,t);v.plugins.push(r)})),m(e),c(vn({initialized:!0}))},E={pluginManager:u,plugins:p},S=e.useCallback((function(e){return K(void 0,void 0,void 0,(function(){var t,n,r,i;return Z(this,(function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),[4,fetch(un.apiBase+"/v2/plugins/user",{headers:{Authorization:"Bearer "+l,"dyte-tracing-id":o}})];case 1:return[4,a.sent().json()];case 2:return(t=(t=a.sent().data.plugins).filter((function(e){return!e.name.includes("v2")}))).push(fn),n=t,(null==(r=g.theme.plugins)?void 0:r.length)>0?b(n.filter((function(e){return r.includes(e.id)})),e):b(n,e),[3,4];case 3:return i=a.sent(),jr.error("plugin_request_failed",i),b([],e),[3,4];case 4:return[2]}}))}))}),[y]);return e.useEffect((function(){K(void 0,void 0,void 0,(function(){var e;return Z(this,(function(t){switch(t.label){case 0:return y!==ee.CONNECTED?[3,2]:(e=new Vo(a,i,c,o,l,v),d(e),[4,e.listenSocketEvents()]);case 1:t.sent(),S(e),t.label=2;case 2:return[2]}}))}))}),[y]),A.default.createElement(qo.Provider,{value:E},r)};function Uo(n){var r;t.useDispatch();var o=t.useSelector((function(e){return e.peers.joinedPeers}));t.useSelector((function(e){return e.participant.id}));var a=n.plugin,c=n.onClose,s=e.useState(""),u=s[0],d=s[1],f=e.useContext(Vr).sessionConfig,p=e.useContext(Io).mediaRoom,m=x.useTranslation().t,h="whitelist"===((null===(r=f.permissions.plugins.config[a.id])||void 0===r?void 0:r.defaultAccess)||"blacklist"),g=function(e){return e!==(null==a?void 0:a.enabledBy)&&(h?!a.ACLAccessGrantedUsers.includes(e):a.ACLAccessRemovedUsers.includes(e))},v=function(e){return e===(null==a?void 0:a.enabledBy)||(h?a.ACLAccessGrantedUsers.includes(e):!a.ACLAccessRemovedUsers.includes(e))};return A.default.createElement(no,{isOpen:!0,onClose:c},A.default.createElement(i.ModalBody,null,A.default.createElement(i.Stack,{spacing:6,height:"80"},A.default.createElement(i.Center,{mt:"4"},A.default.createElement(i.Text,{fontSize:"lg",fontWeight:"bold"},"Control"," ",a.name," ","Access")),A.default.createElement(i.InputGroup,{marginY:4},A.default.createElement(i.InputLeftElement,null,A.default.createElement(i.Icon,{boxSize:6,as:l.Search,fill:"text.400","aria-label":"Search"})),A.default.createElement(i.Input,{color:"text.100",backgroundColor:"secondary.800",border:"none",borderRadius:"0.25em",focusBorderColor:"none",errorBorderColor:"none",size:"md",fontSize:"1em",placeholder:"Search",value:u,onChange:function(e){return d(e.target.value)}})),A.default.createElement(i.Box,{display:"flex",flexDirection:"column",overflowY:"scroll",className:"dyte-modal-content-container"},o.filter((function(e){return""===u||e.displayName.toLowerCase().includes(u.toLowerCase())})).map((function(e){return A.default.createElement(i.Flex,{direction:"row",alignItems:"center",pb:2},A.default.createElement(Ao,{size:"sm",name:e.displayName}),A.default.createElement(i.Flex,{marginLeft:3,flexGrow:1,alignItems:"center",paddingY:2,borderBottom:"1px solid",borderColor:"secondary.800"},A.default.createElement(i.Text,{color:"text.200",fontSize:"lg"},e.displayName.substring(0,10),".."),A.default.createElement(i.Flex,{marginLeft:"auto"},A.default.createElement(i.HStack,null,A.default.createElement(i.Button,{padding:"6px",bg:g(e.userId)?"primary.300":"secondary.800",onClick:function(){return t=e.userId,void(v(t)&&p.removePluginAccess(a.id,t));var t}},A.default.createElement(l.Visibility,{size:"14px"})," ",A.default.createElement(i.Text,{fontSize:"12px",ml:"4px"},m("View Only"))),A.default.createElement(i.Button,{padding:"6px",bg:v(e.userId)?"primary.300":"secondary.800",onClick:function(){return t=e.userId,void(g(t)&&p.grantPluginAccess(a.id,t));var t}},A.default.createElement(l.GppGood,{size:"14px"})," ",A.default.createElement(i.Text,{fontSize:"12px",ml:"4px"},m("Full Control")))))))}))))))}var Go=function(){return A.default.createElement(i.Flex,{alignItems:"center",justifyContent:"center",height:"100%",width:"100%"},A.default.createElement(i.Fade,{in:!0},A.default.createElement(i.Spinner,null)))},Jo=function(n){var r,o=n.frame,a=n.height,c=n.width,s=e.useContext(qo),u=e.useRef(null),d=t.useSelector((function(e){return e.participant.id})),f=t.useSelector((function(e){return e.plugin.plugins})).find((function(e){return e.id===o.plugin})),p=e.useContext(Vr).sessionConfig,m=e.useState(!1),h=m[0],g=m[1],v=e.useState(!0),y=v[0],b=v[1],E=p.permissions.plugins||{can_close:!1,can_start:!0,can_edit_acl:!1},S=d===(null==f?void 0:f.enabledBy)||(null==E?void 0:E.can_close),w=d===(null==f?void 0:f.enabledBy)||(null==E?void 0:E.can_edit_acl),x="whitelist"===((null===(r=p.permissions.plugins.config[f.id])||void 0===r?void 0:r.defaultAccess)||"blacklist"),C=function(){var e;return d===(null==f?void 0:f.enabledBy)||(x?null===(e=null==f?void 0:f.ACLAccessGrantedUsers)||void 0===e?void 0:e.includes(d):!f.ACLAccessRemovedUsers.includes(d))},_=function(){var e,t=null===(e=p.permissions.plugins.config[f.id])||void 0===e?void 0:e.handlesViewOnly,n=!C()&&!t;return t&&s.pluginManager.sendIframeEvent({type:"websocket/plugin-data",payload:{pluginId:f.id,type:"setViewOnly",value:!C()}}),n};e.useEffect((function(){var e;_(),null===(e=u.current)||void 0===e||e.focus()}),[null==f?void 0:f.ACLAccessGrantedUsers,u]),e.useEffect((function(){var e=s.pluginManager.meeting.plugins.find((function(e){return e.id===f.id}));b(_()),null==e||e.on("toggleViewMode",(function(e){b(e)}))}),[]);var k=e.useState(!0),I=k[0],T=k[1];return A.default.createElement(i.Box,{height:a,width:c,alignItems:"center"},A.default.createElement(i.Flex,{height:"100%",width:"100%",direction:"column"},A.default.createElement(i.HStack,{height:"35px",width:"100%",bgColor:"secondary.900",justify:"space-between",paddingX:"10px",borderTopLeftRadius:"6px",borderTopRightRadius:"6px"},!C()&&A.default.createElement(i.HStack,{"aria-label":"view-only",marginRight:"8px",size:"8px",mt:"2px",fontSize:"14px",padding:"2px",paddingLeft:"6px",paddingRight:"6px",bg:"secondary.600",borderRadius:"4px",border:"1px solid var(--chakra-colors-primary-300)"},A.default.createElement(i.Box,{fontSize:"12px",color:"primary.300",fontWeight:"bold"},"View Only"),A.default.createElement(l.Lock,{size:"14px",color:"var(--chakra-colors-primary-300)"})),w&&A.default.createElement(i.Button,{onClick:function(){return g(!0)},"aria-label":"edit-access",marginRight:"8px",size:"8px",mt:"2px",fontSize:"14px",padding:"2px",paddingLeft:"6px",paddingRight:"6px",bg:"secondary.1000"},A.default.createElement(i.Box,{marginRight:"4px"},"CONTROL"),A.default.createElement(l.Group,{size:"14px"})),S&&A.default.createElement(i.IconButton,{onClick:function(){s.pluginManager.removeRoomPlugin({id:o.plugin})},"aria-label":"close",isRound:!0,mt:"2px",padding:"3px",size:"14px",icon:A.default.createElement(l.Close,{size:"14px"})})),A.default.createElement(i.Flex,{grow:1,height:"100%",bgColor:"white",borderBottomRadius:"8px",overflow:"hidden"},I&&A.default.createElement(Go,null),h&&A.default.createElement(Uo,{plugin:f,onClose:function(){return g(!1)}}),A.default.createElement(i.Box,{display:I?"none":"block",width:c,height:"100%",position:"relative",borderBottomRadius:"6px"},_()&&y&&A.default.createElement(i.Box,{tabIndex:0,ref:u,style:{zIndex:10,position:"absolute"},height:"100%",width:"100%"}),A.default.createElement("iframe",{className:"dyte-iframe",height:"100%",width:"100%",style:{maxWidth:"100%",borderBottomRightRadius:"6px",overflowY:"scroll",borderBottomLeftRadius:"6px"},title:o.view,src:o.url,onLoad:function(){return T(!1)},ref:function(e){s.pluginManager.addIframeView(o,e)},allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})))))},Yo=function(t){var n=t.activeVideoHeightDesktop;t.remainingWidthDesktop;var r=t.activePeer,o=e.useState(!0),a=o[0],c=o[1],s=e.useContext(ki).mediaTracks.setScreenShareTracks,u=e.useContext(Io).mediaRoom;return A.default.createElement(i.Box,{position:"relative",p:"2em",height:n,maxWidth:"100%",flexGrow:1,justifyContent:"center",alignItems:"center",backgroundColor:"secondary.900",display:"flex",className:"dyte-client-screen-preview",borderRadius:6},A.default.createElement(i.Flex,{w:"90%",justify:"center"},a&&A.default.createElement(i.Box,{height:!a&&0,w:a?"50%":0,opacity:!a&&0,overflow:"hidden"},A.default.createElement(i.Box,{maxW:"350px",overflow:"hidden"},A.default.createElement(i.Heading,{color:"text.200"},"Your screen is now being shared"),A.default.createElement(i.Text,{mt:10,color:"text.300",fontWeight:"normal"},"The screen preview has been minimized for you. You can expand to preview it."))),A.default.createElement(i.VStack,{spacing:6},A.default.createElement(No,{contain:!0,height:a?162:n-100,width:a?288:"auto",peer:r,hideBadge:!0}),A.default.createElement(i.HStack,{spacing:6},A.default.createElement(i.Button,{px:6,variant:"secondaryDefault",leftIcon:A.default.createElement(i.Icon,{as:a?l.OpenInFull:l.CloseFullscreen,fill:"text.100",boxSize:"5"}),iconSpacing:"0.5em",onClick:function(){return c(!a)}},a?"Expand Preview":"Minimize Preview"),A.default.createElement(i.Button,{px:6,variant:"danger",leftIcon:A.default.createElement(i.Icon,{as:l.StopScreenShare,fill:"text.100",boxSize:"5"}),iconSpacing:"0.5em",onClick:function(){return K(void 0,void 0,void 0,(function(){return Z(this,(function(e){return u.disableScreenShare(),s(void 0),[2]}))}))}},"Stop Sharing")))))},Ko=function(n){var r=e.useRef(null),o=e.useState(!1),a=o[0],c=o[1],s=n.children,u=n.height,d=n.width,f=n.onFullScreen,p=n.onFullScreenEnd,m=n.isMobile,h=t.useSelector((function(e){return e.participant.sharingScreen}));n.maxVideoHeight;var g=Y(n,["maxVideoHeight"]),v=function(e){document.webkitCurrentFullScreenElement||(p&&p(),c(!1))},y=function(e){document.fullscreenElement||(p&&p(),c(!1))};e.useEffect((function(){return Zn()?(window.addEventListener("webkitfullscreenchange",v),function(){return window.removeEventListener("webkitfullscreenchange",v)}):(window.addEventListener("fullscreenchange",y),function(){return window.removeEventListener("fullscreenchange",y)})}),[a]);var b=a?"100vh":u-12;m&&(b=a?"100vh":Math.min(.5625*d,u));var E=a?"100vw":d;return A.default.createElement(i.Box,{position:"relative",maxWidth:"100%",ref:r,background:"secondary.900",borderRadius:6,height:"fit-content"},!h&&A.default.createElement(i.Tooltip,{label:"Fullscreen","aria-label":"FullScreen",portalProps:{containerRef:{current:document.getElementById("dyte-base-elem")||document.getElementById("dyte-shadow").shadowRoot.getElementById("dyte-base-elem")}}},A.default.createElement(i.Icon,{zIndex:2,position:"absolute",top:"0",right:"0",cursor:"pointer",onClick:function(){if(a)p&&p(),document.exitFullscreen?document.exitFullscreen():document.mozExitFullScreen?document.mozExitFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen(),c(!1);else{if(f&&f(),!r.current)return;r.current.requestFullscreen?r.current.requestFullscreen():r.current.mozRequestFullScreen?r.current.mozRequestFullScreen():r.current.webkitRequestFullscreen?r.current.webkitRequestFullscreen():r.current.msRequestFullscreen&&r.current.msRequestFullscreen(),c(!0)}},as:a?l.CloseFullscreen:l.Fullscreen,boxSize:"8",margin:"3",borderRadius:"4",padding:"1",background:"secondary.700",fill:a?"var(--chakra-colors-danger-500)":"white"})),A.default.createElement(No,J({},a?g:n,{width:E,height:b,isSideView:!0}),s))},Zo=function(n){var r,o,a,l=n.widthOffset,c=n.sharingScreen,s=n.peers,u=n.controlBarHeight,d=e.useContext(Vr).sessionConfig,f=e.useContext(Eo),p=f.screenSharePeers,m=f.selfPeer,h=Et(),g=(null===(r=d.theme)||void 0===r?void 0:r.dimensions)||h,v=g.width,y=g.height,b=t.useSelector((function(e){return e.room.activeSpeakerPeerId})),E=t.useSelector((function(e){return e.room.maxPreferredStreams})),S=t.useSelector((function(e){return e.room.selectedScreenSharingPeer})),w=e.useRef(!1),x=v<1024||w.current,C=v>y,_=Wn()&&C;Wn();var k=e.useState(E),I=k[0],T=k[1],P=0;d.theme.header.is_enabled&&(P-=40),d.theme.control_bar.is_enabled&&(P-=u),_?v+=P:(y+=P,v-=l);var O=y-8,D=t.useSelector((function(e){return e.plugin}));e.useEffect((function(){T(y>400?E:y>200?E/2:E/2-1)}),[y]);var N,R,M,L=[],z=[];s.forEach((function(e){e.id===b&&(R=e),e.isScreensharing?L.unshift(e):e.isPinned?(N=e,L.unshift(e)):L.push(e)})),p.length>0&&(""!==S&&p.find((function(e){return e.id===S}))||(S=null===(o=p[0])||void 0===o?void 0:o.id),M=p.find((function(e){return e.id===S})),z=p.filter((function(e){return e.id!==S})));var B=M||N||R,F=!!B;B||(B=L[L.length-1]);var j,V=D.main.length>0?1:0,W=M?1:0,q=I-1+W+V,H=Math.min(250,(y-4*(q-1))/q*1.65),U=v-H-16,G=function(e,t,n){var r=1,i=!1;n<3&&(n=3),n>6||n>4&&e>480?(r=Math.ceil(n/4),n=4):n>3&&e<=480&&(r=2,n=3);var o=Math.floor(e/n);return t-r*o<.65*t&&(o=.35*t/r,r=Math.ceil(o*n/e)),o<140&&(i=!0),{mainViewHeightOffset:r*o,videoSizeMobile:o-12,hideBadge:i}}(v,y,s.length+z.length+W+V),Y=G.mainViewHeightOffset,K=G.videoSizeMobile,Z=G.hideBadge;if(D.main.length>0){var Q=D.main[0];j=A.default.createElement(Jo,{height:y-16-(x?Y:0),width:"100%",frame:Q})}else j=_?A.default.createElement(Ko,{height:y-16,width:v-32,isMobile:!0,contain:B.screenshare||"contain"===d.theme.grid.single.videoFit,peer:B,totalPeers:L.length,size:"sm"}):x?A.default.createElement(Ko,{contain:!0,width:v-20,isMobile:!0,height:y-Y-8,totalPeers:L.length,peer:B,size:"sm",onFullScreen:function(){w.current=!0},onFullScreenEnd:function(){w.current=!1}}):A.default.createElement(Ko,{totalPeers:L.length,contain:B.screenshare||"contain"===(null===(a=d.theme)||void 0===a?void 0:a.grid.single.videoFit),height:O,width:U-64,peer:B});var X="rotate("+(_?90:0)+"deg)",$=Math.floor(y/2)+"px "+Math.floor(y/2)+"px",ee={height:y,width:v,flexDirection:"column",backgroundColor:"secondary.1000",transform:X,transformOrigin:$,alignItems:"center",px:4},te={height:O,p:5,flex:1};return A.default.createElement(i.Flex,J({},x?ee:{backgroundColor:"secondary.1000",className:"dyte-client-noSelect",flexDir:"row",flexWrap:"wrap",pt:2.5,px:5},{justifyContent:"center"}),A.default.createElement(i.Flex,J({alignItems:"center"},x?{borderRadius:6,flexGrow:1,minWidth:"100%",justifyContent:"center"}:te),!x&&c&&(null==M?void 0:M.id)===m.id?A.default.createElement(Yo,{activeVideoHeightDesktop:O,remainingWidthDesktop:U,activePeer:B}):j),x&&!_&&A.default.createElement(i.Flex,{mt:0,className:"dyte-client-noScrollbar",justifyContent:"center",flexWrap:"wrap",minHeight:"fit-content",width:"100%"},(y>500||Wn())&&L.map((function(e){return F&&e.id===B.id?null:A.default.createElement(i.Box,{key:e.id+"_video",py:1},A.default.createElement(No,{width:K,height:K,peer:e,isMobile:x,totalPeers:L.length,size:"sm",hideBadge:Z}))})),z.map((function(e){return A.default.createElement(i.Box,{key:e.id+"_video_screen",py:1},A.default.createElement(No,{width:K,height:K,peer:e,isMobile:x,totalPeers:L.length,size:"sm",hideBadge:Z,isInactiveScreenShare:!0}))}))),x&&(_?L.map((function(e){var t=J({},e);return t.videoVisible=!1,t.videoTrack=null,A.default.createElement(i.Box,{key:e.id+"_video",position:"absolute",zIndex:-5,top:0,visibility:"hidden"},A.default.createElement(No,{width:1,height:1,peer:t,totalPeers:L.length}))})):null),!x&&A.default.createElement(i.Box,{justifyContent:"flex-end",height:O},A.default.createElement(i.Box,{display:"flex",flexDirection:"column",overflowY:"scroll",overflowX:"hidden",width:H,alignItems:"flex-start",justifyContent:"flex-start",height:O},L.map((function(e){return B.screenshare||0!==D.main.length||e.id!==B.id?A.default.createElement(i.Box,{key:e.id+"_video",mb:"9px"},A.default.createElement(No,{width:y<400?H-12:H,peer:e,size:"sm",totalPeers:L.length,isSideView:!0})):null})),z.map((function(e){return A.default.createElement(i.Box,{key:e.id+"_video_screen"},A.default.createElement(No,{width:H,peer:e,size:"sm",totalPeers:L.length,isSideView:!0,isInactiveScreenShare:!0}))})))))},Qo=function(e,t){var n=!e.permissions.can_present;return A.default.createElement(i.VStack,null,n&&A.default.createElement(i.Text,{fontSize:"lg",py:"1em"},"Host will start presenting soon.",A.default.createElement("br",null),A.default.createElement("br",null),A.default.createElement(i.Spinner,{color:"text.100",size:"lg"})),!n&&A.default.createElement(i.Text,{fontSize:"lg",py:"1em"},"You are the host"),A.default.createElement(i.Spacer,null),n&&("a446c4de-979e-4d4f-97f7-2b695e75ef90"===t.connectionConfig.clientId?A.default.createElement(i.Text,{fontSize:"md",fontWeight:"300"},"Please wait for the host to go live"):A.default.createElement(i.Text,{fontSize:"md",fontWeight:"300"},"Your video & audio is turned off as a viewer. You can request to",A.default.createElement("br",null),"ask a question or present using the",A.default.createElement("b",null," REQUEST "),"button below.")),!n&&("a446c4de-979e-4d4f-97f7-2b695e75ef90"===t.connectionConfig.clientId?A.default.createElement(i.Text,{fontSize:"md",fontWeight:"300"},"Please click on the Go Live button below to start the session."):A.default.createElement(i.Text,{fontSize:"md",fontWeight:"300"},"To begin the webinar please start presenting or accept a request",A.default.createElement("br",null),"to present from the participants tab.")))},Xo=function(e,t){for(var n=[],r=0;r<t.length;r+=1){var i=t[r];e.has(i)&&n.push(e.get(i))}return n},$o=function(n){var r,i,o=n.widthOffset,a=n.singleSpeakerView,l=t.useSelector((function(e){return e.room.roomViewType})),c=t.useSelector((function(e){return e.room.gridView})),s=t.useSelector((function(e){return e.plugin})),u=t.useSelector((function(e){return e.participant.hidden})),d=t.useSelector((function(e){return e.participant.webinarHiddenParticipant}))&&l===ut.webinar,f=t.useSelector((function(e){return e.participant.sharingScreen})),p=e.useRef([]),m=t.useSelector((function(e){return e.room.maxPreferredStreams})),h=t.useSelector((function(e){return e.room.socketState})),g=t.useSelector((function(e){return e.room.currentPage})),v=t.useSelector((function(e){return e.peers.currentPagePeerIds})),y=t.useSelector((function(e){return e.peers.activeSpeakerPagePeerIds})),b=e.useContext(Vr),E=b.meeting,S=b.sessionConfig,w=e.useContext(Eo),x=Et(),C=(null===(r=S.theme)||void 0===r?void 0:r.dimensions)||x,_=C.width;C.height;var k=w.processedPeers,I=w.screenshareVideoConsumers,T=w.joinedProcessedPeers,P=w.selfPeer,O=v;e.useEffect((function(){h===ee.NOT_STARTED&&(null==E||E.emit(E.Events.disconnect))}),[h]);var D=0,N=[],R=new Map;k.forEach((function(e){R.set(e.id,e)}));var M=_<480?42:72;if(O.length>0&&g>0?(R.set(P.id,P),N=Xo(R,O),p.current=N.map((function(e){return e.id}))):(N=Xo(R,y),p.current=N.map((function(e){return e.id})),N=N.concat(u||S.permissions.is_recorder||d||!d&&l===ut.webinar&&P.requestToJoinType===bt.ask?[]:[P])),!P)return A.default.createElement(Qn,null);if(h===ee.NOT_STARTED)return A.default.createElement(Qn,{inStage:!0,text:"You got disconnected! Retrying connection..."});if((null===(i=P.flags)||void 0===i?void 0:i.recorder)&&N.length<1&&T.length>=1)return A.default.createElement(Qn,{loading:!1,text:"Waiting for host to join the stage",inStage:!0});if(N.length<1)return A.default.createElement(Qn,{loading:!(l===ut.webinar),text:l===ut.webinar?Qo(S,E):"Waiting for users to join the meeting",inStage:!0});if(I.length>0||a||f||"highlighted"===c||s.main.length>0)return A.default.createElement(Zo,{peers:N,sharingScreen:f,widthOffset:o,controlBarHeight:M});if(l===ut.webinar){var L=u||S.permissions.is_recorder||d||!d&&l===ut.webinar&&P.requestToJoinType===bt.ask?k.length:k.length+1;D=L>=m?m:L}else D=N.filter((function(e){return!e.hiddenParticipant})).length;return A.default.createElement(jo,{peers:N,widthOffset:o,gridSize:D,showAlone:l!==ut.webinar,controlBarHeight:M})};$o.defaultProps={singleSpeakerView:!1};var ea=A.default.memo($o),ta=function(e){return Math.trunc(e).toString().padStart(2,"0")},na=function(){var n=t.useSelector((function(e){return e.room.startedAt})),r=A.default.useRef(),o=A.default.useState(0),a=o[0],l=o[1],c=A.default.useRef();return e.useEffect((function(){if(n){var e=function(){l((Date.now()-new Date(n).getTime())/1e3),c.current=setTimeout((function(){r.current&&(r.current=requestAnimationFrame(e))}),500)};r.current=requestAnimationFrame(e)}return function(){clearTimeout(c.current),cancelAnimationFrame(r.current)}}),[n]),A.default.createElement(i.Flex,{color:"text.200",display:"flex",fontWeight:"medium"},A.default.createElement(i.Center,null,a>=3600&&A.default.createElement(A.default.Fragment,null,ta(a/3600),":"),ta(a%3600/60),":",ta(a%60)))};var ra,ia,oa,aa,la=A.default.memo((function(t){var n=e.useContext(v.ThemeContext).logo;return A.default.createElement(i.Box,null,A.default.createElement(i.Image,J({src:n},t)))}));function ca(){var n=e.useState(""),r=n[0],o=n[1],a=e.useContext(Eo).joinedProcessedPeers,c=t.useSelector((function(e){return e.room.chatMessages})),s=t.useSelector((function(e){return e.participant.id})),u=e.useRef([]),d=c.filter((function(e){return!0!==e.read&&e.type===oa.poll&&e.userId!==s})),f=function(e){var t=new Audio(e);t.volume=.2;var n=t.play();null==n||n.catch((function(e){return jr.warn("notif_play_failed",e)}))};return e.useEffect((function(){if(a.length>u.current.length&&u.current.length>0){var e=a.find((function(e){var t=e.id;return!u.current.includes(t)}));e&&e.displayName&&a.length<10&&(f("https://dyte-uploads.s3.ap-south-1.amazonaws.com/notification_join.mp3"),o((t=e.displayName,n=10,(t.length>n?t.substring(0,n)+"...":t)+" joined the meeting")))}var t,n;u.current=a.map((function(e){return e.id}))}),[a.length]),e.useEffect((function(){var e=setTimeout((function(){""!==r&&o("")}),4e3);return function(){return clearTimeout(e)}}),[r]),e.useEffect((function(){if(d.length>0){var e=d[d.length-1];o("New poll by "+e.displayName),f("https://dyte-uploads.s3.ap-south-1.amazonaws.com/notification_message.mp3")}}),[d.length]),r?A.default.createElement(C.motion.div,{style:{overflow:"hidden"},variants:{collapsed:function(){return{width:0}},expanded:function(){return{width:"18em"}}},initial:""!==r?"collapsed":"expanded",animate:""!==r?"expanded":"collapsed",transition:{duration:.6}},A.default.createElement(i.Flex,{paddingLeft:2,paddingRight:2,height:"100%",borderRadius:4,alignItems:"center",justifyContent:"flex-end",zIndex:2,bg:"transparent"},A.default.createElement(i.HStack,null,A.default.createElement(i.Icon,{as:l.Notifications,boxSize:5,fill:"primary.300"}),A.default.createElement(i.Text,{fontWeight:"400",color:"primary.300",whiteSpace:"nowrap"},r)))):A.default.createElement(A.default.Fragment,null)}!function(e){e[e.NO_VIDEO=0]="NO_VIDEO",e[e.NO_MIC=1]="NO_MIC"}(ra||(ra={})),function(e){e[e.NOT_ALLOWED=0]="NOT_ALLOWED",e[e.REQUEST_FIRST=1]="REQUEST_FIRST",e[e.ALLOWED=2]="ALLOWED"}(ia||(ia={})),function(e){e[e.text=0]="text",e[e.image=1]="image",e[e.file=2]="file",e[e.poll=3]="poll"}(oa||(oa={})),function(e){e.webinar="webinar",e.groupCall="group_call",e.audioRoom="audio_room"}(aa||(aa={}));var sa=function(n){n.isMobile;var r=t.useDispatch(),o=e.useContext(Io).mediaRoom,a=t.useSelector((function(e){return e.peers.joinedPeers})),c=t.useSelector((function(e){return e.room.maxPreferredStreams})),s=t.useSelector((function(e){return e.room.currentPage})),u=t.useSelector((function(e){return e.peers.currentPagePeerIds}));t.useSelector((function(e){return e.peers.activeSpeakerPagePeerIds}));var d=a.length>=c||0!==s,f=t.useSelector((function(e){return e.room.roomViewType})),p=e.useState("count"),m=p[0],h=p[1],g=e.useRef(s),v=e.useRef(a.length),y=e.useContext(Eo).joinedProcessedPeers;y=y.filter((function(e,t,n){return n.findIndex((function(t){return t.id===e.id}))===t}));var b=a.length+1,E=Math.ceil(b/c),S=t.useSelector((function(e){return e.participant.preset})),w=function(e){r(et(e)),o.getPage(e)};e.useEffect((function(){S&&w(0)}),[S]),e.useEffect((function(){if(0!==s){if(v.current<a.length){var e=s*c>=a.length+1,t=u.length===c;e&&!t&&w(s)}if(v.current>a.length){var n=c*(s-1);0===n?w(0):a.length<n&&w(2===s?0:s-1)}}v.current=a.length}),[a]),e.useEffect((function(){1===s&&0===g.current&&h("autoOff"),0===s&&h("autoOn"),setTimeout((function(){h("count")}),1e3),g.current=s}),[s]);var x=function(e){void 0===e&&(e=!0),e?0===s&&h("autoOn"):h("count")};if(f===ut.webinar)return A.default.createElement(i.Center,{minW:"5em"},A.default.createElement(i.Text,{fontWeight:"600",fontSize:"md",mr:1},y.length+1),A.default.createElement(i.Icon,{as:l.Group,fill:"text.200",boxSize:"5",verticalAlign:"middle"}));var C;return A.default.createElement(A.default.Fragment,null,d&&A.default.createElement(i.IconButton,{bg:"secondary.700",borderRadius:"4px",variant:"controls",disabled:0===s,id:"dyte-btn-pagination-prev",icon:A.default.createElement(i.Icon,{as:l.ChevronLeft}),onClick:function(){return w(s-1)},"aria-label":"pagination-left",py:"5px !important"}),A.default.createElement(i.Center,{minW:"6.25em",h:"100%",onMouseEnter:function(){return x(!0)},onMouseLeave:function(){return x(!1)}},"autoOff"===(C=m)?A.default.createElement(i.Text,{fontSize:"sm"},"Auto Layout Off"):"autoOn"===C?A.default.createElement(i.Text,{fontSize:"sm"},"Auto Layout On"):A.default.createElement(A.default.Fragment,null,0===s?A.default.createElement(i.Icon,{as:l.AutoFixHigh,fill:"primary.500",boxSize:"5",verticalAlign:"middle"}):A.default.createElement(i.Text,{fontWeight:"600",mr:1},(s-1)*c+1,"-",Math.min(s*c,b),"/"),A.default.createElement(i.Text,{fontWeight:"600",fontSize:"md",mr:1},b,""),A.default.createElement(i.Icon,{as:l.Group,fill:"text.200",boxSize:"5",verticalAlign:"middle"}))),d&&A.default.createElement(i.IconButton,{bg:"secondary.700",id:"dyte-btn-pagination-next",borderRadius:"4px",_hover:{bg:"secondary.1000"},variant:"controls",h:"1em",w:"1em",disabled:s===E,onClick:function(){return w(s+1)},icon:A.default.createElement(i.Icon,{as:l.ChevronRight}),"aria-label":"pagination-right",py:"5px !important"}))},ua=O.forwardRef((function(e,t){return O.createElement(c.StyledIconBase,J({iconAttrs:{fill:"currentColor"},iconVerticalAlign:"middle",iconViewBox:"0 0 20 20"},e,{ref:t}),O.createElement("path",{d:"M5.453 4.167a.726.726 0 00-1.027-.01A8.225 8.225 0 002 10a8.228 8.228 0 002.604 6.015.725.725 0 001.01-.025c.316-.316.277-.819-.027-1.11A6.73 6.73 0 013.5 10c0-1.846.741-3.52 1.943-4.738.29-.295.32-.785.01-1.095z",fill:"#FF414D"}),O.createElement("path",{d:"M7.214 5.93a.714.714 0 00-1.008-.017A5.733 5.733 0 004.5 10a5.73 5.73 0 001.893 4.264.713.713 0 00.983-.037c.328-.328.267-.844-.041-1.134A4.237 4.237 0 016 10c0-1.15.457-2.194 1.2-2.96.286-.294.333-.793.014-1.11zM12.788 5.93a.714.714 0 011.008-.017A5.734 5.734 0 0115.502 10a5.73 5.73 0 01-1.893 4.264.713.713 0 01-.983-.037c-.328-.328-.267-.844.04-1.134A4.237 4.237 0 0014.003 10c0-1.15-.457-2.194-1.2-2.96-.286-.294-.333-.793-.014-1.11z",fill:"#FF414D"}),O.createElement("path",{d:"M14.549 4.167a.726.726 0 011.027-.01A8.225 8.225 0 0118 10a8.226 8.226 0 01-2.604 6.015.725.725 0 01-1.01-.025c-.316-.316-.277-.819.028-1.11A6.73 6.73 0 0016.503 10c0-1.846-.741-3.52-1.943-4.738-.29-.295-.32-.785-.01-1.095zM10 8.5a1.5 1.5 0 100 3 1.5 1.5 0 000-3z",fill:"#FF414D"}))}));ua.displayName="OnStageIcon";var da=A.default.memo((function(n){var r,o,a,c,s,u,d,f,p=n.isMobile,m=n.title;n.copyLink,n.linkCopied;var h=t.useSelector((function(e){return e.room.waitingState})),g=t.useSelector((function(e){return e.room.roomViewType})),v=t.useSelector((function(e){return e.peers.recordingPeer})),y=t.useSelector((function(e){return e.room.pipMode})),b=t.useDispatch(),E=t.useSelector((function(e){return e.participant.webinarHiddenParticipant}))&&g===ut.webinar,S=e.useRef(!1),w=e.useContext(Vr),x=w.meeting,C=w.sessionConfig,_=t.useSelector((function(e){return e.plugin.titlebar})),k=e.useContext(qo);return e.useEffect((function(){v?S.current=!0:S.current&&(S.current=!1)}),[v]),A.default.createElement(i.Flex,{height:"40px",bg:"secondary.1000",className:"dyte-client-noSelect",px:4,py:1},A.default.createElement(i.Stack,{isInline:!0,spacing:5,alignItems:"center"},(null===(r=C.theme.header.elements)||void 0===r?void 0:r.logo)&&A.default.createElement(la,{h:"7"}),!p&&(null===(o=C.theme.header.elements)||void 0===o?void 0:o.title)&&(null===(a=C.theme.header.elements)||void 0===a?void 0:a.logo)&&A.default.createElement(i.Divider,{orientation:"vertical",borderColor:"text.400",bgColor:"text.400",height:"5",opacity:"0.64"}),!p&&(null===(c=C.theme.header.elements)||void 0===c?void 0:c.title)&&A.default.createElement(i.Box,{overflow:"hidden",display:"-webkit-box",className:"dyte-meeting-title"},A.default.createElement(i.Text,{color:"text.200"},m)),v&&A.default.createElement(i.Center,{className:"dyte-client-blink"},A.default.createElement(i.Icon,{as:l.FiberManualRecord,color:"danger.500",mr:1}),A.default.createElement(i.Text,{color:"danger.500",fontSize:"sm",lineHeight:"100%"},"REC")),g===ut.webinar&&!E&&A.default.createElement(i.Center,{className:"dyte-client-blink"},A.default.createElement(i.Icon,{as:ua,h:"20px",w:"20px",color:"danger.500",mr:1}),!p&&A.default.createElement(i.Text,{color:"danger.500",fontSize:p?"8px":"md"},"a446c4de-979e-4d4f-97f7-2b695e75ef90"===x.connectionConfig.clientId?"LIVE":"PRESENTING"))),A.default.createElement(i.Spacer,null),_[0]&&A.default.createElement("iframe",{src:_[0].url,title:_[0].view,className:"dyte-iframe",id:"dyte-plugin-titlebar",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",ref:function(e){k.pluginManager.addIframeView(_[0],e)}}),A.default.createElement(i.Spacer,null),A.default.createElement(i.Stack,{isInline:!0},!p&&A.default.createElement(ca,null),A.default.createElement(i.Stack,{isInline:!0,spacing:p?2:5,p:1,alignItems:"center"},(null===(s=C.theme.header.elements)||void 0===s?void 0:s.participant_count)&&A.default.createElement(sa,{isMobile:p}),Yn()&&(null===(u=C.theme.controls)||void 0===u?void 0:u.pip_toggle)&&!p&&A.default.createElement(i.Button,{px:"2",py:"1",leftIcon:y?A.default.createElement(l.DisabledByDefault,{size:"1.5em"}):A.default.createElement(l.PictureInPicture,{size:"1.5em"}),onClick:function(){return b(Ce(!y))},fontSize:"md",fontWeight:"medium",background:y?"danger.300":"secondary.800",_hover:{bg:y?"danger.500":"secondary.900"}},y?"Disable PiP":"Enable PiP"),(null===(d=C.theme.header.elements)||void 0===d?void 0:d.participant_count)&&!p&&A.default.createElement(i.Divider,{marginLeft:1,orientation:"vertical",borderColor:"text.400",bgColor:"text.400",height:"5",opacity:"0.64"}),A.default.createElement(i.Center,{className:"dyte-clock"},(null===(f=C.theme.header.elements)||void 0===f?void 0:f.timer)&&h!==te.WAITING&&A.default.createElement(na,null)))))})),fa=function(n){var r=n.isOpen,o=n.onClose,a=A.default.useRef(),l=t.useSelector((function(e){return e.room.kicked})),c=e.useContext(Io).mediaRoom,s=e.useContext(Vr),u=s.meeting,d=s.sessionConfig,f=x.useTranslation().t,p=function(){Xr.callEnded(),u?(u.emit(u.Events.disconnect),u.emit(u.Events.meetingEnded,{kicked:l})):setTimeout((function(){c.stopAllProducers()}))};e.useEffect((function(){u&&(u.leaveRoom=p)}),[u]),e.useEffect((function(){l&&p()}),[l]);return A.default.createElement(i.AlertDialog,{isCentered:!0,isOpen:r,leastDestructiveRef:a,onClose:o,portalProps:{containerRef:{current:document.getElementById("dyte-base-elem")||document.getElementById("dyte-shadow").shadowRoot.getElementById("dyte-base-elem")}}},A.default.createElement(i.AlertDialogOverlay,{bg:"rgba(50, 50, 50, 0.8)"},A.default.createElement(i.AlertDialogContent,{width:"auto",bg:"secondary.1000",color:"text.100"},A.default.createElement(i.AlertDialogHeader,{fontSize:"lg",fontWeight:"bold"},A.default.createElement(i.Heading,{as:"h3",size:"md"},f("Leave"))),A.default.createElement(i.AlertDialogBody,null,f("confirm_leave")),A.default.createElement(i.AlertDialogFooter,null,A.default.createElement(i.Stack,{spacing:3,width:"100%"},A.default.createElement(i.Flex,null,A.default.createElement(i.Button,{size:"sm",flex:"1",variant:"secondaryDefault",ref:a,onClick:o},f("Cancel")),A.default.createElement(i.Button,{size:"sm",flex:"1",variant:"danger",onClick:function(){return p()},ml:3},f("Leave"))),d.permissions.kick_participant&&A.default.createElement(i.Button,{size:"sm",width:"100%",variant:"danger",onClick:function(){return K(void 0,void 0,void 0,(function(){return Z(this,(function(e){switch(e.label){case 0:return[4,c.kickAll()];case 1:return e.sent(),[2]}}))}))}},f("End Meeting for All")))))))},pa=function(t){var n,r=t.variant,o=t.label,a=t.icon,c=t.disabled,s=t.onClick,u=t.onMouseOver,d=t.onMouseOut;t.onMouseEnter,t.onMouseLeave;var f,p=t.isActive,m=t.menu,h=t.badge,g=t.dataCy,v=t.ariaLabel,y=t.fullMenu,b=t.fullMenuOptions,E=t.disableHoverEffect,S=t.permissionWarning,w=e.useRef(null),x=Et(),C=(null===(n=e.useContext(Vr).sessionConfig.theme)||void 0===n?void 0:n.dimensions)||x,_=C.height,k=C.width,I=k>_,T=Wn()&&I,P=e.useState(!1),O=P[0],D=P[1],N="rotate("+(T?90:0)+"deg)",R=k<480;return A.default.createElement(i.Flex,{position:"relative",onMouseOver:u,onMouseOut:d,className:"primaryDefault"===r?"dyte-control-bar-btn-wrapper-small":"dyte-control-bar-btn-wrapper",mx:"2px"},!y&&m.length>0&&A.default.createElement(i.Menu,{placement:"top"},A.default.createElement(i.MenuButton,{as:i.IconButton,"aria-label":"menu-"+o,icon:A.default.createElement(i.Icon,{as:l.MoreVert,fill:"text.400"}),variant:"none",position:"absolute",top:"0",right:"0",onClick:function(){D((function(e){return!e}))},zIndex:"1",size:"md",minWidth:"2",height:"6"}),O&&(f=m,A.default.createElement("div",{style:{transform:N,width:0}},A.default.createElement(i.MenuList,{border:"2px solid",borderColor:"secondary.700",p:"0.4em"},f.map((function(e,t){var n=e.title,r=e.defaultValue,o=e.onChange,a=e.options;return A.default.createElement("div",{key:n+r},0!==t&&A.default.createElement(i.MenuDivider,{my:"0.5em"}),A.default.createElement(i.MenuOptionGroup,{defaultValue:r,title:n,ml:"2",onChange:o,key:n+r},a.map((function(e){var t=e.key,n=e.value,r=e.children;return A.default.createElement(i.MenuItemOption,{iconSpacing:"1em",fontSize:"sm",value:n,key:t,borderRadius:"md"},r)}))))})))))),!y&&A.default.createElement(i.Button,{variant:r||"controls",onClick:function(){s(),w.current&&w.current.blur()},isDisabled:c,px:"2",pb:"0.3em",pt:{base:"0.3em",sm:"2"},"aria-label":v,"data-cy":g,minWidth:R?"52px":"74px",width:{base:"auto",sm:"auto"},height:R?"36px":"62px",borderRadius:8,border:"2px solid",borderColor:p?"primary.500":"transparent",ref:w,display:"flex",alignItems:"center",justifyContent:"center"},""!==h&&A.default.createElement(i.Center,{bgColor:"primaryDefault"===r?"text.100":"primary.500",textColor:"primaryDefault"===r?"primary.500":"text.100",className:"primaryDefault"!==r?"dyte-client-notificationBadge dyte-badge-border":"dyte-client-notificationBadge dyte-badge-border-primary"},A.default.createElement("span",null,h)),A.default.createElement(i.Stack,{transform:N},A.default.createElement(i.Center,{fontSize:{base:"1.5em",sm:"1.5em"},width:"1em",height:"1em",lineHeight:"24px",mx:"auto"},a),S&&A.default.createElement(i.Center,{position:"absolute",right:1,top:-4},A.default.createElement(i.Icon,{as:zn,fill:"warning.500"})),!R&&A.default.createElement(i.Text,{className:E?"":"dyte-control-bar-label",fontSize:"sm",marginTop:"0.25em !important",color:"text.200",display:{base:"none",sm:"block"}},o))),y&&A.default.createElement(i.Menu,{placement:"top"},A.default.createElement(i.MenuButton,{as:i.Button,variant:r||"controls",isDisabled:c,width:{base:"100%",sm:"20"},p:"2",height:{base:"40px",sm:"64px"},borderRadius:8,borderTop:p?"primary.500":"transparent",border:"2px solid","aria-label":"menu-"+o},A.default.createElement(i.Stack,{transform:N},A.default.createElement(i.Center,{fontSize:{base:"sm",sm:"xl"}},a),A.default.createElement(i.Text,{className:E?"":"dyte-control-bar-label",fontSize:"sm",marginTop:"0.25em !important",display:{base:"none",sm:"block"}},o))),A.default.createElement(i.MenuList,{"aria-label":"menu-list-dyte"},b.map((function(e,t){return A.default.createElement(i.MenuItem,{key:e.key,value:e.value,"aria-label":e.key,onClick:function(){return s(e)}},e.label)})))))};function ma(t){var n=t.toggle,r=t.onLoad,o=_.useForm(),a=o.register,c=o.handleSubmit,s=e.useState(2),u=s[0],d=s[1],f=e.useContext(Io).mediaRoom,p=x.useTranslation().t;e.useEffect((function(){r()}),[]);return A.default.createElement(i.Box,{className:"dyte-client-bubble dyte-client-other",alignSelf:"flex-end !important",maxWidth:"400px !important",py:"0.8em",px:"1em",width:"85%"},A.default.createElement("form",{onSubmit:c((function(e){return function(e){f.newPoll(e),n()}(e)}))},A.default.createElement(i.Stack,{spacing:4},A.default.createElement(i.Text,{textAlign:"center"},p("Poll Question")),A.default.createElement(i.Textarea,{name:"question",ref:a({required:!0}),rows:4,variant:"dark",className:"dyte-client-dark",placeholder:p("What is your poll for?"),"data-cy":"polls-description",autoFocus:!0}),Array.from({length:u},(function(e,t){return t})).map((function(e){return A.default.createElement(i.Input,{variant:"dark",key:e,name:"options["+e+"]",ref:a({required:!0}),className:"dyte-client-dark",placeholder:p("Enter an option"),"data-cy":"polls-option-"+e})})),A.default.createElement(i.Button,{onClick:function(){return d(u+1)},size:"sm",px:2,py:2,height:"auto",fontSize:"1em",variant:"alternateDark",width:"full",leftIcon:A.default.createElement(i.Icon,{as:l.Add,fill:"text.300",boxSize:5}),"data-cy":"polls-add-option",iconSpacing:"0.5em"},p("Add an option")),A.default.createElement(i.Checkbox,{name:"anonymous",variant:"poll",ref:a},p("Anonymous")),A.default.createElement(i.Checkbox,{name:"hideVotes",variant:"poll",ref:a,defaultIsChecked:!0},p("Hide results before voting")),A.default.createElement(i.Box,{height:1}),A.default.createElement(i.Button,{type:"submit","data-cy":"polls-create-poll"},p("Create Poll")))))}function ha(e){var t=e.option;e.index;var n=e.active,r=e.selfId,o=t.votes.find((function(e){return e.id===r})),a={containerRef:{current:document.getElementById("dyte-base-elem")||document.getElementById("dyte-shadow").shadowRoot.getElementById("dyte-base-elem")}};return A.default.createElement(i.Flex,{direction:"column",bgColor:n?"primary.500":"secondary.700",borderRadius:"0.5em",p:2,className:"dyte-client-noSelect"},A.default.createElement(i.Flex,{px:1,justifyContent:"space-between"},A.default.createElement(i.Checkbox,{variant:"poll",isChecked:!!o,overflowWrap:"anywhere",spacing:"0.5em"},A.default.createElement(i.Box,{color:"text.100"},t.text)),null!==t.count&&A.default.createElement(i.Text,null,"("+t.count+")")),A.default.createElement(i.Flex,{mt:2},t.votes.slice(0,3).map((function(e){return A.default.createElement(i.Tooltip,{placement:"auto",label:e.name,key:"poll-vote-"+e.id,portalProps:a},A.default.createElement(i.Avatar,{size:"sm",w:8,h:8,mx:"0.1em",bgColor:n?"secondary.700":"primary.500",src:un.apiBase+"/picture/"+e.id,color:"text.100",name:e.name,fontSize:"inherit",lineHeight:"base"}))})),t.votes.length>3&&A.default.createElement(i.Tooltip,{placement:"auto",label:t.votes.slice(3).map((function(e){return e.name})).join(", "),portalProps:a},A.default.createElement(i.Avatar,{size:"sm",w:8,h:8,mx:"0.1em",bgColor:n?"secondary.700":"primary.500",color:"text.100",name:"+"+(t.votes.length-3),getInitials:function(e){return e}}))))}function ga(e){var t=e.selfPeer,n=e.mediaRoom,r=e.poll;if(r){var o=Math.max.apply(Math,Q(Q([],r.options.map((function(e){return e.votes.length})),!1),[0],!1));return A.default.createElement(i.Box,null,A.default.createElement(i.Stack,{spacing:2},A.default.createElement(i.Text,{textAlign:"left"},r.question),r.options.map((function(e,a){return A.default.createElement(i.Box,{onClick:function(){return function(e){n.votePoll({index:e,pollId:r.id})}(a)},key:a,"data-cy":"polls-vote-option-"+a},A.default.createElement(ha,{active:e.votes.length===o&&e.votes.length>0,option:e,index:a,selfId:t.userId}))}))))}return A.default.createElement(i.Text,{fontStyle:"italic"},"Poll wasn't found or has been deleted")}function va(n){var r=n.active,o=i.useDisclosure(),a=o.isOpen,l=o.onToggle,c=e.useContext(Io).mediaRoom,s=e.useContext(Eo).selfPeer,u=e.useContext(Vr).sessionConfig,d=t.useSelector((function(e){return e.room.polls})),f=e.useRef(null),p=x.useTranslation().t,m=function(){Zn()?f.current.scrollIntoView():f.current.scrollIntoView({behavior:"smooth",inline:"start",block:"nearest"})};e.useEffect(m,[]);var h=t.useSelector((function(e){return e.room.chatMessages})).filter((function(e){return!0!==e.read&&e.type===oa.poll})),g=t.useDispatch();return e.useEffect((function(){h.length>0&&r&&g(Ke(oa.poll))}),[h]),A.default.createElement(i.Flex,{height:"100%",direction:"column",justifyContent:"space-between",overflowY:"auto"},A.default.createElement(i.Text,{textAlign:"center"},p("Polls")),A.default.createElement(i.Box,{marginTop:"2em",overflowY:"auto",className:"dyte-client-noScrollbar",flexGrow:1},Object.values(d).map((function(e,t){return A.default.createElement(i.Box,{my:2,key:t},A.default.createElement(i.Text,{ml:4},e.createdBy?"Poll by "+e.createdBy:""),A.default.createElement(i.Box,{mt:1,className:"dyte-polls dyte-client-bubble dyte-client-other dyte-client-type-3"},A.default.createElement(ga,{mediaRoom:c,poll:e,selfPeer:s})))})),A.default.createElement(i.Box,{my:3},a&&A.default.createElement(ma,{onLoad:m,toggle:l})),A.default.createElement("div",{ref:f})),u.permissions.polls.can_create&&A.default.createElement(i.Button,{fontSize:"1em",variant:a?"dangerSimple":"primaryDefault",onClick:function(){l()},"data-cy":"polls-create-button",boxShadow:a?"0 0 12px rgba(0,0,0,0.3)":"0"},p(a?"Cancel Poll Creation":"Create New Poll")))}function ya(e){fetch(e).then((function(e){return e.blob()})).then((function(e){!function(e){var t,n=[new ClipboardItem((t={},t[e.type]=e,t))];navigator.clipboard.write(n)}(e)})).catch((function(e){return jr.warn("image_cp_failed",e)}))}function ba(e){if(e){var t=new URL(e).pathname.split("/"),n=decodeURIComponent(t[t.length-1]);fetch(e).then((function(e){return e.blob()})).then((function(e){var t=URL.createObjectURL(e),r=document.createElement("a");r.href=t,r.style.display="none",n&&(r.download=n),document.body.appendChild(r),r.click(),document.body.removeChild(r)})).catch((function(e){return jr.warn("image_dl_failed",e)}))}}pa.defaultProps={disabled:!1,variant:null,menu:[],isActive:!1,badge:"",ariaLabel:"",dataCy:"",fullMenu:!1,fullMenuOptions:[],disableHoverEffect:!1,onMouseOver:function(){},onMouseOut:function(){},onMouseEnter:function(){},onMouseLeave:function(){},permissionWarning:!1};var Ea=function(t){var n,r=t.isOpen,o=t.setImageModalData,a=t.imageLink,c=t.userAvatarSrc,s=t.userDisplayName,u=A.default.useRef(),d=a&&a.endsWith(".png"),f=e.useState(!0),p=f[0],m=f[1],h=e.useState(!1),g=h[0],v=h[1];return A.default.createElement(i.AlertDialog,{isCentered:!0,isOpen:r,size:"5xl",leastDestructiveRef:u,onClose:function(){return o({isOpen:!1})},portalProps:{containerRef:{current:document.getElementById("dyte-base-elem")||(null===(n=document.getElementById("dyte-shadow"))||void 0===n?void 0:n.shadowRoot.getElementById("dyte-base-elem"))}}},A.default.createElement(i.AlertDialogOverlay,{bg:"rgba(50, 50, 50, 0.8)"},A.default.createElement(i.AlertDialogContent,{padding:["10px","24px"],width:"auto",bg:"secondary.1000",color:"text.100"},A.default.createElement(i.HStack,{marginBottom:"20px"},A.default.createElement(Ao,{name:s,imgSrc:c,size:"sm",dimensions:30}),A.default.createElement(i.Text,null,"Shared by"," ",A.default.createElement("b",null,s)),A.default.createElement(i.Tooltip,{textAlign:"center",label:"Close",portalProps:{containerRef:{current:document.getElementById("dyte-base-elem")||document.getElementById("dyte-shadow").shadowRoot.getElementById("dyte-base-elem")}}},A.default.createElement(i.Box,{onClick:function(){return o({isOpen:!1})},cursor:"pointer",_hover:{backgroundColor:"secondary.700"},transition:"background-color ease 0.3s",position:"absolute",right:["15px","27px"],top:["10px","22px"],padding:"6px 10px",paddingTop:"4px",backgroundColor:"secondary.800",verticalAlign:"middle",fontSize:"17px",borderRadius:"4px"},A.default.createElement(i.Icon,{fill:"danger.500",as:l.CloseFullscreen})))),p&&A.default.createElement(i.Spinner,null),A.default.createElement(i.Box,{display:p?"none":"block",onLoad:function(){return m(!1)}},A.default.createElement(i.Image,{src:a,alt:"Image shared by "+s,objectFit:"contain",maxW:"100%",maxH:"80vh",marginX:"auto"})),A.default.createElement(i.HStack,{marginTop:"20px",textAlign:"center",alignItems:"center",justifyContent:"center",flexWrap:"wrap"},d&&A.default.createElement(i.Button,{size:"sm",fontSize:"13px",width:"40",display:["none","block"],marginRight:[0,"20px"],marginBottom:["10px",0],leftIcon:g?A.default.createElement(i.Icon,{as:l.Check,fontSize:"18px"}):A.default.createElement(i.Icon,{as:l.ContentCopy}),variant:"secondaryDefault",onClick:g?null:function(){ya(a),v(!0),setTimeout((function(){v(!1)}),5e3)}},g?"Copied":"Copy Image"),A.default.createElement(i.Button,{size:"sm",fontSize:"13px",width:"40",leftIcon:A.default.createElement(i.Icon,{as:l.Download}),onClick:function(){ba(a)}},"Download")))))},Sa=function(t){var n=t.src,r=t.setImageModalData,o=t.userAvatarSrc,a=t.userDisplayName,c=n&&n.endsWith(".png"),s=e.useState(!1),u=s[0],d=s[1],f={containerRef:{current:document.getElementById("dyte-base-elem")||document.getElementById("dyte-shadow").shadowRoot.getElementById("dyte-base-elem")}};return A.default.createElement(i.Box,{display:"none",position:"absolute",cursor:"pointer",top:"2px",right:"2px",backgroundColor:"secondary.900",padding:"5px 10px",paddingTop:"0px",borderRadius:"5px",minWidth:c?"100px":"70px",fontSize:"20px",className:"dyte-client-chat-img-actions"},c&&(u?A.default.createElement(i.Tooltip,{textAlign:"center",shouldWrapChildren:!0,label:"Copied",portalProps:f},A.default.createElement(i.Icon,{fill:"white",_hover:{fill:"primary.500"},as:l.Check,marginRight:"9px"})):A.default.createElement(i.Tooltip,{textAlign:"center",shouldWrapChildren:!0,label:"Copy Image",portalProps:f},A.default.createElement(i.Icon,{fill:"white",as:l.ContentCopy,_hover:{fill:"primary.500"},marginRight:"9px",onClick:function(e){e.stopPropagation(),ya(n),d(!0),setTimeout((function(){d(!1)}),5e3)}}))),A.default.createElement(i.Tooltip,{textAlign:"center",shouldWrapChildren:!0,label:"Download Image",portalProps:f},A.default.createElement(i.Icon,{fill:"white",as:l.Download,marginRight:"9px",_hover:{fill:"primary.500"},onClick:function(e){e.stopPropagation(),ba(n)}})),A.default.createElement(i.Tooltip,{textAlign:"center",shouldWrapChildren:!0,label:"Expand Image",portalProps:f},A.default.createElement(i.Icon,{fill:"white",_hover:{fill:"primary.500"},onClick:function(){return r({isOpen:!0,imageLink:n,userAvatarSrc:o,userDisplayName:a})},as:l.OpenInFull})))},wa=/(https?:\/\/[^\s]+)/,xa=function(e){var t=e.msg.message.trim().split(" "),n=t.length-1;return A.default.createElement("div",null,t.map((function(e,t){var r=" ";return t===n&&(r=""),e.match(wa)?A.default.createElement("span",{key:e},A.default.createElement(i.Link,{href:e,isExternal:!0},e),r):A.default.createElement("span",{key:e},e,r)})))},Ca=function(e){return new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},_a=function(t){var n=t.link,r=t.setImageModalData,o=t.userDisplayName,a=t.userAvatarSrc,l=n.link,c=e.useState(!0),s=c[0],u=c[1];return A.default.createElement(i.Box,{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",paddingBottom:1,className:"dyte-client-chat-img-linkbox",cursor:"zoom-in",onLoad:function(){return u(!1)},onClick:function(e){e.stopPropagation(),r({isOpen:!0,imageLink:l,userAvatarSrc:a,userDisplayName:o})},height:"10em",minW:"8em"},s&&A.default.createElement(i.Spinner,null),A.default.createElement(Sa,{src:l,setImageModalData:r,userAvatarSrc:a,userDisplayName:o}),A.default.createElement(i.Image,{src:l,display:s?"none":"block",alt:"",objectFit:"cover",height:"100%",mx:"auto"}))};var ka=function(e){var t=e.message,n=t.name,r=t.size,o=t.link;return A.default.createElement(i.Flex,{alignItems:"center",wordBreak:"break-word"},A.default.createElement(i.Flex,{direction:"column"},A.default.createElement(i.Text,{textAlign:"left"},n),A.default.createElement(i.Text,{textAlign:"left",fontSize:"12px"},function(e){var t=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,t)).toFixed(2)+" "+["B","kB","MB","GB","TB"][t]}(r))),A.default.createElement(i.Box,{ml:3},A.default.createElement("a",{href:o,target:"_blank",rel:"noreferrer",download:n},A.default.createElement(i.Icon,{as:l.VerticalAlignBottom,fill:"white",boxSize:6}))))};function Ia(e){var t=e.children,n=e.icon,r=e.variant,o=e.onClick;return A.default.createElement(i.MenuItem,{as:i.Button,icon:n,width:"auto",height:"2.5em",borderRadius:"full",px:4,py:2,lineHeight:"100%",verticalAlign:"middle",onClick:o,variant:r,margin:3,backgroundColor:"secondary.700",_hover:{bg:Bn.secondary[800]+" !important"},iconSpacing:"1em",commandSpacing:"1em"},t)}function Ta(n){var r=n.message,i=n.setImageModalData,o=n.userDisplayName,a=n.userAvatarSrc,l=e.useContext(Io).mediaRoom,c=t.useSelector((function(e){return e.room.polls})),s=e.useContext(Eo).selfPeer;switch(r.type){case oa.text:return A.default.createElement(xa,{msg:r});case oa.image:return A.default.createElement(_a,{link:r,setImageModalData:i,userDisplayName:o,userAvatarSrc:a});case oa.file:return A.default.createElement(ka,{message:r});default:return A.default.createElement(ga,{mediaRoom:l,poll:c[r.pollId],selfPeer:s})}}var Pa=e.memo((function(n){var r=n.messages,o=t.useSelector((function(e){return e.participant.id})),a=t.useSelector((function(e){return e.plugin.plugins})),l=e.useState({isOpen:!1,imageLink:"",userAvatarSrc:"",userDisplayName:""}),c=l[0],s=l[1];return A.default.createElement(A.default.Fragment,null,A.default.createElement(Ea,{isOpen:c.isOpen,setImageModalData:s,imageLink:c.imageLink,userDisplayName:c.userDisplayName,userAvatarSrc:c.userAvatarSrc}),r.map((function(e,t){var n,l,c,u,d,f,p=a.find((function(t){return t.id===e.pluginId})),m=p?""+p.name:e.displayName,h=p?p.picture:un.apiBase+"/picture/"+e.userId;return f=e.userId!==(null===(n=r[t-1])||void 0===n?void 0:n.userId)&&e.userId!==(null===(l=r[t+1])||void 0===l?void 0:l.userId)||e.pluginId?"only":e.userId===(null===(c=r[t-1])||void 0===c?void 0:c.userId)&&e.userId===(null===(u=r[t+1])||void 0===u?void 0:u.userId)?"middle":e.userId!==(null===(d=r[t-1])||void 0===d?void 0:d.userId)?"first":"last",e.userId!==o||e.pluginId?A.default.createElement(i.Stack,{className:"dyte-client-otherText dyte-client-"+f,key:t},("first"===f||"only"===f)&&A.default.createElement(i.Text,{className:"dyte-client-user",color:"text.100",size:"xs"},m," ",p&&A.default.createElement(i.Badge,{marginLeft:"5px",fontSize:"0.5em"},"Plugin")),A.default.createElement(i.Flex,{direction:"row",alignItems:"flex-end",marginTop:"0 !important"},"last"===f||"only"===f?A.default.createElement(Ao,{name:m,imgSrc:un.apiBase+"/picture/"+e.userId,size:"sm",dimensions:30}):A.default.createElement(i.Box,{w:30,h:30}),A.default.createElement("div",{className:"dyte-client-bubble dyte-client-other dyte-client-selectable dyte-client-"+f+" dyte-client-type-"+e.type},A.default.createElement(Ta,{message:e,setImageModalData:s,userDisplayName:m,userAvatarSrc:h}),A.default.createElement(i.Text,{color:"text.400",fontSize:"10px",className:"dyte-client-chat-timestamp dyte-client-noSelect"},e.time&&Ca(e.time))))):A.default.createElement(i.Stack,{className:"dyte-client-selfText dyte-client-"+f,width:"100%",key:t},A.default.createElement("div",{className:"dyte-client-bubble dyte-client-self dyte-client-selectable dyte-client-"+f+" dyte-client-type-"+e.type},A.default.createElement(Ta,{message:e,setImageModalData:s,userDisplayName:m,userAvatarSrc:h}),A.default.createElement(i.Text,{color:"text.300",fontSize:"10px",className:"dyte-client-chat-timestamp dyte-client-noSelect"},e.time&&Ca(e.time))))})))}),(function(e,t){return e.messages.length===t.messages.length}));function Aa(n){var r=n.openSidebarView;n.active;var o=e.useState(""),c=o[0],s=o[1],u=t.useSelector((function(e){return e.room.roomName})),d=t.useSelector((function(e){return e.room.chatMessages})),f=t.useSelector((function(e){return e.participant.id})),p=d.filter((function(e){return!0!==e.read&&e.userId!==f})),m=e.useContext(Eo).selfPeer,h=e.useContext(Io).mediaRoom,g=e.useContext(Vr).sessionConfig,v=x.useTranslation().t,y=e.useRef(null),b=e.useRef(null),E=e.useRef(null),S=e.useRef(null),w=a.useMutation("\n  mutation($file: Upload!, $roomName: String!) {\n    uploadFile(file: $file, roomName: $roomName) {\n\t\tlink\n    }\n  }\n")[0],_=t.useDispatch(),k=e.useRef(null),I=e.useState(!1),T=I[0],P=I[1],O=e.useRef(!1),D=e.useRef(!0),N=function(){O.current=!0,Zn()?y.current.scrollIntoView():y.current.scrollIntoView({behavior:"smooth",inline:"start",block:"nearest"}),P(!1),_(Ke(null)),setTimeout((function(){O.current=!1}),600)},R=function(){O.current=!0,setTimeout((function(){N()}),400)},M=function(){var e,t,n=(null===(t=null===(e=document.getElementById("dyte-shadow"))||void 0===e?void 0:e.shadowRoot.querySelector("[data-cy=chat-input-textarea]"))||void 0===t?void 0:t.value)||"",r=c||n;if(""!==r.trim()){var i={message:r,userId:m.id,displayName:m.displayName,type:oa.text,time:(new Date).getTime()};h.sendMessage(i),c?s(""):document.getElementById("dyte-shadow")&&(document.getElementById("dyte-shadow").shadowRoot.querySelector("[data-cy=chat-input-textarea]").value=""),R()}};function L(e){var t=e.target,n=t.validity,r=t.files[0];return K(this,void 0,void 0,(function(){return Z(this,(function(e){switch(e.label){case 0:return n.valid?[4,w({variables:{file:r,roomName:u}})]:[3,2];case 1:(function(e,t,n){var r={displayName:m.displayName,type:oa.file,link:e,userId:m.id,name:t,size:n,time:(new Date).getTime()};h.sendMessage(r),R()})(e.sent().data.uploadFile.link,r.name,r.size),e.label=2;case 2:return[2]}}))}))}function z(e){var t=e.target,n=t.validity,r=t.files[0];return K(this,void 0,void 0,(function(){return Z(this,(function(e){switch(e.label){case 0:return n.valid?[4,w({variables:{file:r,roomName:u}})]:[3,2];case 1:(function(e){var t={displayName:m.displayName,type:oa.image,link:e,userId:m.id,time:(new Date).getTime()};h.sendMessage(t),R()})(e.sent().data.uploadFile.link),e.label=2;case 2:return[2]}}))}))}e.useEffect((function(){S.current.focus({preventScroll:!0}),N();var e=function(e){k.current.scrollTop+k.current.clientHeight+100<k.current.scrollHeight?(D.current&&!O.current&&(D.current=!1),T||O.current||P(!0)):(D.current||(D.current=!0),P(!1),_(Ke(null)))},t=function(e){var t=e.target.innerText;e.clipboardData.setData("text/plain",t)},n=k.current;return null==n||n.addEventListener("scroll",e),null==n||n.addEventListener("copy",t),function(){null==n||n.removeEventListener("scroll",e),null==n||n.removeEventListener("copy",t)}}),[]),e.useEffect((function(){p.length>0&&D.current&&N()}),[p]);return A.default.createElement(i.Flex,{height:"100%",direction:"column",justifyContent:"space-between",p:"1",pr:"0"},A.default.createElement(i.Center,null,A.default.createElement(i.Text,null,v("Chat"))),A.default.createElement(i.Box,{flexGrow:1,overflowY:"hidden",position:"relative"},A.default.createElement(i.Box,{height:"100%",className:"dyte-client-scrollbar",paddingTop:"2em",overflowY:"auto",flexGrow:1,ref:k},A.default.createElement("section",{className:"dyte-client-discussion"},A.default.createElement(Pa,{messages:d}),A.default.createElement("div",{ref:y}))),A.default.createElement(C.AnimatePresence,null,T&&A.default.createElement(C.motion.div,{initial:{y:100},animate:{y:0},transition:{ease:"easeInOut"},exit:{y:100}},A.default.createElement(i.Box,{position:"absolute",bottom:"0",w:"100%",display:"flex",flexDir:"column"},A.default.createElement(i.Button,{leftIcon:A.default.createElement(l.ArrowDownward,{size:"1.25em"}),onClick:N,h:"10",fontSize:"sm",w:"auto",mx:"auto",rounded:"full",mb:"-6",bg:p.length>0?"primary.500":"secondary.700",_hover:{bg:p.length>0?"primary.700":"secondary.800"}},"See latest messages"," ",p.length>0&&"("+p.length+")"),A.default.createElement(i.Box,{h:"10",bgGradient:"linear(to-b, transparent, secondary.1000)"}))))),A.default.createElement(i.Box,null,A.default.createElement(i.InputGroup,{alignItems:"center"},A.default.createElement(i.InputLeftElement,{top:"inherit",left:"0.5em"},A.default.createElement(i.Menu,{variant:"chat",autoSelect:!1,placement:"top-start",isLazy:!0},(function(e){var t=e.isOpen;return A.default.createElement(A.default.Fragment,null,A.default.createElement("input",{onChange:z,ref:b,type:"file",id:"selectedFile",style:{display:"none"},accept:"image/*"}),A.default.createElement("input",{onChange:L,ref:E,type:"file",id:"selectedFile",style:{display:"none"}}),(g.permissions.chat.public.files||g.permissions.polls.can_create&&g.theme.control_bar.elements.polls)&&A.default.createElement(i.MenuButton,{as:i.IconButton,bg:"secondary.700",_expanded:{bg:"primary.500"},variant:"solid",size:"md",p:"0.5em",icon:A.default.createElement(i.Icon,{as:l.Add,transitionDuration:"0.2s",transform:t?"rotate(45deg)":"none",fill:"text.100",boxSize:"6",_hover:{fill:"text.200"}}),"aria-label":"Add attachment",isRound:!0}),A.default.createElement(i.MenuList,{marginLeft:"-20px"},g.permissions.chat.public.files&&A.default.createElement(i.MenuItem,{onClick:function(){return E.current.click()},p:0,pl:4,mb:4},A.default.createElement(i.Text,{fontSize:"sm"},"Limit: 1MB / file")),g.permissions.chat.public.files&&A.default.createElement(Ia,{variant:"alternateDark",icon:A.default.createElement(i.Icon,{fill:"text.100",w:"1.5em",h:"1.5em",as:l.InsertDriveFile}),onClick:function(){return E.current.click()}},v("File")),g.permissions.polls.can_create&&g.theme.control_bar.elements.polls&&A.default.createElement(Ia,{variant:"alternateDark",icon:A.default.createElement(i.Icon,{fill:"text.100",w:"1.5em",h:"1.5em",as:l.Poll}),onClick:function(){return r(Na.Polls)}},v("Poll")),g.permissions.chat.public.files&&A.default.createElement(Ia,{variant:"alternateDark",icon:A.default.createElement(i.Icon,{fill:"text.100",w:"1.5em",h:"1.5em",as:l.Image}),onClick:function(){return b.current.click()}},v("Image"))))}))),A.default.createElement(i.Textarea,{className:"dyte-client-chatInput",onKeyPress:function(e){13===e.charCode&&(e.shiftKey||(M(),e.preventDefault()))},ref:S,color:"text.100",backgroundColor:"secondary.800",border:"none",focusBorderColor:"primary.500",errorBorderColor:"none",size:"sm",minHeight:"48px",lineHeight:"2",resize:"none",borderRadius:"60px",disabled:!g.permissions.chat.public.text,paddingLeft:"50px",paddingRight:"50px",fontSize:"16px",placeholder:v("Type a message..."),_placeholder:{color:"text.200"},onChange:function(e){return s(e.target.value)},value:c,"data-cy":"chat-input-textarea"}),A.default.createElement(i.InputRightElement,{top:"inherit",right:"0.5em"},A.default.createElement(i.IconButton,{disabled:!g.permissions.chat.public.text,onClick:function(){return M()},variant:"solid",icon:A.default.createElement(i.Icon,{as:l.Send,boxSize:"6",fill:"text.100","aria-label":"add"}),"aria-label":"Send message",size:"md",p:"0.5em","data-cy":"chat-send-button",isRound:!0})))))}function Oa(n){var r,o=n.peer,a=n.mediaRoom,c=n.permissions,s=n.showPresentersAction,u=n.showAttendeesAction,d=n.showAudioVideoIcons,f=n.participantControls,p=t.useSelector((function(e){return e.room.activeSpeakerPeerId})),m=t.useSelector((function(e){return e.room.roomViewType})),h=o.id===p,g=e.useContext(Eo).individualControls,v=(null==c?void 0:c.pin_participant)||(null==c?void 0:c.can_allow_participant_audio)||(null==c?void 0:c.can_allow_participant_video);return A.default.createElement(i.Flex,{key:o.id,direction:"row",alignItems:"center",className:"dyte-client-noSelect",borderBottom:"1px solid",borderColor:"secondary.800"},A.default.createElement(Ao,{size:"sm",name:o.displayName,imgSrc:un.apiBase+"/picture/"+o.userId}),A.default.createElement(i.Flex,{marginLeft:3,flexGrow:1,alignItems:"center",paddingY:4},A.default.createElement(i.HStack,{color:"text.200"},A.default.createElement(eo,{name:o.displayName,charSize:20}),A.default.createElement(i.Box,{backgroundColor:"primary.500",color:"text.100",fontSize:"sm",borderRadius:3,px:1},o.isMe?"me":o.label)),A.default.createElement(i.Flex,{marginLeft:"auto",marginRight:2},d&&(o.audioMuted?A.default.createElement(i.Icon,{boxSize:"1.25em",marginRight:3,as:l.MicOff,fill:"danger.500"}):A.default.createElement(i.Icon,{boxSize:"1.25em",marginRight:3,as:l.Mic,fill:h?"primary.500":"text.400"})),d&&(o.videoConsumerId?A.default.createElement(i.Icon,{boxSize:"1.25em",marginRight:v?3:0,as:l.Videocam,fill:"text.400"}):A.default.createElement(i.Icon,{boxSize:"1.25em",marginRight:v?3:0,as:l.VideocamOff,fill:"danger.500"})),v&&A.default.createElement(i.Menu,{placement:"auto"},A.default.createElement(i.MenuButton,{as:i.IconButton,"aria-label":"menu",icon:A.default.createElement(i.Icon,{as:l.MoreVert,fill:"text.400",boxSize:"5"}),variant:"none",size:"sm",minWidth:"2",boxSize:"1.25em"}),A.default.createElement(i.MenuList,{zIndex:3},(null==c?void 0:c.pin_participant)&&m!==ut.webinar&&(o.isPinned?A.default.createElement(i.MenuItem,{onClick:function(){return a.pin(null)}},"Unpin"):A.default.createElement(i.MenuItem,{onClick:function(){return a.pin(o.id)}},"Pin")),(null==c?void 0:c.can_allow_participant_audio)&&A.default.createElement(i.MenuItem,{isDisabled:o.audioMuted,onClick:function(){return a.disableAudio(o.id)}},"Mute Audio"),(null==c?void 0:c.can_allow_participant_video)&&A.default.createElement(i.MenuItem,{isDisabled:!o.videoConsumerId,onClick:function(){return a.disableVideo(o.id)}},"Disable Video"),!o.isMe&&(null==c?void 0:c.kick_participant)&&A.default.createElement(i.MenuItem,{onClick:function(){return a.kick(o.id)}},"Kick"),m===ut.webinar&&!o.isMe&&s&&A.default.createElement(i.MenuItem,{onClick:function(){return a.removePeerFromStage(o.id,ft.REQUESTED_BY_MODERATOR)}},"Force Stop Presenting"),m===ut.webinar&&!o.isMe&&u&&A.default.createElement(i.MenuItem,{onClick:function(){return a.acceptAllRequestToJoinStage([{id:o.id,requestToJoinType:bt.present,type:ft.REQUESTED_BY_MODERATOR}])}},"Grant Premission to Present"),(null==f?void 0:f.length)>0&&A.default.createElement(i.MenuDivider,{my:"2",border:"`1px solid",borderColor:"secondary.700"}),null==f?void 0:f.map((function(e){return A.default.createElement(i.MenuItem,{onClick:function(){return e.onClick(o.id)}},e.label)})),g[o.id]&&A.default.createElement(i.MenuDivider,{my:"2",border:"`1px solid",borderColor:"secondary.700"}),null===(r=g[o.id])||void 0===r?void 0:r.map((function(e){return o.id===e.id?A.default.createElement(i.MenuItem,{key:e.id,onClick:function(){return e.onClick(o.id)}},e.label):null})))))))}function Da(){var n=e.useContext(Eo),r=n.processedPeers,o=n.joinedProcessedPeers,a=n.selfPeer;r=[a].concat(r.sort((function(e,t){return e.id.localeCompare(t.id)}))).filter((function(e){return!(null==e?void 0:e.webinarHiddenParticipant)||(null==e?void 0:e.metadata.view_type)===ut.groupCall}));var c,s=[a].concat(o).filter((function(e){return!(null==e?void 0:e.webinarHiddenParticipant)&&e.requestToJoinType===bt.ask}));r=r.concat(s).filter((c=new Set,function(e){return!c.has(e.id)&&c.add(e.id)}));var u=e.useContext(Io).mediaRoom,d=e.useContext(Vr),f=d.sessionConfig,p=d.participantControls,m=e.useState(""),h=m[0],g=m[1],v=t.useDispatch(),y=t.useSelector((function(e){return e.participant.organizationId})),b=x.useTranslation().t,E=o.filter((function(e){return(null==e?void 0:e.metadata.view_type)===ut.webinar})).map((function(e){return e.id})),S=t.useSelector((function(e){return e.room.requestToJoinPeersList})).filter((function(e){return E.includes(e.id)})),w=S.filter((function(e){return e.requestToJoinType===bt.present})),C=S.filter((function(e){return e.requestToJoinType===bt.ask})),_=[a].concat(o).filter((function(e){return(null==e?void 0:e.webinarHiddenParticipant)&&(null==e?void 0:e.metadata.view_type)===ut.webinar})).filter((function(e,t,n){return n.findIndex((function(t){return t.id===e.id}))===t}));e.useEffect((function(){v(it())}),[]);var k=function(e,t){u.acceptAllRequestToJoinStage([{id:e,requestToJoinType:t,type:ft.REQUESTED_BY_PARTICIPANT}])},I=function(e){u.rejectRequestToJoinStage(e)},T=function(e){u.acceptAllRequestToJoinStage(e.map((function(e){return{id:e.id,requestToJoinType:e.requestToJoinType}})))};return A.default.createElement(i.Box,{px:"0.4em",height:"100%",overflowY:"auto",className:"dyte-client-noScrollbar"},A.default.createElement(i.Center,null,A.default.createElement(i.Text,null,b("Participants"))),A.default.createElement(i.Box,{marginTop:"1.4em"},A.default.createElement(i.Text,null,"In Call (",o.filter((function(e,t,n){return n.findIndex((function(t){return t.id===e.id}))===t})).length+1,")"),"1ad1a2b3-1ed1-41f3-a491-6acfab230eaf"!==y&&A.default.createElement(i.InputGroup,{marginY:4},A.default.createElement(i.InputLeftElement,null,A.default.createElement(i.Icon,{boxSize:6,as:l.Search,fill:"text.400","aria-label":"Search"})),A.default.createElement(i.Input,{color:"text.100",backgroundColor:"secondary.800",border:"none",borderRadius:"0.25em",focusBorderColor:"none",errorBorderColor:"none",size:"md",fontSize:"1em",placeholder:"Search",value:h,onChange:function(e){return g(e.target.value)}})),C.length>0&&A.default.createElement(i.Box,{marginTop:"1.5em"},A.default.createElement(i.Flex,{direction:"row",justifyContent:"space-between",marginBottom:"1.5"},A.default.createElement(i.Text,{color:"#FF414D"},"Request to ask   (",C.length,")"),A.default.createElement(i.Text,{color:"#2160FD",cursor:"pointer",onClick:function(){return T(C)}},"Accept All")),C.filter((function(e){return""===h||e.name.toLowerCase().includes(h.toLowerCase())})).map((function(e){return A.default.createElement(i.Flex,{key:e.id,direction:"row",alignItems:"center"},A.default.createElement(Ao,{size:"sm",name:e.name}),A.default.createElement(i.Flex,{marginLeft:3,flexGrow:1,alignItems:"center",paddingY:2,borderBottom:"1px solid",borderColor:"secondary.800"},A.default.createElement(i.Text,{color:"text.200",fontSize:"md"},e.name),A.default.createElement(i.Flex,{marginLeft:"auto"},A.default.createElement(i.IconButton,{variant:"solidDarker",color:"danger.500",size:"sm","aria-label":"reject",icon:A.default.createElement(i.Icon,{boxSize:"5",as:l.Close}),_hover:{borderColor:"danger.500"},onClick:function(){return I(e.id)}}),A.default.createElement(i.IconButton,{variant:"solidDarker",color:"primary.300",size:"sm","aria-label":"accept",p:1,icon:A.default.createElement(i.Icon,{boxSize:"5",as:l.Check}),_hover:{borderColor:"primary.500"},onClick:function(){return k(e.id,e.requestToJoinType)},ml:2}))))}))),w.length>0&&A.default.createElement(i.Box,{marginTop:"1.5em"},A.default.createElement(i.Flex,{direction:"row",justifyContent:"space-between",marginBottom:"1.5"},A.default.createElement(i.Text,{color:"#FF414D"},"Requesting to present (",w.length,")"),A.default.createElement(i.Text,{color:"#2160FD",cursor:"pointer",onClick:function(){return T(w)}},"Accept All")),w.filter((function(e){return""===h||e.name.toLowerCase().includes(h.toLowerCase())})).map((function(e){return A.default.createElement(i.Flex,{key:e.id,direction:"row",alignItems:"center"},A.default.createElement(Ao,{size:"sm",name:e.name}),A.default.createElement(i.Flex,{marginLeft:3,flexGrow:1,alignItems:"center",paddingY:2,borderBottom:"1px solid",borderColor:"secondary.800"},A.default.createElement(i.Text,{color:"text.200",fontSize:"md"},e.name),A.default.createElement(i.Flex,{marginLeft:"auto"},A.default.createElement(i.IconButton,{variant:"solidDarker",color:"danger.500",size:"sm","aria-label":"reject",icon:A.default.createElement(i.Icon,{boxSize:"5",as:l.Close}),_hover:{borderColor:"danger.500"},onClick:function(){return I(e.id)}}),A.default.createElement(i.IconButton,{variant:"solidDarker",color:"primary.300",size:"sm","aria-label":"accept",p:1,icon:A.default.createElement(i.Icon,{boxSize:"5",as:l.Check}),_hover:{borderColor:"primary.500"},onClick:function(){return k(e.id,e.requestToJoinType)},ml:2}))))}))),A.default.createElement(i.Box,{marginTop:"1.5em"},r.filter((function(e){return""===h||e.displayName.toLowerCase().includes(h.toLowerCase())})).map((function(e){return A.default.createElement(Oa,{peer:e,key:e.id,mediaRoom:u,permissions:null==f?void 0:f.permissions,participantControls:p,showPresentersAction:!0})}))),f.permissions.show_participant_list&&_.length>0&&A.default.createElement(i.Box,{marginTop:"1.5em"},A.default.createElement(i.Flex,{direction:"row",justifyContent:"space-between",mb:"2"},A.default.createElement(i.Text,null,"Attendees (",_.length,")")),_.filter((function(e){return""===h||e.displayName.toLowerCase().includes(h.toLowerCase())})).map((function(e){return A.default.createElement(Oa,{peer:e,key:e.id,mediaRoom:u,permissions:null==f?void 0:f.permissions,showAttendeesAction:!0,showAudioVideoIcons:!1,participantControls:p})})))))}Oa.defaultProps={showPresentersAction:!1,showAttendeesAction:!1,showAudioVideoIcons:!0,participantControls:[]};var Na,Ra={hidden:{y:-20,opacity:0,scale:.96},visible:{opacity:1,y:0},hovered:{scale:1},exit:{opacity:0,scale:0},hiddenNoPlugin:{opacity:0,scale:1},exitNoPlugin:{scale:0,opacity:0,transition:{duration:0}}};function Ma(t){var n,r=t.plugin,o=t.activePlugins,a=t.screenSharing,l=t.openSidebarView,c=t.canStart,s=e.useContext(qo),u=e.useContext(Vr).meeting;return a?n="Disable screen share to activate a plugin.":c?o>0&&(n="Stop the current plugin to start a new one"):n="You don't have the required permissions",A.default.createElement(C.motion.div,{variants:Ra,initial:"hidden",animate:"visible",whileHover:"hovered"},A.default.createElement(i.Flex,{marginY:"0.8em",borderRadius:"0.5em",padding:"0.75em",backgroundColor:"secondary.1000",direction:"column"},A.default.createElement(i.Flex,{direction:"row",alignItems:"center"},A.default.createElement(i.Image,{height:"2.75em",width:"2.75em",src:r.picture,marginRight:"0.75em",borderRadius:"lg"}),A.default.createElement(i.Box,null,A.default.createElement(i.Heading,{fontWeight:500,fontSize:"1.2em",color:"text.200"},r.name)),n?A.default.createElement(i.Box,{marginLeft:"auto"},A.default.createElement(i.Tooltip,{textAlign:"center",shouldWrapChildren:!0,label:n,openDelay:200,placement:"top-start",maxW:40,portalProps:{containerRef:{current:document.getElementById("dyte-base-elem")||document.getElementById("dyte-shadow").shadowRoot.getElementById("dyte-base-elem")}}},A.default.createElement(i.IconButton,{variant:"solidDarker",icon:A.default.createElement(i.Icon,{boxSize:"6",as:Rn,fill:"primary.500"}),size:"lg","aria-label":"enable plugin",opacity:"0.5",_hover:{},borderRadius:"lg",disabled:!0}))):A.default.createElement(i.IconButton,{variant:"solidDarker",borderRadius:"lg",marginLeft:"auto",icon:A.default.createElement(i.Icon,{boxSize:"6",as:Rn,fill:"primary.500"}),size:"lg","aria-label":"enable plugin",onClick:function(){s.pluginManager.addRoomPlugin(r),l(Na.Plugins),u.plugins.forEach((function(e){e.id===r.id&&e.data.length>0&&e.data.forEach((function(t){return e.sendData(t)}))}))},"data-cy":"plugins-"+r.name+"-enable-button"})),A.default.createElement(i.Text,{marginTop:"0.5em",color:"text.400"},r.description)))}function La(n){var r=n.plugin,o=n.pluginPermissions,a=e.useContext(qo),c=t.useSelector((function(e){return e.peers.joinedPeers})),s=t.useSelector((function(e){return e.participant.id})),u=x.useTranslation().t,d=s===(null==r?void 0:r.enabledBy)||(null==o?void 0:o.can_close);return A.default.createElement(C.motion.div,{variants:Ra,initial:"hidden",animate:"visible",exit:"exit"},A.default.createElement(i.Flex,{marginY:"0.8em",borderRadius:"0.5em",padding:"0.5em",direction:"column"},A.default.createElement(i.Flex,{direction:"row",alignItems:"center"},A.default.createElement(i.Image,{height:"2.75em",width:"2.75em",src:r.picture,marginRight:"0.75em",borderRadius:"lg"}),A.default.createElement(i.Box,null,A.default.createElement(i.Heading,{fontWeight:500,fontSize:"1.2em",color:"text.100"},r.name),A.default.createElement(i.Text,{fontSize:"0.8em",color:"text.400"},function(){if(!r.enabledBy)return u("Activated");if(r.enabledBy===s)return u("Activated by me");var e=c.find((function(e){return e.userId===r.enabledBy}));return e?"Activated by "+e.displayName:u("Activated")}())),d&&A.default.createElement(i.IconButton,{variant:"solidDarker",marginLeft:"auto",icon:A.default.createElement(i.Icon,{boxSize:"6",as:l.Close,fill:"danger.500"}),size:"lg","aria-label":"close plugin",onClick:function(){a.pluginManager.removeRoomPlugin({id:r.id})},"data-cy":"plugins-remove-button",borderRadius:"lg"}))))}function za(n){var r=t.useSelector((function(e){return e.plugin.plugins})),o=e.useContext(qo),a=x.useTranslation().t,l=e.useContext(Vr),c=l.sessionConfig;l.meeting;var s=(null==c?void 0:c.permissions.plugins)||{can_close:!1,can_start:!0},u=t.useSelector((function(e){return e.consumers.activeConsumers})).filter((function(e){return"video"===e.kind&&e.appData.screenShare})).length,d=t.useSelector((function(e){return e.participant.sharingScreen})),f=1===u||d,p=function(e){var t;return(null===(t=c.permissions.plugins.config[e])||void 0===t?void 0:t.defaultAccess)||"blacklist"},m=n.openSidebarView;return A.default.createElement(i.Box,{height:"100%",overflowY:"auto",className:"dyte-client-noScrollbar"},A.default.createElement(i.Center,null,A.default.createElement(i.Text,null,a("Plugins"))),A.default.createElement(C.motion.div,{initial:{y:-20},animate:{y:0}},A.default.createElement(i.Box,{paddingY:"1em",borderBottom:"1px solid",borderColor:"secondary.800"},A.default.createElement(i.Heading,{marginTop:"0.5em",marginBottom:"1em",fontSize:"1.2em",fontWeight:600,color:"text.300"},a("Active Plugin")),A.default.createElement(C.AnimatePresence,{exitBeforeEnter:!0},0===r.length?A.default.createElement(C.motion.div,{variants:Ra,initial:"hiddenNoPlugin",animate:"visible",exit:"exitNoPlugin",key:r.length},A.default.createElement(i.Center,null,A.default.createElement(i.Text,{textAlign:"center",color:"text.400",maxWidth:"160px"},a("no_active_plugin")))):r.map((function(e){return A.default.createElement(La,{plugin:e,key:"pluginactive",pluginPermissions:s})})))),A.default.createElement(i.Box,{paddingY:"1em",borderBottom:"1px solid",borderColor:"secondary.800"},A.default.createElement(i.Heading,{fontSize:"1.2em",marginTop:"0.5em",marginBottom:"1em",fontWeight:600,color:"text.300"},a("Plugin Store")),o.plugins.map((function(e){return A.default.createElement(Ma,{plugin:J(J({},e),{ACLType:p(e.id)}),canStart:s.can_start,activePlugins:r.length,screenSharing:f,key:e.name,openSidebarView:m})})))))}function Ba(e){var t=e.tab,n=e.activeTab,r=e.children;return A.default.createElement(i.Fade,{style:{height:"100%"},in:n===t},r)}function Fa(n){var r=n.activeTab,o=n.openSidebarView;t.useSelector((function(e){return e.room.roomViewType}));var a=e.useContext(Vr).meeting.modules.getAll().filter((function(e){return"sidebar"===e.type})),l=Q(Q([],Object.keys(Na).slice(0,-1),!0),a.map((function(e){return e.sidebarComponent.name})),!0);return A.default.createElement(i.Box,{h:"100%"},A.default.createElement(i.Tabs,{h:"100%",index:l.indexOf(r),isLazy:!0},A.default.createElement(i.TabPanels,{h:"100%"},A.default.createElement(i.TabPanel,{h:"100%",p:"1em 0.7em"},A.default.createElement(Ba,{activeTab:r,tab:Na.Chat},A.default.createElement(Aa,{openSidebarView:o,active:r===Na.Chat}))),A.default.createElement(i.TabPanel,{h:"100%",p:"1em 0.7em"},A.default.createElement(Ba,{activeTab:r,tab:Na.Polls},A.default.createElement(va,{active:r===Na.Polls}))),A.default.createElement(i.TabPanel,{h:"100%",p:"1em 0.7em"},A.default.createElement(Ba,{activeTab:r,tab:Na.Participants},A.default.createElement(Da,null))),A.default.createElement(i.TabPanel,{h:"100%",p:"1em 0.7em"},A.default.createElement(Ba,{activeTab:r,tab:Na.Plugins},A.default.createElement(za,{openSidebarView:o}))),a.map((function(e){return A.default.createElement(i.TabPanel,{h:"100%",p:"1em 0.7em",key:"module_"+e.sidebarComponent.name+"_sidebar"},A.default.createElement(Ba,{activeTab:r,tab:e.sidebarComponent.name},A.default.createElement(e.sidebarComponent.component,null)))})))))}function ja(t){var n=t.isOpen,r=t.onOpen,o=t.onClose,a=t.onVideo,c=t.onAudio,s=t.children,u=e.useRef(null);return A.default.createElement(i.Popover,{isOpen:n,onOpen:r,onClose:o,initialFocusRef:u,placement:"top",variant:"primary",isLazy:!0},A.default.createElement(i.PopoverTrigger,null,A.default.createElement(i.Box,null,s)),A.default.createElement(i.PopoverContent,null,A.default.createElement(i.PopoverHeader,{textAlign:"center",mt:"1.5"},"Mute All"),A.default.createElement(i.PopoverFooter,null,A.default.createElement(i.Flex,null,A.default.createElement(i.Button,{variant:"alternateDark",onClick:function(){return a()},fontSize:"1.05em",borderRadius:"lg",px:"8"},A.default.createElement(i.Icon,{as:l.VideocamOff,fill:"text.100",boxSize:"6",mr:"2"}),"Video"),A.default.createElement(i.Button,{variant:"alternateDark",onClick:function(){return c()},ml:3,fontSize:"1.05em",borderRadius:"lg",px:"8"},A.default.createElement(i.Icon,{as:l.MicOff,fill:"text.100",boxSize:"6",mr:"2"}),"Audio")))))}Ma.defaultProps={activePlugins:0,screenSharing:!1},function(e){e.Chat="Chat",e.Polls="Polls",e.Participants="Participants",e.Plugins="Plugins",e.None="None"}(Na||(Na={}));var Va=function(e){return K(void 0,void 0,void 0,(function(){var t,n,r,i,o;return Z(this,(function(a){switch(a.label){case 0:return t=e.authToken,n=e.organizationId,r=e.roomName,i=e.peerId,[4,fetch(un.apiBase+"/v1/organizations/"+n+"/rooms/"+r+"/recording",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","dyte-tracing-id":i,Authorization:"Bearer "+t}})];case 1:if(201!==(o=a.sent()).status)throw new Error("Recording failed to start");return[2,o.json()]}}))}))},Wa=function(e){return K(void 0,void 0,void 0,(function(){var t,n,r,i,o,a;return Z(this,(function(l){switch(l.label){case 0:return t=e.authToken,n=e.organizationId,r=e.roomName,i=e.recordingId,o=e.peerId,[4,fetch(un.apiBase+"/v1/organizations/"+n+"/rooms/"+r+"/recordings/"+i,{method:"PUT",body:JSON.stringify({recordingAction:"stop"}),headers:{Accept:"application/json","Content-Type":"application/json","dyte-tracing-id":o,Authorization:"Bearer "+t}})];case 1:if(201!==(a=l.sent()).status)throw new Error("Recording failed to stop");return[2,a.json()]}}))}))},qa=function(e){return K(void 0,void 0,void 0,(function(){var t,n,r,i;return Z(this,(function(o){switch(o.label){case 0:return t=e.authToken,n=e.organizationId,r=e.roomName,i=e.peerId,[4,fetch(un.apiBase+"/v1/organizations/"+n+"/rooms/"+r+"/active-recording?limit=50",{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json","dyte-tracing-id":i,Authorization:"Bearer "+t}})];case 1:return[2,o.sent().json()]}}))}))},Ha=function(n){var r=n.isMobile,o=e.useState(null),a=o[0],c=o[1],s=e.useState("NOT_INIT"),u=s[0],d=s[1],f=t.useSelector((function(e){return e.peers.recordingPeer})),p=t.useSelector((function(e){return e.participant.authToken})),m=t.useSelector((function(e){return e.room.roomName})),h=e.useContext(Vr).meeting,g=t.useSelector((function(e){return e.participant.organizationId}))||h.connectionConfig.clientId,v=t.useSelector((function(e){return e.participant.peerId})),y=function(e,t){return K(void 0,void 0,void 0,(function(){var t,n,r,i,o,a,l;return Z(this,(function(s){switch(s.label){case 0:return[4,qa(e)];case 1:if(t=s.sent(),0===(null===(o=t.data)||void 0===o?void 0:o.total))d("NOT_STARTED"),c(null);else switch(r=void 0,(null===(a=t.data)||void 0===a?void 0:a.recording)?(n=t.data.recording.status,r=t.data.recording.id):(null===(l=t.data)||void 0===l?void 0:l.total)>0&&(i=t.data.recordings.sort((function(e,t){return e.invokedTime>t.invokedTime?-1:e.invokedTime<t.invokedTime?1:0}))[0],n=i.status,r=i.id),n){case"UPLOADING":d("STOPPING");break;case"UPLOADED":d("NOT_STARTED");break;case"INVOKED":d("STARTING"),c(r);break;case"RECORDING":d("RECORDING"),c(r);break;default:d("NOT_STARTED"),c(null)}return[2]}}))}))};e.useEffect((function(){p&&m&&g&&"NOT_INIT"===u&&y({authToken:p,roomName:m,organizationId:g,peerId:v})}),[p,m,g,a]),e.useEffect((function(){"STARTING"===u&&f?d("RECORDING"):"STOPPING"!==u||f?y({authToken:p,peerId:v,organizationId:g,roomName:m}):d("NOT_STARTED")}),[f]);var b="STARTING"===u||"STOPPING"===u||"NOT_INIT"===u,E=r?oo:pa;return A.default.createElement(E,{disabled:b,onClick:function(){return K(void 0,void 0,void 0,(function(){var e,t,n,r,i;return Z(this,(function(o){switch(o.label){case 0:if(e={authToken:p,roomName:m,organizationId:g,peerId:v},!a)return[3,5];d("STOPPING"),e.recordingId=a,o.label=1;case 1:return o.trys.push([1,3,,4]),[4,Wa(e)];case 2:return o.sent(),c(null),[3,4];case 3:return o.sent(),d("RECORDING"),[3,4];case 4:return[3,9];case 5:d("STARTING"),o.label=6;case 6:return o.trys.push([6,8,,9]),[4,Va(e)];case 7:return t=o.sent(),n=null===(i=null===(r=t.data)||void 0===r?void 0:r.recording)||void 0===i?void 0:i.id,c(n),[3,9];case 8:return o.sent(),d("NOT_STARTED"),[3,9];case 9:return[2]}}))}))},icon:function(){switch(u){case"NOT_STARTED":return A.default.createElement(i.Icon,{as:l.FiberManualRecord,fill:"danger.500"});case"RECORDING":return A.default.createElement(i.Icon,{as:l.FiberManualRecord,fill:"text.400"});case"STARTING":case"STOPPING":case"NOT_INIT":default:return A.default.createElement(i.Spinner,{size:"sm"})}}(),label:function(){switch(u){case"NOT_INIT":return"Loading";case"NOT_STARTED":return"Record";case"RECORDING":return"Stop Record";case"STARTING":return"Starting";case"STOPPING":return"Stopping";default:return"Loading"}}()})},Ua=O.forwardRef((function(e,t){return O.createElement(c.StyledIconBase,J({iconAttrs:{fill:"none",width:24,height:24},iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:t}),O.createElement("path",{d:"M3 3h18c1.1 0 2 .9 2 2l-.01 12c0 1.1-.89 2-1.99 2h-2v-2h1c.55 0 1-.45 1-1V6c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h1v2H3c-1.1 0-2-.9-2-2V5c0-1.1.9-2 2-2z"}),O.createElement("path",{d:"M11.293 9.293a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L13 12.414V22a1 1 0 11-2 0v-9.586l-2.293 2.293a1 1 0 01-1.414-1.414l4-4z"}))}));Ua.displayName="JoinStageIcon";var Ga=O.forwardRef((function(e,t){return O.createElement(c.StyledIconBase,J({iconAttrs:{fill:"none",width:24,height:24},iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:t}),O.createElement("path",{d:"M3 3h18c1.1 0 2 .9 2 2l-.01 12c0 1.1-.89 2-1.99 2h-2v-2h1c.55 0 1-.45 1-1V6c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h1v2H3c-1.1 0-2-.9-2-2V5c0-1.1.9-2 2-2z"}),O.createElement("path",{d:"M11.293 22.707a1 1 0 001.414 0l4-4a1 1 0 00-1.414-1.414L13 19.586V10a1 1 0 10-2 0v9.586l-2.293-2.293a1 1 0 00-1.414 1.414l4 4z"}))}));Ga.displayName="LeaveStageIcon";var Ja=O.forwardRef((function(e,t){return O.createElement(c.StyledIconBase,J({iconAttrs:{fill:"currentColor"},iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:t}),O.createElement("path",{d:"M10.8 10.2V3.3a.9.9 0 111.8 0v6.9a.6.6 0 001.2 0V4.5a.9.9 0 111.8 0v7.8c.795-.511 1.671-.9 2.4-.9 1.166 0 2.146.389 2.382 1.338.014.058.019.117.019.175 0 .18-.085.35-.23.459l-1.574 1.181c-1.275.956-2.476 2.239-3.314 3.587-.453.729-.861 1.483-1.264 2.241-.432.813-.706 1.219-2.018 1.219H8.346c-1.145 0-1.58-.64-2.345-2.4-.765-1.76-1.2-3.533-1.2-4.2V6.3a.9.9 0 011.8 0v4.5a.6.6 0 101.2 0V4.5a.9.9 0 011.8 0v5.7a.6.6 0 101.2 0z"}))}));Ja.displayName="RaiseHandIcon";var Ya=function(e){var t=e.button,n=e.pluginService;return"popover"===t.type?A.default.createElement(i.Popover,{placement:"top",variant:"primary",key:t.label},A.default.createElement(i.PopoverTrigger,null,A.default.createElement(i.Button,{variant:"controls",width:{base:"auto",sm:"auto"},minW:"74px",px:"2",pb:"2",pt:"3",height:{base:"40px",sm:"64px"},borderRadius:8},A.default.createElement(i.Stack,null,A.default.createElement(i.Center,{fontSize:{base:"sm",sm:"xl"}},t.icon),A.default.createElement(i.Text,{fontSize:"xs",marginTop:"0.25em !important",display:{base:"none",sm:"block"}},t.label)))),A.default.createElement(i.PopoverContent,{variant:"controls"},A.default.createElement(i.PopoverArrow,{bg:"secondary.800",boxShadow:"none !important"}),A.default.createElement(i.PopoverCloseButton,{color:"text.100"}),A.default.createElement("iframe",{src:t.url,className:"dyte-iframe",title:"Plugin content",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",ref:function(e){n.pluginManager.addIframeView(t.viewFrame,e)}}))):A.default.createElement(pa,{onClick:t.onClick,icon:t.icon,label:t.label,key:t.label})},Ka=A.default.memo((function(r){var o,a,c,s,u,d,f,p,m,h,g,v,y,b,E=r.leaveCall,S=r.copyLink,w=r.sidebarView,C=r.isSidebarOpen,_=r.openSidebarView,k=r.linkCopied,I=r.isMobile,T=e.useContext(Io).mediaRoom,P=i.useDisclosure(),O=P.isOpen,D=P.onOpen,N=P.onClose,R=e.useContext(Eo).allMuted,M="danger.500",L="text.300",z=e.useContext(ki),B=z.mediaTracks,F=B.screenShareTracks,j=B.setScreenShareTracks,V=z.inputDevices,q=V.toggleAudioState,H=V.toggleVideoState,U=V.audioInputDevices,G=V.videoInputDevices,J=V.speakerOutputDevices,Y=V.onAudioInputChange,X=V.onVideoInputChange,$=V.onSpeakerOutputChange,ee=z.isAudioTrackSilent,te=z.audioPermission,ne=z.videoPermission,re=z.screensharePermission,ie=z.setScreensharePermission,oe=z.permissionModal.onOpen,ae=z.screensharePermissionModal.onOpen,le=e.useContext(Vr),ce=le.meeting,se=le.sessionConfig,ue=Et(),de=(null===(o=se.theme)||void 0===o?void 0:o.dimensions)||ue,fe=de.height,pe=de.width,me=Wn()&&pe>fe,he=t.useSelector((function(e){return e.room.roomViewType})),ge=t.useSelector((function(e){return e.participant.requestToJoinType})),ve=t.useSelector((function(e){return e.consumers.activeConsumers})),ye=t.useSelector((function(e){return e.participant.audioMuted})),be=t.useSelector((function(e){return e.participant.videoOff})),Ee=t.useSelector((function(e){return e.participant.videoTrackSelection})),Se=t.useSelector((function(e){return e.participant.audioTrackSelection})),we=t.useSelector((function(e){return e.participant.speakerTrackSelection})),xe=t.useSelector((function(e){return e.plugin.plugins})),_e=t.useSelector((function(e){return e.participant.sharingScreen})),ke=t.useSelector((function(e){return e.participant.webinarHiddenParticipant}))&&he===ut.webinar;t.useSelector((function(e){return e.participant.audioProduction})),t.useSelector((function(e){return e.participant.videoProduction}));var Ie=t.useSelector((function(e){return e.participant.presentingState})),Te=t.useSelector((function(e){return e.room.chatMessages})),Pe=t.useSelector((function(e){return e.room.requestToJoinPeersList})),Ae=t.useSelector((function(e){return e.room.gridView})),Oe=t.useSelector((function(e){return e.participant.id})),De=Te.filter((function(e){return!0!==e.read&&e.type!==oa.poll&&e.userId!==Oe})),Ne=Pe.filter((function(e){return!0!==e.seen})),Re=Te.filter((function(e){return!0!==e.read&&e.type===oa.poll})),Me=t.useSelector((function(e){return e.participant.requestToJoinStageState})),Le=document.getElementsByClassName("dyte-client-root")[0],ze=e.useState(!1),Be=ze[0],Fe=ze[1],je=Kn().osName,Ve=ce.modules.getAll(),We=t.useSelector((function(e){return e.plugin.controlbar})),qe=e.useState([]),He=qe[0],Ue=qe[1],Ge=e.useState([]),Je=Ge[0],Ye=Ge[1],Ke=se.theme.control_bar.elements,Qe=t.useSelector((function(e){return e.room.pipMode})),Xe=e.useState(!1),$e=Xe[0],et=Xe[1],tt=x.useTranslation().t;e.useEffect((function(){var e=function(){return Fe(!!(document.fullscreenElement||document.mozFullScreenElemen||document.webkitFullscreenElement))};return document.addEventListener("fullscreenchange",e),function(){return document.removeEventListener("fullscreenchange",e)}}),[]),e.useEffect((function(){ce&&(ce.controlBar._setButtons=function(e){Ue(Q([],e,!0))})}),[ce]),e.useEffect((function(){se.permissions.view_type===ut.groupCall&&Me===yt.ACCEPTED&&bt.ask&&T.removePeerFromStage(T.peerid,ft.REQUESTED_BY_PARTICIPANT)}),[se.permissions.view_type]),e.useEffect((function(){var e=Q([],He,!0);We&&We.forEach((function(t){e.push({type:"popover",icon:A.default.createElement("img",{src:t.props.icon,width:28}),label:t.props.label,position:t.props.position,url:t.url,onClick:function(){},viewFrame:t})})),Ye(e)}),[He,We]);var nt=e.useState(!1),rt=nt[0],it=nt[1],ot=e.useState(!1),at=ot[0],lt=ot[1],ct=t.useDispatch(),st=e.useContext(qo),dt=se.permissions.produce,pt=dt.audio,mt=dt.video.allow,ht=ve.filter((function(e){return"video"===e.kind&&e.appData.screenShare})).length<(se.permissions.max_screenshare_count||1);e.useEffect((function(){if(1===De.length&&w!==Na.Chat&&!rt){var e=new Audio("https://dyte-uploads.s3.ap-south-1.amazonaws.com/notification_message.mp3");e.volume=.2;var t=e.play();null==t||t.catch((function(e){jr.warn("notif_play_failed_2",e)})),setTimeout((function(){return it(!1)}),2e3),it(!0)}}),[De.length]),e.useEffect((function(){!I&&at&&lt(!1)}),[I]);var gt={containerRef:{current:document.getElementById("dyte-base-elem")||document.getElementById("dyte-shadow").shadowRoot.getElementById("dyte-base-elem")}},St=I?oo:pa,wt=Zn()&&Wn()?null:Ke.fullscreen&&A.default.createElement(St,{onClick:function(){Be?document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():Le.requestFullscreen?Le.requestFullscreen():Le.mozRequestFullScreen?Le.mozRequestFullScreen():Le.webkitRequestFullscreen?Le.webkitRequestFullscreen():Le.msRequestFullscreen&&Le.msRequestFullscreen()},icon:Be?A.default.createElement(i.Icon,{as:l.FullscreenExit,fill:L}):A.default.createElement(i.Icon,{as:l.Fullscreen,fill:L}),label:tt(Be?"Exit":"Full Screen"),dataCy:"control-bar-fullscreen-button"}),xt=(null===(s=null===(c=null===(a=se.permissions)||void 0===a?void 0:a.produce)||void 0===c?void 0:c.screenshare)||void 0===s?void 0:s.allow)&&Ke.screenshare&&ge!==bt.ask&&A.default.createElement(i.Tooltip,{textAlign:"center",label:0!==xe.length?"Disable the active plugin to screen share.":ht?_e?"Stop sharing screen":"Share your screen":"Someone else is already screen sharing",openDelay:200,placement:"top",maxW:40,portalProps:gt},A.default.createElement("span",null,A.default.createElement(St,{onClick:function(){return K(void 0,void 0,void 0,(function(){var e,t;return Z(this,(function(n){switch(n.label){case 0:if(_e||!ht||re===Si.SYS_DENIED)return[3,5];void 0!==(null==F?void 0:F.video)&&(null==F||F.video.stop()),void 0!==(null==F?void 0:F.audio)&&(null==F||F.audio.stop()),n.label=1;case 1:return n.trys.push([1,3,,4]),Xr.screenShareRequested(),[4,ni()];case 2:return e=n.sent(),j({video:e.video,audio:e.audio}),[3,4];case 3:return(t=n.sent())instanceof DOMException&&qn()&&"NotAllowedError"===t.name&&"Permission denied by system"===t.message?(jr.error("error_screensharing",t.name),ie(Si.SYS_DENIED)):jr.error("error_screensharing",t),[3,4];case 4:return[3,6];case 5:re===Si.SYS_DENIED?ae():(T.disableScreenShare(),j(void 0)),n.label=6;case 6:return[2]}}))}))},icon:_e?A.default.createElement(i.Icon,{as:l.StopScreenShare,fill:"danger.500"}):A.default.createElement(i.Icon,{as:l.ScreenShare,fill:L}),disabled:!(_e||0===xe.length&&ht),label:tt(_e?"Stop Sharing":"Share Screen"),dataCy:"control-bar-share-screen-button"}))),Ct=Ke.layout&&A.default.createElement(St,{onClick:function(){return K(void 0,void 0,void 0,(function(){return Z(this,(function(e){return ct(Ze("multi"===Ae?"highlighted":"multi")),[2]}))}))},icon:"multi"===Ae?A.default.createElement(i.Icon,{as:l.ViewSidebar,fill:L}):A.default.createElement(i.Icon,{as:l.ViewModule,fill:L}),label:tt("Layout"),dataCy:"control-bar-layout-button"}),_t=Ke.chat&&A.default.createElement(St,{onClick:function(){return _(Na.Chat)},isActive:C&&w===Na.Chat,icon:A.default.createElement(i.Icon,{as:l.Chat,fill:L}),badge:0===De.length?"":De.length.toString(),label:tt("Chat"),dataCy:"control-bar-chat-button"}),kt=Ke.polls&&A.default.createElement(St,{onClick:function(){return _(Na.Polls)},isActive:C&&w===Na.Polls,badge:0===Re.length?"":Re.length.toString(),icon:A.default.createElement(i.Icon,{as:l.Poll,fill:L}),label:tt("Polls"),dataCy:"control-bar-polls-button"}),It=Ke.participants&&A.default.createElement(St,{onClick:function(){return _(Na.Participants)},isActive:C&&w===Na.Participants,icon:A.default.createElement(i.Icon,{as:l.Groups,fill:L}),label:tt("Participants"),badge:0===Ne.length?"":Ne.length.toString(),dataCy:"control-bar-participants-button"}),Tt=Ke.plugins&&A.default.createElement(St,{onClick:function(){return _(Na.Plugins)},isActive:C&&w===Na.Plugins,icon:A.default.createElement(i.Icon,{as:Rn,fill:"primary.500"}),label:"cecf293a-dd7f-4490-9464-7bb3d2a14249"===(null===(u=null==ce?void 0:ce.connectionConfig)||void 0===u?void 0:u.clientId)||"52fea1ae-f0ab-4599-af32-da1776f4e7b7"===(null===(d=null==ce?void 0:ce.connectionConfig)||void 0===d?void 0:d.clientId)?"Teach":tt("Plugins"),variant:"alternateDefault"}),Pt={TOGGLE_MIC:["+shift+m","ctrl+shift+m"],TOGGLE_VIDEO:["+shift+v","ctrl+shift+v"]},At=function(e){e.preventDefault(),q()},Ot=function(e){e.preventDefault(),H()};e.useEffect((function(){return W.default(Pt.TOGGLE_MIC.join(","),At),W.default(Pt.TOGGLE_VIDEO.join(","),Ot),function(){W.default.unbind(Pt.TOGGLE_MIC.join(",")),W.default.unbind(Pt.TOGGLE_VIDEO.join(","))}}),[q,H]);var Dt=function(e,t,n){var r="";return t===Si.DENIED?r=e+" permission denied.":0===n.length?r="No "+e+" devices found.":t===Si.FAILED?r="Error occured in getting "+e+".":"Microphone"===e&&!ye&&ee&&(r="We are unable to hear you. Please select a different device instead."),r},Nt=pe<480,Rt=Nt?42:72,Mt="a446c4de-979e-4d4f-97f7-2b695e75ef90"===ce.connectionConfig.clientId?"Go Live":tt("Present"),Lt=Rt+"px";(document.getElementById("dyte-base-elem")||document.getElementById("dyte-shadow").shadowRoot.getElementById("dyte-base-elem")).style.setProperty("--dyte-controlbar-height",Lt);var zt=I&&(Ke.chat||Ke.participants||Ke.polls||Ke.screenshare||Ke.layout||Ke.screenshare||Je.length>0);return A.default.createElement(i.Box,{className:"dyte-client-noSelect",height:Lt,width:"100%",bg:"secondary.1000",style:{position:"absolute",bottom:Nt?"4px":"0px"},py:1},A.default.createElement(i.Flex,{direction:"column",borderRadius:4},A.default.createElement(i.Flex,{justify:"center"},A.default.createElement(i.Flex,{position:"absolute",left:"2"},I||A.default.createElement(A.default.Fragment,null,wt,Ke.invite&&A.default.createElement(pa,{onClick:S,icon:k?A.default.createElement(i.Icon,{as:l.Check,fill:"success.500"}):A.default.createElement(i.Icon,{as:l.Share,fill:L}),label:tt(k?"Link Copied":"Invite"),dataCy:"control-bar-invite-button"}),!ke&&xt,Ct,(null===(f=se.permissions)||void 0===f?void 0:f.can_record)&&A.default.createElement(Ha,{isMobile:!1}),Je.filter((function(e){return"left"===e.position})).map((function(e){return A.default.createElement(Ya,{button:e,pluginService:st})})))),A.default.createElement(i.Flex,{width:pe>480?"auto":"100%",pl:"2",pr:"4",justifyContent:"space-between"},he===ut.webinar&&((null===(p=se.permissions)||void 0===p?void 0:p.can_present)||(null===(m=se.permissions)||void 0===m?void 0:m.request_produce)&&Me===yt.ACCEPTED&&Ie===vt.NOT_PRESENTING)&&A.default.createElement(A.default.Fragment,null,A.default.createElement(pa,{onClick:function(){ke?ct($t()):et(!0)},icon:A.default.createElement(i.Icon,{as:ke?Ua:Ga,fill:ke?L:M}),label:ke?Mt:tt("Stop"),disableHoverEffect:!0}),A.default.createElement(no,{isOpen:$e,onClose:function(){et(!1)},hasBorder:!1},A.default.createElement(i.ModalHeader,{pt:"6"},tt("leave_stage_header")),A.default.createElement(i.ModalFooter,{px:"4",pb:"4",justifyContent:"center"},A.default.createElement(i.Button,{py:"2",flex:"1",variant:"danger",mr:"2",onClick:function(){T.stopPresenting(),et(!1)}},"Yes"),A.default.createElement(i.Button,{py:"2",flex:"1",variant:"solidDark",onClick:function(){return et(!1)}},"No")))),(null===(h=se.permissions)||void 0===h?void 0:h.request_produce)&&A.default.createElement(pa,{onClick:function(){return e=bt.present,void(Me===yt.ACCEPTED?T.removePeerFromStage(T.peerid,ft.REQUESTED_BY_PARTICIPANT):(ct(Kt(yt.INITIATED)),ct(Zt(e))));var e},icon:A.default.createElement(i.Icon,{as:Me===yt.ACCEPTED?Ga:Ja,fill:Me===yt.ACCEPTED?M:L}),disabled:Me===yt.WAITING,label:Me===yt.ACCEPTED?tt("Drop"):tt("Request"),ariaLabel:Me===yt.ACCEPTED?"Drop":"Request",disableHoverEffect:!0}),!I&&(null===(g=se.permissions)||void 0===g?void 0:g.can_allow_participant_audio)&&A.default.createElement(ja,{isOpen:O,onOpen:D,onClose:N,onAudio:function(){T.muteAll(!0),N()},onVideo:function(){T.muteAllVideo(),N()}},A.default.createElement(pa,{onClick:function(){},icon:A.default.createElement(i.Icon,{as:l.VoiceOverOff,fill:L}),label:tt("Mute All")})),!ke&&A.default.createElement(A.default.Fragment,null,pt&&A.default.createElement(i.Tooltip,{textAlign:"center",label:Dt("Microphone",te,U)||!Wn()&&("macOS"===je?"Toggle Mic ( + Shift + M)":"Toggle Mic (Ctrl + Shift + M)"),openDelay:300,placement:"top",maxW:"60",portalProps:gt,isOpen:!(ye||!ee)||void 0},A.default.createElement("span",null,A.default.createElement(pa,{disabled:te===Si.INIT||te===Si.FAILED||te===Si.NOT_APPLICABLE,onClick:te!==Si.ACCEPTED?oe:q,icon:ye||te===Si.INIT?A.default.createElement(i.Icon,{as:l.MicOff,fill:M}):A.default.createElement(i.Icon,{as:l.Mic,fill:L}),label:tt(ye?"Mic Off":"Mic On"),dataCy:"control-bar-toggle-audio-button",ariaLabel:"mute-toggle",permissionWarning:te===Si.DENIED||te===Si.SYS_DENIED,menu:(U.length>0?[{title:tt("Input Microphone Device"),options:U.map((function(e,t){return{children:e.label||"Input "+(t+1),key:e.deviceId||n.nanoid(),value:e.deviceId}})),defaultValue:null==Se?void 0:Se.selectedDeviceId,onChange:Y}]:[]).concat(0===J.length?[]:[{title:tt("Output Speaker Device"),options:J.map((function(e,t){return{children:e.label||"Output "+(t+1),key:e.deviceId||n.nanoid(),value:e.deviceId}})),defaultValue:null==we?void 0:we.selectedDeviceId,onChange:$}]),disableHoverEffect:!0}))),mt&&A.default.createElement(i.Tooltip,{textAlign:"center",label:Dt("Camera",ne,G)||!Wn()&&("macOS"===je?"Toggle Video ( + Shift + V)":"Toggle Video (Ctrl + Shift + V)"),openDelay:300,placement:"top",maxW:60,portalProps:gt},A.default.createElement("span",null,A.default.createElement(pa,{disabled:ne===Si.INIT||ne===Si.FAILED||ne===Si.NOT_APPLICABLE,onClick:ne!==Si.ACCEPTED?oe:H,icon:be||ne===Si.INIT?A.default.createElement(i.Icon,{as:l.VideocamOff,fill:M}):A.default.createElement(i.Icon,{as:l.Videocam,fill:L}),permissionWarning:ne===Si.DENIED||ne===Si.SYS_DENIED,label:tt(be?"Video Off":"Video On"),ariaLabel:"camera-toggle",dataCy:"control-bar-toggle-video-button",menu:G.length>0?[{title:tt("Camera Device"),options:G.map((function(e,t){return{children:A.default.createElement(A.default.Fragment,null,e.label||"Camera "+(t+1)),key:e.deviceId||n.nanoid(),value:e.deviceId}})),defaultValue:null==Ee?void 0:Ee.selectedDeviceId,onChange:X}]:[],disableHoverEffect:!0})))),A.default.createElement(pa,{onClick:E,icon:A.default.createElement(i.Icon,{as:l.CallEnd,fill:M}),label:tt("Leave"),disableHoverEffect:!0,dataCy:"control-bar-leave-button"}),!I&&Je.filter((function(e){return"center"===e.position})).map((function(e){return A.default.createElement(Ya,{button:e,pluginService:st})})),zt&&A.default.createElement(pa,{onClick:function(){lt(!at)},icon:A.default.createElement(i.Icon,{transform:me?"rotate(-90deg)":"",as:at?l.ExpandMore:l.ExpandLess,fill:L}),badge:De.length+Re.length===0?"":(De.length+Re.length).toString(),variant:"primaryDefault",label:tt("More")})),A.default.createElement(i.Flex,{position:"absolute",right:"2"},I||A.default.createElement(A.default.Fragment,null,Je.filter((function(e){return"right"===e.position})).map((function(e){return A.default.createElement(Ya,{button:e,pluginService:st})})),Ve.map((function(e){return!e.hidden&&A.default.createElement(pa,{key:"module_"+e.sidebarComponent.name+"_button",onClick:function(){return _(e.sidebarComponent.name)},isActive:C&&w===e.sidebarComponent.name,icon:e.icon,label:e.sidebarComponent.name})})),_t,kt,It,Tt))),A.default.createElement(i.Flex,{justify:"center"},I&&at&&A.default.createElement(io,{close:function(){return lt(!1)}},A.default.createElement(no,{isOpen:!0,onClose:function(){return lt(!1)},small:!0},A.default.createElement(A.default.Fragment,null,(null===(v=se.permissions)||void 0===v?void 0:v.can_allow_participant_audio)&&A.default.createElement(St,{onClick:function(){return T.muteAll(!0)},icon:A.default.createElement(i.Icon,{as:l.VolumeOff,fill:L}),disabled:R,label:tt(R?"All Muted":"Mute All"),dataCy:"control-bar-mute-all-button"}),wt,Ct,(null===(y=se.permissions)||void 0===y?void 0:y.can_record)&&A.default.createElement(Ha,{isMobile:!0}),Wn()||ke?null:xt,_t,kt,It,Ve.map((function(e){return!e.hidden&&A.default.createElement(St,{key:"module_"+e.sidebarComponent.name+"_button",onClick:function(){return _(e.sidebarComponent.name)},icon:e.icon,label:e.sidebarComponent.name})})),Tt,Yn()&&(null===(b=se.theme.controls)||void 0===b?void 0:b.pip_toggle)&&A.default.createElement(St,{onClick:function(){return ct(Ce(!Qe))},icon:Qe?A.default.createElement(l.DisabledByDefault,{size:"1.5em"}):A.default.createElement(l.PictureInPicture,{size:"1.5em"}),label:tt(Qe?"Disable PIP":"Enable PIP"),dataCy:"control-bar-pip-button"}),Je.map((function(e){return"popover"===e.type?A.default.createElement(Ya,{button:e,pluginService:st}):A.default.createElement(St,{onClick:e.onClick,icon:e.icon,label:e.label,key:e.label})}))))))))}));function Za(){var n=e.useContext(Io).mediaRoom,r=t.useDispatch(),o=t.useSelector((function(e){return e.room.waitlistedPeers}));o.length;return 0===o.length?null:A.default.createElement(i.Modal,{isOpen:!0,onClose:function(){},portalProps:{containerRef:{current:document.getElementById("dyte-base-elem")||document.getElementById("dyte-shadow").shadowRoot.getElementById("dyte-base-elem")}}},A.default.createElement(i.ModalOverlay,null),A.default.createElement(i.ModalContent,{borderRadius:"8px",className:"dyte-client-noSelect",color:"text.100",bg:"secondary.900"},A.default.createElement(i.ModalHeader,null,"Waiting Requests"),A.default.createElement(i.ModalBody,null,A.default.createElement(i.Stack,{spacing:6,height:"80"},o.map((function(e){return A.default.createElement(i.Flex,{direction:"row",alignItems:"center"},A.default.createElement(Ao,{size:"sm",name:e.name}),A.default.createElement(i.Flex,{marginLeft:3,flexGrow:1,alignItems:"center",paddingY:2,borderBottom:"1px solid",borderColor:"secondary.800"},A.default.createElement(i.Text,{color:"text.200",fontSize:"lg"},e.name),A.default.createElement(i.Flex,{marginLeft:"auto"},A.default.createElement(i.IconButton,{variant:"solidDarker",color:"danger.500",size:"md","aria-label":"reject",icon:A.default.createElement(i.Icon,{boxSize:"6",as:l.Close}),_hover:{borderColor:"var(--chakra-colors-danger-500)"},onClick:function(){return t=e.id,r(Je({id:t})),void n.rejectWaitingRequest(t);var t}}),A.default.createElement(i.IconButton,{variant:"solidDarker",color:"primary.300",size:"md","aria-label":"accept",p:1,icon:A.default.createElement(i.Icon,{boxSize:"6",as:l.Check}),_hover:{borderColor:"var(--chakra-colors-primary-500)"},onClick:function(){return t=e.id,r(Je({id:t})),void n.acceptWaitingRequest(t);var t},ml:2}))))}))))))}var Qa=function(e){return"recorder@dyte.in"!==e&&("undefined"==typeof window||!window.location.href.includes("DYTE_BOT"))},Xa=new(function(){function e(){this.errorCallback=null,this.device={id:null,set:!1}}return e.prototype.init=function(){this.audio=document.createElement("audio"),this.audio.autoplay=!0,this.audioStream=new MediaStream,this.audio.srcObject=this.audioStream,this.audioTracks=[]},e.prototype.onError=function(e){this.errorCallback=e},e.prototype.addPeer=function(e){var t=e.audioTrack;null!=t&&(this.audioTracks.some((function(e){return e.id===t.id}))||(this.audioStream.addTrack(t),this.audioTracks.push(t),this.play()))},e.prototype.removePeer=function(e){var t=e.audioTrack;null!=t&&(this.audioStream.removeTrack(t),this.audioTracks=this.audioTracks.filter((function(e){return e.id!==t.id})))},e.prototype.cleanup=function(e){var t=this;this.audioTracks.filter((function(t){return!e.includes(t.id)})).forEach((function(e){t.audioStream.removeTrack(e)})),this.audioTracks=this.audioTracks.filter((function(t){return e.includes(t.id)}))},e.prototype.play=function(){var e,t;return K(this,void 0,void 0,(function(){var n,r=this;return Z(this,(function(i){switch(i.label){case 0:return this.audio.srcObject=this.audioStream,n=this.audio,!this.device.id||this.device.set?[3,2]:[4,null===(e=n.setSinkId)||void 0===e?void 0:e.call(n,this.device.id)];case 1:i.sent(),this.device.set=!0,i.label=2;case 2:return null===(t=this.audio.play())||void 0===t||t.catch((function(e){"NotAllowedError"===e.name&&r.errorCallback&&r.errorCallback(),jr.warn("audio_play_failed",e),Xr.mediaPlaybackFailed("AUDIO")})),[2]}}))}))},e.prototype.setDeviceId=function(e){this.device={id:e,set:!1}},e}()),$a=function(e){return e.isMe?null:e.audioMuted||null==e.audioTrack?(Xa.removePeer(e),null):(Xa.addPeer(e),e.audioTrack.id)};function el(){var n=e.useRef(document.getElementById("dyte-base-elem")||document.getElementById("dyte-shadow").shadowRoot.getElementById("dyte-base-elem")),r=t.useSelector((function(e){return e.participant.email})),o=e.useState("playing"),a=o[0],c=o[1],s=t.useSelector((function(e){return e.participant.speakerTrackSelection})),u=e.useContext(Eo),d=u.joinedProcessedPeers,f=u.screenSharePeers,p=d.concat(f);return e.useEffect((function(){Xa.init(),Xa.play(),Xa.onError((function(){c("aborted")}))}),[]),e.useEffect((function(){var e=p.map($a);Xa.cleanup(e)}),[p]),e.useEffect((function(){(null==s?void 0:s.selectedDeviceId)&&Xa.setDeviceId(s.selectedDeviceId)}),[null==s?void 0:s.selectedDeviceId]),A.default.createElement(A.default.Fragment,null,A.default.createElement(i.Modal,{isOpen:"aborted"===a&&Qa(r),onClose:function(){},portalProps:{containerRef:n},variant:"primary",isCentered:!0},A.default.createElement(i.ModalOverlay,{bg:"secondary.900"}),A.default.createElement(i.ModalContent,{background:"secondary.1000",w:"90%",maxW:"360px",px:"4",py:"6",color:"text.100"},A.default.createElement(i.Text,{fontSize:"2xl",fontWeight:"bold"},"Allow Audio Playback"),A.default.createElement(i.Text,{my:"4"},"In order to play audio properly on your device, click the button below"),A.default.createElement(i.Button,{mt:"2",py:"2",variant:"solid",fontWeight:"semibold",onClick:function(){Xa.play(),c("playing")}},A.default.createElement(l.PlayArrow,{size:"2em"}),"Play Audio"))))}function tl(n){var r=n.isMobile,o=t.useSelector((function(e){return e.room.roomViewType})),a=t.useSelector((function(e){return e.participant.requestToJoinStageState})),l=t.useSelector((function(e){return e.participant.requestToJoinType})),c=e.useContext(Io).mediaRoom,s=t.useDispatch(),u=o===ut.webinar&&a===yt.INITIATED;return A.default.createElement(i.Modal,{isOpen:u,onClose:function(){},size:"lg",portalProps:{containerRef:{current:document.getElementById("dyte-base-elem")||document.getElementById("dyte-shadow").shadowRoot.getElementById("dyte-base-elem")}}},A.default.createElement(i.ModalOverlay,{bg:"primary.400",opacity:".4"}),A.default.createElement(i.ModalContent,{borderRadius:"8px",className:"dyte-client-noSelect",color:"text.100",bg:"secondary.1000"},A.default.createElement(i.ModalHeader,{paddingBottom:".5em",textAlign:"center"},l===bt.ask&&"Request to Ask",l===bt.present&&"Request to Present"),A.default.createElement(i.ModalBody,{paddingBottom:"2.5em"},A.default.createElement(i.Flex,{direction:r?"column":"row",justifyContent:"space-between"},A.default.createElement(i.Button,{width:r?"100%":"48%",my:"0.5em",py:"0.25em",variant:"danger",fontWeight:"600",size:"md",onClick:function(){s(Kt(yt.NONE)),s(Zt(void 0))},"aria-label":"cancel-present-request"},"Cancel"),A.default.createElement(i.Button,{width:r?"100%":"48%",my:"0.5em",py:"0.4em",size:"md",fontSize:"md",onClick:function(){s(Kt(yt.WAITING)),c.requestToJoinStage(l),lt({title:"Requested successfully",status:"success",duration:5e3,isClosable:!0,position:"top"})},"aria-label":"confirm-present-request"},"Confirm & Request")))))}var nl=function(t){var n=t.isMobile,r=e.useContext(Eo),o=r.joinedProcessedPeers,a=r.selfPeer,l=o.concat([a]).filter((function(e){return!e.webinarHiddenParticipant&&e.requestToJoinType===bt.ask}));return A.default.createElement(i.Flex,{direction:"row",position:"absolute",zIndex:"3",padding:"20px 12px 20px 20px",alignItems:"flex-end",justifyContent:"flex-end",bottom:"64px",right:"64px"},l.map((function(e){return A.default.createElement(i.Box,{key:e.id,zIndex:3},A.default.createElement(No,{peer:e,height:n?"80px":"120px",width:n?"130px":"200px",pipMode:!0}))})))};function rl(e){var t=e.deviceName,n=e.value,r=e.onChange,o=e.inputDevices,a=e.showLabel,c=x.useTranslation().t,s=null,u="";return t.includes(c("Camera"))&&(s=l.Videocam,u="Camera"),t.includes(c("Microphone"))&&(s=l.Mic,u="Input"),t.includes(c("Speaker"))&&(s=l.VolumeUp,u="Output"),A.default.createElement(i.Box,{zIndex:10},A.default.createElement(i.Menu,null,(function(e){var c=e.isOpen;return A.default.createElement(A.default.Fragment,null,A.default.createElement(i.MenuButton,{fontSize:"sm",as:i.Button,size:"sm",variant:"",color:"text.400",isActive:c,iconSpacing:"0.5em",rightIcon:A.default.createElement(i.Icon,{as:c?l.ExpandLess:l.ExpandMore,fill:"text.400",boxSize:a?5:8}),leftIcon:A.default.createElement(i.Icon,{as:s,fill:"text.400",boxSize:a?5:8})},a&&t),A.default.createElement(i.MenuList,{fontSize:"sm"},A.default.createElement(i.MenuOptionGroup,{value:n,onChange:r},o.map((function(e,t){return A.default.createElement(i.MenuItemOption,{key:e.deviceId,value:e.deviceId,iconSpacing:"1em"},e.label||u+" "+(t+1))})))))})))}nl.defaultProps={isMobile:!1};var il=e.memo((function(e){if("macOS"===Fn().getOSName())return null;var t=Hn();if(!t&&qn()||t&&Zn())return null;return A.default.createElement(i.Alert,{className:"permission-denied-alert",status:"warning",my:"1em",borderRadius:"md",width:"fit-content"},A.default.createElement(i.AlertIcon,null),A.default.createElement(i.Flex,{flexDirection:"column"},e.height>400&&e.width<800&&A.default.createElement(i.AlertTitle,{color:"secondary.900"},function(){var e=Kn();return"It looks like you are using "+e.browserName+" on "+e.osName}()),A.default.createElement(i.AlertDescription,{color:"secondary.900"},"For the best experience, switch to"," ",t?"Safari":"Google Chrome")))}));function ol(n){var r,o=n.children,a=n.scroll,c=n.shouldSetupStreams,s=n.showBrowserWarnings,u=n.maxWidth,d=n.height,f=e.useContext(Vr).sessionConfig,p=Et(),m=((null===(r=f.theme)||void 0===r?void 0:r.dimensions)||p).width,h=x.useTranslation().t,g=Math.floor(3*m/9);m<1024&&m>768?g=Math.floor(4*m/9):m<768&&(g=Math.floor(7*m/9)),u&&g>u&&(g=u);var v=Math.floor(9*g/16);d<600&&m>460&&m<768&&(v=Math.floor(3*d/8),g=Math.floor(7*v/4)),d<400&&m>460&&m<768&&(v=Math.floor(4*d/8),g=Math.floor(8*v/4));var y=t.useSelector((function(e){return e.participant.id})),b=t.useSelector((function(e){return e.participant.videoOff})),E=t.useSelector((function(e){return e.participant.audioMuted})),S=t.useSelector((function(e){return e.participant.displayName})),w=t.useSelector((function(e){return e.participant.device})),C=t.useSelector((function(e){return e.participant.videoProduction})),_=t.useSelector((function(e){return e.participant.audioProduction})),k=t.useSelector((function(e){return e.participant.audioTrackSelection})),I=t.useSelector((function(e){return e.participant.videoTrackSelection})),T=t.useSelector((function(e){return e.participant.speakerTrackSelection})),P=e.useContext(ki),O=P.mediaTracks,D=O.webcamTrack,N=O.audioTrack,R=P.inputDevices,M=R.audioInputDevices,L=R.videoInputDevices,z=R.speakerOutputDevices,B=R.onAudioInputChange,F=R.onVideoInputChange,j=R.onSpeakerOutputChange,V=R.toggleAudioState,q=R.toggleVideoState,H=P.setupStreams,U=P.isAudioTrackSilent,G=P.audioPermission,Y=P.videoPermission,K=P.permissionModal.onOpen;e.useEffect((function(){c&&H()}),[]);var Z=f.permissions.produce,Q=Z.audio,X=Z.video.allow,ee=function(){var e="",t="";return Y===Si.DENIED&&G===Si.DENIED?(e="Camera & Mic permissions denied. ",t="both"):Y===Si.DENIED?(e="Camera permission denied.",t="camera"):G===Si.DENIED?(e="Microphone permission denied.",t="microphone"):!X||0!==L.length&&Y!==Si.NOTFOUND?!Q||0!==M.length&&G!==Si.NOTFOUND?Y===Si.FAILED?(e="Check if any other application is using the camera.",t="camera"):G===Si.FAILED?(e="Check if any other application is using the microphone.",t="microphone"):!E&&U&&(e="We are unable to hear you. Please select a different device instead.",t="microphone"):(e="No microphone found. Check if any other application is using the microphone.",t="microphone"):(e="No camera devices found. Check if any other application is using the camera.",t="camera"),{deviceError:t,message:e}},te=[];m<800&&te.push("mw800"),m<460&&te.push("mw460"),d<600&&te.push("mh600"),d<400&&te.push("mh400");var ne={id:y,device:w,displayName:S,audioMuted:E,videoVisible:!b,videoTrack:D,audioTrack:N,isMe:!0,metadata:null},re=a?{overflow:"scroll",className:"dyte-client-noScrollbar"}:{},ie={TOGGLE_MIC:["cmd+shift+m","ctrl+shift+m"],TOGGLE_VIDEO:["cmd+shift+v","ctrl+shift+v"]},oe=function(e){e.preventDefault(),V()},ae=function(e){e.preventDefault(),q()};e.useEffect((function(){return W.default(ie.TOGGLE_MIC.join(","),oe),W.default(ie.TOGGLE_VIDEO.join(","),ae),function(){W.default.unbind(ie.TOGGLE_MIC.join(",")),W.default.unbind(ie.TOGGLE_VIDEO.join(","))}}),[V,q]);var le=Kn(),ce=le.isMobile,se=le.osName,ue={containerRef:{current:document.getElementById("dyte-base-elem")||document.getElementById("dyte-shadow").shadowRoot.getElementById("dyte-base-elem")}};return A.default.createElement(i.Flex,J({flexDirection:"column",overflowY:"scroll",width:m,overflowX:"hidden",className:"dyte-client-noScrollbar"},re),A.default.createElement(i.Flex,{alignItems:"center",width:"100%",className:"make-session-layout "+te.join(" "),overflowX:"hidden",height:d,align:d<400&&m>460?"flex-start":"center",justifyContent:d<480&&m<460?"flex-start":"center"},A.default.createElement(i.Box,{width:g,display:"flex",flexDirection:"column",alignItems:"center"},A.default.createElement(No,{height:v,width:g,peer:ne},Q&&A.default.createElement(i.Tooltip,{textAlign:"center",label:"microphone"===ee().deviceError?ee().message:!ce&&("macOS"===se?"Toggle Mic ( + Shift + M)":"Toggle Mic (Ctrl + Shift + M)"),openDelay:800,placement:"top",maxW:60,portalProps:ue},A.default.createElement(i.IconButton,{borderRadius:"4px",backgroundColor:"secondary.900",disabled:_===$.NOT_APPLICABLE||G===Si.INIT,variant:"controls",size:m>460?"lg":"sm",onClick:V,icon:E||G===Si.INIT?A.default.createElement(i.Icon,{as:l.MicOff,boxSize:"6",fill:"danger.500"}):A.default.createElement(i.Icon,{as:l.Mic,boxSize:"6",fill:"text.200"}),"aria-label":"mute-toggle"})),X&&A.default.createElement(i.Tooltip,{textAlign:"center",label:"camera"===ee().deviceError?ee().message:!ce&&("macOS"===se?"Toggle Video ( + Shift + V)":"Toggle Video (Ctrl + Shift + V)"),openDelay:800,placement:"top",maxW:60,portalProps:ue},A.default.createElement(i.IconButton,{borderRadius:"4px",backgroundColor:"secondary.900",disabled:C===$.NOT_APPLICABLE||Y===Si.INIT,variant:"controls",size:m>460?"lg":"sm",onClick:q,icon:b||Y===Si.INIT?A.default.createElement(i.Icon,{as:l.VideocamOff,boxSize:"6",fill:"danger.500"}):A.default.createElement(i.Icon,{as:l.Videocam,boxSize:"6",fill:"text.200"}),"aria-label":"camera-toggle"}))),A.default.createElement(i.Flex,{justify:"space-between",marginTop:"1em"},M.length>0&&Q&&A.default.createElement(rl,{deviceName:h("Microphone"),value:null==k?void 0:k.selectedDeviceId,onChange:B,inputDevices:M,showLabel:m>560}),L.length>0&&X&&A.default.createElement(rl,{deviceName:h("Camera"),value:null==I?void 0:I.selectedDeviceId,onChange:F,inputDevices:L,showLabel:m>560}),z.length>0&&A.default.createElement(rl,{deviceName:h("Speaker"),value:null==T?void 0:T.selectedDeviceId,onChange:j,inputDevices:z,showLabel:m>560})),A.default.createElement(i.Flex,null,s&&G!==Si.INIT&&Y!==Si.INIT&&function(){var e=ee(),t=e.deviceError,n=e.message;return""!==t?A.default.createElement(i.Alert,{className:"permission-denied-alert "+te.join(" "),status:"error",my:"1em",borderRadius:"md",color:"gray.800"},A.default.createElement(i.HStack,{justify:"space-between",flex:1},A.default.createElement(i.HStack,null,d>400&&m>800&&A.default.createElement(i.AlertIcon,null),A.default.createElement(i.AlertDescription,null,n)),A.default.createElement(i.Flex,{direction:"row",alignItems:"center"},(G===Si.DENIED||Y===Si.DENIED)&&d>400&&m>800?A.default.createElement(i.Button,{className:"permission-denied-alert-button "+te.join(" "),variant:"danger",onClick:K},"Help?"):A.default.createElement(i.AlertIcon,{cursor:"pointer",onClick:K})))):A.default.createElement(A.default.Fragment,null)}()),s&&A.default.createElement(il,{height:d,width:m})),s&&A.default.createElement(i.Box,{className:"make-session-spacer "+te.join(" ")}),!!o&&A.default.createElement(i.Box,{m:0,width:"fit-content"},o)))}function al(n){var r,o,a=n.isMobile,l=t.useSelector((function(e){return e.room.roomViewType})),c=t.useSelector((function(e){return e.participant.presentingState})),s=e.useContext(Io).mediaRoom,u=e.useContext(Vr),d=u.meeting,f=u.sessionConfig,p=t.useSelector((function(e){return e.participant.requestToJoinType})),m=t.useDispatch(),h=l===ut.webinar&&c===vt.INITIATED,g=null===(r=f.permissions)||void 0===r?void 0:r.accept_present_requests;return A.default.createElement(i.Modal,{isOpen:h,onClose:function(){},size:"2xl",scrollBehavior:"outside",portalProps:{containerRef:{current:document.getElementById("dyte-base-elem")||document.getElementById("dyte-shadow").shadowRoot.getElementById("dyte-base-elem")}}},A.default.createElement(i.ModalOverlay,{bg:"rgba(0,0,0,0.8)"}),A.default.createElement(i.ModalContent,{borderRadius:"8px",className:"dyte-client-noSelect",color:"text.100",bg:"secondary.1000"},A.default.createElement(i.ModalBody,{py:"1em"},A.default.createElement(i.VStack,null,A.default.createElement(ol,{shouldSetupStreams:!1,showBrowserWarnings:!1,maxWidth:500,height:300}),A.default.createElement(i.Flex,{direction:a?"column":"row",justifyContent:"space-between",width:"100%"},A.default.createElement(i.Button,{width:a?"100%":"48%",my:"0.5em",variant:"danger",px:"2em",fontWeight:"600",size:"md",onClick:function(){var e;(null===(e=f.permissions)||void 0===e?void 0:e.accept_present_requests)?m(Xt()):s.removePeerFromStage(s.peerid,ft.REQUESTED_BY_PARTICIPANT)},"aria-label":"cancel-present"},"Cancel"),A.default.createElement(i.Button,{width:a?"100%":"48%",my:"0.5em",size:"md",px:"2em",fontSize:"md",onClick:function(){s.startPresenting()},"aria-label":"start-present"},(o="Join and\n\t\t"+(p===bt.present?"Present":"Ask"),g&&(o="a446c4de-979e-4d4f-97f7-2b695e75ef90"===d.connectionConfig.clientId?"Go Live":"Start Presenting"),o)))))))}ol.defaultProps={scroll:!1,children:!1,shouldSetupStreams:!0,showBrowserWarnings:!0,maxWidth:null};var ll=A.default.memo((function(n){var r=t.useDispatch(),i=e.useContext(Vr),o=i.meeting,a=i.processPreset,l=i.sessionConfig;t.useStore().getState;var c=t.useSelector((function(e){return e.room.roomViewType})),s=t.useSelector((function(e){return e.participant.webinarHiddenParticipant}))&&c===Ar.webinar,u=t.useSelector((function(e){return e.room.initialGUMFetch})),d=t.useSelector((function(e){return e.room.producersState})),f=t.useSelector((function(e){return e.room.legacyMode})),p=t.useSelector((function(e){return e.room.joined})),m=t.useSelector((function(e){return e.participant.hidden})),h=t.useSelector((function(e){return e.plugin.main})),g=t.useSelector((function(e){return e.participant.preset})),v=t.useSelector((function(e){return e.participant.audioMuted})),y=t.useSelector((function(e){return e.peers.recordingPeer})),b=e.useRef(!1),E=e.useContext(Io).mediaRoom,S=e.useContext(ki).mediaTracks,w=S.audioTrack,x=S.webcamTrack,C=S.processedWebcamTrack,_=S.screenShareTracks,k=S.setScreenShareTracks,I=t.useSelector((function(e){return e.consumers.activeConsumers})).filter((function(e){return"video"===e.kind&&e.appData.screenShare})).length<(l.permissions.max_screenshare_count||1);e.useEffect((function(){y?(null==o||o.emit(o.Events.recordingStarted),b.current=!0):b.current&&(b.current=!1,null==o||o.emit(o.Events.recordingStopped))}),[y]),e.useEffect((function(){E&&d===$.LOADED&&K(void 0,void 0,void 0,(function(){return Z(this,(function(e){return f!==E.legacyMode&&(E.legacyMode=f,E.resetVideoProducers(x,null==_?void 0:_.video)),[2]}))}))}),[f,d]),e.useEffect((function(){o.plugins.forEach((function(e,t){o.plugins[t].isActivated=!!h.find((function(t){return t.plugin===e.id}))}))}),[h.length]),e.useEffect((function(){d===$.NOT_STARTED&&p&&u&&!m&&!s?(E.hidden||(E.getMesssages(),E.getPolls()),E.hidden=!1,K(void 0,void 0,void 0,(function(){return Z(this,(function(e){switch(e.label){case 0:return r(Oe($.CONNECTING)),C?[4,E.shareWebcam(C)]:[3,2];case 1:return e.sent(),[3,4];case 2:return x?[4,E.shareWebcam(x)]:[3,4];case 3:e.sent(),e.label=4;case 4:return w?[4,E.shareMic(w,v)]:[3,6];case 5:e.sent(),e.label=6;case 6:return _?[4,E.shareScreen(_)]:[3,8];case 7:e.sent(),e.label=8;case 8:return r(Oe($.LOADED)),null==o||o.emit(o.Events.localMediaConnected),[2]}}))}))):s&&E.hidden!==s&&(E.hidden=!0,E.stopAllProducers(!0),r(Oe($.NOT_STARTED)))}),[d,p,u,m,s]),e.useEffect((function(){g&&a(g)}),[g]),e.useEffect((function(){!I&&_?(void 0!==(null==_?void 0:_.video)&&(null==_||_.video.stop()),void 0!==(null==_?void 0:_.audio)&&(null==_||_.audio.stop()),k(void 0),lt({description:"Screensharing already started",status:"error",duration:5e3,isClosable:!0,position:"top"})):_&&E.shareScreen(_)}),[_]);var T=function(){return K(void 0,void 0,void 0,(function(){return Z(this,(function(e){return E.disableScreenShare(),k(void 0),[2]}))}))};return e.useEffect((function(){var e;return null===(e=null==_?void 0:_.video)||void 0===e||e.addEventListener("ended",T),function(){var e;null===(e=null==_?void 0:_.video)||void 0===e||e.removeEventListener("ended",T)}}),[_]),null}));function cl(e){return"top"===e}function sl(e){return"bottom"===e}function ul(e){return"left"===e}function dl(e){return"right"===e}function fl(){return"undefined"!=typeof window}var pl=function(e){function t(t){var n=e.call(this,t)||this;return n.MAX_NEGATIVE_SCROLL=20,n.SCROLL_TO_CLOSE=75,n.ALLOW_DRAWER_TRANSFORM=!0,n.getNegativeScroll=function(e){var t=n.props.direction,r=n.getElementSize();sl(t)||cl(t)?n.NEGATIVE_SCROLL=r-e.scrollHeight-n.MAX_NEGATIVE_SCROLL:n.NEGATIVE_SCROLL=r-e.scrollWidth-n.MAX_NEGATIVE_SCROLL},n.getDrawerTransform=function(e){var t=n.props.direction;return sl(t)?{transform:"translate3d(0, "+e+"px, 0)"}:cl(t)?{transform:"translate3d(0, -"+e+"px, 0)"}:ul(t)?{transform:"translate3d(-"+Math.abs(e)+"px, 0, 0)"}:dl(t)?{transform:"translate3d("+e+"px, 0, 0)"}:null},n.getElementSize=function(){var e=n.props.direction;return fl()?sl(e)||cl(e)?window.innerHeight:window.innerWidth:null},n.shouldWeCloseDrawer=function(){var e=n.state.start,t=n.props.direction,r=0;return dl(t)&&(r=n.drawer.scrollWidth),n.MOVING_POSITION!==r&&(dl(t)?n.NEW_POSITION<r&&n.MOVING_POSITION-e>n.SCROLL_TO_CLOSE:ul(t)||cl(t)?n.NEW_POSITION>=r&&e-n.MOVING_POSITION>n.SCROLL_TO_CLOSE:n.NEW_POSITION>=r&&n.MOVING_POSITION-e>n.SCROLL_TO_CLOSE)},n.hideDrawer=function(){var e=n.props,t=e.allowClose,r=e.onRequestClose,i=e.direction,o=0;return dl(i)&&(o=n.drawer.scrollWidth),!1===t?n.setState((function(){return{position:o,thumb:0,touching:!1}})):(n.setState((function(){return{position:o,touching:!1}})),n.removeListeners(),r(),null)},n.release=function(e){var t=n.props.direction;if(n.setState((function(){return{touching:!1}})),n.shouldWeCloseDrawer())n.hideDrawer();else{var r=0;dl(t)&&(r=n.drawer.scrollWidth),n.setState((function(){return{position:r}}))}},n.drag=function(e){var t=n.props.direction,r=n.state,i=r.thumb;r.start;var o=r.position,a=e.touches[0],l=a.pageY,c=a.pageX,s=sl(t)||cl(t)?l:c,u=s-i,d=sl(t)?o+u:o-u;if(d>0&&n.ALLOW_DRAWER_TRANSFORM){e.preventDefault();var f=n.props,p=f.onDrag,m=f.notifyWillClose;p({newPosition:d}),n.MOVING_POSITION=s,n.NEW_POSITION=d;var h=0;dl(t)&&(h=n.drawer.scrollWidth),d<h&&n.shouldWeCloseDrawer()?m(!0):m(!1),n.NEGATIVE_SCROLL<d&&n.setState((function(){return{thumb:s,position:h>0?Math.min(d,h):d}}))}},n.tap=function(e){var t=e.touches[0],r=t.pageY,i=t.pageX,o=n.props.direction,a=sl(o)||cl(o)?r:i;n.NEW_POSITION=0,n.MOVING_POSITION=0,n.setState((function(){return{thumb:a,start:a,touching:!0}}))},n.removeListeners=function(){n.drawer&&(n.drawer.removeEventListener("touchend",n.release),n.drawer.removeEventListener("touchmove",n.drag),n.drawer.removeEventListener("touchstart",n.tap),n.setState({listenersAttached:!1}))},n.attachListeners=function(e){var t=n.props,r=t.dontApplyListeners,i=t.getModalRef,o=t.direction,a=n.state.listenersAttached;if(e&&!a&&!r){n.drawer=e,i(e),n.drawer.addEventListener("touchend",n.release),n.drawer.addEventListener("touchmove",n.drag),n.drawer.addEventListener("touchstart",n.tap);var l=0;dl(o)&&(l=e.scrollWidth),n.setState({listenersAttached:!0,position:l},(function(){setTimeout((function(){n.drawer.style.display="none",n.drawer.offsetHeight,n.drawer.style.display=""}),300)}))}},n.inViewportChange=function(e){(0,n.props.inViewportChange)(e),n.ALLOW_DRAWER_TRANSFORM=e},n.preventDefault=function(e){return e.preventDefault()},n.stopPropagation=function(e){return e.stopPropagation()},n.state={open:t.open,thumb:0,start:0,position:0,touching:!1,listenersAttached:!1},n}return U(t,e),t.prototype.componentDidUpdate=function(e,t){var n=this,r=this.props.open;!r&&e.open&&(this.removeListeners(),setTimeout((function(){n.setState((function(){return{open:!1}}))}),300)),this.drawer&&this.getNegativeScroll(this.drawer);var i=this.props.onOpen;r&&!e.open&&(i(),this.setState((function(){return{open:!0}})))},t.prototype.componentWillUnmount=function(){this.removeListeners()},t.prototype.getPosition=function(e){var t=this.state.position;return dl(this.props.direction)?e-t:t},t.prototype.render=function(){var e,t=this.props;t.containerElementClass;var n=t.containerOpacity;t.dontApplyListeners;var r=t.id,i=t.getContainerRef;t.getModalRef;var o=t.direction,a=t.height,l=t.width,c=t.hasDimensions,s=this.state.open&&this.props.open;if(!this.state.open&&!this.props.open||!fl())return null;this.state.touching;var u=this.getElementSize(),d=this.getPosition(u),f={backgroundColor:"rgba(55, 56, 56, "+(s?n:0)+")",position:c?"absolute":"fixed",top:0,left:0,right:0,bottom:0,display:"flex",justifyContent:"center",flexShrink:0,alignItems:"center",zIndex:1011,width:l,height:a};return dl(o)&&Object.assign(f,{overflowX:"hidden"}),E.createPortal(A.default.createElement("div",{id:r,style:f,onClick:this.hideDrawer,ref:i},A.default.createElement(q.default,{style:{position:"absolute",top:0,height:1,width:"100%"},onChange:this.inViewportChange}),A.default.createElement("div",{onClick:this.stopPropagation,style:this.getDrawerTransform(s?d:u),ref:this.attachListeners,className:this.props.modalElementClass.toString()||""},this.props.children)),(null===(e=document.getElementById("dyte-shadow"))||void 0===e?void 0:e.shadowRoot.getElementById("dyte-base-elem"))||document.getElementById("dyte-base-elem")||window.document.body)},t.defaultProps={id:"dyte-client-drawer",notifyWillClose:function(){},onOpen:function(){},onDrag:function(){},inViewportChange:function(){},onRequestClose:function(){},getContainerRef:function(){},getModalRef:function(){},containerOpacity:.6,direction:"bottom",parentElement:null,allowClose:!0,dontApplyListeners:!1,containerElementClass:"",modalElementClass:""},t}(e.Component),ml=function(n){var r,o,a=n.isOpen,c=n.onClose,s=n.view,u=e.useState(0),d=u[0],f=u[1],p=e.useContext(Vr),m=p.meeting,h=p.sessionConfig;t.useSelector((function(e){return e.room.roomViewType}));var g=m.modules.getAll(),v=h.theme.control_bar.elements.chat?0:1,y=v+(h.theme.control_bar.elements.participants?0:1),b=y+(h.theme.control_bar.elements.polls?0:1),E=b+(h.theme.control_bar.elements.plugins?0:1),S=function(e){if(e===Na.Chat)f(0);else if(e===Na.Participants)f(1-v);else if(e===Na.Polls)f(2-y);else if(e===Na.Plugins)f(3-b);else{var t=g.filter((function(e){return!e.hidden})).findIndex((function(e){return e.sidebarComponent.name}));f(4+t-E)}};e.useEffect((function(){s&&S(s)}),[s]);var w=Et(),x=(null===(r=h.theme)||void 0===r?void 0:r.dimensions)||w,C=x.height,_=x.width;return A.default.createElement(pl,{open:a,modalElementClass:"dyte-client-mobileDrawer",onRequestClose:function(){return c()},height:C,width:_,hasDimensions:!!(null===(o=h.theme)||void 0===o?void 0:o.dimensions)},A.default.createElement(i.Tabs,{height:"100%",display:"flex",flexDir:"column",variant:"solid-rounded",index:d,onChange:function(e){return f(e)}},A.default.createElement(i.TabList,{mb:2,px:4,pt:2,dislay:"flex",justifyContent:"space-between"},A.default.createElement(i.Flex,null,h.theme.control_bar.elements.chat&&A.default.createElement(i.Tab,{backgroundColor:"transparent",_selected:{backgroundColor:"secondary.800"}},A.default.createElement(i.Icon,{as:l.Chat,fill:"text.100",boxSize:6})),h.theme.control_bar.elements.participants&&A.default.createElement(i.Tab,{backgroundColor:"transparent",_selected:{backgroundColor:"secondary.800"}},A.default.createElement(i.Icon,{as:l.Groups,fill:"text.100",boxSize:6})),h.theme.control_bar.elements.polls&&A.default.createElement(i.Tab,{backgroundColor:"transparent",_selected:{backgroundColor:"secondary.800"}},A.default.createElement(i.Icon,{as:l.Poll,fill:"text.100",boxSize:6})),h.theme.control_bar.elements.plugins&&A.default.createElement(i.Tab,{backgroundColor:"transparent",_selected:{backgroundColor:"secondary.800"}},A.default.createElement(i.Icon,{as:Rn,fill:"primary.500",boxSize:6})),!Wn()&&g.map((function(e){return!e.hidden&&A.default.createElement(i.Tab,{backgroundColor:"transparent",_selected:{backgroundColor:"secondary.800"}},e.icon)}))),A.default.createElement(i.Box,{px:"1em",py:"0.5em",onClick:function(){return c()},cursor:"pointer"},A.default.createElement(i.Icon,{as:l.Close,fill:"text.100",boxSize:6}))),A.default.createElement(i.Divider,null),A.default.createElement(i.TabPanels,{height:"100%",maxH:"90%",flex:1,display:"flex",flexDirection:"column"},h.theme.control_bar.elements.chat&&A.default.createElement(i.TabPanel,{height:"100%",flex:1},A.default.createElement(Aa,{openSidebarView:S,active:0===d})),h.theme.control_bar.elements.participants&&A.default.createElement(i.TabPanel,{height:"100%",flex:1},A.default.createElement(Da,null)),h.theme.control_bar.elements.polls&&A.default.createElement(i.TabPanel,{height:"100%",flex:1},A.default.createElement(va,{active:2===d})),h.theme.control_bar.elements.plugins&&A.default.createElement(i.TabPanel,{height:"100%",flex:1},A.default.createElement(za,{openSidebarView:S})),!Wn()&&g.map((function(e){return!e.hidden&&A.default.createElement(i.TabPanel,{height:"100%",flex:1},A.default.createElement(e.sidebarComponent.component,null))})))))},hl=A.default.memo((function(n){var r,o,a,l,c,s,u,d,f=i.useDisclosure(),p=f.isOpen,m=f.onClose,h=f.onOpen,g=n.roomName,v=e.useContext(Vr),y=v.sessionConfig,b=v.meeting,E=t.useSelector((function(e){return e.room.roomDisplayTitle})),S=t.useSelector((function(e){return e.plugin.main})),w=i.useDisclosure(),x=w.isOpen,C=w.onClose,_=w.onOpen,k=e.useState(Na.None),I=k[0],T=k[1],P=Et(),O=(null===(o=y.theme)||void 0===o?void 0:o.dimensions)||P,D=O.height,N=O.width,R=e.useState(null),M=R[0],L=R[1],z=e.useState(null),B=z[0],F=z[1],j=i.useClipboard(window.location.href.replace("/stage/","/join/")),V=j.onCopy,W=j.hasCopied,q=N<1024,H=function(e){if(e===I)return T(Na.None),b.activeSidebarTab=Na.None,void(q||C());T(e),q||_(),b.activeSidebarTab=e};e.useEffect((function(){I!==Na.None&&(q?C():_())}),[q]);var U=380;N<=1400&&(U=300);var G=N>D,J=Wn()&&G;J&&(N=(r=[D,N])[0],D=r[1]);var Y=x?N-U:N;null===(l=((null===(a=document.getElementById("dyte-shadow"))||void 0===a?void 0:a.shadowRoot)||document).getElementById("dyte-base-elem"))||void 0===l||l.style.setProperty("--dyte-main-width",Y+"px");var K=N<480?42:72,Z=D-((null===(c=y.theme)||void 0===c?void 0:c.control_bar.is_enabled)?K:0),Q=D-((null===(s=y.theme)||void 0===s?void 0:s.header.is_enabled)?40:0),X="rotate("+(J?-90:0)+"deg)",$=Math.floor(N/2)+"px "+Math.floor(N/2)+"px",ee={position:"absolute",zIndex:10,top:y.theme.header.is_enabled?40:0,left:0,width:"var(--dyte-main-width)",height:"calc("+Q+"px - var(--dyte-controlbar-height))"};e.useEffect((function(){b&&(b.grid.setOverlay=function(e,t){L(null==e?null:"string"==typeof e?A.default.createElement("div",{style:ee,dangerouslySetInnerHTML:{__html:e}}):A.default.createElement("div",{style:ee},e)),t&&setTimeout((function(){L(null)}),t)},b.createPopup=function(e){F(e)},b.openChatView=function(){I!==Na.Chat&&H(Na.Chat)},b.closeChatView=function(){I===Na.Chat&&H(Na.Chat)})}),[b,I]);var te=A.default.createElement(no,{isOpen:!!B,onClose:function(){return F(null)}},B);return A.default.createElement(i.Flex,{direction:"column",bg:"secondary.900",height:D,width:N,transform:X,transformOrigin:$},A.default.createElement(i.Flex,{direction:"row"},A.default.createElement(ll,null),A.default.createElement(i.Flex,{direction:"column",width:Y},te,M,A.default.createElement(fa,{isOpen:p,onClose:m}),(null===(u=y.theme)||void 0===u?void 0:u.header.is_enabled)&&A.default.createElement(da,{title:""!==E?E:g,linkCopied:W,copyLink:V,isMobile:q}),A.default.createElement(i.Box,{position:"relative"},A.default.createElement(nl,{isMobile:q}),A.default.createElement(Do,null,A.default.createElement(ea,{widthOffset:x?U:0,singleSpeakerView:S.length>0&&!q})),A.default.createElement(el,null),A.default.createElement(i.Spacer,null))),A.default.createElement(i.Box,{bg:"secondary.1000",display:x?"unset":"none",zIndex:"1",height:Z,width:x?U:0},A.default.createElement(Fa,{activeTab:I,openSidebarView:H}))),(null===(d=y.theme)||void 0===d?void 0:d.control_bar.is_enabled)&&A.default.createElement(Ka,{sidebarView:I,isSidebarOpen:x,openSidebarView:H,linkCopied:W,copyLink:V,isMobile:q,leaveCall:h}),q&&A.default.createElement(ml,{isOpen:I!==Na.None,view:I,onClose:function(){return H(I)}}),A.default.createElement(Za,null),A.default.createElement(tl,{isMobile:q}),A.default.createElement(al,{isMobile:q}))}));function gl(){var n,r,o=t.useSelector((function(e){return e.room.roomDisplayTitle})),a=t.useSelector((function(e){return e.room.roomName})),c=i.useClipboard(window.location.href.replace("/stage/","/join/")),s=c.onCopy,u=c.hasCopied,d=e.useContext(Vr).sessionConfig,f=Et(),p=(null===(r=d.theme)||void 0===r?void 0:r.dimensions)||f,m=p.height,h=p.width,g=h<1024,v=t.useSelector((function(e){return e.participant.videoTrackSelection})),y=t.useSelector((function(e){return e.participant.audioTrackSelection})),b=t.useSelector((function(e){return e.participant.speakerTrackSelection})),E=e.useContext(ki),S=E.mediaTracks,w=S.webcamTrack,x=S.audioTrack,C=E.inputDevices,_=C.toggleAudioState,k=C.toggleVideoState,I=C.audioInputDevices,T=C.videoInputDevices,P=C.speakerOutputDevices,O=C.onAudioInputChange,D=C.onVideoInputChange,N=C.onSpeakerOutputChange,R="danger.500",M="text.400",L=t.useSelector((function(e){return e.participant.audioMuted})),z=t.useSelector((function(e){return e.participant.videoOff})),B=i.useDisclosure(),F=B.isOpen,j=B.onClose,V=B.onOpen,W=h>m,q=Wn()&&W;q&&(h=(n=[m,h])[0],m=n[1]);var H="rotate("+(q?-90:0)+"deg)",U=Math.floor(h/2)+"px "+Math.floor(h/2)+"px";return A.default.createElement(i.Flex,{direction:"column",bg:"secondary.1000",height:m,width:h,transform:H,transformOrigin:U},A.default.createElement(fa,{isOpen:F,onClose:j}),d.theme.header.is_enabled?A.default.createElement(da,{title:""!==o?o:a,linkCopied:u,copyLink:s,isMobile:g}):null,A.default.createElement(jo,{peers:[{isMe:!0,videoTrack:w,audioTrack:x,audioMuted:L,videoVisible:!z,metadata:null}],gridSize:1,waitingRoom:!0}),d.theme.waiting_room.enable_preview&&A.default.createElement(i.Box,{className:"dyte-client-noSelect"},A.default.createElement(i.Flex,{position:"absolute",bottom:"0",width:"100%",justify:"center"},A.default.createElement(i.Flex,null,A.default.createElement(pa,{onClick:_,icon:L?A.default.createElement(i.Icon,{as:l.MicOff,fill:R}):A.default.createElement(i.Icon,{as:l.Mic,fill:M}),label:L?"Mic Off":"Mic On",menu:[{title:"Input Microphone Device",options:I.map((function(e){return{children:e.label,key:e.deviceId,value:e.deviceId}})),defaultValue:null==y?void 0:y.selectedDeviceId,onChange:O},{title:"Output Speaker Device",options:P.map((function(e){return{children:e.label,key:e.deviceId,value:e.deviceId}})),defaultValue:null==b?void 0:b.selectedDeviceId,onChange:N}]}),A.default.createElement(pa,{onClick:k,icon:z?A.default.createElement(i.Icon,{as:l.VideocamOff,fill:R}):A.default.createElement(i.Icon,{as:l.Videocam,fill:M}),label:z?"Video Off":"Video On",menu:[{title:"Camera Device",options:T.map((function(e){return{children:A.default.createElement(A.default.Fragment,null,e.label),key:e.deviceId,value:e.deviceId}})),defaultValue:null==v?void 0:v.selectedDeviceId,onChange:D}]}),A.default.createElement(pa,{onClick:V,icon:A.default.createElement(i.Icon,{as:l.CallEnd,fill:R}),label:"Leave"})))))}var vl=function(){var n,r=t.useSelector((function(e){return e.room.socketState})),o=t.useSelector((function(e){return e.room.routerState})),a=t.useSelector((function(e){return e.producers.activeProducers})).reduce((function(e,t){return Math.min(e,t.score)}),10),c=e.useContext(Vr).sessionConfig,s=Et(),u=(null===(n=c.theme)||void 0===n?void 0:n.dimensions)||s,d=u.width,f=u.height,p=t.useSelector((function(e){return e.consumers.activeConsumers})),m=e.useState(""),h=m[0],g=m[1],v=e.useState(A.default.createElement(A.default.Fragment,null)),y=v[0],b=v[1],E=e.useRef(null),S=e.useState(0),w=S[0],C=S[1],_=e.useRef(null),k=x.useTranslation().t,I=function(){var e;p.length>0&&"connected"!==(null===(e=window.recvTransport)||void 0===e?void 0:e.connectionState)&&(g("We're facing issues connecting to the server."),b(A.default.createElement(i.Spinner,{size:"lg"}))),C((function(e){return e+1}))};return e.useEffect((function(){var e;if(_.current&&clearTimeout(_.current),p.length>0&&"connected"!==(null===(e=window.recvTransport)||void 0===e?void 0:e.connectionState)&&(E.current=setTimeout(I,1e4)),a<5||""!==h&&a<6){var t=Wn()?". Please join from a desktop browser":"";g("You seem to be facing internet issues"+t),b(A.default.createElement(i.AlertIcon,{boxSize:"1em",as:l.SignalCellularAlt,color:"danger.500"}))}else r===ee.DISCONNECTED?_.current=setTimeout((function(){g(k("Reconnecting")+" ..."),b(A.default.createElement(i.Spinner,{size:"lg"}))}),1e3):o!==$.LOADED?(g(k("Connecting")+"..."),b(A.default.createElement(i.Spinner,{size:"lg"}))):(g(""),b(A.default.createElement(A.default.Fragment,null)))}),[a,r,p.length,w,o]),h?A.default.createElement(i.Flex,{width:d,height:f,justifyContent:"center",alignItems:"flex-end",position:"absolute"},A.default.createElement(i.Alert,{status:"warning",padding:"0.75em 0.25em",width:"25em",opacity:"0.95",justifyContent:"center",borderRadius:"md",marginBottom:"5em",zIndex:"10"},y,A.default.createElement(i.AlertDescription,{lineHeight:"4",ml:4,color:"secondary.900"},h))):A.default.createElement(A.default.Fragment,null)},yl=function(n){var r=e.useState(null),o=r[0],a=r[1];return t.useSelector((function(e){return e.participant.peerId})),t.useSelector((function(e){return e.participant.displayName})),e.useEffect((function(){var e=function(){},t=Xr.onSafeInitialization((function(){K(void 0,void 0,void 0,(function(){return Z(this,(function(t){return e=Xr.onPreCallTestResults((function(e,t){var r=e,o=t;if(e.connectionInfo&&(r="success",(o=e.connectionInfo).rtt=1e3*o.RTT,o.jitter=0),"success"===r){var l={speedIcon:A.default.createElement(i.Icon,{as:zn,color:"warning.500"}),qualityIcon:A.default.createElement(i.Icon,{as:zn,color:"warning.500"})};void 0!==o.fractionalLoss&&void 0!==o.jitter&&void 0!==o.rtt&&(o.fractionalLoss<.01&&o.jitter<150&&o.rtt<150?l.qualityIcon=A.default.createElement(i.Icon,{as:Mn,color:"success.500"}):o.fractionalLoss<.04&&o.jitter<300&&o.rtt<300?l.qualityIcon=A.default.createElement(i.Icon,{as:Ln,color:"warning.500"}):l.qualityIcon=A.default.createElement(i.Icon,{as:Ln,color:"danger.500"})),void 0!==o.throughput&&(o.throughput>2e3?l.speedIcon=A.default.createElement(i.Icon,{as:Mn,color:"success.500"}):o.throughput>1e3?l.speedIcon=A.default.createElement(i.Icon,{as:Ln,color:"warning.500"}):l.speedIcon=A.default.createElement(i.Icon,{as:Ln,color:"danger.500"})),a(l),n.onComplete(l)}})),[2]}))}))})),r=setTimeout((function(){a((function(e){return e||{speedIcon:A.default.createElement(i.Icon,{as:zn,color:"warning.500"}),qualityIcon:A.default.createElement(i.Icon,{as:zn,color:"warning.500"})}}))}),6e3);return function(){var n;clearTimeout(r),Xr.removeInitializationListener(t),null===(n=Xr.backend)||void 0===n||n.eventHandler.removeListener("precall_end",e)}}),[]),Fr.hasFeature(mt.INTERNAL_CALL_STATS)?A.default.createElement(i.Box,{background:"secondary.800",px:4,py:1,borderRadius:5,userSelect:"none"},A.default.createElement(i.HStack,{justifyContent:"space-around",spacing:"0"},A.default.createElement(i.Text,null,"Network"),A.default.createElement(i.HStack,{background:"secondary.700",px:4,py:1,borderRadius:5,flexGrow:.5,justifyContent:"space-around",spacing:"4"},A.default.createElement(i.HStack,{spacing:"3"},A.default.createElement(i.Text,null,"Speed"),o?o.speedIcon:A.default.createElement(i.Spinner,{color:"text.100",boxSize:4})),A.default.createElement(i.HStack,{spacing:"3"},A.default.createElement(i.Text,null,"Quality"),o?o.qualityIcon:A.default.createElement(i.Spinner,{color:"text.100",boxSize:4}))))):null},bl=function(e){var t=e.children;return A.default.createElement(A.default.Fragment,null,t)},El=function(e){var t=e.modules,n=e.children;if(0===t.length)return A.default.createElement(A.default.Fragment,null,n);var r=t[0].contextComponent||bl,i=t.slice(1);return A.default.createElement(r,null,A.default.createElement(El,{modules:i},n))};function Sl(n){var r,o=e.useContext(Io).mediaRoom,a=t.useSelector((function(e){return e.participant.displayName})),l=t.useSelector((function(e){return e.participant.audioMuted})),c=t.useSelector((function(e){return e.room.routerState})),s=t.useSelector((function(e){return e.room.joined})),u=t.useSelector((function(e){return e.plugin.initialized})),d=t.useSelector((function(e){return e.room.waitingState})),f=n.roomName,p=e.useContext(Vr),m=p.sessionConfig,h=p.meeting,g=Et(),v=(null===(r=m.theme)||void 0===r?void 0:r.dimensions)||g,y=v.height,b=v.width;return e.useEffect((function(){c===$.LOADED&&(null==o||o.joinRoom(a,l))}),[c]),e.useEffect((function(){d===te.ACCEPTED&&(null==o||o.joinRoom(a,l))}),[d]),e.useEffect((function(){s&&u&&(null==h||h.emit(h.Events.meetingJoined))}),[s,u]),s?d===te.WAITING?A.default.createElement(gl,null):d===te.REJECTED?A.default.createElement(i.Stack,{height:y,width:b,backgroundColor:"#202124",justify:"center",align:"center"},A.default.createElement(i.Text,{color:"text.100",className:"dyte-client-noSelect"},"Host rejected you request")):A.default.createElement(hl,{roomName:f}):A.default.createElement(Qn,{text:"This seems to be taking too long...",showTextAfter:10,showReloadButton:!0})}function wl(n){var r,o,l=t.useDispatch(),c=n.roomName,s=n.autoTune,u=t.useSelector((function(e){return e.participant.peerId})),d=e.useContext(Vr),f=d.meeting,p=d.sessionConfig,m=d.updatePreset,h=e.useState(!0),g=h[0],v=h[1],y=a.useManualQuery("\nquery Session($roomName: String!, $password: String, $ipInformation: String) {\n\tsession(roomName: $roomName, password: $password) {\n\t  title,\n\t  roomNodeLink(ipInformation: $ipInformation),\n\t  roomName,\n\t  password\n\t}\n  }\n",{variables:{roomName:c,password:""}}),b=y[0],E=y[1],S=E.data,w=E.error,C=E.loading,_=x.useTranslation().t,k=Et(),I=(null===(r=p.theme)||void 0===r?void 0:r.dimensions)||k,T=I.height,P=I.width,O=e.useContext(a.ClientContext),D=e.useContext(ki),N=D.setupStreams,R=D.audioPermission,M=D.videoPermission,L=t.useSelector((function(e){return e.participant.authToken})),z=t.useSelector((function(e){return e.participant.displayName}));t.useSelector((function(e){return e.participant.email}));var B=t.useSelector((function(e){return e.participant.userFetchError}));t.useSelector((function(e){return e.participant.clientSpecificId}));var F=t.useSelector((function(e){return e.room.presetFetched})),j=e.useState(null);j[0];var V=j[1],W=i.useStyleConfig("Input",{variant:"primary"}),q=e.useRef(null),H=p.permissions.produce.video.allow,U=new URLSearchParams;"undefined"!=typeof window&&(U=new URLSearchParams(window.location.search));var G=function(){var e=function(e){var t="";try{e&&(t=JSON.stringify(e))}catch(e){jr.error("callstats_ip_failed",{})}O.setHeader("Authorization","Bearer "+L),b({variables:{roomName:c,password:"",ipInformation:t}})};Fr.hasFeature(mt.INTERNAL_CALL_STATS)?(q.current=setTimeout(e,3e3),Xr.onSafeInitialization((function(t){q.current&&clearTimeout(q.current),e(t)}))):e(null)},J=function(){v(!1),G()};if(e.useEffect((function(){l(Ne(c)),l(ae())}),[]),e.useEffect((function(){F&&N()}),[F]),e.useEffect((function(){M!==Si.INIT&&R!==Si.INIT&&(Fr.hasFeature(mt.INTERNAL_CALL_STATS)?(Xr.initialize(u,z),Xr.setRoomName(c)):Xr.stallCallStats())}),[M,R]),e.useEffect((function(){}),[S]),e.useEffect((function(){L&&L!==localStorage.getItem("dyte-authtoken")&&(f.showSetupScreen||G(),m(c,L))}),[L]),e.useEffect((function(){w&&(jr.error("graphql_error",{error:w}),w.graphQLErrors[0].message.indexOf("No open session")>=0&&(null==f||f._onError("MEETING_NOTFOUND")))}),[w,f]),Hn()&&!Zn())try{if(Number.parseFloat(Vn())<14.3)return A.default.createElement(Qn,{loading:!1,text:"This browser is not supported on this version of iOS, please update to iOS 14.3 or newer"})}catch(e){}if(Gn())return A.default.createElement(Qn,{loading:!1,text:"The current version of this browser is unsupported, please update the version or try another browser."});if(Jn()){var Y=jn();return A.default.createElement(Qn,{loading:!1,text:Y+" is not supported, please try another browser."})}if(B)return A.default.createElement(Qn,{loading:!1,text:"Error occured while fetching user. Error: "+B.code+" "+B.message});if(R===Si.INIT||M===Si.INIT)return A.default.createElement(Qn,{text:_("Waiting for permissions")+"..."});if(w){var K=w.graphQLErrors[0].message;return"UNAUTHORIZED"===K?(jr.trace("graphql_unauth"),A.default.createElement(Qn,{loading:!1,text:"You are not authorized to join this meeting"})):(null==K?void 0:K.indexOf("No open session"))>=0?A.default.createElement(Qn,{loading:!1,text:"The room is closed or doesn't exist. Please contact your adminstrator"}):A.default.createElement(Qn,{loading:!1,text:"Some error occured"})}return((null==f?void 0:f.showSetupScreen)||U.get("showSetupScreen"))&&g?A.default.createElement(i.Flex,{height:T,width:P,justifyContent:"center",backgroundColor:"secondary.1000"},A.default.createElement(ol,{scroll:!0,shouldSetupStreams:!1,height:T},A.default.createElement(i.Stack,{justifyContent:"center",width:T>600?[.8*P,.8*P,.4*P,.25*P]:"fit-content"},A.default.createElement(yl,{onComplete:function(e){return V(e)}}),z&&!p.permissions.can_edit_display_name&&A.default.createElement(A.default.Fragment,null,A.default.createElement(i.Text,{fontSize:"1.4em",color:"text.100",textAlign:"center"},_("Hi")," ",z)),p.permissions.can_edit_display_name&&A.default.createElement(A.default.Fragment,null,A.default.createElement(i.FormControl,null,A.default.createElement(i.HStack,{justifyContent:"space-between"},A.default.createElement(i.FormLabel,null,A.default.createElement(i.HStack,null,A.default.createElement(i.Text,null,_("Your name"))))),A.default.createElement(i.Input,{type:"text",sx:W,value:z,onChange:function(e){return l(kt(e.target.value))},autoComplete:"name",placeholder:"Steve Jobs",name:"displayName",autoFocus:!0,required:!0,isRequired:!0,onKeyDown:function(e){"Enter"===e.key&&""!==z.trim()&&J()}}))),T>500&&P>768&&A.default.createElement(i.Text,{mb:"20px !important",fontSize:"16",color:"text.300",textAlign:"center"},_(H?"check_audio_video":"check_audio")),A.default.createElement(i.Button,{autoFocus:!0,onClick:J},_("Join"))))):C?A.default.createElement(Qn,{text:"Starting Meeting..."}):A.default.createElement(po,{url:null===(o=null==S?void 0:S.session)||void 0===o?void 0:o.roomNodeLink,roomURL:c,peerId:u},A.default.createElement(To,{peerId:u,roomName:c,autoTune:s},A.default.createElement(So,null,A.default.createElement(Ho,{roomName:c,peerId:u},A.default.createElement(El,{modules:f.modules.getAll()},A.default.createElement(vl,null),A.default.createElement(Sl,{roomName:c}))))))}wl.defaultProps={autoTune:!0};var xl,Cl=function(e){function t(t){var n=e.call(this,t)||this;return n.state={hasError:!1},n}return U(t,e),t.getDerivedStateFromError=function(e){return{hasError:!0}},t.prototype.componentDidCatch=function(e){jr.error("caught_boundary_error",e)},t.prototype.render=function(){return this.state.hasError?A.default.createElement(Qn,{text:"Something went wrong.."}):this.props.children},t}(A.default.Component),_l=function(r){var i=r.clientId,o=r.uiConfig,l=r.onInit,c=r.onError,s=r.lang,u=r.useShadowDom,d=r.meetingConfig,f=e.useState(null),p=f[0],m=f[1],h=e.useState(null),g=h[0],v=h[1],y=e.useState(!1),b=y[0],E=y[1];return d||(d={roomName:"",authToken:""}),e.useEffect((function(){var e,t={clientId:i,authToken:d.authToken,roomName:d.roomName,endpoints:[],lang:s};d.devicePreferences&&(t.devicePreferences=d.devicePreferences),(null==d?void 0:d.apiBase)&&dn(d.apiBase);var r=new ko(t,o);xl=r,r.showSetupScreen=null===(e=d.showSetupScreen)||void 0===e||e;var a=n.nanoid();jr.trace("renderKey",a),v(a),m(r),r.on(r.Events.meetingEnded,(function(){return E(!0)})),r.onError((function(e){return c(e)})),l(r)}),[d.roomName,d.authToken,d.apiBase]),!p||b?null:A.default.createElement("div",{className:"dyte-client dyte-client-root",key:g},A.default.createElement("link",{rel:"stylesheet",href:"https://fonts.googleapis.com/css?family=Inter:400,500,600|Lato:300,400,600"}),A.default.createElement(Co,{useShadowDom:u},A.default.createElement("div",{id:"dyte-base-elem"},A.default.createElement(Cl,null,A.default.createElement(t.Provider,{store:Dn},A.default.createElement(a.ClientContext.Provider,{value:Nn(p.connectionConfig.apiBase)},A.default.createElement(Wr,{meeting:p},A.default.createElement(Ii,null,A.default.createElement(wl,{roomName:d.roomName,autoTune:void 0===d.autoTune||d.autoTune})))))))))};function kl(e,t){function n(e){return null!=e&&"object"==typeof e}var r=Object.keys(e||{}),i=Object.keys(t||{});if(r.length!==i.length)return!1;for(var o=0,a=r;o<a.length;o++){var l=e[d=a[o]],c=t[d];if((f=n(l)&&n(c))&&!kl(l,c)||!f&&l!==c)return!1}for(var s=0,u=i;s<u.length;s++){var d,f;l=e[d=u[s]],c=t[d];if((f=n(l)&&n(c))&&!kl(l,c)||!f&&l!==c)return!1}return!0}_l.defaultProps={uiConfig:null,onError:function(e){},lang:null,useShadowDom:!1};var Il,Tl=Object.assign(A.default.memo(_l,(function(e,t){return!!kl(t.meetingConfig,e.meetingConfig)&&(kl(t.uiConfig,e.uiConfig)||xl&&xl.updateUIConfig(t.uiConfig),!0)})),{version:"0.37.0"});!function(e){e.CLIENTID_INVALID="CLIENTID_INVALID",e.MEETING_UNAUTHORIZED="MEETING_UNAUTHORIZED",e.MEETING_NOTFOUND="MEETING_NOTFOUND"}(Il||(Il={}));var Pl=Il;exports.DyteErrors=Pl,exports.DyteMeeting=Tl,exports.Meeting=ko;
